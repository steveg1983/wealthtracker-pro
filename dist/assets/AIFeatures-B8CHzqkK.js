function e(){const{transactions:e,categories:t}=i(),s=k(),[a,y]=S.useState([]),[b,f]=S.useState(!0),[v,j]=S.useState(D.getConfig()),[N,w]=S.useState(!1),[A,M]=S.useState(null);S.useEffect(()=>{$()},[e,t]);const $=async()=>{f(!0);try{const s=await D.detectAnomalies(e,t);y(s),D.saveAnomalies(s)}finally{f(!1)}},C=e=>{D.dismissAnomaly(e),y(a.filter(t=>t.id!==e))},T=e=>{switch(e){case"unusual_amount":return r.jsx(p,{size:16});case"frequency_spike":return r.jsx(x,{size:16});case"new_merchant":return r.jsx(u,{size:16});case"category_overspend":default:return r.jsx(g,{size:16});case"time_pattern":return r.jsx(h,{size:16});case"duplicate_charge":return r.jsx(m,{size:16})}},E=e=>{switch(e){case"low":return"text-yellow-600 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/20";case"medium":return"text-orange-600 dark:text-orange-400 bg-orange-50 dark:bg-orange-900/20";case"high":return"text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20"}},_=D.getAnomalyStats(a);return b?r.jsx("div",{className:"flex items-center justify-center h-64",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"bg-gradient-to-r from-red-500 to-orange-500 rounded-2xl p-6 text-white",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Anomaly Detection"}),r.jsx("p",{className:"text-red-100",children:"AI-powered detection of unusual financial patterns and potential issues"})]}),r.jsx("button",{onClick:()=>w(!N),className:"p-2 bg-white/20 rounded-lg hover:bg-white/30 transition-colors",children:r.jsx(o,{size:20})})]}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[r.jsxs("div",{className:"bg-white/20 rounded-lg p-3",children:[r.jsx("p",{className:"text-3xl font-bold",children:_.total}),r.jsx("p",{className:"text-sm text-red-100",children:"Total Anomalies"})]}),r.jsxs("div",{className:"bg-white/20 rounded-lg p-3",children:[r.jsx("p",{className:"text-3xl font-bold",children:_.bySeverity.high||0}),r.jsx("p",{className:"text-sm text-red-100",children:"High Severity"})]}),r.jsxs("div",{className:"bg-white/20 rounded-lg p-3",children:[r.jsx("p",{className:"text-3xl font-bold",children:_.bySeverity.medium||0}),r.jsx("p",{className:"text-sm text-red-100",children:"Medium Severity"})]}),r.jsxs("div",{className:"bg-white/20 rounded-lg p-3",children:[r.jsxs("p",{className:"text-3xl font-bold",children:["$",_.totalAmount.toFixed(0)]}),r.jsx("p",{className:"text-sm text-red-100",children:"Total Amount"})]})]})]}),N&&r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Detection Settings"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sensitivity Level"}),r.jsx("div",{className:"flex gap-2",children:["low","medium","high"].map(e=>r.jsx("button",{onClick:()=>(e=>{const t={...v,sensitivityLevel:e};j(t),D.saveConfig(t)})(e),className:"px-4 py-2 rounded-lg capitalize "+(v.sensitivityLevel===e?"bg-indigo-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:e},e))})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Detection Types"}),r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:[{type:"unusual_amount",label:"Unusual Amounts"},{type:"frequency_spike",label:"Frequency Spikes"},{type:"new_merchant",label:"New Merchants"},{type:"category_overspend",label:"Category Overspending"},{type:"time_pattern",label:"Time Patterns"},{type:"duplicate_charge",label:"Duplicate Charges"}].map(({type:e,label:t})=>r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:v.enabledTypes.has(e),onChange:()=>(e=>{const t=new Set(v.enabledTypes);t.has(e)?t.delete(e):t.add(e);const s={...v,enabledTypes:t};j(s),D.saveConfig(s)})(e),className:"rounded text-indigo-600"}),r.jsx("span",{className:"text-sm",children:t})]},e))})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Lookback Period"}),r.jsxs("select",{value:v.lookbackMonths,onChange:e=>{const t={...v,lookbackMonths:Number(e.target.value)};j(t),D.saveConfig(t)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[r.jsx("option",{value:1,children:"1 month"}),r.jsx("option",{value:3,children:"3 months"}),r.jsx("option",{value:6,children:"6 months"}),r.jsx("option",{value:12,children:"12 months"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Auto Alert"}),r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:v.autoAlert,onChange:e=>{const t={...v,autoAlert:e.target.checked};j(t),D.saveConfig(t)},className:"rounded text-indigo-600"}),r.jsx("span",{className:"text-sm",children:"Send notifications for new anomalies"})]})]})]}),r.jsx("button",{onClick:$,className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:"Re-run Detection"})]})]}),0===a.length?r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-8 text-center",children:[r.jsx(d,{className:"mx-auto text-green-500 mb-3",size:48}),r.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Anomalies Detected"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Your financial activity looks normal. We'll keep monitoring for any unusual patterns."})]}):r.jsx("div",{className:"space-y-3",children:a.map(e=>r.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-4 hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>M(e),children:r.jsxs("div",{className:"flex items-start gap-4",children:[r.jsx("div",{className:`p-2 rounded-lg ${E(e.severity)}`,children:T(e.type)}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:e.title}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.description}),e.suggestedAction&&r.jsxs("p",{className:"text-sm text-indigo-600 dark:text-indigo-400 mt-2",children:[r.jsx(c,{size:14,className:"inline mr-1"}),e.suggestedAction]})]}),r.jsx("button",{onClick:t=>{t.stopPropagation(),C(e.id)},className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",title:"Dismiss",children:r.jsx(l,{size:16})})]}),r.jsxs("div",{className:"flex items-center gap-4 mt-3 text-xs text-gray-500 dark:text-gray-400",children:[r.jsx("span",{className:`px-2 py-1 rounded-full ${E(e.severity)}`,children:e.severity}),e.amount&&r.jsxs("span",{children:["$",e.amount.toFixed(2)]}),e.merchant&&r.jsx("span",{children:e.merchant}),e.category&&r.jsx("span",{children:t.find(t=>t.id===e.category)?.name||e.category}),r.jsx("span",{children:n(e.detectedAt,"MMM d, h:mm a")})]})]})]})},e.id))}),A&&r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-lg w-full p-6",children:[r.jsxs("div",{className:"flex items-start justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`p-2 rounded-lg ${E(A.severity)}`,children:T(A.type)}),r.jsx("h3",{className:"text-lg font-semibold",children:A.title})]}),r.jsx("button",{onClick:()=>M(null),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:r.jsx(l,{size:20})})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:A.description}),A.suggestedAction&&r.jsxs("div",{className:"bg-indigo-50 dark:bg-indigo-900/20 p-3 rounded-lg",children:[r.jsx("p",{className:"text-sm font-medium text-indigo-900 dark:text-indigo-200 mb-1",children:"Suggested Action"}),r.jsx("p",{className:"text-sm text-indigo-700 dark:text-indigo-300",children:A.suggestedAction})]}),r.jsxs("div",{className:"flex gap-3",children:[A.transactionId&&r.jsx("button",{onClick:()=>{var e;(e=A.transactionId)&&s(`/transactions?highlight=${e}`),M(null)},className:"flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:"View Transaction"}),A.transactions&&A.transactions.length>0&&r.jsxs("button",{onClick:()=>{s(`/transactions?ids=${A.transactions?.join(",")}`),M(null)},className:"flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:["View ",A.transactions.length," Transactions"]}),r.jsx("button",{onClick:()=>{C(A.id),M(null)},className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600",children:"Dismiss"})]})]})]})})]})}function t(){const{transactions:e,categories:t,budgets:s,updateBudget:a,addBudget:n}=i(),{formatCurrency:l}=E(),[m,h]=S.useState(null),[u,p]=S.useState(!0),[j,N]=S.useState(!1),[w,k]=S.useState(new Set),[A,M]=S.useState(_.getConfig());S.useEffect(()=>{$()},[e,t,s]);const $=()=>{p(!0);try{const a=_.analyzeBudgets(e,t,s);h(a)}finally{p(!1)}},C=(e,t)=>{const s={...A,[e]:t};M(s),_.saveConfig(s),setTimeout($,100)};return u?r.jsx("div",{className:"flex items-center justify-center h-64",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):m?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-500 rounded-2xl p-6 text-white",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Budget Recommendations"}),r.jsx("p",{className:"text-indigo-100",children:"AI-powered budget optimization based on your spending patterns"})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>N(!j),className:"p-2 bg-white/20 rounded-lg hover:bg-white/30 transition-colors",title:"Settings",children:r.jsx(o,{size:20})}),r.jsx("button",{onClick:()=>{if(!m)return;const e=_.exportRecommendations(m),t=new Blob([e],{type:"text/plain"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`budget-recommendations-${(new Date).toISOString().split("T")[0]}.txt`,a.click(),URL.revokeObjectURL(s)},className:"p-2 bg-white/20 rounded-lg hover:bg-white/30 transition-colors",title:"Export Report",children:r.jsx(y,{size:20})})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[r.jsxs("div",{className:"bg-white/20 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-sm text-indigo-100",children:"Budget Health"}),r.jsx("span",{className:"text-2xl",children:(T=m.score,T>=80?"\ud83c\udfaf":T>=60?"\ud83d\udcca":"\u26a0\ufe0f")})]}),r.jsxs("p",{className:`text-3xl font-bold ${(e=>e>=80?"text-green-600 dark:text-green-400":e>=60?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400")(m.score)}`,children:[m.score,"/100"]})]}),r.jsxs("div",{className:"bg-white/20 rounded-lg p-4",children:[r.jsx("p",{className:"text-sm text-indigo-100 mb-2",children:"Current Budget"}),r.jsx("p",{className:"text-2xl font-bold",children:l(m.totalCurrentBudget)})]}),r.jsxs("div",{className:"bg-white/20 rounded-lg p-4",children:[r.jsx("p",{className:"text-sm text-indigo-100 mb-2",children:"Recommended"}),r.jsx("p",{className:"text-2xl font-bold",children:l(m.totalRecommendedBudget)})]}),r.jsxs("div",{className:"bg-white/20 rounded-lg p-4",children:[r.jsx("p",{className:"text-sm text-indigo-100 mb-2",children:"Potential Savings"}),r.jsx("p",{className:"text-2xl font-bold text-green-300",children:l(m.totalPotentialSavings)})]})]})]}),j&&r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Recommendation Settings"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Analysis Period"}),r.jsxs("select",{value:A.lookbackMonths,onChange:e=>C("lookbackMonths",Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[r.jsx("option",{value:3,children:"Last 3 months"}),r.jsx("option",{value:6,children:"Last 6 months"}),r.jsx("option",{value:12,children:"Last 12 months"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Recommendation Style"}),r.jsxs("select",{value:A.aggressiveness,onChange:e=>C("aggressiveness",e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[r.jsx("option",{value:"conservative",children:"Conservative (75th percentile)"}),r.jsx("option",{value:"moderate",children:"Moderate (65th percentile)"}),r.jsx("option",{value:"aggressive",children:"Aggressive (50th percentile)"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Minimum Confidence"}),r.jsxs("select",{value:A.minConfidence,onChange:e=>C("minConfidence",Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[r.jsx("option",{value:.6,children:"60%"}),r.jsx("option",{value:.7,children:"70%"}),r.jsx("option",{value:.8,children:"80%"}),r.jsx("option",{value:.9,children:"90%"})]})]}),r.jsx("div",{className:"flex items-center gap-4",children:r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:A.includeSeasonality,onChange:e=>C("includeSeasonality",e.target.checked),className:"rounded text-indigo-600"}),r.jsx("span",{className:"text-sm",children:"Include seasonal adjustments"})]})})]})]}),m.insights.length>0&&r.jsxs("div",{className:"space-y-3",children:[r.jsx("h3",{className:"text-lg font-semibold",children:"Insights"}),m.insights.map((e,t)=>r.jsx("div",{className:"p-4 rounded-lg border "+("positive"===e.impact?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"negative"===e.impact?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800"),children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"mt-0.5",children:"achievement"===e.type?r.jsx(d,{size:20,className:"text-green-600 dark:text-green-400"}):"opportunity"===e.type?r.jsx(b,{size:20,className:"text-blue-600 dark:text-blue-400"}):r.jsx(g,{size:20,className:"text-yellow-600 dark:text-yellow-400"})}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:e.title}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.description})]})]})},t))]}),m.recommendations.length>0&&r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h3",{className:"text-lg font-semibold",children:"Recommendations"}),w.size>0&&r.jsxs("button",{onClick:()=>{const e=m?.recommendations.filter(e=>w.has(e.categoryId))||[];_.applyRecommendations(e).forEach(({categoryId:e,amount:i})=>{const r=s.find(t=>t.category===e),o=t.find(t=>t.id===e);r?a(r.id,{amount:i}):o&&n({name:`${o.name} Budget`,category:e,amount:i,period:"monthly",rollover:!1,notifications:!0})}),k(new Set),setTimeout($,100)},className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:["Apply ",w.size," Selected"]})]}),m.recommendations.map(e=>r.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-4",children:r.jsxs("div",{className:"flex items-start gap-4",children:[r.jsx("input",{type:"checkbox",checked:w.has(e.categoryId),onChange:t=>{const s=new Set(w);t.target.checked?s.add(e.categoryId):s.delete(e.categoryId),k(s)},className:"mt-1 rounded text-indigo-600"}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:e.categoryName}),r.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-gray-500",children:"Current:"}),r.jsx("span",{className:"font-medium",children:e.currentBudget?l(e.currentBudget):"No budget"})]}),r.jsx(f,{size:16,className:"text-gray-400"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-gray-500",children:"Recommended:"}),r.jsx("span",{className:"font-medium text-indigo-600 dark:text-indigo-400",children:l(e.recommendedBudget)})]})]})]}),r.jsx("button",{onClick:()=>(e=>{const t=s.find(t=>t.category===e.categoryId);t?a(t.id,{amount:e.recommendedBudget}):n({name:`${e.categoryName} Budget`,category:e.categoryId,amount:e.recommendedBudget,period:"monthly",rollover:!1,notifications:!0}),setTimeout($,100)})(e),className:"px-3 py-1 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded-lg hover:bg-indigo-200 dark:hover:bg-indigo-900/50 transition-colors",children:"Apply"})]}),r.jsxs("div",{className:"mt-3 space-y-2",children:[r.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("span",{children:"Avg spending:"}),r.jsx("span",{className:"font-medium",children:l(e.averageSpending)})]}),r.jsxs("div",{className:"flex items-center gap-1",children:["increasing"===e.spendingTrend?r.jsx(x,{size:14,className:"text-red-500"}):"decreasing"===e.spendingTrend?r.jsx(v,{size:14,className:"text-green-500"}):null,r.jsxs("span",{children:[e.spendingTrend," ",e.trendPercentage,"%"]})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("span",{children:"Confidence:"}),r.jsxs("span",{className:"font-medium",children:[Math.round(100*e.confidence),"%"]})]})]}),r.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[r.jsx(c,{size:14,className:"inline mr-1"}),e.reasoning]}),e.potentialSavings&&r.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400 font-medium",children:[r.jsx(b,{size:14,className:"inline mr-1"}),"Potential savings: ",l(e.potentialSavings),"/month"]})]})]})]})},e.categoryId))]}),0===m.recommendations.length&&r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-8 text-center",children:[r.jsx(d,{className:"mx-auto text-green-500 mb-3",size:48}),r.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Recommendations Available"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Your budgets are well-aligned with your spending patterns!"})]})]}):r.jsx("div",{className:"text-center py-8",children:r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No budget analysis available"})});var T}function s(){const[s,a]=S.useState("categorization");return r.jsx(A,{title:"AI-Powered Features",rightContent:r.jsx("div",{className:"cursor-pointer",title:"AI-Powered Features",children:r.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",className:"transition-all duration-200 hover:scale-110 drop-shadow-lg hover:drop-shadow-xl",style:{filter:"drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1))"},children:[r.jsx("defs",{children:r.jsxs("linearGradient",{id:"ai-gradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[r.jsx("stop",{offset:"0%",stopColor:"#A78BFA"}),r.jsx("stop",{offset:"100%",stopColor:"#7C3AED"})]})}),r.jsx("circle",{cx:"24",cy:"24",r:"24",fill:"url(#ai-gradient)"}),r.jsx("g",{transform:"translate(12, 12)",children:r.jsx(w,{size:24,className:"text-white"})})]})}),children:r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-1 flex",children:[r.jsxs("button",{onClick:()=>a("categorization"),className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg transition-colors "+("categorization"===s?"bg-indigo-600 text-white":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[r.jsx(j,{size:20}),r.jsx("span",{className:"font-medium",children:"Smart Categorization"})]}),r.jsxs("button",{onClick:()=>a("anomalies"),className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg transition-colors "+("anomalies"===s?"bg-red-600 text-white":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[r.jsx(g,{size:20}),r.jsx("span",{className:"font-medium",children:"Anomaly Detection"})]}),r.jsxs("button",{onClick:()=>a("budgets"),className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg transition-colors "+("budgets"===s?"bg-purple-600 text-white":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[r.jsx(N,{size:20}),r.jsx("span",{className:"font-medium",children:"Budget Recommendations"})]})]}),r.jsxs("div",{children:["categorization"===s&&r.jsx(M,{}),"anomalies"===s&&r.jsx(e,{}),"budgets"===s&&r.jsx(t,{})]})]})})}import{aP as a,ab as n,g as i,j as r,N as o,_ as d,ah as c,X as l,aV as g,aG as m,aZ as h,e as u,T as x,aB as p,aS as y,H as b,aA as f,J as v,aR as j,aL as N,aY as w}from"./index-CgJz7Gw0.js";import{w as k,a as S}from"./chunk-BWx9oMeS.js";import{P as A}from"./chunk-DLeAFLQD.js";import M from"./SmartCategorizationSettings-BT3KqbBd.js";import{s as $}from"./chunk-BcvNNmv9.js";import{s as C}from"./chunk-Bz0sHhCn.js";import{d as T}from"./chunk-qSphH5g5.js";import{u as E}from"./chunk-Tf-3Dz44.js";import"./chunk-BN8kgYrt.js";import"./chunk-C1eKK5Oc.js";import"./chunk-CkYa08k9.js";const D=new class{STORAGE_KEY="money_management_anomaly_config";ANOMALIES_KEY="money_management_detected_anomalies";THRESHOLDS={low:{amountDeviation:3,frequencyIncrease:2,categoryOverspend:1.5},medium:{amountDeviation:2.5,frequencyIncrease:1.5,categoryOverspend:1.3},high:{amountDeviation:2,frequencyIncrease:1.3,categoryOverspend:1.2}};getConfig(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(e){const t=JSON.parse(e);return t.enabledTypes=new Set(t.enabledTypes),t}}catch(e){console.error("Failed to load anomaly detection config:",e)}return{enabledTypes:new Set(["unusual_amount","frequency_spike","new_merchant","category_overspend"]),sensitivityLevel:"medium",lookbackMonths:3,minTransactionHistory:30,autoAlert:!0}}saveConfig(e){const t=this.getConfig(),s={...t,...e,enabledTypes:e.enabledTypes?Array.from(e.enabledTypes):Array.from(t.enabledTypes)};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(s))}async detectAnomalies(e,t){const s=this.getConfig(),a=[],n=C(new Date,s.lookbackMonths),i=e.filter(e=>new Date(e.date)>=n);if(i.length<s.minTransactionHistory)return[];const r=[...i].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime());s.enabledTypes.has("unusual_amount")&&a.push(...this.detectUnusualAmounts(r,s)),s.enabledTypes.has("frequency_spike")&&a.push(...this.detectFrequencySpikes(r,s)),s.enabledTypes.has("new_merchant")&&a.push(...this.detectNewMerchants(r,e)),s.enabledTypes.has("category_overspend")&&a.push(...this.detectCategoryOverspend(r,t,s)),s.enabledTypes.has("time_pattern")&&a.push(...this.detectTimePatternAnomalies(r)),s.enabledTypes.has("duplicate_charge")&&a.push(...this.detectDuplicateCharges(r));const o=this.getSavedAnomalies(),d=new Set(o.filter(e=>e.dismissed).map(e=>e.id));return a.filter(e=>!d.has(e.id))}detectUnusualAmounts(e,t){const s=[],a=this.THRESHOLDS[t.sensitivityLevel].amountDeviation,n=new Map;return e.forEach(e=>{if("expense"===e.type){const t=n.get(e.category)||[];t.push(e),n.set(e.category,t)}}),n.forEach((e,t)=>{if(e.length<5)return;const n=e.map(e=>Math.abs(e.amount)),i=n.reduce((e,t)=>e+t,0)/n.length,r=n.reduce((e,t)=>e+Math.pow(t-i,2),0)/n.length,o=Math.sqrt(r);e.forEach(e=>{const n=Math.abs(e.amount),r=Math.abs((n-i)/o);if(r>a){const a=r>4?"high":r>3?"medium":"low";s.push({id:`unusual-amount-${e.id}`,type:"unusual_amount",severity:a,transactionId:e.id,title:"Unusual Transaction Amount",description:`${e.description} - $${n.toFixed(2)} is ${r.toFixed(1)} standard deviations from your typical ${t} spending`,detectedAt:new Date,amount:n,category:t,merchant:this.extractMerchant(e.description),suggestedAction:"Review this transaction to ensure it's correct"})}})}),s}detectFrequencySpikes(e,t){const s=[],a=this.THRESHOLDS[t.sensitivityLevel].frequencyIncrease,n=new Map;return e.forEach(e=>{if("expense"===e.type){const t=this.extractMerchant(e.description),s=n.get(t)||[];s.push(e),n.set(t,s)}}),n.forEach((e,t)=>{if(e.length<3)return;const n=[...e].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()),i=[];for(let s=1;s<n.length-1;s++){const e=T(new Date(n[s].date),new Date(n[s-1].date));i.push(e)}const r=i.reduce((e,t)=>e+t,0)/i.length,o=T(new Date(n[n.length-1].date),new Date(n[n.length-2].date));if(o<r/a){const e=n.slice(-3);s.push({id:`frequency-spike-${t}-${Date.now()}`,type:"frequency_spike",severity:o<r/(1.5*a)?"high":"medium",transactions:e.map(e=>e.id),title:"Unusual Frequency Increase",description:`You've made ${e.length} purchases at ${t} in ${o} days, much more frequent than your usual ${r.toFixed(0)} day interval`,detectedAt:new Date,merchant:t,suggestedAction:"Check for duplicate charges or subscription changes"})}}),s}detectNewMerchants(e,t){const s=[],a=new Set,n=C(new Date,6);t.filter(e=>new Date(e.date)<n).forEach(e=>{a.add(this.extractMerchant(e.description))});const i=new Map;return e.filter(e=>"expense"===e.type).forEach(e=>{const t=this.extractMerchant(e.description);if(!a.has(t)){const s=i.get(t)||{amount:0,count:0,transactions:[]};s.amount+=Math.abs(e.amount),s.count++,s.transactions.push(e.id),i.set(t,s)}}),i.forEach((e,t)=>{(e.amount>100||e.count>2)&&s.push({id:`new-merchant-${t.replace(/\s+/g,"-")}`,type:"new_merchant",severity:e.amount>500?"high":e.amount>200?"medium":"low",transactions:e.transactions,title:"New Merchant Detected",description:`First time purchasing from ${t} - ${e.count} transaction(s) totaling $${e.amount.toFixed(2)}`,detectedAt:new Date,amount:e.amount,merchant:t,suggestedAction:"Verify this is a legitimate merchant and these charges are authorized"})}),s}detectCategoryOverspend(e,t,s){const i=[],r=this.THRESHOLDS[s.sensitivityLevel].categoryOverspend,o=new Date,d=$(o),c=a(o),l=new Map,g=new Map;e.filter(e=>{const t=new Date(e.date);return"expense"===e.type&&t>=d&&t<=c}).forEach(e=>{const t=l.get(e.category)||0;l.set(e.category,t+Math.abs(e.amount))});const m=new Map;for(let n=1;n<=3;n++){const t=$(C(o,n)),s=a(C(o,n)),i=new Map;e.filter(e=>{const a=new Date(e.date);return"expense"===e.type&&a>=t&&a<=s}).forEach(e=>{const t=i.get(e.category)||0;i.set(e.category,t+Math.abs(e.amount))}),i.forEach((e,t)=>{const s=m.get(t)||[];s.push(e),m.set(t,s)})}return m.forEach((e,t)=>{const s=e.reduce((e,t)=>e+t,0)/e.length;g.set(t,s)}),l.forEach((e,s)=>{const a=g.get(s)||0;if(a>0&&e>a*r){const r=t.find(e=>e.id===s),d=(e-a)/a*100;i.push({id:`overspend-${s}-${n(o,"yyyy-MM")}`,type:"category_overspend",severity:d>100?"high":d>50?"medium":"low",title:"Category Overspending",description:`${r?.name||s} spending is ${d.toFixed(0)}% higher than your 3-month average`,detectedAt:new Date,amount:e,category:s,suggestedAction:`Review ${r?.name||s} expenses and consider adjusting your budget`})}}),i}detectTimePatternAnomalies(e){const t=[],s=[];return e.filter(e=>"expense"===e.type).forEach(e=>{const t=new Date(e.date),a=t.getHours();t.getDay(),a>=0&&a<5&&s.push(e)}),s.length>0&&t.push({id:`time-pattern-${Date.now()}`,type:"time_pattern",severity:s.length>3?"high":"medium",transactions:s.map(e=>e.id),title:"Unusual Transaction Times",description:`${s.length} transaction(s) occurred during unusual hours (midnight-5AM)`,detectedAt:new Date,suggestedAction:"Verify these late-night transactions are legitimate"}),t}detectDuplicateCharges(e){const t=[],s=new Map;return e.filter(e=>"expense"===e.type).forEach(e=>{const t=`${this.extractMerchant(e.description)}-${Math.abs(e.amount).toFixed(2)}`,a=s.get(t)||[];a.push(e),s.set(t,a)}),s.forEach((e,s)=>{if(!(e.length<2))for(let a=0;a<e.length-1;a++)for(let s=a+1;s<e.length;s++){const n=Math.abs(T(new Date(e[a].date),new Date(e[s].date)));n<=3&&t.push({id:`duplicate-${e[a].id}-${e[s].id}`,type:"duplicate_charge",severity:"high",transactions:[e[a].id,e[s].id],title:"Possible Duplicate Charge",description:`Two identical charges of $${Math.abs(e[a].amount).toFixed(2)} at ${this.extractMerchant(e[a].description)} within ${n} days`,detectedAt:new Date,amount:Math.abs(e[a].amount),merchant:this.extractMerchant(e[a].description),suggestedAction:"Check if one of these is a duplicate charge and contact the merchant if needed"})}}),t}extractMerchant(e){return e.replace(/[#*]/g,"").replace(/\d{4,}/g,"").replace(/\s+/g," ").trim().split(" ").slice(0,3).join(" ")}saveAnomalies(e){localStorage.setItem(this.ANOMALIES_KEY,JSON.stringify(e))}getSavedAnomalies(){try{const e=localStorage.getItem(this.ANOMALIES_KEY);return e?JSON.parse(e):[]}catch{return[]}}dismissAnomaly(e){const t=this.getSavedAnomalies(),s=t.find(t=>t.id===e);s&&(s.dismissed=!0,this.saveAnomalies(t))}getAnomalyStats(e){const t={total:e.length,byType:{},bySeverity:{},totalAmount:0};return e.forEach(e=>{t.byType[e.type]=(t.byType[e.type]||0)+1,t.bySeverity[e.severity]=(t.bySeverity[e.severity]||0)+1,e.amount&&(t.totalAmount+=e.amount)}),t}},_=new class{STORAGE_KEY="budget_recommendation_config";PERCENTILES={conservative:.75,moderate:.65,aggressive:.5};SEASONAL_FACTORS={Gifts:{11:2.5,0:2},Travel:{5:1.3,6:1.5,7:1.5},Utilities:{0:1.3,1:1.3,6:1.2,7:1.2},Entertainment:{11:1.2}};getConfig(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(e)return JSON.parse(e)}catch(e){console.error("Failed to load recommendation config:",e)}return{lookbackMonths:6,includeSeasonality:!0,aggressiveness:"moderate",minConfidence:.7,considerGoals:!0}}saveConfig(e){const t={...this.getConfig(),...e};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}analyzeBudgets(e,t,s){const a=this.getConfig(),n=[],i=[],r=this.analyzeCategorySpending(e,a.lookbackMonths);t.forEach(e=>{const t=r.get(e.id);if(!t||t.months.length<3)return;const i=s.find(t=>t.category===e.id),o=this.generateRecommendation(e,t,i,a);o.confidence>=a.minConfidence&&n.push(o)}),n.sort((e,t)=>{const s={high:3,medium:2,low:1},a=s[t.priority]-s[e.priority];return 0!==a?a:(t.potentialSavings||0)-(e.potentialSavings||0)}),i.push(...this.generateInsights(e,t,s,n));const o=s.reduce((e,t)=>e+t.amount,0),d=n.reduce((e,t)=>e+t.recommendedBudget,0),c=n.reduce((e,t)=>e+(t.potentialSavings||0),0),l=this.calculateBudgetHealthScore(s,e,n);return{totalCurrentBudget:o,totalRecommendedBudget:d,totalPotentialSavings:c,recommendations:n,insights:i,score:l}}analyzeCategorySpending(e,t){const s=new Map,n=new Date;for(let i=0;i<t;i++){const t=$(C(n,i)),r=a(C(n,i)),o=e.filter(e=>{const s=new Date(e.date);return"expense"===e.type&&s>=t&&s<=r}),d=new Map;o.forEach(e=>{const t=d.get(e.category)||0;d.set(e.category,t+Math.abs(e.amount))}),d.forEach((e,a)=>{const n=s.get(a)||{months:[],amounts:[],total:0};n.months.push(t),n.amounts.push(e),n.total+=e,s.set(a,n)})}return s}generateRecommendation(e,t,s,a){const n=[...t.amounts].sort((e,t)=>e-t),i=t.total/t.amounts.length,r=this.PERCENTILES[a.aggressiveness];let o=n[Math.floor(n.length*r)]||i;a.includeSeasonality&&(o=this.applySeasonalAdjustment(e.name,o,new Date));const d=this.calculateTrend(t.amounts);"increasing"===d.direction&&d.percentage>10&&(o*=1+d.percentage/200),o=5*Math.ceil(o/5);const c=this.calculateStdDev(n)/i,l=Math.max(.5,Math.min(1,1-c));let g="medium";const m=s?.amount||0,h=Math.abs(o-m),u=m>0?h/m*100:100;u>30||0===m&&i>100?g="high":u<10&&(g="low");const x=m>o?m-o:0,p=this.generateReasoning(e.name,m,o,i,d,a);return{categoryId:e.id,categoryName:e.name,currentBudget:m||void 0,recommendedBudget:o,averageSpending:i,spendingTrend:d.direction,trendPercentage:d.percentage,confidence:l,reasoning:p,priority:g,potentialSavings:x>0?x:void 0}}calculateTrend(e){if(e.length<2)return{direction:"stable",percentage:0};const t=e.length,s=e.map((e,t)=>t),a=s.reduce((e,t)=>e+t,0),n=e.reduce((e,t)=>e+t,0),i=(t*s.reduce((t,s,a)=>t+s*e[a],0)-a*n)/(t*s.reduce((e,t)=>e+t*t,0)-a*a),r=n/t,o=Math.abs(i/r*100*t);let d;return d=i>.05*r?"increasing":i<.05*-r?"decreasing":"stable",{direction:d,percentage:Math.round(o)}}calculateStdDev(e){const t=e.reduce((e,t)=>e+t,0)/e.length,s=e.reduce((e,s)=>e+Math.pow(s-t,2),0)/e.length;return Math.sqrt(s)}applySeasonalAdjustment(e,t,s){const a=s.getMonth(),n=this.SEASONAL_FACTORS[e];return n&&n[a]?t*n[a]:t}generateReasoning(e,t,s,a,n,i){const r=[];return 0===t?r.push(`Based on your average spending of $${a.toFixed(0)} in ${e}`):s>t?r.push("Your current budget may be too restrictive"):s<t&&r.push("You have an opportunity to reduce this budget"),"increasing"===n.direction&&n.percentage>15?r.push(`spending has been increasing by ${n.percentage}%`):"decreasing"===n.direction&&n.percentage>15&&r.push(`spending has been decreasing by ${n.percentage}%`),r.push(`using ${i.aggressiveness} analysis of ${i.lookbackMonths} months`),r.join(", ")+"."}generateInsights(e,t,s,a){const n=[],i=new Date,r=$(i);a.forEach(e=>{!e.currentBudget&&e.averageSpending>100&&n.push({type:"unbudgeted",title:`Unbudgeted Spending in ${e.categoryName}`,description:`You're spending an average of $${e.averageSpending.toFixed(0)} per month in ${e.categoryName} without a budget.`,impact:"negative",actionable:!0,categoryId:e.categoryId,amount:e.averageSpending})}),s.forEach(s=>{const a=t.find(e=>e.id===s.category);if(!a)return;const o=e.filter(e=>e.category===s.category&&"expense"===e.type&&new Date(e.date)>=r).reduce((e,t)=>e+Math.abs(t.amount),0),d=o/s.amount*100,c=new Date(i.getFullYear(),i.getMonth()+1,0).getDate(),l=i.getDate();d>l/c*100+20&&n.push({type:"overspend",title:`Overspending Alert: ${a.name}`,description:`You've spent ${d.toFixed(0)}% of your budget with ${c-l} days left in the month.`,impact:"negative",actionable:!0,categoryId:a.id,amount:o})});const o=a.filter(e=>e.potentialSavings).reduce((e,t)=>e+(t.potentialSavings||0),0);o>100&&n.push({type:"opportunity",title:"Budget Optimization Available",description:`You could potentially save $${o.toFixed(0)} per month by adjusting your budgets to match your actual spending patterns.`,impact:"positive",actionable:!0,amount:o});const d=s.filter(e=>{const t=a.find(t=>t.categoryId===e.category);return t&&Math.abs(t.recommendedBudget-e.amount)/e.amount<.1});return d.length>=.7*s.length&&n.push({type:"achievement",title:"Excellent Budget Management",description:`${Math.round(d.length/s.length*100)}% of your budgets are well-aligned with your spending patterns!`,impact:"positive",actionable:!1}),n}calculateBudgetHealthScore(e,t,s){let a=100;const n=$(new Date),i=5*s.filter(e=>!e.currentBudget&&e.averageSpending>50).length;a-=Math.min(25,i),e.forEach(e=>{const t=s.find(t=>t.categoryId===e.category);if(t){const s=Math.abs(t.recommendedBudget-e.amount)/e.amount;s>.3?a-=5:s>.2&&(a-=3)}}),e.forEach(e=>{const s=t.filter(t=>t.category===e.category&&"expense"===t.type&&new Date(t.date)>=n).reduce((e,t)=>e+Math.abs(t.amount),0);if(s>e.amount){const t=(s-e.amount)/e.amount*100;a-=Math.min(10,Math.floor(t/10))}});const r=s.filter(e=>e.confidence>.8).length;return a+=Math.min(10,2*r),Math.max(0,Math.min(100,a))}applyRecommendations(e,t){return(t?e.filter(e=>t.includes(e.categoryId)):e).map(e=>({categoryId:e.categoryId,amount:e.recommendedBudget}))}exportRecommendations(e){const t=["Budget Recommendations Report",`Generated: ${n(new Date,"MMMM d, yyyy")}`,`Budget Health Score: ${e.score}/100`,"",`Total Current Budget: $${e.totalCurrentBudget.toFixed(2)}`,`Total Recommended Budget: $${e.totalRecommendedBudget.toFixed(2)}`,`Potential Savings: $${e.totalPotentialSavings.toFixed(2)}`,"","Recommendations:",""];return e.recommendations.forEach(e=>{t.push(`${e.categoryName}:`),t.push(`  Current Budget: $${e.currentBudget?.toFixed(2)||"0.00"}`),t.push(`  Recommended: $${e.recommendedBudget.toFixed(2)}`),t.push(`  Average Spending: $${e.averageSpending.toFixed(2)}`),t.push(`  Trend: ${e.spendingTrend} (${e.trendPercentage}%)`),t.push(`  Confidence: ${(100*e.confidence).toFixed(0)}%`),t.push(`  ${e.reasoning}`),t.push("")}),t.push("Insights:"),t.push(""),e.insights.forEach(e=>{t.push(`\u2022 ${e.title}`),t.push(`  ${e.description}`),t.push("")}),t.join("\n")}};export{s as default};
