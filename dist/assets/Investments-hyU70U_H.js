const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ChartComponents-nikqtBD9.js","assets/chunk-BN8kgYrt.js","assets/chunk-BWx9oMeS.js","assets/PieChartWrapper-BJQINqwI.js","assets/BarChartWrapper-B83pkzBO.js","assets/LineChartWrapper-DaUhqEl1.js","assets/AreaChartWrapper-Daf9nNsu.js","assets/TreemapWrapper-C14VTw9k.js"])))=>i.map(i=>d[i]);
async function e(e){try{const t=function(e){return e.toUpperCase().trim()}(e);if(!t||t.length>10)throw new Error("Invalid stock symbol");if("true"===new URLSearchParams(window.location.search).get("demo"))return function(e){const t={price:100+400*Math.random(),name:`${e} Corp.`,change:10*(Math.random()-.5)},r={AAPL:{price:189.5,name:"Apple Inc.",change:2.34},GOOGL:{price:142.75,name:"Alphabet Inc.",change:-1.12},MSFT:{price:378.2,name:"Microsoft Corporation",change:4.56},AMZN:{price:156.8,name:"Amazon.com Inc.",change:1.89},TSLA:{price:245.3,name:"Tesla Inc.",change:-5.67},META:{price:512.4,name:"Meta Platforms Inc.",change:3.21},NVDA:{price:723.9,name:"NVIDIA Corporation",change:12.45},"BRK.B":{price:367.5,name:"Berkshire Hathaway Inc.",change:.98},JPM:{price:195.6,name:"JPMorgan Chase & Co.",change:2.1},V:{price:276.3,name:"Visa Inc.",change:1.45}}[e.toUpperCase()]||t,a=v(r.price),s=v(r.change),n=a.greaterThan(0)?s.dividedBy(a.minus(s)).times(100):v(0),i=a.minus(s);return{symbol:e.toUpperCase(),price:a,currency:"USD",change:s,changePercent:n,previousClose:i,marketCap:a.times(v(1e9*Math.random()+1e8)),volume:Math.floor(5e7*Math.random()+1e6),dayHigh:a.times(v(1+.02*Math.random())),dayLow:a.times(v(1-.02*Math.random())),fiftyTwoWeekHigh:a.times(v(1.2+.3*Math.random())),fiftyTwoWeekLow:a.times(v(.5+.3*Math.random())),name:r.name,exchange:"NASDAQ",lastUpdated:new Date}}(t);const r=ge.get(t);if(r&&Date.now()-r.timestamp<6e4)return r;const a=await le(()=>async function(e){const t=[];for(const a of he)try{const t=await fetch(`${a}${e}`,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"},signal:AbortSignal.timeout(5e3)});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const r=await t.json(),s=r.chart?.result?.[0];if(!s||!s.meta)throw new Error("Invalid response format");const n=s.meta,i=n.regularMarketPrice,l=n.chartPreviousClose||n.previousClose;if(!i||!l)throw new Error("Missing price data");const d=v(i),o=v(l),c=d.minus(o),x=o.greaterThan(0)?c.dividedBy(o).times(100):v(0);return{symbol:e,price:d,currency:n.currency||"USD",change:c,changePercent:x,previousClose:o,marketCap:n.marketCap?v(n.marketCap):void 0,volume:n.regularMarketVolume,dayHigh:n.regularMarketDayHigh?v(n.regularMarketDayHigh):void 0,dayLow:n.regularMarketDayLow?v(n.regularMarketDayLow):void 0,fiftyTwoWeekHigh:n.fiftyTwoWeekHigh?v(n.fiftyTwoWeekHigh):void 0,fiftyTwoWeekLow:n.fiftyTwoWeekLow?v(n.fiftyTwoWeekLow):void 0,name:n.longName||n.shortName,exchange:n.exchangeName,lastUpdated:new Date}}catch(r){t.push(r);continue}if(t.length>0)throw new Error(`All endpoints failed: ${t.map(e=>e.message).join(", ")}`);return null}(t),{maxRetries:3,initialDelay:500,onRetry:(e,t)=>{console.warn(`Stock quote fetch attempt ${e} failed:`,t.message)}});if(a){const e={...a,timestamp:Date.now()};ge.set(t,e)}return a}catch(t){return se.handleError(t,{category:ie.NETWORK,severity:ne.LOW,context:{symbol:e},userMessage:`Unable to fetch quote for ${e}. Please try again later.`,retryable:!0}),null}}async function t(t){try{const r=new Map;if(!t||0===t.length)return r;const a=5;for(let s=0;s<t.length;s+=a){const n=t.slice(s,s+a).map(async t=>({symbol:t,quote:await e(t)}));(await Promise.allSettled(n)).forEach((e,t)=>{"fulfilled"===e.status&&e.value.quote&&r.set(e.value.symbol,e.value.quote)})}return r}catch(r){return se.handleError(r,{category:ie.NETWORK,severity:ne.MEDIUM,context:{symbols:t},userMessage:"Failed to fetch stock quotes. Please try again later."}),new Map}}async function r(e,t,r){if(t===r)return e;try{const a=await f(),s="GBP"===t?e:e.dividedBy(v(a[t]||1));return"GBP"===r?s:s.times(v(a[r]||1))}catch(a){return console.error("Error converting stock price:",a),e}}function a({accountId:e,accountName:a,holdings:s,currency:n,onClose:i}){const l=ae(),{prices:d,loading:o,error:c,refreshPrices:x}=function(e){const[r,a]=re.useState(new Map),[s,n]=re.useState(!1),[i,l]=re.useState(null),d=re.useCallback(async()=>{if(0!==e.length){n(!0),l(null);try{const r=e.map(e=>e.ticker).filter(Boolean),s=[...new Set(r)],n=await t(s),i=new Map;n.forEach((e,t)=>{i.set(t,{symbol:e.symbol,price:e.price.toNumber(),currency:e.currency,change:e.change.toNumber(),changePercent:e.changePercent.toNumber(),lastUpdated:e.lastUpdated,name:e.name})}),a(i)}catch(r){l(r instanceof Error?r.message:"Failed to fetch stock prices"),console.error("Error fetching stock prices:",r)}finally{n(!1)}}},[e]);re.useEffect(()=>{d();const e=setInterval(d,3e5);return()=>clearInterval(e)},[d]);const o=re.useCallback(e=>r.get(e.toUpperCase()),[r]);return{prices:r,loading:s,error:i,refreshPrices:d,getPrice:o}}(s),[g,h]=re.useState("value"),[m,u]=re.useState([]),[p,y]=re.useState(0),[b,k]=re.useState(0),[j,f]=re.useState(0),[E,D]=re.useState(!1);re.useEffect(()=>{(async()=>{const e=[];let t=0,a=0;for(const i of s){const s=d.get(i.ticker);if(s){const l=await r(v(s.price),s.currency,n),d=l.times(i.shares).toNumber(),o=(i.averageCost||i.value/i.shares)*i.shares,c=d-o,x=o>0?c/o*100:0;e.push({...i,currentPrice:l.toNumber(),marketValue:d,gain:c,gainPercent:x,currency:s.currency,lastUpdated:s.lastUpdated,name:s.name||i.name}),t+=d,a+=o}else{const r=i.value;e.push({...i,marketValue:r,currentPrice:i.shares>0?r/i.shares:0}),t+=r,a+=r}}u(e),y(t),k(a),f(t-a)})()},[s,d,n]);const M=[...m].sort((e,t)=>{switch(g){case"value":return(t.marketValue||0)-(e.marketValue||0);case"shares":return t.shares-e.shares;case"name":return e.name.localeCompare(t.name);case"gain":return(t.gain||0)-(e.gain||0);default:return 0}}),L=e=>p>0?(e/p*100).toFixed(1):"0",F=e=>{const t=e.toFixed(2);return e>=0?`+${t}%`:`${t}%`};return N.jsxs("div",{children:[N.jsx("div",{className:"p-6 border-b-2 border-[#5A729A] dark:border-gray-700 bg-secondary dark:bg-gray-800",children:N.jsxs("div",{className:"flex items-center justify-between",children:[N.jsxs("div",{className:"flex items-center gap-4",children:[N.jsx("button",{onClick:i,className:"p-2 text-white/70 hover:text-white dark:text-gray-400 dark:hover:text-gray-200 rounded-lg",children:N.jsx(w,{size:24})}),N.jsxs("div",{children:[N.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-white dark:text-white",children:[a," Portfolio"]}),N.jsx("p",{className:"text-sm text-white/80 dark:text-gray-300 mt-1",children:"Real-time portfolio valuation"})]})]}),N.jsxs("button",{onClick:async()=>{D(!0),await x(),setTimeout(()=>D(!1),1e3)},className:"flex items-center gap-2 px-4 py-2 text-sm border border-white/30 dark:border-gray-600 rounded-lg hover:bg-white/10 dark:hover:bg-gray-700 text-white dark:text-gray-200 "+(E?"opacity-50 cursor-not-allowed":""),disabled:E||o,children:[N.jsx(C,{size:16,className:E?"animate-spin":""}),"Refresh Prices"]})]})}),N.jsxs("div",{className:"p-6 bg-white dark:bg-gray-800 m-6 rounded-lg shadow-md border-2 border-blue-200 dark:border-gray-700 overflow-y-auto",style:{maxHeight:"calc(90vh - 8rem)"},children:[c&&N.jsx("div",{className:"mb-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:N.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:c})}),N.jsx("div",{className:"flex gap-4 mb-4",children:N.jsx("button",{onClick:()=>l(`/transactions?account=${e}`),className:"px-4 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:"View Transactions"})}),N.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[N.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[N.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Market Value"}),N.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:T(p,n)}),o&&N.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Updating..."})]}),N.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[N.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Cost"}),N.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:T(b,n)})]}),N.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[N.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Gain/Loss"}),N.jsxs("div",{className:"flex items-center gap-2",children:[N.jsxs("p",{className:"text-2xl font-bold "+(j>=0?"text-green-600":"text-red-600"),children:[j>=0?"+":"",T(j,n)]}),j>=0?N.jsx(S,{className:"text-green-600",size:20}):N.jsx(A,{className:"text-red-600",size:20})]}),N.jsx("p",{className:"text-sm "+(j>=0?"text-green-600":"text-red-600"),children:b>0?F(j/b*100):"0.00%"})]}),N.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[N.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Holdings"}),N.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s.length}),N.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[d.size," with live prices"]})]})]}),N.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden",children:[N.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:N.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Holdings"})}),0===s.length?N.jsxs("div",{className:"p-8 text-center",children:[N.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No holdings in this portfolio yet."}),N.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-2",children:"Add investments to track your portfolio."})]}):N.jsxs(N.Fragment,{children:[N.jsx("div",{className:"px-6 py-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50",children:N.jsxs("div",{className:"flex items-center gap-4",children:[N.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Sort by:"}),N.jsx("button",{onClick:()=>h("value"),className:"text-sm px-3 py-1 rounded "+("value"===g?"bg-primary text-white":"text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600"),children:"Value"}),N.jsx("button",{onClick:()=>h("gain"),className:"text-sm px-3 py-1 rounded "+("gain"===g?"bg-primary text-white":"text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600"),children:"Gain/Loss"}),N.jsx("button",{onClick:()=>h("shares"),className:"text-sm px-3 py-1 rounded "+("shares"===g?"bg-primary text-white":"text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600"),children:"Shares"}),N.jsx("button",{onClick:()=>h("name"),className:"text-sm px-3 py-1 rounded "+("name"===g?"bg-primary text-white":"text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600"),children:"Name"})]})}),N.jsx("div",{className:"hidden md:block overflow-x-auto",children:N.jsxs("table",{className:"w-full",children:[N.jsx("thead",{children:N.jsxs("tr",{className:"bg-secondary dark:bg-gray-700 border-b-2 border-[#5A729A] dark:border-gray-600",children:[N.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-white dark:text-gray-200 uppercase tracking-wider",children:"Ticker"}),N.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-white dark:text-gray-200 uppercase tracking-wider",children:"Name"}),N.jsx("th",{className:"px-6 py-3 text-right text-xs font-semibold text-white dark:text-gray-200 uppercase tracking-wider",children:"Shares"}),N.jsx("th",{className:"px-6 py-3 text-right text-xs font-semibold text-white dark:text-gray-200 uppercase tracking-wider",children:"Avg Cost"}),N.jsx("th",{className:"px-6 py-3 text-right text-xs font-semibold text-white dark:text-gray-200 uppercase tracking-wider",children:"Current Price"}),N.jsx("th",{className:"px-6 py-3 text-right text-xs font-semibold text-white dark:text-gray-200 uppercase tracking-wider",children:"Market Value"}),N.jsx("th",{className:"px-6 py-3 text-right text-xs font-semibold text-white dark:text-gray-200 uppercase tracking-wider",children:"Gain/Loss"}),N.jsx("th",{className:"px-6 py-3 text-right text-xs font-semibold text-white dark:text-gray-200 uppercase tracking-wider",children:"% Portfolio"})]})}),N.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:M.map((e,t)=>{const r=d.get(e.ticker),a=!!r;return N.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[N.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:N.jsxs("div",{className:"flex items-center gap-2",children:[N.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.ticker}),a&&N.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 text-xs bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 rounded-full",children:[N.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"}),"Live"]})]})}),N.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:[e.name,e.currency&&e.currency!==n&&N.jsxs("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400",children:["(",e.currency,")"]})]}),N.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900 dark:text-gray-100",children:e.shares.toLocaleString()}),N.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900 dark:text-gray-100",children:T(e.averageCost||e.value/e.shares,n)}),N.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right",children:N.jsxs("div",{className:"flex flex-col items-end",children:[N.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:T(e.currentPrice||0,n)}),r&&N.jsx("span",{className:"text-xs "+(r.changePercent>=0?"text-green-600":"text-red-600"),children:F(r.changePercent)})]})}),N.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-medium text-gray-900 dark:text-white",children:T(e.marketValue||e.value,n)}),N.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right",children:void 0!==e.gain?N.jsxs("div",{className:"flex flex-col items-end",children:[N.jsxs("span",{className:"font-medium "+(e.gain>=0?"text-green-600":"text-red-600"),children:[e.gain>=0?"+":"",T(e.gain,n)]}),N.jsx("span",{className:"text-xs "+((e.gainPercent||0)>=0?"text-green-600":"text-red-600"),children:F(e.gainPercent||0)})]}):N.jsx("span",{className:"text-gray-400",children:"-"})}),N.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right",children:N.jsxs("div",{className:"flex items-center justify-end gap-2",children:[N.jsx("div",{className:"w-20 bg-gray-200 dark:bg-gray-600 rounded-full h-2",children:N.jsx("div",{className:"bg-primary h-2 rounded-full",style:{width:`${L(e.marketValue||e.value)}%`}})}),N.jsxs("span",{className:"text-gray-600 dark:text-gray-400 w-12 text-right",children:[L(e.marketValue||e.value),"%"]})]})})]},`${e.ticker}-${t}`)})})]})}),N.jsx("div",{className:"md:hidden",children:M.map((e,t)=>{const r=!!d.get(e.ticker);return N.jsxs("div",{className:"px-4 py-4 border-b border-gray-200 dark:border-gray-700 last:border-b-0",children:[N.jsxs("div",{className:"flex justify-between items-start mb-2",children:[N.jsxs("div",{children:[N.jsxs("div",{className:"flex items-center gap-2",children:[N.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:e.ticker}),r&&N.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 text-xs bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 rounded-full",children:[N.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"}),"Live"]})]}),N.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.name})]}),N.jsxs("div",{className:"text-right",children:[N.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:T(e.marketValue||e.value,n)}),N.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[L(e.marketValue||e.value),"%"]})]})]}),N.jsxs("div",{className:"flex justify-between text-sm",children:[N.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[e.shares.toLocaleString()," @ ",T(e.currentPrice||0,n)]}),void 0!==e.gain&&N.jsxs("span",{className:"font-medium "+(e.gain>=0?"text-green-600":"text-red-600"),children:[e.gain>=0?"+":"",T(e.gain,n)," (",F(e.gainPercent||0),")"]})]})]},`${e.ticker}-${t}`)})}),d.size>0&&N.jsx("div",{className:"px-6 py-3 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50",children:N.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400",children:[N.jsxs("div",{className:"flex items-center gap-1",children:[N.jsx(P,{size:12}),N.jsxs("span",{children:["Prices updated: ",(new Date).toLocaleTimeString()]})]}),N.jsx("span",{children:"Live prices from Yahoo Finance"})]})})]})]})]})]})}function s({isOpen:e,onClose:t,accountId:r}){const{accounts:a,addTransaction:s}=E(),{formatCurrency:n}=de(),{formData:i,updateField:l,handleSubmit:d,setFormData:o}=D({selectedAccountId:r||"",investmentType:"share",stockCode:"",name:"",units:"",pricePerUnit:"",fees:"",stampDuty:"",date:(new Date).toISOString().split("T")[0],notes:""},{onSubmit:e=>{if(!(e.selectedAccountId&&e.name&&e.units&&e.pricePerUnit))return void alert("Please fill in all required fields");const t=parseFloat(e.units)||0,r=parseFloat(e.pricePerUnit)||0,i=parseFloat(e.fees)||0,l=parseFloat(e.stampDuty)||0,d=t*r+i+l,o=a.find(t=>t.id===e.selectedAccountId),c=`${"share"===e.investmentType?"Buy":"Investment"}: ${e.name}${e.stockCode?` (${e.stockCode})`:""} - ${e.units} units @ ${n(parseFloat(e.pricePerUnit),o?.currency||"GBP")}/unit`,x=[`Investment Type: ${e.investmentType}`,`Stock Code: ${e.stockCode||"N/A"}`,`Units: ${e.units}`,`Price per unit: ${e.pricePerUnit}`,`Transaction Fee: ${e.fees||"0"}`,`Stamp Duty: ${e.stampDuty||"0"}`].join("\n");s({date:new Date(e.date),description:c,amount:-d,type:"expense",category:"cat-27",accountId:e.selectedAccountId,notes:e.notes?`${x}\n\nAdditional Notes: ${e.notes}`:x,tags:["investment",e.investmentType,e.stockCode].filter(Boolean),investmentData:{symbol:e.stockCode,quantity:t,pricePerShare:r,transactionFee:i,stampDuty:l,totalCost:d}})},onClose:t}),c=a.filter(e=>"investment"===e.type);re.useEffect(()=>{e||o({selectedAccountId:r||"",investmentType:"share",stockCode:"",name:"",units:"",pricePerUnit:"",fees:"",stampDuty:"",date:(new Date).toISOString().split("T")[0],notes:""})},[e,r,o]);const x=a.find(e=>e.id===i.selectedAccountId),g=x?F(x.currency):"\xa3";return N.jsx(M,{isOpen:e,onClose:t,title:"Add Investment",size:"xl",children:N.jsxs("form",{onSubmit:d,children:[N.jsxs(L,{children:[!r&&N.jsxs("div",{className:"mb-6",children:[N.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Investment Account*"}),N.jsxs("select",{value:i.selectedAccountId,onChange:e=>l("selectedAccountId",e.target.value),className:"w-full px-3 py-2 bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-300/50 dark:border-gray-600/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white",required:!0,children:[N.jsx("option",{value:"",children:"Select an investment account"}),c.map(e=>N.jsxs("option",{value:e.id,children:[e.name," (",e.institution||"Investment",")"]},e.id))]}),0===c.length&&N.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"No investment accounts found. Please create an investment account first."})]}),N.jsxs("div",{className:"mb-6",children:[N.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Category of Investment*"}),N.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[{value:"fund",label:"Fund"},{value:"share",label:"Share"},{value:"cash",label:"Cash"},{value:"other",label:"Other"}].map(e=>N.jsx("button",{type:"button",onClick:()=>l("investmentType",e.value),className:"px-4 py-2 rounded-lg transition-colors "+(i.investmentType===e.value?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),children:e.label},e.value))})]}),N.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[N.jsxs("div",{children:[N.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["fund"===i.investmentType?"Fund Code":"share"===i.investmentType?"Stock Code":"Reference","cash"!==i.investmentType&&N.jsx("span",{className:"text-gray-400 text-xs ml-1",children:"(e.g. AAPL)"})]}),N.jsx("input",{type:"text",value:i.stockCode,onChange:e=>l("stockCode",e.target.value.toUpperCase()),placeholder:"share"===i.investmentType?"AAPL":"fund"===i.investmentType?"ISIN/SEDOL":"Optional",className:"w-full px-3 py-2 bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-300/50 dark:border-gray-600/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white",disabled:"cash"===i.investmentType})]}),N.jsxs("div",{children:[N.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Investment Name*"}),N.jsx("input",{type:"text",value:i.name,onChange:e=>l("name",e.target.value),placeholder:"share"===i.investmentType?"Apple Inc.":"fund"===i.investmentType?"Fund Name":"Description",className:"w-full px-3 py-2 bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-300/50 dark:border-gray-600/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white",required:!0})]}),N.jsxs("div",{children:[N.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["cash"===i.investmentType?"Amount":"Number of Units/Shares","*"]}),N.jsx("input",{type:"number",step:"0.0001",value:i.units,onChange:e=>l("units",e.target.value),placeholder:"cash"===i.investmentType?"1000.00":"100",className:"w-full px-3 py-2 bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-300/50 dark:border-gray-600/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white",required:!0})]}),N.jsxs("div",{children:[N.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["cash"===i.investmentType?`Price per Unit (${g})`:`Price per Unit/Share (${g})`,"*"]}),N.jsx("input",{type:"number",step:"0.01",value:i.pricePerUnit,onChange:e=>l("pricePerUnit",e.target.value),placeholder:"cash"===i.investmentType?"1.00":"150.00",className:"w-full px-3 py-2 bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-300/50 dark:border-gray-600/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white",required:!0})]}),N.jsxs("div",{children:[N.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Transaction Fee (",g,")"]}),N.jsx("input",{type:"number",step:"0.01",value:i.fees,onChange:e=>l("fees",e.target.value),placeholder:"0.00",className:"w-full px-3 py-2 bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-300/50 dark:border-gray-600/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white"})]}),N.jsxs("div",{children:[N.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Stamp Duty/Levy (",g,")"]}),N.jsx("input",{type:"number",step:"0.01",value:i.stampDuty,onChange:e=>l("stampDuty",e.target.value),placeholder:"0.00",className:"w-full px-3 py-2 bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-300/50 dark:border-gray-600/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white"})]}),N.jsxs("div",{children:[N.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Purchase Date*"}),N.jsx("input",{type:"date",value:i.date,onChange:e=>l("date",e.target.value),className:"w-full px-3 py-2 bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-300/50 dark:border-gray-600/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white",required:!0})]})]}),N.jsxs("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[N.jsxs("div",{className:"flex justify-between items-center",children:[N.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Cost:"}),N.jsx("span",{className:"text-xl font-bold text-gray-900 dark:text-white",children:n((parseFloat(i.units)||0)*(parseFloat(i.pricePerUnit)||0)+(parseFloat(i.fees)||0)+(parseFloat(i.stampDuty)||0),x?.currency||"GBP")})]}),i.units&&i.pricePerUnit&&N.jsxs("div",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400 space-y-1",children:[N.jsxs("div",{className:"flex justify-between",children:[N.jsxs("span",{children:["Shares: ",i.units," \xd7 ",g,i.pricePerUnit]}),N.jsxs("span",{children:[g,(parseFloat(i.units)*parseFloat(i.pricePerUnit)).toFixed(2)]})]}),parseFloat(i.fees)>0&&N.jsxs("div",{className:"flex justify-between",children:[N.jsx("span",{children:"Transaction Fee:"}),N.jsxs("span",{children:[g,i.fees]})]}),parseFloat(i.stampDuty)>0&&N.jsxs("div",{className:"flex justify-between",children:[N.jsx("span",{children:"Stamp Duty:"}),N.jsxs("span",{children:[g,i.stampDuty]})]})]})]}),N.jsxs("div",{className:"mt-6",children:[N.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notes"}),N.jsx("textarea",{value:i.notes,onChange:e=>l("notes",e.target.value),rows:3,placeholder:"Additional information about this investment...",className:"w-full px-3 py-2 bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-300/50 dark:border-gray-600/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white"})]})]}),N.jsx(I,{children:N.jsxs("div",{className:"flex justify-end gap-3 w-full",children:[N.jsx("button",{type:"button",onClick:t,className:"px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"Cancel"}),N.jsxs("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[N.jsx(_,{size:20}),"Add Investment"]})]})})]})})}function n({holdings:e,baseCurrency:t,className:r=""}){const{formatCurrency:a}=de(),[s,n]=re.useState(!1),i=re.useMemo(()=>e.map(e=>e.symbol),[e]),{quotes:l,isLoading:d,error:o,lastUpdate:c,marketStatus:x,refresh:g}=function({symbols:e,enabled:t=!0,onUpdate:r}){const[a,s]=re.useState(new Map),[n,i]=re.useState(!0),[l,d]=re.useState(null),[o,c]=re.useState(null),[x,g]=re.useState(()=>me.getMarketStatus()),h=re.useRef(null),m=re.useCallback(e=>{s(t=>{const r=new Map(t);return r.set(e.symbol,e.quote),r}),c(e.timestamp),d(null)},[r]),u=re.useCallback(()=>{i(!0),e.forEach(e=>{me.fetchAndBroadcast(e)})},[e]);return re.useEffect(()=>{if(!t||0===e.length)return;i(!0),h.current=me.subscribeMultiple(e,m);const r=setInterval(()=>{g(me.getMarketStatus())},6e4),a=({symbol:e,error:t})=>{d(`Failed to fetch price for ${e}: ${t.message}`),i(!1)};me.on("error",a);const s=setTimeout(()=>{i(!1)},5e3);return()=>{h.current&&h.current(),clearInterval(r),clearTimeout(s),me.off("error",a)}},[e,t,m]),{quotes:a,isLoading:n,error:l,lastUpdate:o,marketStatus:x,refresh:u}}({symbols:i,enabled:!0,onUpdate:e=>{}}),h=re.useMemo(()=>{let t=v(0),r=v(0),a=v(0);const s=e.map(e=>{const s=l.get(e.symbol),n=s?.price||e.averageCost,i=s?.change||v(0),d=s?.changePercent||v(0),o=n.times(e.shares),c=o.minus(e.costBasis),x=e.costBasis.greaterThan(0)?c.dividedBy(e.costBasis).times(100):v(0);return t=t.plus(o),r=r.plus(e.costBasis),a=a.plus(i.times(e.shares)),{...e,quote:s,currentPrice:n,marketValue:o,gain:c,gainPercent:x,dayChange:i,dayChangePercent:d,allocation:v(0)}});s.forEach(e=>{e.allocation=t.greaterThan(0)?e.marketValue.dividedBy(t).times(100):v(0)});const n=t.minus(r),i=r.greaterThan(0)?n.dividedBy(r).times(100):v(0),d=t.minus(a).greaterThan(0)?a.dividedBy(t.minus(a)).times(100):v(0);return{totalValue:t,totalCost:r,totalGain:n,totalGainPercent:i,totalDayChange:a,totalDayChangePercent:d,holdings:s}},[e,l]);return 0===e.length?N.jsx("div",{className:`bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-6 ${r}`,children:N.jsxs("div",{className:"text-center py-8",children:[N.jsx(O,{className:"mx-auto text-gray-400 mb-4",size:48}),N.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No Holdings"}),N.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Add stocks to your portfolio to see real-time prices and performance."})]})}):N.jsxs("div",{className:`space-y-6 ${r}`,children:[N.jsxs("div",{className:"flex justify-between items-start",children:[N.jsxs("div",{children:[N.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Real-Time Portfolio"}),N.jsxs("div",{className:"flex items-center gap-4 mt-1",children:[N.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:c?`Updated: ${c.toLocaleTimeString()}`:"Loading..."}),N.jsx("div",{className:"flex items-center gap-2",children:x.isOpen?N.jsxs(N.Fragment,{children:[N.jsx(q,{size:16,className:"text-green-500"}),N.jsx("span",{className:"text-sm text-green-600 dark:text-green-400",children:"Market Open"})]}):N.jsxs(N.Fragment,{children:[N.jsx(z,{size:16,className:"text-gray-400"}),N.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Market Closed"})]})})]})]}),N.jsxs("button",{onClick:async()=>{n(!0),g(),setTimeout(()=>n(!1),1e3)},disabled:s||d,className:"flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-secondary transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[N.jsx(U,{size:16,className:s?"animate-spin":""}),"Refresh"]})]}),N.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[N.jsx("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-4",children:N.jsxs("div",{className:"flex items-center justify-between",children:[N.jsxs("div",{className:"flex-1",children:[N.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Portfolio Value"}),d?N.jsx(B,{variant:"text",className:"w-24 h-8"}):N.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:a(h.totalValue)})]}),N.jsx($,{className:"text-primary",size:24})]})}),N.jsx("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-4",children:N.jsxs("div",{className:"flex items-center justify-between",children:[N.jsxs("div",{className:"flex-1",children:[N.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Day Change"}),d?N.jsx(B,{variant:"text",className:"w-24 h-8"}):N.jsxs(N.Fragment,{children:[N.jsxs("p",{className:"text-xl font-bold "+(h.totalDayChange.greaterThanOrEqualTo(0)?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[h.totalDayChange.greaterThanOrEqualTo(0)?"+":"",a(h.totalDayChange)]}),N.jsxs("p",{className:"text-sm "+(h.totalDayChangePercent.greaterThanOrEqualTo(0)?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[h.totalDayChangePercent.greaterThanOrEqualTo(0)?"+":"",h.totalDayChangePercent.toFixed(2),"%"]})]})]}),h.totalDayChange.greaterThanOrEqualTo(0)?N.jsx(V,{className:"text-green-500",size:24}):N.jsx(R,{className:"text-red-500",size:24})]})}),N.jsx("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-4",children:N.jsxs("div",{className:"flex items-center justify-between",children:[N.jsxs("div",{className:"flex-1",children:[N.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Gain/Loss"}),d?N.jsx(B,{variant:"text",className:"w-24 h-8"}):N.jsxs(N.Fragment,{children:[N.jsxs("p",{className:"text-xl font-bold "+(h.totalGain.greaterThanOrEqualTo(0)?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[h.totalGain.greaterThanOrEqualTo(0)?"+":"",a(h.totalGain)]}),N.jsxs("p",{className:"text-sm "+(h.totalGainPercent.greaterThanOrEqualTo(0)?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[h.totalGainPercent.greaterThanOrEqualTo(0)?"+":"",h.totalGainPercent.toFixed(2),"%"]})]})]}),h.totalGain.greaterThanOrEqualTo(0)?N.jsx(V,{className:"text-green-500",size:24}):N.jsx(R,{className:"text-red-500",size:24})]})}),N.jsx("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-4",children:N.jsxs("div",{className:"flex items-center justify-between",children:[N.jsxs("div",{className:"flex-1",children:[N.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Invested"}),d?N.jsx(B,{variant:"text",className:"w-24 h-8"}):N.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:a(h.totalCost)})]}),N.jsx(V,{className:"text-blue-500",size:24})]})})]}),N.jsxs("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-6",children:[N.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Holdings"}),o&&N.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:N.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:o})}),N.jsx("div",{className:"space-y-3",children:h.holdings.map(e=>N.jsxs("div",{className:"relative overflow-hidden",children:[e.quote&&N.jsx("div",{className:"absolute inset-0 bg-primary/10 dark:bg-primary/20 animate-pulse pointer-events-none opacity-0 price-update"}),N.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[N.jsx("div",{className:"flex-1",children:N.jsxs("div",{className:"flex items-center gap-3",children:[N.jsxs("div",{children:[N.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:e.symbol}),N.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.shares.toFixed(2)," shares @ ",a(e.averageCost)]})]}),e.quote&&N.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-green-100 dark:bg-green-900/30 rounded-full",children:[N.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),N.jsx("span",{className:"text-xs text-green-600 dark:text-green-400",children:"Live"})]})]})}),N.jsxs("div",{className:"grid grid-cols-4 gap-6 text-right",children:[N.jsxs("div",{children:[N.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Price"}),d?N.jsx(B,{variant:"text",className:"w-16 h-6"}):N.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:a(e.currentPrice)})]}),N.jsxs("div",{children:[N.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Day"}),d?N.jsx(B,{variant:"text",className:"w-16 h-6"}):N.jsxs("p",{className:"font-semibold "+(e.dayChange.greaterThanOrEqualTo(0)?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[e.dayChange.greaterThanOrEqualTo(0)?"+":"",e.dayChangePercent.toFixed(2),"%"]})]}),N.jsxs("div",{children:[N.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Value"}),d?N.jsx(B,{variant:"text",className:"w-20 h-6"}):N.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:a(e.marketValue)})]}),N.jsxs("div",{children:[N.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Gain/Loss"}),d?N.jsx(B,{variant:"text",className:"w-20 h-6"}):N.jsxs(N.Fragment,{children:[N.jsxs("p",{className:"font-semibold "+(e.gain.greaterThanOrEqualTo(0)?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[e.gain.greaterThanOrEqualTo(0)?"+":"",a(e.gain)]}),N.jsxs("p",{className:"text-xs "+(e.gainPercent.greaterThanOrEqualTo(0)?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[e.gainPercent.greaterThanOrEqualTo(0)?"+":"",e.gainPercent.toFixed(2),"%"]})]})]})]})]})]},e.symbol))})]})]})}function i({accountId:t,holdings:r,onUpdate:a}){const{formatCurrency:s}=de(),[n,i]=re.useState(!1),[l,d]=re.useState(null),[o,c]=re.useState(!1),[x,g]=re.useState(""),[h,m]=re.useState(""),[u,p]=re.useState(""),[y,b]=re.useState(""),k=()=>{m(""),p(""),b(""),g("")},j=()=>{k(),i(!0)},f=r.reduce((e,t)=>e.plus(t.costBasis),v(0));return N.jsxs("div",{className:"space-y-6",children:[N.jsxs("div",{className:"flex justify-between items-center",children:[N.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Portfolio Holdings (",r.length,")"]}),N.jsxs("button",{onClick:j,className:"flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-secondary transition-colors",children:[N.jsx(W,{size:20}),"Add Holding"]})]}),0===r.length?N.jsxs("div",{className:"text-center py-12 bg-gray-50 dark:bg-gray-800/50 rounded-lg",children:[N.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"No holdings yet. Add stocks to track your portfolio performance."}),N.jsxs("button",{onClick:j,className:"inline-flex items-center gap-2 px-6 py-3 bg-primary text-white rounded-lg hover:bg-secondary transition-colors",children:[N.jsx(W,{size:20}),"Add Your First Stock"]})]}):N.jsxs("div",{className:"space-y-3",children:[r.map(e=>N.jsxs("div",{className:"flex items-center justify-between p-4 bg-white dark:bg-gray-800 rounded-lg shadow-sm hover:shadow-md transition-shadow",children:[N.jsxs("div",{className:"flex-1",children:[N.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:e.symbol}),N.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.shares.toFixed(2)," shares @ ",s(e.averageCost)]})]}),N.jsxs("div",{className:"flex items-center gap-6",children:[N.jsxs("div",{className:"text-right",children:[N.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Cost Basis"}),N.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:s(e.costBasis)})]}),N.jsxs("div",{className:"flex items-center gap-2",children:[N.jsx("button",{onClick:()=>(e=>{d(e),m(e.symbol),p(e.shares.toString()),b(e.averageCost.toString()),g("")})(e),className:"p-2 text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Edit holding",children:N.jsx(H,{size:18})}),N.jsx("button",{onClick:()=>(e=>{if(confirm("Are you sure you want to remove this holding?")){const t=r.filter(t=>t.id!==e);a(t)}})(e.id),className:"p-2 text-gray-600 dark:text-gray-400 hover:text-red-600 dark:hover:text-red-400 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Remove holding",children:N.jsx(G,{size:18})})]})]})]},e.id)),N.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:N.jsxs("div",{className:"flex justify-between items-center",children:[N.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:"Total Cost Basis"}),N.jsx("span",{className:"text-xl font-bold text-gray-900 dark:text-white",children:s(f)})]})})]}),N.jsx(M,{isOpen:n||!!l,onClose:()=>{i(!1),d(null),k()},title:l?"Edit Holding":"Add Stock Holding",children:N.jsxs("div",{className:"space-y-4",children:[N.jsxs("div",{children:[N.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Stock Symbol"}),N.jsxs("div",{className:"relative",children:[N.jsx("input",{type:"text",value:h,onChange:e=>m(e.target.value.toUpperCase()),placeholder:"AAPL, MSFT, GOOGL...",className:"w-full px-4 py-2 pl-10 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white uppercase",disabled:o}),N.jsx(Y,{size:20,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"})]})]}),N.jsxs("div",{children:[N.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Number of Shares"}),N.jsx("input",{type:"number",value:u,onChange:e=>p(e.target.value),placeholder:"0.00",step:"0.01",min:"0",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white",disabled:o})]}),N.jsxs("div",{children:[N.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Average Cost per Share"}),N.jsx("input",{type:"number",value:y,onChange:e=>b(e.target.value),placeholder:"0.00",step:"0.01",min:"0",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white",disabled:o})]}),u&&y&&!isNaN(parseFloat(u))&&!isNaN(parseFloat(y))&&N.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:N.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Cost Basis: ",s(v(parseFloat(u)*parseFloat(y)))]})}),x&&N.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:N.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:x})}),N.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[N.jsx("button",{onClick:()=>{i(!1),d(null),k()},className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:"Cancel"}),N.jsxs(K,{isLoading:o,onClick:async()=>{if(g(""),!h||!u||!y)return void g("All fields are required");const t=parseFloat(u),s=parseFloat(y);if(isNaN(t)||t<=0)return void g("Shares must be a positive number");if(isNaN(s)||s<=0)return void g("Average cost must be a positive number");c(!0);try{const t=await async function(t){return null!==await e(t)}(h);if(!t)return g(`Symbol "${h}" not found. Please check and try again.`),void c(!1)}catch(m){return g("Unable to validate symbol. Please try again."),void c(!1)}c(!1);const n=v(t),o=v(s),x=n.times(o);if(l){const e=r.map(e=>e.id===l.id?{...e,symbol:h.toUpperCase(),shares:n,averageCost:o,costBasis:x}:e);a(e),d(null)}else{const e={id:`holding-${Date.now()}`,symbol:h.toUpperCase(),shares:n,averageCost:o,costBasis:x,dateAdded:new Date};a([...r,e]),i(!1)}k()},className:"px-6 py-2 bg-primary text-white rounded-lg hover:bg-secondary transition-colors disabled:opacity-50 disabled:cursor-not-allowed",loadingText:"Validating...",children:[N.jsx(J,{size:16,className:"mr-2"}),l?"Update":"Add"," Holding"]})]})]})})]})}function l({onStockSelect:e}){const[t,r]=re.useState(""),[a,s]=re.useState([]),n=["AAPL","MSFT","GOOGL","AMZN","TSLA","META","NVDA","NFLX","V","JPM","JNJ","WMT","PG","UNH","HD","MA","DIS","VZ","ADBE","NFLX","KO","NKE","CRM","INTC","CSCO","PFE","XOM","CVX"];return N.jsxs("div",{className:"relative",children:[N.jsxs("div",{className:"relative",children:[N.jsx(Y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),N.jsx("input",{type:"text",value:t,onChange:e=>(e=>{if(r(e),e.length>0){const t=n.filter(t=>t.toLowerCase().includes(e.toLowerCase()));s(t.slice(0,10))}else s([])})(e.target.value),placeholder:"Search stocks (e.g., AAPL)",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] focus:border-transparent"})]}),a.length>0&&N.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:a.map(t=>N.jsx("button",{onClick:()=>(t=>{e(t),r(""),s([])})(t),className:"w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-900 dark:text-white",children:t},t))})]})}function d(){const{formatCurrency:e}=de(),[r,a]=oe("stock-watchlist",[]),[s,n]=re.useState(new Map),[i,d]=re.useState(!1),[o,c]=re.useState(!1),[x,g]=re.useState(null),h=async()=>{if(0!==r.length){d(!0);try{const e=await t(r);n(e),g(new Date)}catch(e){console.error("Error fetching watchlist quotes:",e)}finally{d(!1)}}};re.useEffect(()=>{h();const e=setInterval(h,6e4);return()=>clearInterval(e)},[r]);const m=e=>{const t=e.toUpperCase();r.includes(t)||a([...r,t]),c(!1)};return 0===r.length?N.jsxs("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-6",children:[N.jsxs("div",{className:"flex items-center justify-between mb-6",children:[N.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Stock Watchlist"}),N.jsxs("button",{onClick:()=>c(!0),className:"flex items-center gap-2 px-4 py-2 bg-[var(--color-primary)] text-white rounded-lg hover:bg-[var(--color-primary)]/90",children:[N.jsx(W,{size:16}),"Add Stock"]})]}),o?N.jsxs("div",{className:"mb-6",children:[N.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Add Stock to Watchlist"}),N.jsx(l,{onStockSelect:m}),N.jsx("button",{onClick:()=>c(!1),className:"mt-3 text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:"Cancel"})]}):N.jsxs("div",{className:"text-center py-8",children:[N.jsx("div",{className:"text-gray-400 mb-4",children:N.jsx("svg",{className:"mx-auto h-16 w-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:N.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})})}),N.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Stocks in Watchlist"}),N.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Add stocks to your watchlist to track their real-time performance."}),N.jsxs("button",{onClick:()=>c(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-[var(--color-primary)] text-white rounded-lg hover:bg-[var(--color-primary)]/90",children:[N.jsx(W,{size:16}),"Add Your First Stock"]})]})]}):N.jsxs("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-6",children:[N.jsxs("div",{className:"flex items-center justify-between mb-6",children:[N.jsxs("div",{children:[N.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Stock Watchlist"}),x&&N.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Last updated: ",x.toLocaleTimeString()]})]}),N.jsxs("div",{className:"flex items-center gap-2",children:[N.jsxs("button",{onClick:()=>{h()},disabled:i,className:"flex items-center gap-2 px-3 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white disabled:opacity-50",children:[N.jsx(U,{size:16,className:i?"animate-spin":""}),"Refresh"]}),N.jsxs("button",{onClick:()=>c(!0),className:"flex items-center gap-2 px-4 py-2 bg-[var(--color-primary)] text-white rounded-lg hover:bg-[var(--color-primary)]/90",children:[N.jsx(W,{size:16}),"Add Stock"]})]})]}),o&&N.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[N.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Add Stock to Watchlist"}),N.jsx(l,{onStockSelect:m}),N.jsx("button",{onClick:()=>c(!1),className:"mt-3 text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:"Cancel"})]}),N.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(t=>{const l=s.get(t);return N.jsxs("div",{className:"relative",children:[N.jsx("button",{onClick:()=>(e=>{a(r.filter(t=>t!==e));const t=new Map(s);t.delete(e),n(t)})(t),className:"absolute -top-2 -right-2 z-10 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",children:N.jsx(X,{size:12})}),l?N.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[N.jsxs("div",{className:"flex items-center justify-between mb-2",children:[N.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:l.symbol}),i&&N.jsx(U,{size:14,className:"animate-spin text-gray-400"})]}),l.name&&N.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2 truncate",children:l.name}),N.jsxs("div",{className:"flex items-center justify-between mb-2",children:[N.jsx("span",{className:"text-lg font-bold text-gray-900 dark:text-white",children:e(l.price)}),N.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:l.currency})]}),N.jsxs("div",{className:"flex items-center gap-1 text-sm "+(l.change.greaterThanOrEqualTo(0)?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[N.jsxs("span",{children:[l.change.greaterThanOrEqualTo(0)?"+":"",e(l.change)]}),N.jsxs("span",{children:["(",l.change.greaterThanOrEqualTo(0)?"+":"",l.changePercent.toFixed(2),"%)"]})]})]}):N.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[N.jsxs("div",{className:"flex items-center justify-between mb-2",children:[N.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:t}),N.jsx(U,{size:14,className:"animate-spin text-gray-400"})]}),N.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading..."})]})]},t)})})]})}function o({height:e=300}){return N.jsx("div",{className:"w-full",style:{height:e},children:N.jsx(B,{className:"w-full h-full rounded-lg"})})}function c(e){return N.jsx(re.Suspense,{fallback:N.jsx(o,{height:e.height||300}),children:N.jsx(pe,{...e})})}function x(e){return N.jsx(re.Suspense,{fallback:N.jsx(o,{height:e.height||300}),children:N.jsx(ye,{...e})})}function g({children:e,...t}){const[r,a]=re.useState(null);return re.useEffect(()=>{ce(()=>import("./ChartComponents-nikqtBD9.js"),__vite__mapDeps([0,1,2])).then(e=>a(()=>e.ResponsiveContainer))},[]),r?N.jsx(r,{...t,children:e}):N.jsx("div",{style:{width:t.width,height:t.height},children:e})}function h(e){const[t,r]=re.useState(null);return re.useEffect(()=>{ce(()=>import("./ChartComponents-nikqtBD9.js"),__vite__mapDeps([0,1,2])).then(e=>r(()=>e.Tooltip))},[]),t?N.jsx(t,{...e}):null}function m(e){const[t,r]=re.useState(null);return re.useEffect(()=>{ce(()=>import("./ChartComponents-nikqtBD9.js"),__vite__mapDeps([0,1,2])).then(e=>r(()=>e.Cell))},[]),t?N.jsx(t,{...e}):null}function u(e){const[t,r]=re.useState(null);return re.useEffect(()=>{ce(()=>import("./ChartComponents-nikqtBD9.js"),__vite__mapDeps([0,1,2])).then(e=>r(()=>e.Pie))},[]),t?N.jsx(t,{...e}):null}function p(e){const[t,r]=re.useState(null);return re.useEffect(()=>{ce(()=>import("./ChartComponents-nikqtBD9.js"),__vite__mapDeps([0,1,2])).then(e=>r(()=>e.Line))},[]),t?N.jsx(t,{...e}):null}function y(e){const[t,r]=re.useState(null);return re.useEffect(()=>{ce(()=>import("./ChartComponents-nikqtBD9.js"),__vite__mapDeps([0,1,2])).then(e=>r(()=>e.XAxis))},[]),t?N.jsx(t,{...e}):null}function b(e){const[t,r]=re.useState(null);return re.useEffect(()=>{ce(()=>import("./ChartComponents-nikqtBD9.js"),__vite__mapDeps([0,1,2])).then(e=>r(()=>e.YAxis))},[]),t?N.jsx(t,{...e}):null}function k(e){const[t,r]=re.useState(null);return re.useEffect(()=>{ce(()=>import("./ChartComponents-nikqtBD9.js"),__vite__mapDeps([0,1,2])).then(e=>r(()=>e.CartesianGrid))},[]),t?N.jsx(t,{...e}):null}function j(){const{accounts:e,transactions:t,updateAccount:r}=E(),{formatCurrency:l}=de(),[o,j]=re.useState("1Y"),[f,w]=re.useState(null),[C,T]=re.useState(!1),[S,A]=re.useState("overview"),[P,D]=re.useState(null),M=e=>new Intl.NumberFormat("en-GB",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e)+"%",L=e.filter(e=>"investment"===e.type),F=L.reduce((e,t)=>e+t.balance,0),I=t.filter(e=>e.category?.toLowerCase().includes("invest")||L.some(t=>e.accountId===t.id)),_=I.filter(e=>"expense"===e.type).reduce((e,t)=>e+t.amount,0),q=F-_,z=_>0?q/_*100:0,U=L.map(e=>{const t="string"==typeof e.balance?parseFloat(e.balance):e.balance;return{name:e.name,value:t,allocation:F>0?t/F*100:0,return:0,ticker:e.institution||"N/A"}}),B=(()=>{const e=[],t=new Date;let r=12;switch(o){case"1M":r=1;break;case"3M":r=3;break;case"6M":r=6;break;case"1Y":r=12;break;case"ALL":{const e=I.reduce((e,t)=>{const r=new Date(t.date);return r<e?r:e},new Date);r=Math.max(12,Math.ceil((t.getTime()-e.getTime())/2592e6));break}}let a=0;for(let s=r-1;s>=0;s--){const r=new Date(t.getFullYear(),t.getMonth()-s,1),n=I.filter(e=>new Date(e.date)<=new Date(r.getFullYear(),r.getMonth()+1,0));a=n.filter(e=>"expense"===e.type).reduce((e,t)=>e+t.amount,0)-n.filter(e=>"income"===e.type).reduce((e,t)=>e+t.amount,0),0===s?a=F:a*=1+(z>0?z/100/12:0)*s,e.push({month:r.toLocaleString("default",{month:"short"}),value:Math.max(0,a)})}return e})(),$=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#06B6D4","#84CC16"];return 0===L.length?N.jsxs("div",{children:[N.jsx("div",{className:"bg-secondary dark:bg-gray-700 rounded-2xl shadow p-4 mb-6",children:N.jsx("h1",{className:"text-3xl font-bold text-white",children:"Investments"})}),N.jsxs("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-8 text-center",children:[N.jsx(Z,{className:"mx-auto text-gray-400 mb-4",size:64}),N.jsx("h2",{className:"text-xl font-semibold text-theme-heading dark:text-white mb-2",children:"No Investment Accounts Yet"}),N.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Add an investment account to start tracking your portfolio performance."}),N.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-500",children:'Go to Accounts \u2192 Add Account \u2192 Choose "Investment" as the account type'})]})]}):N.jsxs(xe,{title:"Investments",rightContent:L.length>0&&N.jsx("div",{onClick:()=>T(!0),className:"cursor-pointer",title:"Add Investment",children:N.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",className:"transition-all duration-200 hover:scale-110 drop-shadow-lg hover:drop-shadow-xl",style:{filter:"drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1))"},children:[N.jsx("circle",{cx:"24",cy:"24",r:"24",fill:"#D9E1F2",className:"transition-all duration-200",onMouseEnter:e=>e.currentTarget.setAttribute("fill","#C5D3E8"),onMouseLeave:e=>e.currentTarget.setAttribute("fill","#D9E1F2")}),N.jsx("g",{transform:"translate(12, 12)",children:N.jsx("path",{d:"M12 5v14M5 12h14",stroke:"#1F2937",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})}),children:[N.jsxs("div",{className:"flex space-x-1 bg-gray-100 dark:bg-gray-700 p-1 rounded-lg mb-6",children:[N.jsxs("button",{onClick:()=>A("overview"),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium rounded-md transition-colors "+("overview"===S?"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),children:[N.jsx(Z,{size:16}),"Overview"]}),N.jsxs("button",{onClick:()=>A("watchlist"),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium rounded-md transition-colors "+("watchlist"===S?"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),children:[N.jsx(Q,{size:16}),"Watchlist"]}),N.jsxs("button",{onClick:()=>A("portfolio"),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium rounded-md transition-colors "+("portfolio"===S?"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),children:[N.jsx(ee,{size:16}),"Portfolio"]}),N.jsxs("button",{onClick:()=>A("manage"),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium rounded-md transition-colors "+("manage"===S?"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),children:[N.jsx(W,{size:16}),"Manage"]})]}),"overview"===S&&N.jsxs("div",{className:"grid gap-6",children:[N.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[N.jsx("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-6",children:N.jsxs("div",{className:"flex items-center justify-between",children:[N.jsxs("div",{children:[N.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Portfolio Value"}),N.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:l(F)})]}),N.jsx(Z,{className:"text-primary",size:24})]})}),N.jsx("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-6",children:N.jsxs("div",{className:"flex items-center justify-between",children:[N.jsxs("div",{children:[N.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Invested"}),N.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:l(_)})]}),N.jsx(Z,{className:"text-blue-500",size:24})]})}),N.jsx("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-6",children:N.jsxs("div",{className:"flex items-center justify-between",children:[N.jsxs("div",{children:[N.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Return"}),N.jsxs("p",{className:"text-2xl font-bold "+(q>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[q>=0?"+":"",l(q)]})]}),N.jsx(V,{className:q>=0?"text-green-500":"text-red-500",size:24})]})}),N.jsx("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-6",children:N.jsxs("div",{className:"flex items-center justify-between",children:[N.jsxs("div",{children:[N.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Return %"}),N.jsxs("p",{className:"text-2xl font-bold "+(z>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[z>=0?"+":"",M(z)]})]}),N.jsx(R,{className:z>=0?"text-green-500":"text-red-500",size:24})]})})]}),N.jsxs("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-6",children:[N.jsxs("div",{className:"flex justify-between items-center mb-4",children:[N.jsx("h2",{className:"text-xl font-semibold text-theme-heading dark:text-white",children:"Portfolio Performance"}),N.jsx("div",{className:"flex gap-2",children:["1M","3M","6M","1Y","ALL"].map(e=>N.jsx("button",{onClick:()=>j(e),className:"px-3 py-1 text-sm rounded-lg transition-colors "+(o===e?"bg-primary text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),children:e},e))})]}),N.jsx("div",{className:"h-64",children:N.jsx(g,{width:"100%",height:"100%",children:N.jsxs(x,{data:B,children:[N.jsx(k,{strokeDasharray:"3 3",stroke:"#374151"}),N.jsx(y,{dataKey:"month",stroke:"#9CA3AF"}),N.jsx(b,{stroke:"#9CA3AF",tickFormatter:e=>{const t=l(e);return e>=1e3?`${t.charAt(0)}${(e/1e3).toFixed(0)}k`:t}}),N.jsx(h,{formatter:e=>l(e),contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid #ccc",borderRadius:"8px"}}),N.jsx(p,{type:"monotone",dataKey:"value",stroke:"#3B82F6",strokeWidth:2,dot:{fill:"#3B82F6"}})]})})})]}),N.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[N.jsxs("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-6",children:[N.jsx("h2",{className:"text-xl font-semibold mb-4 text-theme-heading dark:text-white",children:"Holdings"}),0===U.length?N.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:"No holdings to display"}):N.jsx("div",{className:"space-y-4",children:U.map((e,t)=>{const r=L.find(t=>t.name===e.name);return r?N.jsxs("div",{className:"border-b dark:border-gray-700 pb-4 last:border-0 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 -mx-2 px-2 py-2 rounded",onClick:()=>w(r.id),children:[N.jsxs("div",{className:"flex justify-between items-start mb-2",children:[N.jsxs("div",{className:"flex items-center gap-2",children:[N.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:$[t%$.length]}}),N.jsxs("div",{children:[N.jsx("h3",{className:"font-medium text-gray-900 dark:text-white hover:text-primary dark:hover:text-primary transition-colors",children:e.name}),N.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.ticker})]})]}),N.jsxs("div",{className:"flex items-center gap-2",children:[N.jsx("div",{className:"text-right",children:N.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:l(e.value)})}),r.holdings&&r.holdings.length>0&&N.jsx(te,{className:"text-gray-400",size:20})]})]}),N.jsxs("div",{className:"flex items-center gap-2",children:[N.jsx("div",{className:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:N.jsx("div",{className:"h-2 rounded-full",style:{width:`${e.allocation}%`,backgroundColor:$[t%$.length]}})}),N.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 w-12 text-right",children:M(e.allocation)})]})]},r.id):null})})]}),N.jsxs("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-6",children:[N.jsx("h2",{className:"text-xl font-semibold mb-4 text-theme-heading dark:text-white",children:"Asset Allocation"}),0===U.length?N.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:"No data to display"}):N.jsxs(N.Fragment,{children:[N.jsx("div",{className:"h-64",children:N.jsx(g,{width:"100%",height:"100%",children:N.jsxs(c,{children:[N.jsx(u,{data:U,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",children:U.map((e,t)=>N.jsx(m,{fill:$[t%$.length]},`cell-${t}`))}),N.jsx(h,{formatter:e=>l(e),contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid #ccc",borderRadius:"8px"}})]})})}),N.jsx("div",{className:"mt-4 space-y-2",children:U.map((e,t)=>N.jsxs("div",{className:"flex items-center justify-between text-sm",children:[N.jsxs("div",{className:"flex items-center gap-2",children:[N.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:$[t%$.length]}}),N.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:e.ticker})]}),N.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:M(e.allocation)})]},e.name))})]})]})]}),N.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-2xl p-6",children:N.jsxs("div",{className:"flex items-start gap-3",children:[N.jsx(O,{className:"text-blue-600 dark:text-blue-400 mt-1",size:20}),N.jsxs("div",{children:[N.jsx("h3",{className:"font-semibold text-blue-900 dark:text-blue-300 mb-2",children:"Investment Tips"}),N.jsxs("ul",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1",children:[N.jsx("li",{children:"\u2022 Add investment accounts to track your portfolio"}),N.jsx("li",{children:"\u2022 Record investment transactions with appropriate categories"}),N.jsx("li",{children:"\u2022 Review your asset allocation regularly"}),N.jsx("li",{children:"\u2022 Consider your risk tolerance and investment timeline"})]})]})]})})]}),"watchlist"===S&&N.jsx(d,{}),"portfolio"===S&&N.jsx("div",{className:"space-y-6",children:0===L.length?N.jsxs("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-8 text-center",children:[N.jsx(Z,{className:"mx-auto text-gray-400 mb-4",size:64}),N.jsx("h2",{className:"text-xl font-semibold text-theme-heading dark:text-white mb-2",children:"No Investment Accounts Yet"}),N.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Add an investment account to start tracking your portfolio performance with real-time data."}),N.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-500",children:'Go to Accounts \u2192 Add Account \u2192 Choose "Investment" as the account type'})]}):N.jsxs("div",{className:"space-y-6",children:[N.jsxs("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-6",children:[N.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Combined Portfolio"}),N.jsx(n,{holdings:L.flatMap(e=>(e.holdings||[]).map(e=>({symbol:e.symbol||e.ticker,shares:v(e.shares),averageCost:v(e.averageCost||e.costBasis/e.shares||e.value/e.shares),costBasis:v(e.costBasis||e.shares*(e.averageCost||e.value/e.shares))}))),baseCurrency:L[0]?.currency||"USD"})]}),L.map(e=>N.jsxs("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-6",children:[N.jsxs("div",{className:"flex justify-between items-center mb-4",children:[N.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e.name}),N.jsx("button",{onClick:()=>{D(e.id),A("manage")},className:"text-sm text-primary hover:text-secondary transition-colors",children:"Manage Holdings \u2192"})]}),e.holdings&&e.holdings.length>0?N.jsx(n,{holdings:e.holdings.map(e=>({symbol:e.symbol||e.ticker,shares:v(e.shares),averageCost:v(e.averageCost||e.costBasis/e.shares||e.value/e.shares),costBasis:v(e.costBasis||e.shares*(e.averageCost||e.value/e.shares))})),baseCurrency:e.currency}):N.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-4",children:'No holdings in this account. Click "Manage Holdings" to add stocks.'})]},e.id))]})}),"manage"===S&&N.jsx("div",{className:"space-y-6",children:0===L.length?N.jsxs("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-8 text-center",children:[N.jsx(Z,{className:"mx-auto text-gray-400 mb-4",size:64}),N.jsx("h2",{className:"text-xl font-semibold text-theme-heading dark:text-white mb-2",children:"No Investment Accounts Yet"}),N.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Add an investment account to start managing your portfolio holdings."})]}):N.jsxs("div",{className:"space-y-6",children:[N.jsxs("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-4",children:[N.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Select Investment Account"}),N.jsxs("select",{value:P||"",onChange:e=>D(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white",children:[N.jsx("option",{value:"",children:"Choose an account..."}),L.map(e=>N.jsx("option",{value:e.id,children:e.name},e.id))]})]}),P&&(()=>{const e=L.find(e=>e.id===P);return e?N.jsx("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-6",children:N.jsx(i,{accountId:e.id,holdings:(e.holdings||[]).map(t=>({id:`${e.id}-${t.ticker}`,symbol:t.ticker,shares:v(t.shares),averageCost:v(t.averageCost||t.value/t.shares),costBasis:v(t.shares*(t.averageCost||t.value/t.shares)),dateAdded:t.lastUpdated||new Date})),onUpdate:t=>{const a={...e,holdings:t.map(e=>({ticker:e.symbol,name:e.symbol,shares:e.shares.toNumber(),value:e.costBasis.toNumber(),averageCost:e.averageCost.toNumber(),lastUpdated:new Date}))};r(a)}})}):null})()]})}),f&&(()=>{const e=L.find(e=>e.id===f);return e?N.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:N.jsx("div",{className:"bg-[#D9E1F2] dark:bg-gray-900 rounded-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden border-2 border-blue-300 dark:border-gray-700",children:N.jsx(a,{accountId:f,accountName:e.name,holdings:e.holdings||[],currency:e.currency,onClose:()=>w(null)})})}):null})(),N.jsx(s,{isOpen:C,onClose:()=>T(!1)})]})}import{al as f,F as v,j as N,E as w,am as C,v as T,an as S,ao as A,ap as P,g as E,D,M,m as L,x as F,q as I,aq as _,ar as O,W as q,as as z,at as U,au as B,av as $,T as V,J as R,ag as W,Q as H,V as G,a3 as Y,aw as K,_ as J,X,B as Z,ax as Q,ay as ee,a7 as te}from"./index-CgJz7Gw0.js";import{a as re,w as ae}from"./chunk-BWx9oMeS.js";import{e as se,E as ne,a as ie,r as le}from"./chunk-CpxUZIWP.js";import{u as de}from"./chunk-tt7ooTmr.js";import{u as oe}from"./chunk-DpoEFI3w.js";import{_ as ce}from"./chunk-C1eKK5Oc.js";import{P as xe}from"./chunk-DLeAFLQD.js";import"./chunk-BN8kgYrt.js";const ge=new Map,he=["https://query1.finance.yahoo.com/v8/finance/chart/","https://query2.finance.yahoo.com/v8/finance/chart/"],me=new class{intervals=new Map;subscriptions=new Map;updateFrequency=3e4;isMarketOpen=!1;marketCheckInterval=null;eventListeners=new Map;constructor(){this.checkMarketStatus(),this.marketCheckInterval=setInterval(()=>this.checkMarketStatus(),3e5)}emit(e,t){const r=this.eventListeners.get(e);r&&r.forEach(r=>{try{r(t)}catch(a){console.error(`Error in event listener for ${e}:`,a)}})}on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e).add(t)}off(e,t){const r=this.eventListeners.get(e);r&&(r.delete(t),0===r.size&&this.eventListeners.delete(e))}checkMarketStatus(){const e=new Date,t=e.getDay(),r=60*e.getHours()+e.getMinutes()-(e.getTimezoneOffset()-300);this.isMarketOpen=t>=1&&t<=5&&r>=570&&r<960,this.updateFrequency=this.isMarketOpen?3e4:3e5}subscribe(e,t){const r=e.toUpperCase();return this.subscriptions.has(r)||this.subscriptions.set(r,new Set),this.subscriptions.get(r).add(t),this.intervals.has(r)||(this.startPolling(r),this.fetchAndBroadcast(r)),()=>{const e=this.subscriptions.get(r);e&&(e.delete(t),0===e.size&&(this.stopPolling(r),this.subscriptions.delete(r)))}}subscribeMultiple(e,t){const r=e.map(e=>this.subscribe(e,t));return()=>r.forEach(e=>e())}startPolling(e){const t=setInterval(()=>{this.fetchAndBroadcast(e)},this.updateFrequency);this.intervals.set(e,t)}stopPolling(e){const t=this.intervals.get(e);t&&(clearInterval(t),this.intervals.delete(e))}async fetchAndBroadcast(t){try{const r=await e(t);if(r){const e={symbol:t,quote:r,timestamp:new Date};this.emit("priceUpdate",{symbol:e.symbol,quote:{...e.quote,price:e.quote.price.toString(),change:e.quote.change.toString(),changePercent:e.quote.changePercent.toString(),previousClose:e.quote.previousClose.toString(),marketCap:e.quote.marketCap?.toString(),dayHigh:e.quote.dayHigh?.toString(),dayLow:e.quote.dayLow?.toString(),fiftyTwoWeekHigh:e.quote.fiftyTwoWeekHigh?.toString(),fiftyTwoWeekLow:e.quote.fiftyTwoWeekLow?.toString()},timestamp:e.timestamp.toISOString()});const a=this.subscriptions.get(t);a&&a.forEach(r=>{try{r(e)}catch(a){console.error(`Error in price update callback for ${t}:`,a)}})}}catch(r){console.error(`Error fetching price for ${t}:`,r),this.emit("error",{symbol:t,error:String(r)})}}setUpdateFrequency(e){this.updateFrequency=Math.max(1e4,e),this.intervals.forEach((e,t)=>{this.stopPolling(t),this.startPolling(t)})}getMarketStatus(){return{isOpen:this.isMarketOpen,nextCheck:new Date(Date.now()+3e5)}}dispose(){this.intervals.forEach(e=>clearInterval(e)),this.intervals.clear(),this.subscriptions.clear(),this.marketCheckInterval&&clearInterval(this.marketCheckInterval),this.eventListeners.clear()}},ue=document.createElement("style");ue.textContent="\n  @keyframes priceFlash {\n    0% { opacity: 0; }\n    50% { opacity: 1; }\n    100% { opacity: 0; }\n  }\n  \n  .price-update {\n    animation: priceFlash 0.5s ease-in-out;\n  }\n",document.head.appendChild(ue);const pe=re.lazy(()=>ce(()=>import("./PieChartWrapper-BJQINqwI.js"),__vite__mapDeps([3,1,2])));re.lazy(()=>ce(()=>import("./BarChartWrapper-B83pkzBO.js"),__vite__mapDeps([4,1,2])));const ye=re.lazy(()=>ce(()=>import("./LineChartWrapper-DaUhqEl1.js"),__vite__mapDeps([5,1,2])));re.lazy(()=>ce(()=>import("./AreaChartWrapper-Daf9nNsu.js"),__vite__mapDeps([6,1,2]))),re.lazy(()=>ce(()=>import("./TreemapWrapper-C14VTw9k.js"),__vite__mapDeps([7,1,2]))),re.lazy(()=>ce(()=>import("./ChartComponents-nikqtBD9.js"),__vite__mapDeps([0,1,2])));export{j as default};
