import{s as t}from"./chunk-CkYa08k9.js";const e=new class{parseQIF(t){const e=t.split("\n").map(t=>t.trim()),a=[];let s,n={};for(const r of e){if(r.startsWith("!Type:")){s=r.substring(6);continue}if("^"===r){n.date&&void 0!==n.amount&&a.push(n),n={};continue}const t=r.charAt(0),e=r.substring(1);switch(t){case"D":n.date=this.parseQIFDate(e);break;case"T":case"U":n.amount=this.parseAmount(e);break;case"P":n.payee=e;break;case"M":n.memo=e;break;case"L":n.category=e.replace(/[[\]]/g,"");break;case"N":n.checkNumber=e;break;case"C":n.cleared="X"===e||"*"===e}}return n.date&&void 0!==n.amount&&a.push(n),{transactions:a,accountType:s}}parseQIFDate(t){const e=(t=t.replace(/'/g,"/")).split("/");if(3!==e.length){const e=new Date(t);return isNaN(e.getTime())?(new Date).toISOString().split("T")[0]:e.toISOString().split("T")[0]}let[a,s,n]=e;if(2===n.length){const t=(new Date).getFullYear(),e=100*Math.floor(t/100),a=parseInt(n);n=a>t%100+10?(e-100+a).toString():(e+a).toString()}return a=a.padStart(2,"0"),s=s.padStart(2,"0"),`${n}-${a}-${s}`}parseAmount(t){const e=(t=t.replace(/[\xa3$\u20ac\xa5,\s]/g,"")).startsWith("-")||t.startsWith("(")||t.endsWith(")");t=t.replace(/[()+-]/g,"");const a=parseFloat(t)||0;return e?-Math.abs(a):Math.abs(a)}async importTransactions(e,a,s,n={}){const r=this.parseQIF(e),o=[];let c=0;for(const i of r.transactions){if(s.some(t=>{const e=("string"==typeof t.date?t.date:t.date.toISOString().split("T")[0])===i.date,a=Math.abs(t.amount-Math.abs(i.amount))<.01,s=i.payee&&t.description.includes(i.payee);return e&&a&&(s||!i.payee)})){c++;continue}const e=Math.abs(i.amount),r=i.amount<0?"expense":"income";let p=i.payee||"";i.memo&&i.memo!==p&&(p=p?`${p} - ${i.memo}`:i.memo),p=p||"QIF Transaction";const u={date:i.date,description:p,amount:e,type:r,accountId:a,category:i.category||"",cleared:i.cleared||!1,notes:i.checkNumber?`Check #: ${i.checkNumber}`:void 0,recurring:!1};if(n.autoCategorize&&n.categories&&!u.category){s.length>0&&t.learnFromTransactions(s,n.categories);const e=t.suggestCategories(u,1);e.length>0&&e[0].confidence>=.7&&(u.category=e[0].categoryId)}o.push(u)}return{transactions:o,duplicates:c,newTransactions:o.length}}};export{e as q};
