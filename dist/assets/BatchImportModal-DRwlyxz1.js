function e({isOpen:e,onClose:h}){const{accounts:y,transactions:b,addTransaction:f,hasTestData:j,clearAllData:k}=s(),[N,v]=m.useState([]),[w,C]=m.useState(!1),[z,F]=m.useState(-1),[D,I]=m.useState(!1),[M,S]=m.useState(null),T=e=>{switch(e.toLowerCase().split(".").pop()){case"csv":return"csv";case"ofx":return"ofx";case"qif":return"qif";default:return"unknown"}},q=e=>e<1024?e+" bytes":e<1048576?Math.round(e/1024)+" KB":Math.round(e/1048576)+" MB",A=m.useCallback(e=>{const s=Array.from(e.target.files||[]).map(e=>({file:e,name:e.name,size:q(e.size),type:T(e.name),status:"pending"})),t=s.filter(e=>"unknown"!==e.type),a=s.filter(e=>"unknown"===e.type);a.length>0&&alert(`Unsupported file types: ${a.map(e=>e.name).join(", ")}`),v(t)},[]),O=m.useCallback(e=>{e.preventDefault();const s=Array.from(e.dataTransfer.files).map(e=>({file:e,name:e.name,size:q(e.size),type:T(e.name),status:"pending"})),t=s.filter(e=>"unknown"!==e.type),a=s.filter(e=>"unknown"===e.type);a.length>0&&alert(`Unsupported file types: ${a.map(e=>e.name).join(", ")}`),v(e=>[...e,...t])},[]),P=async(e,s)=>{F(s),v(e=>e.map((e,t)=>t===s?{...e,status:"processing"}:e));try{const t=await e.file.text();let a=0,r=0,n="";switch(e.type){case"csv":{const e=p.parseCSV(t),s=p.suggestMappings(e.headers,"transaction"),i=p.generatePreview(e.data,s),l=new Set;i.transactions.forEach(e=>{e.accountId&&l.add(e.accountId)}),1===l.size?n=Array.from(l)[0]:0===l.size&&y.length>0&&(n=y[0].id);for(const t of i.transactions)!b.some(e=>e.date===t.date&&e.amount===t.amount&&e.description===t.description)&&t.date&&void 0!==t.amount&&t.description&&t.category&&t.type?(await f({date:t.date,amount:t.amount,description:t.description,category:t.category,type:t.type,accountId:t.accountId||n,tags:t.tags,notes:t.notes}),a++):r++;break}case"ofx":{const e=await g.importTransactions(t,y,b,{});n=e.matchedAccount?.id||y[0]?.id||"";for(const s of e.transactions)await f(s),a++;r=e.duplicates;break}case"qif":{const e=await u.importTransactions(t,y[0]?.id||"",b,{});n=y[0]?.id||"";for(const s of e.transactions)await f(s),a++;r=e.duplicates;break}}v(e=>e.map((e,t)=>t===s?{...e,status:"success",imported:a,duplicates:r,accountMatched:n}:e))}catch(t){v(e=>e.map((e,a)=>a===s?{...e,status:"error",error:t instanceof Error?t.message:"Import failed"}:e))}},B=async()=>{if(j&&!D)return void I(!0);j&&k(),C(!0),S(null);let e=0,s=0,t=0;for(let a=0;a<N.length;a++)if("pending"===N[a].status){await P(N[a],a);const r=N[a];"success"===r.status&&(t++,e+=r.imported||0,s+=r.duplicates||0)}S({totalFiles:N.length,successfulFiles:t,totalTransactions:e,totalDuplicates:s}),C(!1),F(-1)},U=e=>{switch(e){case"csv":return"\ud83d\udcca";case"ofx":return"\ud83c\udfe6";case"qif":return"\ud83d\udcb0";default:return"\ud83d\udcc4"}},E=e=>{switch(e){case"success":return t.jsx(n,{size:16,className:"text-green-600"});case"error":return t.jsx(c,{size:16,className:"text-red-600"});case"processing":return t.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-primary border-t-transparent rounded-full"});default:return null}};return t.jsx(a,{isOpen:e,onClose:h,title:"Batch Import Files",size:"xl",children:t.jsx("div",{className:"p-6",children:D&&j?t.jsxs("div",{className:"text-center",children:[t.jsx(r,{size:48,className:"mx-auto text-yellow-500 mb-4"}),t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Clear Test Data?"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"You have test data loaded. Importing real data will clear all existing test data."}),t.jsxs("div",{className:"flex gap-3 justify-center",children:[t.jsx("button",{onClick:()=>I(!1),className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:"Cancel"}),t.jsx("button",{onClick:B,className:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90",children:"Clear Test Data & Import"})]})]}):M?t.jsxs("div",{className:"text-center",children:[t.jsx(n,{size:48,className:"mx-auto text-green-600 mb-4"}),t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Import Complete!"}),t.jsx("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 mb-6",children:t.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Files Processed"}),t.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[M.successfulFiles,"/",M.totalFiles]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Transactions Imported"}),t.jsx("p",{className:"text-2xl font-bold text-green-600",children:M.totalTransactions})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Duplicates Skipped"}),t.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:M.totalDuplicates})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Success Rate"}),t.jsxs("p",{className:"text-2xl font-bold text-primary",children:[Math.round(M.successfulFiles/M.totalFiles*100),"%"]})]})]})}),t.jsxs("div",{className:"flex gap-3 justify-center",children:[t.jsx("button",{onClick:()=>{v([]),S(null),I(!1)},className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:"Import More Files"}),t.jsx("button",{onClick:h,className:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90",children:"Done"})]})]}):t.jsx(t.Fragment,{children:0===N.length?t.jsxs("div",{onDrop:O,onDragOver:e=>e.preventDefault(),className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-12 text-center hover:border-primary transition-colors",children:[t.jsx(i,{size:48,className:"mx-auto text-gray-400 mb-4"}),t.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-900 dark:text-white",children:"Drop files here or click to browse"}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Support for CSV, OFX, and QIF files"}),t.jsxs("label",{className:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 cursor-pointer",children:[t.jsx(l,{size:20}),"Select Files",t.jsx("input",{type:"file",multiple:!0,accept:".csv,.ofx,.qif",onChange:A,className:"hidden"})]})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white",children:[N.length," file",1!==N.length?"s":""," selected"]}),t.jsxs("label",{className:"inline-flex items-center gap-2 px-3 py-1.5 text-sm bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 cursor-pointer",children:[t.jsx(l,{size:16}),"Add More",t.jsx("input",{type:"file",multiple:!0,accept:".csv,.ofx,.qif",onChange:A,className:"hidden"})]})]}),t.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:N.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg border "+("error"===e.status?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":"success"===e.status?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"processing"===e.status?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800":"bg-gray-50 dark:bg-gray-700/50 border-gray-200 dark:border-gray-700"),children:[t.jsx("div",{className:"text-2xl",children:U(e.type)}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),E(e.status)]}),t.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.size," \u2022 ",e.type.toUpperCase(),"success"===e.status&&void 0!==e.imported&&t.jsxs("span",{className:"ml-2 text-green-600",children:[e.imported," imported, ",e.duplicates," duplicates"]}),"error"===e.status&&e.error&&t.jsx("span",{className:"ml-2 text-red-600",children:e.error}),e.accountMatched&&t.jsxs("span",{className:"ml-2 text-primary",children:["\u2192 ",y.find(s=>s.id===e.accountMatched)?.name]})]})]}),"pending"===e.status&&!w&&t.jsx("button",{onClick:()=>(e=>{v(N.filter((s,t)=>t!==e))})(s),className:"p-1 text-gray-400 hover:text-red-600 transition-colors",children:t.jsx(c,{size:20})})]},s))})]}),w&&t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[t.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Processing file ",z+1," of ",N.length]}),t.jsxs("span",{className:"text-primary",children:[Math.round((z+1)/N.length*100),"%"]})]}),t.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:t.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:(z+1)/N.length*100+"%"}})})]}),t.jsxs("div",{className:"flex gap-3 justify-end",children:[t.jsx("button",{onClick:h,disabled:w,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg disabled:opacity-50",children:"Cancel"}),t.jsx(d,{onClick:B,disabled:0===N.length,isLoading:w,className:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 disabled:opacity-50 flex items-center gap-2",children:w?t.jsxs(t.Fragment,{children:[t.jsx(o,{size:20}),"Processing..."]}):t.jsxs(t.Fragment,{children:[t.jsx(x,{size:20}),"Import All Files"]})})]})]})})})})}import{g as s,j as t,M as a,ar as r,_ as n,bn as i,bo as l,X as c,aw as d,aD as o,aC as x}from"./index-CgJz7Gw0.js";import{a as m}from"./chunk-BWx9oMeS.js";import{e as p}from"./chunk-5nUEduVz.js";import{o as g}from"./chunk-BfKHasoP.js";import{q as u}from"./chunk-tZvAe11p.js";import"./chunk-BN8kgYrt.js";import"./chunk-C1eKK5Oc.js";import"./chunk-CkYa08k9.js";import"./chunk-BUNwFMNM.js";export{e as default};
