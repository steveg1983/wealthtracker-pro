function e({selectedTags:e,onTagsChange:t,placeholder:r="Add tags...",allowNewTags:n=!0,className:c=""}){const{tags:d,addTag:i,getTagUsageCount:l}=a(),[g,m]=T.useState(""),[x,u]=T.useState(!1),[p,h]=T.useState(-1),y=T.useRef(null),b=T.useRef(null),f=d.filter(t=>t.name.toLowerCase().includes(g.toLowerCase())&&!e.includes(t.name)),j=d.find(e=>e.name.toLowerCase()===g.toLowerCase());T.useEffect(()=>{const e=e=>{b.current&&!b.current.contains(e.target)&&(u(!1),h(-1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const k=a=>{e.includes(a)||t([...e,a]),m(""),u(!1),h(-1)},N=e=>{i({name:e,color:"#6B7280",description:"Created during transaction entry"}),k(e)},v=e=>{const t=d.find(t=>t.name===e);return t?.color||"#6B7280"};return s.jsxs("div",{className:`relative ${c}`,ref:b,children:[e.length>0&&s.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:e.map(a=>s.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-white rounded-full text-sm font-medium",style:{backgroundColor:v(a)},children:[a,s.jsx("button",{type:"button",onClick:()=>{return r=a,void t(e.filter(e=>e!==r));var r},className:"text-white/80 hover:text-white",children:s.jsx(I,{size:14})})]},a))}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{ref:y,type:"text",value:g,onChange:e=>{const t=e.target.value;m(t),u(t.length>0),h(-1)},onFocus:()=>{g.length>0&&u(!0)},onKeyDown:e=>{if(!x)return;const t=f.length+(n&&g.trim()&&!j?1:0);switch(e.key){case"ArrowDown":e.preventDefault(),h(e=>(e+1)%t);break;case"ArrowUp":e.preventDefault(),h(e=>e<=0?t-1:e-1);break;case"Enter":e.preventDefault(),p>=0&&p<f.length?k(f[p].name):p===f.length&&n&&g.trim()&&!j?N(g.trim()):g.trim()&&(j?k(j.name):n&&N(g.trim()));break;case"Escape":u(!1),h(-1)}},placeholder:r,className:"w-full px-3 py-2 h-[42px] bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-300/50 dark:border-gray-600/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white"}),x&&(f.length>0||n&&g.trim()&&!j)&&s.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-60 overflow-y-auto z-50",children:[f.map((e,t)=>{const a=l(e.name);return s.jsxs("div",{className:"px-3 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 "+(p===t?"bg-gray-100 dark:bg-gray-600":""),onClick:()=>k(e.name),children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),s.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),s.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",a," uses)"]})]}),e.description&&s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 ml-5",children:e.description})]},e.id)}),n&&g.trim()&&!j&&s.jsxs("div",{className:"px-3 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 border-t border-gray-200 dark:border-gray-600 "+(p===f.length?"bg-gray-100 dark:bg-gray-600":""),onClick:()=>N(g.trim()),children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(o,{size:14,className:"text-green-600 dark:text-green-400"}),s.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:['Create "',g.trim(),'"']})]}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 ml-5",children:"Create new tag and add to transaction"})]})]})]}),0===e.length&&s.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 flex items-center gap-1",children:[s.jsx(z,{size:12}),"Type to search existing tags or create new ones"]})]})}function t({isOpen:t,onClose:n,transaction:o}){const{accounts:I,categories:z,updateTransaction:W,deleteTransaction:F,getSubCategories:L,getDetailCategories:A}=a(),{addTransaction:E}=function(){const{addTransaction:e,transactions:t}=a(),{checkLargeTransaction:s,checkEnhancedTransactionAlerts:n}=r();return{addTransaction:T.useCallback(a=>{const r={...a,id:`transaction-${Date.now()}`};e(a),n(r,t),"expense"===a.type&&s(a.amount,a.description)},[e,s,n,t])}}(),[M,O]=T.useState(!1),[q,$]=T.useState(!1),[R,B]=T.useState({}),[H,G]=T.useState(""),U=T.useRef(null),X=o?{date:o.date instanceof Date?o.date.toISOString().split("T")[0]:new Date(o.date).toISOString().split("T")[0],description:o.description,amount:"transfer"===o.type?o.amount.toString():Math.abs(o.amount).toString(),type:o.type,category:"",subCategory:"",accountId:o.accountId,tags:o.tags||[],notes:o.notes||"",cleared:o.cleared||!1,reconciledWith:o.reconciledWith||""}:{date:(new Date).toISOString().split("T")[0],description:"",amount:"",type:"expense",category:"",subCategory:"",accountId:I.length>0?I[0].id:"",tags:[],notes:"",cleared:!1,reconciledWith:""},{formData:Y,updateField:J,handleSubmit:K,setFormData:P}=c(X,{onSubmit:e=>{try{B({});const t=C.validateTransaction({id:o?.id,description:e.description,amount:e.amount,type:"transfer"===e.type?"expense":e.type,category:e.category,accountId:e.accountId,date:e.date,tags:e.tags.length>0?e.tags:void 0,notes:e.notes.trim()||void 0}),a={date:new Date(t.date),description:t.description,amount:parseFloat(t.amount),type:e.type,category:t.category,accountId:t.accountId,tags:t.tags,notes:t.notes,cleared:e.cleared,reconciledWith:e.reconciledWith.trim()||void 0};o?W(o.id,a):E(a),n()}catch(t){t instanceof S?B(C.formatErrors(t)):(console.error("Failed to update transaction:",t),B({general:"Failed to update transaction. Please try again."}))}},onClose:()=>{B({}),n()}}),Z=L(`type-${Y.type}`),_=e=>{const t="string"==typeof e?parseFloat(e):e;if(isNaN(t))return"";const a=t<0,r=new Intl.NumberFormat("en-GB",{minimumFractionDigits:2,maximumFractionDigits:2}).format(Math.abs(t));return a?`-${r}`:r};return T.useEffect(()=>{if(o){const e=z.find(e=>e.id===o.category),t=e?.parentId||"",a=e?.parentId?o.category:"",r="transfer"===o.type?o.amount.toString():Math.abs(o.amount).toString();P({date:o.date instanceof Date?o.date.toISOString().split("T")[0]:new Date(o.date).toISOString().split("T")[0],description:o.description,amount:r,type:o.type,category:a,subCategory:t,accountId:o.accountId,tags:o.tags||[],notes:o.notes||"",cleared:o.cleared||!1,reconciledWith:o.reconciledWith||""}),G(_(r))}else{const e=(new Date).toISOString().split("T")[0];P({date:e,description:"",amount:"",type:"expense",subCategory:"",category:"",accountId:I.length>0?I[0].id:"",tags:[],notes:"",cleared:!1,reconciledWith:""}),G("")}O(!1)},[o,I,z,P]),s.jsxs(s.Fragment,{children:[s.jsx(d,{isOpen:t,onClose:n,title:o?"Edit Transaction":"New Transaction",size:"xl",children:s.jsxs("form",{onSubmit:K,children:[s.jsx(i,{children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4",children:[s.jsxs("div",{className:"md:col-span-5",children:[s.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s.jsx(l,{size:16}),"Date"]}),s.jsx("input",{type:"date",value:Y.date,onChange:e=>J("date",e.target.value),className:"w-full px-3 py-3 sm:py-2 h-12 sm:h-[42px] text-base sm:text-sm bg-white dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-blue-400 focus:border-transparent dark:text-white",required:!0})]}),s.jsxs("div",{className:"md:col-span-7",children:[s.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s.jsx(g,{size:16}),"Account"]}),s.jsxs("select",{value:Y.accountId,onChange:e=>J("accountId",e.target.value),className:"w-full px-3 py-3 sm:py-2 h-12 sm:h-[42px] text-base sm:text-sm bg-white dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-blue-400 focus:border-transparent dark:text-white",required:!0,children:[s.jsx("option",{value:"",children:"Select account"}),I.map(e=>s.jsxs("option",{value:e.id,children:[e.name," (",e.type,")"]},e.id))]})]}),s.jsxs("div",{className:"md:col-span-12",children:[s.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s.jsx(m,{size:16}),"Description"]}),s.jsx("input",{type:"text",value:Y.description,onChange:e=>J("description",e.target.value),className:"w-full px-3 py-3 sm:py-2 h-12 sm:h-[42px] text-base sm:text-sm bg-white dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-blue-400 focus:border-transparent dark:text-white",required:!0})]}),s.jsxs("div",{className:"md:col-span-12",children:[s.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s.jsx(x,{size:16}),"Type"]}),s.jsxs("div",{className:"flex gap-4 items-center h-[42px]",children:[s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"radio",value:"income",checked:"income"===Y.type,onChange:e=>J("type",e.target.value),className:"mr-2"}),s.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Income"})]}),s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"radio",value:"expense",checked:"expense"===Y.type,onChange:e=>J("type",e.target.value),className:"mr-2"}),s.jsx("span",{className:"text-red-600 dark:text-red-400",children:"Expense"})]}),s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"radio",value:"transfer",checked:"transfer"===Y.type,onChange:e=>J("type",e.target.value),className:"mr-2"}),s.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Transfer"})]})]})]}),s.jsxs("div",{className:"md:col-span-5",children:[s.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s.jsx(u,{size:16}),"Amount ",Y.accountId&&(()=>{const e=I.find(e=>e.id===Y.accountId);return e?`(${p(e.currency)})`:""})()]}),s.jsx("input",{ref:U,type:"text",value:H,onChange:e=>{const t=e.target.value;if(""===t||"-"===t||/^-?[0-9,]*\.?[0-9]{0,2}$/.test(t)){G(t);const e=(e=>e.replace(/,/g,""))(t);""!==e&&"-"!==e&&isNaN(parseFloat(e))||J("amount",e)}},onBlur:()=>{Y.amount&&""!==Y.amount&&G(_(Y.amount))},onFocus:()=>{U.current&&U.current.select()},placeholder:"0.00",className:"w-full px-3 py-2 h-[42px] text-right bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-300/50 dark:border-gray-600/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent "+(Y.amount&&parseFloat(Y.amount)<0?"text-red-600 dark:text-red-400":Y.amount&&parseFloat(Y.amount)>0?"text-green-600 dark:text-green-400":"text-gray-900 dark:text-white"),required:!0})]}),s.jsxs("div",{className:"md:col-span-12 space-y-3",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-1",children:[s.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:[s.jsx(h,{size:16}),"Category"]}),s.jsxs("button",{type:"button",onClick:()=>$(!0),className:"text-sm text-primary hover:text-secondary flex items-center gap-1",children:[s.jsx(y,{size:14}),"Create new category"]})]}),s.jsxs("select",{value:Y.subCategory,onChange:e=>{J("subCategory",e.target.value),J("category","")},className:"w-full px-3 py-3 sm:py-2 h-12 sm:h-[42px] text-base sm:text-sm bg-white dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-blue-400 focus:border-transparent dark:text-white",required:!0,children:[s.jsx("option",{value:"",children:"Select category"}),Z.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),Y.subCategory&&s.jsxs("div",{children:[s.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s.jsx("div",{className:"w-4 h-4"}),"Sub-category"]}),s.jsxs("select",{value:Y.category,onChange:e=>J("category",e.target.value),className:"w-full px-3 py-3 sm:py-2 h-12 sm:h-[42px] text-base sm:text-sm bg-white dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-blue-400 focus:border-transparent dark:text-white",required:!0,children:[s.jsx("option",{value:"",children:"Select sub-category"}),A(Y.subCategory).map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]})]}),s.jsxs("div",{className:"md:col-span-12",children:[s.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s.jsx(b,{size:16}),"Tags"]}),s.jsx(e,{selectedTags:Y.tags,onTagsChange:e=>J("tags",e),placeholder:"Search or create tags...",allowNewTags:!0})]}),s.jsxs("div",{className:"md:col-span-12",children:[s.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s.jsx(m,{size:16}),"Notes"]}),s.jsx(f,{value:Y.notes,onChange:e=>J("notes",e),placeholder:"Add notes... You can use **bold**, *italic*, [links](url), `code`, lists, etc.",maxHeight:"200px",className:"w-full"})]}),o&&s.jsxs("div",{className:"md:col-span-12",children:[s.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s.jsx(j,{size:16}),"Attachments"]}),s.jsx("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:s.jsx(D,{transactionId:o.id,compact:!0})})]}),s.jsxs("div",{className:"md:col-span-12 space-y-3",children:[s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:Y.cleared,onChange:e=>J("cleared",e.target.checked),className:"rounded border-gray-300 dark:border-gray-600"}),s.jsx(k,{size:16,className:"text-green-600 dark:text-green-400"}),s.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Reconciled"})]}),s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:!!Y.reconciledWith&&"manual"!==Y.reconciledWith,disabled:!0,className:"rounded border-gray-300 dark:border-gray-600 disabled:opacity-50 disabled:cursor-not-allowed"}),s.jsx(N,{size:16,className:"text-blue-600 dark:text-blue-400"}),s.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Linked to bank statement"})]}),o?.reconciledWith&&"manual"!==o.reconciledWith&&s.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600 dark:text-blue-400",children:[s.jsx(N,{size:16}),s.jsxs("span",{children:["Reconciled with transaction ID: ",o.reconciledWith]})]})]})]})}),s.jsx(v,{children:s.jsxs("div",{className:"flex justify-between gap-3 w-full",children:[o&&s.jsx("button",{type:"button",onClick:()=>O(!0),className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600",children:"Delete"}),s.jsxs("div",{className:"flex gap-3 ml-auto",children:[s.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"}),s.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-secondary",children:o?"Save Changes":"Add Transaction"})]})]})})]})}),M&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-4 sm:p-6 w-full max-w-md mx-4 shadow-xl",children:[s.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Delete Transaction?"}),s.jsx("p",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-400 mb-4",children:"Are you sure you want to delete this transaction? This action cannot be undone."}),s.jsxs("div",{className:"flex gap-3 justify-end",children:[s.jsx("button",{onClick:()=>O(!1),className:"px-3 sm:px-4 py-2 text-sm sm:text-base border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"}),s.jsx("button",{onClick:()=>{o&&(F(o.id),n())},className:"px-3 sm:px-4 py-2 text-sm sm:text-base bg-red-500 text-white rounded-lg hover:bg-red-600",children:"Delete"})]})]})}),s.jsx(w,{isOpen:q,onClose:()=>$(!1),initialType:"transfer"===Y.type?"expense":Y.type,onCategoryCreated:e=>{const t=z.find(t=>t.id===e);t&&("detail"===t.level?(J("subCategory",t.parentId||""),J("category",e)):(J("subCategory",e),J("category",""))),$(!1)}})]})}import{g as a,aJ as r,j as s,bt as n,aq as o,D as c,M as d,m as i,r as l,G as g,b2 as m,bM as x,y as u,x as p,A as h,ag as y,bf as b,bW as f,bX as j,bY as k,br as N,q as v,z as w,bZ as C,b_ as S}from"./index-CgJz7Gw0.js";import{a as T}from"./chunk-BWx9oMeS.js";import{X as I}from"./chunk-BI7X5soN.js";import{D}from"./chunk-DhshGXeK.js";import"./chunk-BN8kgYrt.js";import"./chunk-C1eKK5Oc.js";import"./chunk-CvmCzHdt.js";const z=e=>s.jsxs(n,{...e,children:[s.jsx("path",{d:"M4 9H20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),s.jsx("path",{d:"M4 15H20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),s.jsx("path",{d:"M10 3L8 21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),s.jsx("path",{d:"M16 3L14 21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]});export{t as default};
