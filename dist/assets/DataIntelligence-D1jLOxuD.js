function e({onDataChange:e}){const[t,a]=q.useState([]),[s,r]=q.useState(!0),[b,j]=q.useState(!1),[f,N]=q.useState(null),[w,v]=q.useState("all"),[k,D]=q.useState("nextPayment");q.useEffect(()=>{S()},[]);const S=()=>{r(!0);try{const e=F.getSubscriptions();a(e)}catch(e){console.error("Error loading subscriptions:",e)}finally{r(!1)}},A=e=>{switch(e){case"active":return n.jsx(d,{size:16,className:"text-green-500"});case"cancelled":return n.jsx(g,{size:16,className:"text-red-500"});case"paused":return n.jsx(p,{size:16,className:"text-yellow-500"});case"trial":return n.jsx(u,{size:16,className:"text-blue-500"});default:return n.jsx(y,{size:16,className:"text-gray-500"})}},C=e=>{switch(e){case"active":return"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200";case"cancelled":return"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200";case"paused":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-200";case"trial":return"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200"}},z=e=>Math.ceil((e.getTime()-Date.now())/864e5),T=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),M=t.filter(e=>"all"===w||e.status===w).sort((e,t)=>{switch(k){case"nextPayment":return e.nextPaymentDate.getTime()-t.nextPaymentDate.getTime();case"amount":return t.amount-e.amount;case"merchant":return e.merchantName.localeCompare(t.merchantName);default:return 0}}),P=t.filter(e=>"active"===e.status).reduce((e,t)=>e+("monthly"===t.frequency?t.amount:"yearly"===t.frequency?t.amount/12:"quarterly"===t.frequency?t.amount/3:"weekly"===t.frequency?4.33*t.amount:t.amount),0);return s?n.jsx("div",{className:"flex items-center justify-center py-8",children:n.jsx(i,{size:24,className:"animate-spin text-gray-400"})}):n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[n.jsx(c,{size:20,className:"text-green-600 dark:text-green-400"}),"Subscription Manager"]}),n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Manage and track your recurring subscriptions"})]}),n.jsxs("button",{onClick:()=>j(!0),className:"flex items-center gap-2 px-4 py-2 bg-[var(--color-primary)] text-white rounded-lg hover:bg-[var(--color-primary)]/90",children:[n.jsx(l,{size:16}),"Add Subscription"]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[n.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Active"}),n.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:t.filter(e=>"active"===e.status).length})]}),n.jsx(d,{size:24,className:"text-green-500"})]})}),n.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Monthly Cost"}),n.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:T(P)})]}),n.jsx(x,{size:24,className:"text-blue-500"})]})}),n.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Due Soon"}),n.jsx("p",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:t.filter(e=>"active"===e.status&&z(e.nextPaymentDate)<=7).length})]}),n.jsx(o,{size:24,className:"text-orange-500"})]})}),n.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Cancelled"}),n.jsx("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:t.filter(e=>"cancelled"===e.status).length})]}),n.jsx(g,{size:24,className:"text-red-500"})]})})]}),n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("label",{htmlFor:"filter-select",className:"text-sm text-gray-600 dark:text-gray-400",children:"Filter:"}),n.jsxs("select",{id:"filter-select",value:w,onChange:e=>v(e.target.value),className:"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white text-sm","aria-label":"Filter subscriptions by status",children:[n.jsx("option",{value:"all",children:"All"}),n.jsx("option",{value:"active",children:"Active"}),n.jsx("option",{value:"trial",children:"Trial"}),n.jsx("option",{value:"paused",children:"Paused"}),n.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("label",{htmlFor:"sort-select",className:"text-sm text-gray-600 dark:text-gray-400",children:"Sort by:"}),n.jsxs("select",{id:"sort-select",value:k,onChange:e=>D(e.target.value),className:"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white text-sm","aria-label":"Sort subscriptions by",children:[n.jsx("option",{value:"nextPayment",children:"Next Payment"}),n.jsx("option",{value:"amount",children:"Amount"}),n.jsx("option",{value:"merchant",children:"Merchant"})]})]})]}),n.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden",children:0===M.length?n.jsxs("div",{className:"text-center py-8",children:[n.jsx(c,{size:48,className:"mx-auto mb-4 text-gray-400"}),n.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No subscriptions found"})]}):n.jsx("div",{className:"overflow-x-auto",role:"region","aria-label":"Subscriptions table",children:n.jsxs("table",{className:"w-full",role:"table","aria-label":"Active subscriptions",children:[n.jsx("caption",{className:"sr-only",children:"List of active subscriptions with payment details and status"}),n.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:n.jsxs("tr",{role:"row",children:[n.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",role:"columnheader",children:"Merchant"}),n.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",role:"columnheader",children:"Amount"}),n.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",role:"columnheader",children:"Frequency"}),n.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",role:"columnheader",children:"Next Payment"}),n.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",role:"columnheader",children:"Status"}),n.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",role:"columnheader",children:n.jsx("span",{className:"sr-only",children:"Actions"})})]})}),n.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:M.map(t=>{const a=z(t.nextPaymentDate),s=a<=7&&a>0,r=a<0;return n.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",role:"row",children:[n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{children:[n.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:t.merchantName}),t.description&&n.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.description})]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsx("div",{className:"text-gray-900 dark:text-white font-medium",children:T(t.amount)})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsx("div",{className:"text-gray-900 dark:text-white capitalize",children:t.frequency})}),n.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[n.jsx("div",{className:"text-sm "+(r?"text-red-600 dark:text-red-400":s?"text-orange-600 dark:text-orange-400":"text-gray-900 dark:text-white"),children:(i=t.nextPaymentDate,i.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}))}),n.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:r?`${Math.abs(a)} days overdue`:0===a?"Due today":`${a} days`})]}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${C(t.status)}`,children:[A(t.status),t.status]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsx("button",{onClick:()=>N(t),className:"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300",children:n.jsx(m,{size:16})}),n.jsx("button",{onClick:()=>{return a=t.id,void(confirm("Are you sure you want to delete this subscription?")&&(F.deleteSubscription(a),S(),e?.()));var a},className:"text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300",children:n.jsx(h,{size:16})})]})})]},t.id);var i})})]})})}),(b||f)&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl w-full max-w-md p-6",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:f?"Edit Subscription":"Add Subscription"}),n.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Subscription management modal would be implemented here."}),n.jsx("div",{className:"flex justify-end gap-2",children:n.jsx("button",{onClick:()=>{j(!1),N(null)},className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"Cancel"})})]})})]})}function t({onDataChange:e}){const[t,a]=q.useState([]),[s,r]=q.useState(!0),[c,l]=q.useState(""),[x,o]=q.useState("all"),[g,h]=q.useState("confidence"),[y,u]=q.useState(""),[p,D]=q.useState(null);q.useEffect(()=>{S()},[]);const S=()=>{r(!0);try{a([{id:"1",name:"Amazon",cleanName:"Amazon",category:"Shopping",industry:"E-commerce",frequency:"monthly",tags:["online","retail","marketplace"],confidence:.95,avgTransactionAmount:45.99,createdAt:new Date("2024-01-01"),lastUpdated:new Date},{id:"2",name:"Netflix",cleanName:"Netflix",category:"Entertainment",industry:"Streaming",frequency:"monthly",tags:["subscription","streaming","entertainment"],confidence:.98,avgTransactionAmount:15.99,createdAt:new Date("2024-01-01"),lastUpdated:new Date},{id:"3",name:"Starbucks",cleanName:"Starbucks",category:"Food & Dining",industry:"Coffee",frequency:"daily",tags:["coffee","food","chain"],confidence:.92,avgTransactionAmount:5.85,createdAt:new Date("2024-01-01"),lastUpdated:new Date}])}catch(e){console.error("Error loading merchants:",e)}finally{r(!1)}},A=e=>e>=.9?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200":e>=.7?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200",C=["all",...Array.from(new Set(t.map(e=>e.category)))],z=t.filter(e=>{const t=e.name.toLowerCase().includes(c.toLowerCase())||e.cleanName.toLowerCase().includes(c.toLowerCase())||e.tags.some(e=>e.toLowerCase().includes(c.toLowerCase())),a="all"===x||e.category===x;return t&&a}).sort((e,t)=>{switch(g){case"name":return e.name.localeCompare(t.name);case"confidence":return t.confidence-e.confidence;case"frequency":return e.frequency.localeCompare(t.frequency);case"lastUpdated":return t.lastUpdated.getTime()-e.lastUpdated.getTime();default:return 0}});return s?n.jsx("div",{className:"flex items-center justify-center py-8",children:n.jsx(i,{size:24,className:"animate-spin text-gray-400"})}):n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[n.jsx(b,{size:20,className:"text-blue-600 dark:text-blue-400"}),"Merchant Enrichment"]}),n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"View and manage merchant data enrichment and categorization"})]}),n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm",children:[n.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-4",children:"Test Merchant Enrichment"}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("input",{type:"text",value:y,onChange:e=>u(e.target.value),placeholder:"Enter merchant name or transaction description...",className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),n.jsx("button",{onClick:()=>{if(!y.trim())return;const e=F.enrichMerchant(y);D(e)},className:"px-4 py-2 bg-[var(--color-primary)] text-white rounded-lg hover:bg-[var(--color-primary)]/90",children:"Test"})]}),p&&n.jsx("div",{className:"mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Original:"}),n.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:p.originalName})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Clean Name:"}),n.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:p.cleanName})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Category:"}),n.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:p.category})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Industry:"}),n.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:p.industry})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Confidence:"}),n.jsxs("span",{className:"font-medium "+(T=p.confidence,T>=.9?"text-green-600 dark:text-green-400":T>=.7?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"),children:[(100*p.confidence).toFixed(0),"%"]})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Tags:"}),n.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:p.suggestedTags.map((e,t)=>n.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-200 rounded",children:e},t))})]})]})})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[n.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Merchants"}),n.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:t.length})]}),n.jsx(j,{size:24,className:"text-blue-500"})]})}),n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"High Confidence"}),n.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:t.filter(e=>e.confidence>=.9).length})]}),n.jsx(d,{size:24,className:"text-green-500"})]}),n.jsxs("div",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:[t.length>0?Math.round(t.filter(e=>e.confidence>=.9).length/t.length*100):0,"% accuracy"]})]}),n.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Categories"}),n.jsx("p",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:C.length-1})]}),n.jsx(f,{size:24,className:"text-purple-500"})]})}),n.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Avg Confidence"}),n.jsxs("p",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:[t.length>0?Math.round(t.reduce((e,t)=>e+t.confidence,0)/t.length*100):0,"%"]})]}),n.jsx(N,{size:24,className:"text-orange-500"})]})})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(b,{size:16,className:"text-gray-400"}),n.jsx("input",{type:"text",value:c,onChange:e=>l(e.target.value),placeholder:"Search merchants...",className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white text-sm"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(w,{size:16,className:"text-gray-400"}),n.jsx("select",{value:x,onChange:e=>o(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white text-sm",children:C.map(e=>n.jsx("option",{value:e,children:"all"===e?"All Categories":e},e))})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("label",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Sort by:"}),n.jsxs("select",{value:g,onChange:e=>h(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white text-sm",children:[n.jsx("option",{value:"confidence",children:"Confidence"}),n.jsx("option",{value:"name",children:"Name"}),n.jsx("option",{value:"frequency",children:"Frequency"}),n.jsx("option",{value:"lastUpdated",children:"Last Updated"})]})]})]}),n.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden",children:0===z.length?n.jsxs("div",{className:"text-center py-8",children:[n.jsx(b,{size:48,className:"mx-auto mb-4 text-gray-400"}),n.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No merchants found"})]}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full",children:[n.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Merchant"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Category"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Industry"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Confidence"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Frequency"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Avg Amount"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),n.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:z.map(e=>{return n.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{children:[n.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:e.cleanName}),n.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.tags.slice(0,3).map((e,t)=>n.jsx("span",{className:"inline-block mr-2 px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 rounded",children:e},t))})]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsx("div",{className:"text-gray-900 dark:text-white",children:e.category})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsx("div",{className:"text-gray-900 dark:text-white",children:e.industry})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${A(e.confidence)}`,children:[n.jsx(v,{size:12}),(100*e.confidence).toFixed(0),"%"]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsx("div",{className:"text-gray-900 dark:text-white capitalize",children:e.frequency})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsx("div",{className:"text-gray-900 dark:text-white",children:e.avgTransactionAmount?(t=e.avgTransactionAmount,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t)):"-"})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsx("button",{className:"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300",children:n.jsx(k,{size:16})}),n.jsx("button",{className:"text-green-600 dark:text-green-400 hover:text-green-900 dark:hover:text-green-300",children:n.jsx(m,{size:16})})]})})]},e.id);var t})})]})})})]});var T}function a({onDataChange:e}){const[t,a]=q.useState([]),[s,r]=q.useState(!0),[c,l]=q.useState("all"),[x,g]=q.useState("all"),[m,h]=q.useState("confidence"),[p,b]=q.useState(!1);q.useEffect(()=>{j()},[]);const j=()=>{r(!0);try{const e=F.getSpendingPatterns();a(e)}catch(e){console.error("Error loading spending patterns:",e)}finally{r(!1)}},f=e=>{switch(e){case"recurring":return n.jsx(o,{size:16,className:"text-blue-600 dark:text-blue-400"});case"seasonal":return n.jsx(u,{size:16,className:"text-purple-600 dark:text-purple-400"});case"trend":return n.jsx(D,{size:16,className:"text-green-600 dark:text-green-400"});case"anomaly":return n.jsx(y,{size:16,className:"text-red-600 dark:text-red-400"});default:return n.jsx(N,{size:16,className:"text-gray-600 dark:text-gray-400"})}},v=e=>{switch(e){case"recurring":return"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-200";case"seasonal":return"bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-200";case"trend":return"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200";case"anomaly":return"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200"}},A=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),C=["all","recurring","seasonal","trend","anomaly"],z=["all",...Array.from(new Set(t.map(e=>e.category)))],T=t.filter(e=>{const t="all"===c||e.patternType===c,a="all"===x||e.category===x;return t&&a&&e.isActive}).sort((e,t)=>{switch(m){case"confidence":return t.confidence-e.confidence;case"amount":return t.amount-e.amount;case"detectedAt":return t.detectedAt.getTime()-e.detectedAt.getTime();case"frequency":return e.frequency.localeCompare(t.frequency);default:return 0}});return s?n.jsx("div",{className:"flex items-center justify-center py-8",children:n.jsx(i,{size:24,className:"animate-spin text-gray-400"})}):n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[n.jsx(D,{size:20,className:"text-purple-600 dark:text-purple-400"}),"Spending Patterns"]}),n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Discover recurring spending patterns and trends in your financial behavior"})]}),n.jsxs("button",{onClick:async()=>{b(!0);try{await new Promise(e=>setTimeout(e,2e3)),j(),e?.()}catch(t){console.error("Error analyzing patterns:",t)}finally{b(!1)}},disabled:p,className:"flex items-center gap-2 px-4 py-2 bg-[var(--color-primary)] text-white rounded-lg hover:bg-[var(--color-primary)]/90 disabled:opacity-50",children:[n.jsx(i,{size:16,className:p?"animate-spin":""}),p?"Analyzing...":"Analyze Patterns"]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[n.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Patterns"}),n.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:t.filter(e=>e.isActive).length})]}),n.jsx(N,{size:24,className:"text-blue-500"})]})}),n.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Recurring"}),n.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:t.filter(e=>"recurring"===e.patternType&&e.isActive).length})]}),n.jsx(o,{size:24,className:"text-green-500"})]})}),n.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"High Confidence"}),n.jsx("p",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:t.filter(e=>e.confidence>=.8&&e.isActive).length})]}),n.jsx(d,{size:24,className:"text-purple-500"})]})}),n.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Anomalies"}),n.jsx("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:t.filter(e=>"anomaly"===e.patternType&&e.isActive).length})]}),n.jsx(y,{size:24,className:"text-red-500"})]})})]}),n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm",children:[n.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[n.jsx(S,{size:18}),"Pattern Distribution"]}),n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:C.slice(1).map(e=>{const a=t.filter(t=>t.patternType===e&&t.isActive).length,s=t.length>0?a/t.filter(e=>e.isActive).length*100:0;return n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"flex items-center justify-center mb-2",children:f(e)}),n.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a}),n.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 capitalize",children:e}),n.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[s.toFixed(1),"%"]})]},e)})})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(w,{size:16,className:"text-gray-400"}),n.jsx("select",{value:c,onChange:e=>l(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white text-sm",children:C.map(e=>n.jsx("option",{value:e,children:"all"===e?"All Types":e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),n.jsx("div",{className:"flex items-center gap-2",children:n.jsx("select",{value:x,onChange:e=>g(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white text-sm",children:z.map(e=>n.jsx("option",{value:e,children:"all"===e?"All Categories":e},e))})}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("label",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Sort by:"}),n.jsxs("select",{value:m,onChange:e=>h(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white text-sm",children:[n.jsx("option",{value:"confidence",children:"Confidence"}),n.jsx("option",{value:"amount",children:"Amount"}),n.jsx("option",{value:"detectedAt",children:"Detected Date"}),n.jsx("option",{value:"frequency",children:"Frequency"})]})]})]}),n.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden",children:0===T.length?n.jsxs("div",{className:"text-center py-8",children:[n.jsx(D,{size:48,className:"mx-auto mb-4 text-gray-400"}),n.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No spending patterns found"}),n.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-2",children:"Try analyzing your transactions to discover patterns"})]}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full",children:[n.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Pattern"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Type"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Category"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Frequency"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Amount"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Confidence"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Detected"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),n.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:T.map(e=>{return n.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[n.jsx("td",{className:"px-6 py-4",children:n.jsxs("div",{children:[n.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:e.description}),e.merchant&&n.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.merchant})]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${v(e.patternType)}`,children:[f(e.patternType),e.patternType]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsx("div",{className:"text-gray-900 dark:text-white",children:e.category})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsx("div",{className:"text-gray-900 dark:text-white capitalize",children:e.frequency})}),n.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[n.jsx("div",{className:"text-gray-900 dark:text-white",children:A(e.amount)}),n.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["\xb1",A(e.variance)]})]}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium "+(a=e.confidence,a>=.8?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200":a>=.6?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200"),children:[n.jsx(d,{size:12}),(100*e.confidence).toFixed(0),"%"]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:(t=e.detectedAt,t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}))})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:n.jsx("button",{className:"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300",children:n.jsx(k,{size:16})})})]},e.id);var t,a})})]})})})]})}function s({onDataChange:e}){const[t,a]=q.useState([]),[s,r]=q.useState(!0),[l,d]=q.useState("all"),[x,o]=q.useState("all"),[g,m]=q.useState("createdAt"),[h,u]=q.useState(!1);q.useEffect(()=>{p()},[]);const p=()=>{r(!0);try{const e=F.getInsights();a(e)}catch(e){console.error("Error loading insights:",e)}finally{r(!1)}},j=e=>{switch(e){case"subscription_alert":return n.jsx(c,{size:20,className:"text-blue-600 dark:text-blue-400"});case"spending_spike":return n.jsx(D,{size:20,className:"text-red-600 dark:text-red-400"});case"new_merchant":return n.jsx(b,{size:20,className:"text-green-600 dark:text-green-400"});case"category_trend":return n.jsx(N,{size:20,className:"text-purple-600 dark:text-purple-400"});case"duplicate_transaction":return n.jsx(y,{size:20,className:"text-orange-600 dark:text-orange-400"});default:return n.jsx(A,{size:20,className:"text-gray-600 dark:text-gray-400"})}},f=e=>{switch(e){case"high":return"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200";case"medium":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-200";case"low":return"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200"}},v=e=>{switch(e){case"high":return"border-l-red-500";case"medium":return"border-l-yellow-500";case"low":return"border-l-blue-500";default:return"border-l-gray-500"}},S=t.filter(e=>{if(!h&&e.dismissed)return!1;const t="all"===l||e.severity===l,a="all"===x||e.type===x;return t&&a}).sort((e,t)=>{switch(g){case"createdAt":return t.createdAt.getTime()-e.createdAt.getTime();case"severity":{const a={high:3,medium:2,low:1};return a[t.severity]-a[e.severity]}case"category":return(e.category||"").localeCompare(t.category||"");default:return 0}}),P={total:t.filter(e=>!e.dismissed).length,high:t.filter(e=>"high"===e.severity&&!e.dismissed).length,medium:t.filter(e=>"medium"===e.severity&&!e.dismissed).length,low:t.filter(e=>"low"===e.severity&&!e.dismissed).length,actionable:t.filter(e=>e.actionable&&!e.dismissed).length};return s?n.jsx("div",{className:"flex items-center justify-center py-8",children:n.jsx(i,{size:24,className:"animate-spin text-gray-400"})}):n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[n.jsx(A,{size:20,className:"text-orange-600 dark:text-orange-400"}),"Data Insights"]}),n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"AI-powered insights and alerts about your spending patterns"})]}),n.jsxs("button",{onClick:p,className:"flex items-center gap-2 px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:[n.jsx(i,{size:16}),"Refresh"]})]}),n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[n.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total"}),n.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:P.total})]}),n.jsx(A,{size:24,className:"text-blue-500"})]})}),n.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"High Priority"}),n.jsx("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:P.high})]}),n.jsx(y,{size:24,className:"text-red-500"})]})}),n.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Medium"}),n.jsx("p",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:P.medium})]}),n.jsx(y,{size:24,className:"text-yellow-500"})]})}),n.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Low Priority"}),n.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:P.low})]}),n.jsx(y,{size:24,className:"text-blue-500"})]})}),n.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Actionable"}),n.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:P.actionable})]}),n.jsx(C,{size:24,className:"text-green-500"})]})})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(w,{size:16,className:"text-gray-400"}),n.jsxs("select",{value:l,onChange:e=>d(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white text-sm",children:[n.jsx("option",{value:"all",children:"All Severities"}),n.jsx("option",{value:"high",children:"High Priority"}),n.jsx("option",{value:"medium",children:"Medium Priority"}),n.jsx("option",{value:"low",children:"Low Priority"})]})]}),n.jsx("div",{className:"flex items-center gap-2",children:n.jsx("select",{value:x,onChange:e=>o(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white text-sm",children:["all","subscription_alert","spending_spike","new_merchant","category_trend","duplicate_transaction"].map(e=>n.jsx("option",{value:e,children:"all"===e?"All Types":e.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase())},e))})}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(z,{size:16,className:"text-gray-400"}),n.jsxs("select",{value:g,onChange:e=>m(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white text-sm",children:[n.jsx("option",{value:"createdAt",children:"Date Created"}),n.jsx("option",{value:"severity",children:"Severity"}),n.jsx("option",{value:"category",children:"Category"})]})]}),n.jsx("div",{className:"flex items-center gap-2",children:n.jsxs("button",{onClick:()=>u(!h),className:"flex items-center gap-2 px-3 py-2 rounded-lg text-sm "+(h?"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:[h?n.jsx(k,{size:16}):n.jsx(T,{size:16}),h?"Hide Dismissed":"Show Dismissed"]})})]}),n.jsx("div",{className:"space-y-4",children:0===S.length?n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-8 text-center",children:[n.jsx(A,{size:48,className:"mx-auto mb-4 text-gray-400"}),n.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No insights found"}),n.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"all"===l&&"all"===x?"You're all caught up! No active insights at the moment.":"No insights match your current filters."})]}):S.map(t=>{return n.jsx("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-sm border-l-4 ${v(t.severity)} ${t.dismissed?"opacity-60":""}`,children:n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[n.jsx("div",{className:"flex-shrink-0 mt-1",children:j(t.type)}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[n.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:t.title}),n.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${f(t.severity)}`,children:t.severity}),t.actionable&&n.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200",children:"Actionable"}),t.dismissed&&n.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200",children:"Dismissed"})]}),n.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-3",children:t.description}),n.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400",children:[n.jsx("span",{children:(s=t.createdAt,s.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))}),t.category&&n.jsxs(n.Fragment,{children:[n.jsx("span",{children:"\u2022"}),n.jsx("span",{className:"font-medium",children:t.category})]}),t.merchant&&n.jsxs(n.Fragment,{children:[n.jsx("span",{children:"\u2022"}),n.jsx("span",{children:t.merchant})]}),t.amount&&n.jsxs(n.Fragment,{children:[n.jsx("span",{children:"\u2022"}),n.jsx("span",{className:"font-medium",children:(a=t.amount,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a))})]})]})]})]}),!t.dismissed&&n.jsx("div",{className:"flex items-center gap-2 ml-4",children:n.jsx("button",{onClick:()=>{return a=t.id,F.dismissInsight(a),p(),void e?.();var a},className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",title:"Dismiss insight",children:n.jsx(M,{size:16})})})]}),t.actionable&&!t.dismissed&&n.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(C,{size:16,className:"text-green-600 dark:text-green-400"}),n.jsx("span",{className:"text-sm font-medium text-green-600 dark:text-green-400",children:"Recommended Action"})]}),n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Review this insight and take appropriate action if needed."})]})]})},t.id);var a,s})}),S.length>0&&n.jsx("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400",children:[n.jsxs("span",{children:["Showing ",S.length," of ",t.length," insights"]}),n.jsxs("span",{children:[P.actionable," actionable items require attention"]})]})})]})}function r(){const[r,l]=q.useState("overview"),[x,o]=q.useState(null),[g,m]=q.useState([]),[h,p]=q.useState([]),[j,f]=q.useState(!0),[w,v]=q.useState(!1);q.useEffect(()=>{k()},[]);const k=async()=>{f(!0);try{o(F.getStats()),m(F.getInsights()),p(F.getSubscriptions())}catch(e){console.error("Error loading data intelligence data:",e)}finally{f(!1)}},S=()=>{k()},C=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),z=e=>e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),T=e=>{switch(e){case"high":return"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200";case"medium":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-200";case"low":return"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200"}},M=e=>{switch(e){case"subscription_alert":return n.jsx(c,{size:16,className:"text-blue-600 dark:text-blue-400"});case"spending_spike":return n.jsx(D,{size:16,className:"text-red-600 dark:text-red-400"});case"new_merchant":return n.jsx(b,{size:16,className:"text-green-600 dark:text-green-400"});case"category_trend":return n.jsx(N,{size:16,className:"text-purple-600 dark:text-purple-400"});case"duplicate_transaction":return n.jsx(y,{size:16,className:"text-orange-600 dark:text-orange-400"});default:return n.jsx(A,{size:16,className:"text-gray-600 dark:text-gray-400"})}};return j?n.jsx(I,{title:"Data Intelligence",children:n.jsx("div",{className:"flex items-center justify-center min-h-64",children:n.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Loading data intelligence..."})})}):n.jsx(I,{title:"Data Intelligence",children:n.jsxs("div",{className:"max-w-7xl mx-auto",children:[n.jsx("div",{className:"bg-gradient-to-r from-green-600 to-blue-600 dark:from-green-800 dark:to-blue-800 rounded-2xl p-6 mb-6 text-white shadow-lg",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Data Intelligence"}),n.jsx("p",{className:"text-green-100",children:"Smart insights, subscription management, and spending pattern analysis"})]}),n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsxs("button",{onClick:async()=>{v(!0);try{await new Promise(e=>setTimeout(e,2e3)),k()}catch(e){console.error("Error running analysis:",e)}finally{v(!1)}},disabled:w,className:"flex items-center gap-2 px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors disabled:opacity-50",children:[n.jsx(i,{size:16,className:w?"animate-spin":""}),w?"Analyzing...":"Run Analysis"]}),n.jsx(P,{size:48,className:"text-white/80"})]})]})}),n.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm mb-6",children:n.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:n.jsxs("nav",{className:"flex space-x-8 overflow-x-auto",children:[n.jsx("button",{onClick:()=>l("overview"),className:"py-4 px-6 border-b-2 font-medium text-sm whitespace-nowrap "+("overview"===r?"border-[var(--color-primary)] text-[var(--color-primary)]":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(N,{size:16}),"Overview"]})}),n.jsx("button",{onClick:()=>l("subscriptions"),className:"py-4 px-6 border-b-2 font-medium text-sm whitespace-nowrap "+("subscriptions"===r?"border-[var(--color-primary)] text-[var(--color-primary)]":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(c,{size:16}),"Subscriptions"]})}),n.jsx("button",{onClick:()=>l("merchants"),className:"py-4 px-6 border-b-2 font-medium text-sm whitespace-nowrap "+("merchants"===r?"border-[var(--color-primary)] text-[var(--color-primary)]":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(b,{size:16}),"Merchants"]})}),n.jsx("button",{onClick:()=>l("patterns"),className:"py-4 px-6 border-b-2 font-medium text-sm whitespace-nowrap "+("patterns"===r?"border-[var(--color-primary)] text-[var(--color-primary)]":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(D,{size:16}),"Patterns"]})}),n.jsx("button",{onClick:()=>l("insights"),className:"py-4 px-6 border-b-2 font-medium text-sm whitespace-nowrap "+("insights"===r?"border-[var(--color-primary)] text-[var(--color-primary)]":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(A,{size:16}),"Insights",g.length>0&&n.jsx("span",{className:"bg-red-500 text-white text-xs px-2 py-1 rounded-full",children:g.length})]})})]})})}),"overview"===r&&x&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Merchants"}),n.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:x.totalMerchants})]}),n.jsx(b,{size:24,className:"text-blue-500"})]}),n.jsxs("div",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:[x.enrichedMerchants," enriched (",x.categoryAccuracy.toFixed(1),"%)"]})]}),n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Active Subscriptions"}),n.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:x.activeSubscriptions})]}),n.jsx(c,{size:24,className:"text-green-500"})]}),n.jsxs("div",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:[C(x.monthlySubscriptionCost),"/month"]})]}),n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Patterns Detected"}),n.jsx("p",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:x.patternsDetected})]}),n.jsx(D,{size:24,className:"text-purple-500"})]}),n.jsx("div",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"Spending patterns"})]}),n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Active Insights"}),n.jsx("p",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:g.length})]}),n.jsx(A,{size:24,className:"text-orange-500"})]}),n.jsx("div",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"Actionable insights"})]})]}),n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[n.jsx(A,{size:20,className:"text-orange-600 dark:text-orange-400"}),"Recent Insights"]}),n.jsx("button",{onClick:()=>l("insights"),className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:"View All"})]}),0===g.length?n.jsxs("div",{className:"text-center py-8",children:[n.jsx(d,{size:48,className:"mx-auto mb-4 text-gray-400"}),n.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No active insights"})]}):n.jsx("div",{className:"space-y-3",children:g.slice(0,3).map(e=>n.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[n.jsx("div",{className:"flex-shrink-0 mt-1",children:M(e.type)}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[n.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:e.title}),n.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${T(e.severity)}`,children:e.severity})]}),n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.description})]}),n.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:z(e.createdAt)})]},e.id))})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[n.jsx(c,{size:20,className:"text-green-600 dark:text-green-400"}),"Upcoming Renewals"]}),n.jsx("button",{onClick:()=>l("subscriptions"),className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:"Manage"})]}),n.jsx("div",{className:"space-y-3",children:h.slice(0,3).map(e=>{const t=Math.ceil((e.nextPaymentDate.getTime()-Date.now())/864e5);return n.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-2 h-2 rounded-full "+(t<=3?"bg-red-500":t<=7?"bg-yellow-500":"bg-green-500")}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:e.merchantName}),n.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[C(e.amount)," ",e.frequency]})]})]}),n.jsxs("div",{className:"text-right",children:[n.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[t," days"]}),n.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:z(e.nextPaymentDate)})]})]},e.id)})})]}),n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[n.jsx(D,{size:20,className:"text-purple-600 dark:text-purple-400"}),"Analysis Summary"]}),n.jsx(u,{size:16,className:"text-gray-400"})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Last Analysis:"}),n.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:z(x.lastAnalysisRun)})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Data Quality:"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-20 h-2 bg-gray-200 dark:bg-gray-600 rounded-full overflow-hidden",children:n.jsx("div",{className:"h-full bg-green-500 transition-all duration-300",style:{width:`${x.categoryAccuracy}%`}})}),n.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[x.categoryAccuracy.toFixed(0),"%"]})]})]}),n.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:n.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:x.activeSubscriptions}),n.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Active"})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:x.cancelledSubscriptions}),n.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Cancelled"})]})]})})]})]})]})]}),"subscriptions"===r&&n.jsx(e,{onDataChange:S}),"merchants"===r&&n.jsx(t,{onDataChange:S}),"patterns"===r&&n.jsx(a,{onDataChange:S}),"insights"===r&&n.jsx(s,{onDataChange:S})]})})}import{j as n,at as i,I as c,ag as l,O as d,aB as x,r as o,bs as g,Q as m,aF as h,ar as y,aZ as u,aD as p,a3 as b,c6 as j,A as f,B as N,aa as w,c7 as v,ax as k,T as D,ay as S,aH as A,_ as C,c8 as z,bl as T,X as M,bd as P}from"./index-CgJz7Gw0.js";import{a as q}from"./chunk-BWx9oMeS.js";import{P as I}from"./chunk-DLeAFLQD.js";import"./chunk-BN8kgYrt.js";import"./chunk-C1eKK5Oc.js";const F=new class{merchants=[];subscriptions=[];spendingPatterns=[];smartCategories=[];insights=[];constructor(){this.loadData(),this.initializeMerchantDatabase(),this.initializeSmartCategories(),this.createSampleData()}loadData(){try{const e=localStorage.getItem("data-intelligence-merchants");e&&(this.merchants=JSON.parse(e).map(e=>({...e,createdAt:new Date(e.createdAt),lastUpdated:new Date(e.lastUpdated)})));const t=localStorage.getItem("data-intelligence-subscriptions");t&&(this.subscriptions=JSON.parse(t).map(e=>({...e,nextPaymentDate:new Date(e.nextPaymentDate),startDate:new Date(e.startDate),endDate:e.endDate?new Date(e.endDate):void 0,createdAt:new Date(e.createdAt),lastUpdated:new Date(e.lastUpdated)})));const a=localStorage.getItem("data-intelligence-patterns");a&&(this.spendingPatterns=JSON.parse(a).map(e=>({...e,detectedAt:new Date(e.detectedAt)})));const s=localStorage.getItem("data-intelligence-smart-categories");s&&(this.smartCategories=JSON.parse(s).map(e=>({...e,createdAt:new Date(e.createdAt),lastTrained:new Date(e.lastTrained)})));const r=localStorage.getItem("data-intelligence-insights");r&&(this.insights=JSON.parse(r).map(e=>({...e,createdAt:new Date(e.createdAt)})))}catch(e){console.error("Error loading data intelligence data:",e)}}saveData(){try{localStorage.setItem("data-intelligence-merchants",JSON.stringify(this.merchants)),localStorage.setItem("data-intelligence-subscriptions",JSON.stringify(this.subscriptions)),localStorage.setItem("data-intelligence-patterns",JSON.stringify(this.spendingPatterns)),localStorage.setItem("data-intelligence-smart-categories",JSON.stringify(this.smartCategories)),localStorage.setItem("data-intelligence-insights",JSON.stringify(this.insights))}catch(e){console.error("Error saving data intelligence data:",e)}}initializeMerchantDatabase(){0===this.merchants.length&&[{patterns:["amazon","amzn","amazon.com"],name:"Amazon",category:"Shopping",industry:"E-commerce",frequency:"monthly",tags:["online","retail","marketplace"]},{patterns:["netflix","netflix.com"],name:"Netflix",category:"Entertainment",industry:"Streaming",frequency:"monthly",tags:["subscription","streaming","entertainment"]},{patterns:["spotify","spotify.com"],name:"Spotify",category:"Entertainment",industry:"Music Streaming",frequency:"monthly",tags:["subscription","music","streaming"]},{patterns:["uber","uber*"],name:"Uber",category:"Transportation",industry:"Rideshare",frequency:"weekly",tags:["transportation","rideshare","mobile"]},{patterns:["starbucks","sbux"],name:"Starbucks",category:"Food & Dining",industry:"Coffee",frequency:"daily",tags:["coffee","food","chain"]},{patterns:["whole foods","wfm"],name:"Whole Foods Market",category:"Groceries",industry:"Grocery",frequency:"weekly",tags:["grocery","organic","food"]},{patterns:["target","target.com"],name:"Target",category:"Shopping",industry:"Retail",frequency:"monthly",tags:["retail","department","shopping"]},{patterns:["apple","apple.com","itunes"],name:"Apple",category:"Technology",industry:"Technology",frequency:"monthly",tags:["technology","apps","devices"]}].forEach((e,t)=>{this.merchants.push({id:`merchant-${t+1}`,name:e.name,cleanName:e.name,category:e.category,industry:e.industry,frequency:e.frequency,tags:e.tags,confidence:.95,createdAt:new Date,lastUpdated:new Date})})}initializeSmartCategories(){if(0===this.smartCategories.length){const e=[{name:"Subscriptions",confidence:.9,rules:[{type:"merchant",condition:"contains",value:"netflix",weight:.9},{type:"merchant",condition:"contains",value:"spotify",weight:.9},{type:"merchant",condition:"contains",value:"adobe",weight:.8}],merchantPatterns:["netflix","spotify","adobe","microsoft","google"],descriptionPatterns:["subscription","monthly","plan","premium"],amountRanges:[{min:5,max:50,weight:.8},{min:50,max:200,weight:.6}]},{name:"Coffee & Quick Bites",confidence:.85,rules:[{type:"merchant",condition:"contains",value:"starbucks",weight:.9},{type:"merchant",condition:"contains",value:"coffee",weight:.8},{type:"amount",condition:"range",value:15,weight:.7}],merchantPatterns:["starbucks","dunkin","coffee","cafe"],descriptionPatterns:["coffee","latte","espresso","cafe"],amountRanges:[{min:2,max:25,weight:.9}]},{name:"Gas & Fuel",confidence:.9,rules:[{type:"merchant",condition:"contains",value:"shell",weight:.9},{type:"merchant",condition:"contains",value:"exxon",weight:.9},{type:"merchant",condition:"contains",value:"chevron",weight:.9}],merchantPatterns:["shell","exxon","chevron","bp","mobil","gas"],descriptionPatterns:["fuel","gas","gasoline","petrol"],amountRanges:[{min:20,max:100,weight:.8}]}];this.smartCategories=e.map((e,t)=>({...e,id:`smart-cat-${t+1}`,createdAt:new Date,lastTrained:new Date}))}}createSampleData(){if(0===this.subscriptions.length){const e=[{id:"1",merchantId:"merchant-2",merchantName:"Netflix",amount:15.99,frequency:"monthly",nextPaymentDate:new Date(Date.now()+6048e5),category:"Entertainment",status:"active",startDate:new Date("2023-06-15"),description:"Standard Plan",renewalType:"auto",paymentMethod:"Credit Card",transactionIds:["trans-netflix-1","trans-netflix-2"],createdAt:new Date("2023-06-15"),lastUpdated:new Date},{id:"2",merchantId:"merchant-3",merchantName:"Spotify",amount:9.99,frequency:"monthly",nextPaymentDate:new Date(Date.now()+10368e5),category:"Entertainment",status:"active",startDate:new Date("2023-03-10"),description:"Premium Individual",renewalType:"auto",paymentMethod:"Credit Card",transactionIds:["trans-spotify-1","trans-spotify-2"],createdAt:new Date("2023-03-10"),lastUpdated:new Date},{id:"3",merchantId:"merchant-8",merchantName:"Adobe Creative Cloud",amount:52.99,frequency:"monthly",nextPaymentDate:new Date(Date.now()+2592e5),category:"Software",status:"active",startDate:new Date("2023-01-01"),description:"All Apps Plan",renewalType:"auto",paymentMethod:"Credit Card",transactionIds:["trans-adobe-1","trans-adobe-2"],createdAt:new Date("2023-01-01"),lastUpdated:new Date}];this.subscriptions=e}if(0===this.spendingPatterns.length){const e=[{id:"1",patternType:"recurring",category:"Food & Dining",merchant:"Starbucks",frequency:"daily",amount:5.85,variance:1.2,confidence:.87,description:"Daily coffee purchase at Starbucks",transactions:["trans-sb-1","trans-sb-2","trans-sb-3"],detectedAt:new Date("2024-01-15"),isActive:!0},{id:"2",patternType:"seasonal",category:"Shopping",frequency:"yearly",amount:250,variance:45,confidence:.72,description:"Holiday shopping spike in December",transactions:["trans-holiday-1","trans-holiday-2"],detectedAt:new Date("2024-01-10"),isActive:!0},{id:"3",patternType:"trend",category:"Transportation",merchant:"Uber",frequency:"weekly",amount:35,variance:12.5,confidence:.75,description:"Increasing ride-share usage trend",transactions:["trans-uber-1","trans-uber-2","trans-uber-3"],detectedAt:new Date("2024-01-12"),isActive:!0}];this.spendingPatterns=e}if(0===this.insights.length){const e=[{id:"1",type:"subscription_alert",title:"Subscription Renewal Due",description:"Adobe Creative Cloud ($52.99) renews in 3 days",severity:"medium",category:"Software",merchant:"Adobe Creative Cloud",amount:52.99,transactionIds:["trans-adobe-3"],actionable:!0,dismissed:!1,createdAt:new Date},{id:"2",type:"spending_spike",title:"Unusual Spending Detected",description:"Food & Dining spending is 40% higher than usual this month",severity:"medium",category:"Food & Dining",transactionIds:["trans-food-1","trans-food-2"],actionable:!0,dismissed:!1,createdAt:new Date(Date.now()-1728e5)},{id:"3",type:"new_merchant",title:"New Merchant Detected",description:'First transaction with "HelloFresh" - looks like a meal kit subscription',severity:"low",category:"Groceries",merchant:"HelloFresh",amount:89.99,transactionIds:["trans-hellofresh-1"],actionable:!0,dismissed:!1,createdAt:new Date(Date.now()-864e5)}];this.insights=e}this.saveData()}enrichMerchant(e){const t=e.toLowerCase().trim(),a=this.merchants.find(e=>e.tags.some(e=>t.includes(e.toLowerCase()))||t.includes(e.name.toLowerCase())||t.includes(e.cleanName.toLowerCase()));return a?{originalName:e,cleanName:a.cleanName,category:a.category,industry:a.industry,confidence:a.confidence,logo:a.logo,website:a.website,description:a.description,suggestedTags:a.tags}:this.performBasicEnrichment(e)}performBasicEnrichment(e){const t=e.toLowerCase(),a=[{pattern:/coffee|starbucks|dunkin|cafe/i,category:"Food & Dining",industry:"Coffee"},{pattern:/gas|shell|exxon|chevron|bp|fuel/i,category:"Transportation",industry:"Gas Station"},{pattern:/grocery|supermarket|kroger|safeway|whole foods/i,category:"Groceries",industry:"Grocery"},{pattern:/restaurant|dining|food|pizza|burger/i,category:"Food & Dining",industry:"Restaurant"},{pattern:/uber|lyft|taxi|ride/i,category:"Transportation",industry:"Rideshare"},{pattern:/amazon|ebay|shopping|retail/i,category:"Shopping",industry:"E-commerce"},{pattern:/netflix|spotify|subscription|streaming/i,category:"Entertainment",industry:"Streaming"}];for(const{pattern:s,category:r,industry:n}of a)if(s.test(t))return{originalName:e,cleanName:this.cleanMerchantName(e),category:r,industry:n,confidence:.6,suggestedTags:[r.toLowerCase(),n.toLowerCase()]};return{originalName:e,cleanName:this.cleanMerchantName(e),category:"Other",industry:"Unknown",confidence:.3,suggestedTags:["uncategorized"]}}cleanMerchantName(e){return e.replace(/^(POS|DEBIT|CREDIT|PURCHASE|PAYMENT)\s+/i,"").replace(/\s+\d{2}\/\d{2}$/,"").replace(/\s+#\d+$/,"").replace(/\s+\*\d+$/,"").trim()}getSubscriptions(){return this.subscriptions.sort((e,t)=>e.nextPaymentDate.getTime()-t.nextPaymentDate.getTime())}addSubscription(e){const t={...e,id:Date.now().toString(),createdAt:new Date,lastUpdated:new Date};return this.subscriptions.push(t),this.saveData(),t}updateSubscription(e,t){const a=this.subscriptions.findIndex(t=>t.id===e);return-1===a?null:(this.subscriptions[a]={...this.subscriptions[a],...t,lastUpdated:new Date},this.saveData(),this.subscriptions[a])}deleteSubscription(e){const t=this.subscriptions.findIndex(t=>t.id===e);return-1!==t&&(this.subscriptions.splice(t,1),this.saveData(),!0)}detectSubscriptions(e){const t=[],a=e.reduce((e,t)=>{const a=this.cleanMerchantName(t.description);return e[a]||(e[a]=[]),e[a].push(t),e},{});return Object.entries(a).forEach(([e,a])=>{if(a.length<2)return;a.sort((e,t)=>e.date.getTime()-t.date.getTime());const s=[];for(let t=1;t<a.length;t++){const e=Math.round((a[t].date.getTime()-a[t-1].date.getTime())/864e5);s.push(e)}const r=s.reduce((e,t)=>e+t,0)/s.length;if(s.every(e=>Math.abs(e-r)<=3)&&r>=7){let s="monthly";s=r<=10?"weekly":r<=35?"monthly":r<=100?"quarterly":"yearly";const n=this.enrichMerchant(e),i=a.reduce((e,t)=>e+Math.abs(t.amount),0)/a.length;t.push({id:`detected-${Date.now()}-${e}`,merchantId:"unknown",merchantName:n.cleanName,amount:i,frequency:s,nextPaymentDate:new Date(a[a.length-1].date.getTime()+24*r*60*60*1e3),category:n.category,status:"active",startDate:a[0].date,renewalType:"auto",paymentMethod:"Unknown",transactionIds:a.map(e=>e.id),createdAt:new Date,lastUpdated:new Date})}}),t}getSpendingPatterns(){return this.spendingPatterns.filter(e=>e.isActive)}analyzeSpendingPatterns(e){const t=[],a=e.reduce((e,t)=>(e[t.category]||(e[t.category]=[]),e[t.category].push(t),e),{});return Object.entries(a).forEach(([e,a])=>{if(a.length<3)return;a.sort((e,t)=>e.date.getTime()-t.date.getTime());const s=a.map(e=>Math.abs(e.amount)),r=s.reduce((e,t)=>e+t,0)/s.length,n=s.reduce((e,t)=>e+Math.pow(t-r,2),0)/s.length,i=Math.sqrt(n),c=[];for(let t=1;t<a.length;t++){const e=Math.round((a[t].date.getTime()-a[t-1].date.getTime())/864e5);c.push(e)}const l=c.reduce((e,t)=>e+t,0)/c.length,d=c.reduce((e,t)=>e+Math.pow(t-l,2),0)/c.length;if(Math.sqrt(d)<.3*l&&l>0){let s="irregular";s=l<=2?"daily":l<=10?"weekly":l<=35?"monthly":l<=100?"quarterly":"yearly",t.push({id:`pattern-${Date.now()}-${e}`,patternType:"recurring",category:e,frequency:s,amount:r,variance:i,confidence:Math.min(.9,Math.max(.5,1-i/r)),description:`Regular ${s} spending in ${e}`,transactions:a.map(e=>e.id),detectedAt:new Date,isActive:!0})}}),t}suggestCategory(e){const t=e.description.toLowerCase(),a=Math.abs(e.amount);let s={category:"Other",confidence:.3};for(const r of this.smartCategories){let e=0,n=0;for(const a of r.merchantPatterns)t.includes(a.toLowerCase())&&(e+=.8,n+=.8);for(const a of r.descriptionPatterns)t.includes(a.toLowerCase())&&(e+=.6,n+=.6);for(const t of r.amountRanges)a>=t.min&&a<=t.max&&(e+=t.weight,n+=t.weight);if(n>0){const t=Math.min(.95,e/n*r.confidence);t>s.confidence&&(s={category:r.name,confidence:t})}}return s}getInsights(){return this.insights.filter(e=>!e.dismissed).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}generateInsights(e){const t=[];this.subscriptions.filter(e=>{const t=Math.ceil((e.nextPaymentDate.getTime()-Date.now())/864e5);return t<=7&&t>0}).forEach(e=>{const a=Math.ceil((e.nextPaymentDate.getTime()-Date.now())/864e5);t.push({id:`insight-renewal-${e.id}`,type:"subscription_alert",title:"Subscription Renewal Due",description:`${e.merchantName} ($${e.amount.toFixed(2)}) renews in ${a} day${1!==a?"s":""}`,severity:a<=3?"high":"medium",category:e.category,merchant:e.merchantName,amount:e.amount,transactionIds:e.transactionIds,actionable:!0,dismissed:!1,createdAt:new Date})});const a=(new Date).getMonth(),s=(new Date).getFullYear(),r=e.filter(e=>e.date.getMonth()===a&&e.date.getFullYear()===s),n=new Date;n.setMonth(n.getMonth()-1);const i=e.filter(e=>e.date.getMonth()===n.getMonth()&&e.date.getFullYear()===n.getFullYear()),c=this.groupTransactionsByCategory(r),l=this.groupTransactionsByCategory(i);return Object.entries(c).forEach(([e,a])=>{const s=l[e]||0;if(s>0){const n=(a-s)/s*100;n>30&&t.push({id:`insight-spike-${e}`,type:"spending_spike",title:"Unusual Spending Detected",description:`${e} spending is ${n.toFixed(0)}% higher than last month`,severity:n>50?"high":"medium",category:e,amount:a,transactionIds:r.filter(t=>t.category===e).map(e=>e.id),actionable:!0,dismissed:!1,createdAt:new Date})}}),t}groupTransactionsByCategory(e){return e.reduce((e,t)=>{const a=t.category;return e[a]||(e[a]=0),e[a]+=Math.abs(t.amount),e},{})}dismissInsight(e){const t=this.insights.find(t=>t.id===e);t&&(t.dismissed=!0,this.saveData())}getStats(){const e=this.merchants.length,t=this.merchants.filter(e=>e.confidence>.7).length;return{totalMerchants:e,enrichedMerchants:t,activeSubscriptions:this.subscriptions.filter(e=>"active"===e.status).length,cancelledSubscriptions:this.subscriptions.filter(e=>"cancelled"===e.status).length,patternsDetected:this.spendingPatterns.filter(e=>e.isActive).length,monthlySubscriptionCost:this.subscriptions.filter(e=>"active"===e.status).reduce((e,t)=>e+("monthly"===t.frequency?t.amount:"yearly"===t.frequency?t.amount/12:"quarterly"===t.frequency?t.amount/3:"weekly"===t.frequency?4.33*t.amount:t.amount),0),topMerchants:this.merchants.slice(0,5).map(e=>({name:e.name,amount:e.avgTransactionAmount||0,transactionCount:0,category:e.category})),categoryAccuracy:t>0?t/e*100:0,lastAnalysisRun:new Date}}exportData(){return{merchants:this.merchants,subscriptions:this.subscriptions,patterns:this.spendingPatterns,insights:this.insights,stats:this.getStats()}}};export{r as default};
