function e({isOpen:e,onClose:t,title:a,transactionIds:s,issueType:x,onFixed:m}){const{transactions:u,accounts:p,categories:y,updateTransaction:h,deleteTransaction:b}=i(),{formatCurrency:f}=I(),[j,v]=r.useState(null),[N,k]=r.useState({}),w=u.filter(e=>s.includes(e.id)),C=y.map(e=>e.name),D=()=>{v(null),k({})};return n.jsxs(d,{isOpen:e,onClose:t,title:a,children:[n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:["Showing ",w.length," transaction(s)"]}),n.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:w.map(e=>{const t=(a=e.accountId,p.find(e=>e.id===a));var a;const s=j===e.id,r=N[e.id]||{};return n.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[n.jsx("div",{className:"text-sm text-gray-500",children:new Date(e.date).toLocaleDateString()}),n.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t?.name||"Unknown Account"})]}),s?n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Description"}),n.jsx("input",{type:"text",value:r.description||"",onChange:t=>k({...N,[e.id]:{...r,description:t.target.value}}),className:"w-full px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-lg\n                                     bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Amount"}),n.jsx("input",{type:"number",step:"0.01",value:r.amount||"",onChange:t=>k({...N,[e.id]:{...r,amount:t.target.value}}),className:"w-full px-3 py-1 border rounded-lg\n                                       bg-white dark:bg-gray-800 text-gray-900 dark:text-white\n                                       "+(parseFloat(r.amount)<=0?"border-red-500":"border-gray-300 dark:border-gray-600")})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Category"}),n.jsxs("select",{value:r.category||"",onChange:t=>k({...N,[e.id]:{...r,category:t.target.value}}),className:"w-full px-3 py-1 border rounded-lg\n                                       bg-white dark:bg-gray-800 text-gray-900 dark:text-white\n                                       "+(C.includes(r.category)||""===r.category?"border-gray-300 dark:border-gray-600":"border-red-500"),children:[n.jsx("option",{value:"",children:"Select category"}),C.map(e=>n.jsx("option",{value:e,children:e},e))]})]})]})]}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:e.description||"(No description)"}),n.jsxs("div",{className:"flex items-center gap-4 mt-1",children:[n.jsxs("span",{className:"font-medium "+("income"===e.type?"text-green-600":"text-red-600"),children:["income"===e.type?"+":"-",f(Math.abs(e.amount))]}),n.jsx("span",{className:"text-sm px-2 py-1 rounded-full "+(e.category&&C.includes(e.category)?"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300":"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300"),children:e.category||"No category"})]}),"zero-negative-amounts"===x&&n.jsx("div",{className:"text-sm text-red-600 dark:text-red-400 mt-2",children:"\u26a0\ufe0f Amount is zero or negative"}),"invalid-categories"===x&&(!e.category||!C.includes(e.category))&&n.jsx("div",{className:"text-sm text-red-600 dark:text-red-400 mt-2",children:"\u26a0\ufe0f Invalid or missing category"}),"large-transactions"===x&&n.jsx("div",{className:"text-sm text-blue-600 dark:text-blue-400 mt-2",children:"\u2139\ufe0f Unusually large transaction (>10x average)"})]})]}),n.jsx("div",{className:"flex items-center gap-2 ml-4",children:s?n.jsxs(n.Fragment,{children:[n.jsx("button",{onClick:()=>(e=>{const t=N[e];t&&h(e,{amount:parseFloat(t.amount)||0,category:t.category,description:t.description}),v(null),m&&m()})(e.id),className:"p-2 text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20 rounded-lg",title:"Save changes",children:n.jsx(l,{size:20})}),n.jsx("button",{onClick:D,className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg",title:"Cancel",children:n.jsx(c,{size:20})})]}):n.jsxs(n.Fragment,{children:[n.jsx("button",{onClick:()=>(e=>{v(e.id),k({[e.id]:{amount:e.amount,category:e.category,description:e.description}})})(e),className:"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg",title:"Edit transaction",children:n.jsx(o,{size:20})}),n.jsx("button",{onClick:()=>{return t=e.id,void(window.confirm("Are you sure you want to delete this transaction?")&&(b(t),m&&m()));var t},className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg",title:"Delete transaction",children:n.jsx(g,{size:20})})]})})]})},e.id)})})]}),n.jsx("div",{className:"flex justify-end px-6 py-4 border-t border-gray-200 dark:border-gray-700",children:n.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 \n                   dark:hover:bg-gray-700 rounded-lg",children:"Close"})})]})}function t({isOpen:e,onClose:t,changes:a,onUndo:s,onUndoAll:r}){const{formatCurrency:i}=I(),l=e=>{switch(e){case"date":return n.jsx(j,{size:16,className:"text-gray-500"});case"category":return n.jsx(f,{size:16,className:"text-gray-500"});case"amount":case"balance":return n.jsx(b,{size:16,className:"text-gray-500"});case"description":return n.jsx(h,{size:16,className:"text-gray-500"});default:return null}},c=(e,t)=>"date"===t&&e instanceof Date?e.toLocaleDateString():"amount"!==t&&"balance"!==t||"number"!=typeof e?null==e||""===e?"(empty)":String(e):i(e),o=e=>e.includes("error")?"text-red-600 bg-red-50 dark:bg-red-900/20":e.includes("warning")?"text-yellow-600 bg-yellow-50 dark:bg-yellow-900/20":"text-blue-600 bg-blue-50 dark:bg-blue-900/20",g=a.reduce((e,t)=>(e[t.issueType]||(e[t.issueType]=[]),e[t.issueType].push(t),e),{});return n.jsxs(d,{isOpen:e,onClose:t,title:"Fix Summary - What We Changed",children:[n.jsxs("div",{className:"p-6",children:[n.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4 mb-6",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(x,{className:"text-green-600 dark:text-green-400",size:24}),n.jsxs("div",{children:[n.jsxs("h3",{className:"font-medium text-green-900 dark:text-green-100",children:["Successfully Applied ",a.length," Fix",1!==a.length?"es":""]}),n.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 mt-1",children:"Review the changes below. You can undo individual fixes or all changes at once."})]})]})}),a.length>0&&n.jsx("div",{className:"flex justify-end mb-4",children:n.jsxs("button",{onClick:r,className:"flex items-center gap-2 px-4 py-2 text-sm bg-red-600 text-white \n                       rounded-lg hover:bg-red-700 transition-colors",children:[n.jsx(m,{size:16}),"Undo All Changes"]})}),n.jsx("div",{className:"space-y-6 max-h-96 overflow-y-auto",children:Object.entries(g).map(([e,t])=>n.jsxs("div",{children:[n.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:[n.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${o(e)}`,children:e}),n.jsxs("span",{className:"text-sm text-gray-500",children:["(",t.length," changes)"]})]}),n.jsx("div",{className:"space-y-3",children:t.map(e=>n.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white mb-1",children:e.description}),n.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[l(e.field),n.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["balance"===e.field?"Account Balance":"date"===e.field?"Transaction Date":"category"===e.field?"Category":"description"===e.field?"Description":"deleted"===e.field?"Status":e.field,":"]})]}),n.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[n.jsx("span",{className:"text-sm text-red-600 dark:text-red-400 line-through",children:c(e.oldValue,e.field)}),n.jsx(u,{size:16,className:"text-gray-400 flex-shrink-0"}),n.jsx("span",{className:"text-sm text-green-600 dark:text-green-400 font-medium",children:c(e.newValue,e.field)})]})]}),"account"===e.type&&"balance"===e.field&&n.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2 bg-blue-50 dark:bg-blue-900/20 px-2 py-1 rounded",children:"\u2139\ufe0f The account balance has been updated to match the sum of all transactions in this account"})]}),n.jsxs("button",{onClick:()=>s(e.id),className:"ml-4 flex items-center gap-1 px-3 py-1 text-sm text-red-600 \n                                 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"Undo this change",children:[n.jsx(m,{size:14}),"Undo"]})]})},e.id))})]},e))}),0===a.length&&n.jsxs("div",{className:"text-center py-8 text-gray-500",children:[n.jsx(p,{className:"mx-auto mb-3",size:48}),n.jsx("p",{children:"No changes to display"})]})]}),n.jsxs("div",{className:"flex justify-between px-6 py-4 border-t border-gray-200 dark:border-gray-700",children:[n.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:a.some(e=>"created"===e.field)&&n.jsxs("p",{className:"flex items-center gap-2",children:[n.jsx(y,{size:16}),"New transactions may not appear until you navigate to the account"]})}),n.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 \n                   dark:hover:bg-gray-700 rounded-lg",children:"Close"})]})]})}function a({isOpen:e,onClose:t,option:a,onConfirm:s}){const{formatCurrency:i}=I(),[l,c]=r.useState(null);if(!a)return null;const{accountName:o,currentBalance:g,calculatedBalance:x,difference:m}=a,p=m>0?"income":"expense",h=Math.abs(m);return n.jsxs(d,{isOpen:e,onClose:t,title:"Balance Reconciliation Options",children:[n.jsxs("div",{className:"p-6",children:[n.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 mb-6",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(y,{className:"text-yellow-600 dark:text-yellow-400 mt-0.5",size:20}),n.jsxs("div",{children:[n.jsx("h3",{className:"font-medium text-yellow-900 dark:text-yellow-100",children:"Balance Mismatch Detected"}),n.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200 mt-1",children:[o," shows a balance of ",i(g),", but your transactions sum to ",i(x),". The difference is ",i(h),"."]}),(()=>null)()]})]})}),n.jsxs("div",{className:"space-y-4",children:[n.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Choose how to reconcile this difference:"}),n.jsx("label",{className:"block",children:n.jsx("div",{className:"border-2 rounded-lg p-4 cursor-pointer transition-all "+("opening-balance"===l?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"),children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("input",{type:"radio",name:"reconciliation",value:"opening-balance",checked:"opening-balance"===l,onChange:()=>c("opening-balance"),className:"mt-1"}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx(v,{size:20,className:"text-gray-600 dark:text-gray-400"}),n.jsx("span",{className:"font-medium",children:"Adjust Opening Balance"})]}),n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Use this if the account had a balance before your first imported transaction. This will set an opening balance to account for the difference."}),n.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 rounded p-3 text-sm",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Effect:"}),n.jsx("span",{children:"Opening Balance"}),n.jsx(u,{size:14,className:"text-gray-400"}),n.jsx("span",{className:"font-medium text-green-600 dark:text-green-400",children:i(m)})]})})]})]})})}),n.jsx("label",{className:"block",children:n.jsx("div",{className:"border-2 rounded-lg p-4 cursor-pointer transition-all "+("adjustment-transaction"===l?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"),children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("input",{type:"radio",name:"reconciliation",value:"adjustment-transaction",checked:"adjustment-transaction"===l,onChange:()=>c("adjustment-transaction"),className:"mt-1"}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx(N,{size:20,className:"text-gray-600 dark:text-gray-400"}),n.jsx("span",{className:"font-medium",children:"Create Adjustment Transaction"})]}),n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Use this if there's a missing transaction or an error in your records. This will create a new transaction to reconcile the balance."}),n.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 rounded p-3 text-sm",children:n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(j,{size:14,className:"text-gray-400"}),n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Date:"}),n.jsx("span",{children:"Today"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Type:"}),n.jsx("span",{className:"income"===p?"text-green-600":"text-red-600",children:"income"===p?"Income":"Expense"}),n.jsx("span",{className:"font-medium",children:i(h)})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Category:"}),n.jsx("span",{children:"Account Adjustments"})]})]})})]})]})})})]})]}),n.jsxs("div",{className:"flex justify-between px-6 py-4 border-t border-gray-200 dark:border-gray-700",children:[n.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 \n                   dark:hover:bg-gray-700 rounded-lg",children:"Cancel"}),n.jsx("button",{onClick:()=>{l&&s(l)},disabled:!l,className:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark \n                   disabled:opacity-50 disabled:cursor-not-allowed",children:"Apply Selected Fix"})]})]})}function s({isOpen:s,onClose:l}){const{transactions:c,accounts:o,categories:g,updateTransaction:m,deleteTransaction:u,updateAccount:h,addTransaction:b,addCategory:f}=i(),{formatCurrency:j}=I(),[v,N]=r.useState(!1),[$,S]=r.useState(new Set),[T,z]=r.useState({current:0,total:0}),[A,O]=r.useState(null),[B,V]=r.useState([]),[F,M]=r.useState(!1),[E,U]=r.useState(null),[P,W]=r.useState(null),L=r.useMemo(()=>{const e=[],t=new Date,a=c.filter(e=>(e.date instanceof Date?e.date:new Date(e.date))>t);a.length>0&&e.push({id:"future-transactions",type:"warning",category:"Date Issues",description:`${a.length} transaction(s) have future dates`,affectedItems:a.map(e=>e.id),fix:async()=>{const e=[];for(const s of a)e.push({id:`${Date.now()}-${s.id}`,type:"transaction",itemId:s.id,field:"date",oldValue:s.date.toISOString(),newValue:t.toISOString(),description:`Transaction "${s.description}" date changed`,issueType:"Future-dated transactions"}),m(s.id,{date:t});return e},fixDescription:"Set all future transactions to today's date"});const s=new Date;s.setFullYear(s.getFullYear()-5);const r=c.filter(e=>(e.date instanceof Date?e.date:new Date(e.date))<s);r.length>0&&e.push({id:"old-transactions",type:"info",category:"Date Issues",description:`${r.length} transaction(s) are older than 5 years`,affectedItems:r.map(e=>e.id)});const n=c.filter(e=>!e.category||""===e.category);n.length>0&&e.push({id:"missing-categories",type:"warning",category:"Missing Data",description:`${n.length} transaction(s) have no category`,affectedItems:n.map(e=>e.id),fix:async()=>{const e=[];for(const t of n)e.push({id:`${Date.now()}-${t.id}`,type:"transaction",itemId:t.id,field:"category",oldValue:t.category||"",newValue:"Other",description:`Transaction "${t.description}" category set`,issueType:"Missing categories"}),m(t.id,{category:"Other"});return e},fixDescription:'Set all uncategorized transactions to "Other"'});const i=g.map(e=>e.name),d=c.filter(e=>e.category&&!i.includes(e.category));d.length>0&&e.push({id:"invalid-categories",type:"error",category:"Data Integrity",description:`${d.length} transaction(s) have invalid categories`,affectedItems:d.map(e=>e.id),fix:async()=>{const e=[];for(const t of d)e.push({id:`${Date.now()}-${t.id}`,type:"transaction",itemId:t.id,field:"category",oldValue:t.category,newValue:"Other",description:`Transaction "${t.description}" invalid category fixed`,issueType:"Invalid categories"}),m(t.id,{category:"Other"});return e},fixDescription:'Reset invalid categories to "Other"'});const l=c.filter(e=>e.amount<=0);l.length>0&&e.push({id:"invalid-amounts",type:"error",category:"Data Integrity",description:`${l.length} transaction(s) have zero or negative amounts`,affectedItems:l.map(e=>e.id)});const x=new Set(o.map(e=>e.id)),p=c.filter(e=>!x.has(e.accountId));p.length>0&&e.push({id:"orphaned-transactions",type:"error",category:"Data Integrity",description:`${p.length} transaction(s) belong to non-existent accounts`,affectedItems:p.map(e=>e.id),fix:async()=>{const e=[];for(const t of p)e.push({id:`${Date.now()}-${t.id}`,type:"transaction",itemId:t.id,field:"deleted",oldValue:"exists",newValue:"deleted",description:`Orphaned transaction "${t.description}" deleted`,issueType:"Orphaned transactions"}),u(t.id);return e},fixDescription:"Delete all orphaned transactions"});const y=new Map;c.forEach(e=>{const t=`${(e.date instanceof Date?e.date:new Date(e.date)).toDateString()}-${e.description}-${e.amount}`;y.has(t)||y.set(t,[]),y.get(t).push(e)});const h=[];y.forEach(e=>{e.length>1&&h.push(...e.slice(1))}),h.length>0&&e.push({id:"potential-duplicates",type:"warning",category:"Possible Duplicates",description:`${h.length} potential duplicate transaction(s) found`,affectedItems:h.map(e=>e.id)});const b=c.filter(e=>!e.description||""===e.description.trim());b.length>0&&e.push({id:"empty-descriptions",type:"warning",category:"Missing Data",description:`${b.length} transaction(s) have empty descriptions`,affectedItems:b.map(e=>e.id),fix:async()=>{const e=[];for(const t of b){const a=`${t.type} - ${t.category}`;e.push({id:`${Date.now()}-${t.id}`,type:"transaction",itemId:t.id,field:"description",oldValue:t.description||"",newValue:a,description:"Transaction description generated",issueType:"Empty descriptions"}),m(t.id,{description:a})}return e},fixDescription:"Generate descriptions from type and category"}),o.forEach(t=>{const a=c.filter(e=>e.accountId===t.id),s=t.openingBalance||0,r=a.reduce((e,t)=>"income"===t.type?e+t.amount:"expense"===t.type?e-t.amount:"transfer"===t.type?e+t.amount:e,0),n=a.filter(e=>"income"===e.type).reduce((e,t)=>e+t.amount,0),i=a.filter(e=>"expense"===e.type).reduce((e,t)=>e+t.amount,0),d=a.filter(e=>"transfer"===e.type).reduce((e,t)=>e+t.amount,0);console.log(`Account: ${t.name}`,{transactionCount:a.length,income:n,expenses:i,transfers:d,transactionSum:r,openingBalance:s,calculatedBalance:s+r,actualBalance:t.balance,manualCalc:s+n-i-d,types:a.reduce((e,t)=>(e[t.type]=(e[t.type]||0)+1,e),{})});const l=s+r,o=t.balance,g=o-l;Math.abs(g)>.01&&e.push({id:`balance-mismatch-${t.id}`,type:"warning",category:"Balance Issues",description:`${t.name} balance differs from transaction sum by ${j(Math.abs(g))}`,affectedItems:[t.id],fix:async()=>new Promise(a=>{U({type:"opening-balance",accountId:t.id,accountName:t.name,currentBalance:o,calculatedBalance:l,difference:o-l}),W({issue:e.find(e=>e.id===`balance-mismatch-${t.id}`),resolve:a})}),fixDescription:"Choose reconciliation method"})});const f=c.reduce((e,t)=>e+t.amount,0)/c.length,v=c.filter(e=>e.amount>10*f);return v.length>0&&e.push({id:"large-transactions",type:"info",category:"Unusual Data",description:`${v.length} transaction(s) are unusually large (>10x average)`,affectedItems:v.map(e=>e.id)}),e},[c,o,g]),R=r.useMemo(()=>{const e=new Map;return L.forEach(t=>{e.has(t.category)||e.set(t.category,[]),e.get(t.category).push(t)}),e},[L]),Y=r.useMemo(()=>{const e={error:0,warning:0,info:0};return L.forEach(t=>{e[t.type]++}),e},[L]),G=e=>{switch(e){case"error":return n.jsx(k,{className:"text-red-500",size:20});case"warning":return n.jsx(p,{className:"text-yellow-500",size:20});case"info":return n.jsx(y,{className:"text-blue-500",size:20});default:return null}};return n.jsxs(n.Fragment,{children:[n.jsxs(d,{isOpen:s,onClose:l,title:"Data Validation & Cleanup",children:[n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[n.jsx("div",{className:"rounded-lg p-4 "+(Y.error>0?"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800":"bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700"),children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Errors"}),n.jsx("div",{className:"text-2xl font-semibold mt-1",children:Y.error})]}),n.jsx(k,{className:Y.error>0?"text-red-500":"text-gray-400",size:32})]})}),n.jsx("div",{className:"rounded-lg p-4 "+(Y.warning>0?"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800":"bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700"),children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Warnings"}),n.jsx("div",{className:"text-2xl font-semibold mt-1",children:Y.warning})]}),n.jsx(p,{className:Y.warning>0?"text-yellow-500":"text-gray-400",size:32})]})}),n.jsx("div",{className:"rounded-lg p-4 "+(Y.info>0?"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800":"bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700"),children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Info"}),n.jsx("div",{className:"text-2xl font-semibold mt-1",children:Y.info})]}),n.jsx(y,{className:Y.info>0?"text-blue-500":"text-gray-400",size:32})]})})]}),0===L.length?n.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-8 text-center",children:[n.jsx(x,{className:"mx-auto text-green-600 dark:text-green-400 mb-3",size:48}),n.jsx("h4",{className:"text-lg font-medium text-green-900 dark:text-green-300",children:"All data looks good!"}),n.jsx("p",{className:"text-sm text-green-800 dark:text-green-200 mt-1",children:"No validation issues found in your financial data."})]}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:()=>{const e=L.filter(e=>e.fix).map(e=>e.id);S(new Set(e))},className:"px-3 py-1 text-sm text-gray-700 dark:text-gray-300 \n                           hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:"Select All Fixable"}),n.jsx("button",{onClick:()=>{S(new Set)},className:"px-3 py-1 text-sm text-gray-700 dark:text-gray-300 \n                           hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:"Deselect All"})]}),n.jsx("button",{onClick:async()=>{const e=L.filter(e=>$.has(e.id)&&e.fix);if(0===e.length)return;N(!0),z({current:0,total:e.length});const t=[];try{for(let a=0;a<e.length;a++){z({current:a+1,total:e.length});const s=await e[a].fix();t.push(...s),await new Promise(e=>setTimeout(e,100))}S(new Set),V(t),M(!0)}catch(a){console.error("Error fixing issues:",a)}finally{N(!1),z({current:0,total:0})}},disabled:0===$.size||v,className:"flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg\n                         hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed",children:v?n.jsxs(n.Fragment,{children:[n.jsx(w,{size:20,className:"animate-spin"}),"Fixing (",T.current,"/",T.total,")..."]}):n.jsxs(n.Fragment,{children:[n.jsx(C,{size:20}),"Fix Selected Issues"]})})]}),n.jsx("div",{className:"space-y-6",children:Array.from(R).map(([e,t])=>n.jsxs("div",{children:[n.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-3",children:e}),n.jsx("div",{className:"space-y-3",children:t.map(e=>n.jsx("div",{className:"rounded-lg border p-4 "+("error"===e.type?"border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20":"warning"===e.type?"border-yellow-200 dark:border-yellow-800 bg-yellow-50 dark:bg-yellow-900/20":"border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/20"),children:n.jsxs("div",{className:"flex items-start gap-3",children:[e.fix&&n.jsx("input",{type:"checkbox",checked:$.has(e.id),onChange:()=>(e=>{const t=new Set($);t.has(e)?t.delete(e):t.add(e),S(t)})(e.id),className:"mt-1"}),G(e.type),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"font-medium",children:e.description}),e.fixDescription&&n.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:["Fix: ",e.fixDescription]}),n.jsxs("div",{className:"flex items-center justify-between mt-2",children:[n.jsxs("div",{className:"text-xs text-gray-500",children:["Affects ",e.affectedItems.length," item(s)"]}),n.jsxs("button",{onClick:()=>{let t="other";"invalid-categories"===e.id?t="invalid-categories":"invalid-amounts"===e.id?t="zero-negative-amounts":"large-transactions"===e.id&&(t="large-transactions"),O({isOpen:!0,title:e.description,transactionIds:e.affectedItems,issueType:t})},className:"flex items-center gap-1 px-2 py-1 text-xs text-blue-600 dark:text-blue-400\n                                         hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded",children:[n.jsx(D,{size:14}),"View Details"]})]})]})]})},e.id))})]},e))})]})]}),n.jsx("div",{className:"flex justify-end px-6 py-4 border-t border-gray-200 dark:border-gray-700",children:n.jsx("button",{onClick:l,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 \n                   dark:hover:bg-gray-700 rounded-lg",children:"Close"})})]}),A&&n.jsx(e,{isOpen:A.isOpen,onClose:()=>O(null),title:A.title,transactionIds:A.transactionIds,issueType:A.issueType,onFixed:()=>{O(null)}}),n.jsx(t,{isOpen:F,onClose:()=>M(!1),changes:B,onUndo:e=>{const t=B.find(t=>t.id===e);t&&("transaction"===t.type?"deleted"===t.field||m(t.itemId,{[t.field]:t.oldValue}):"account"===t.type&&h(t.itemId,{[t.field]:t.oldValue}),V(B.filter(t=>t.id!==e)))},onUndoAll:()=>{[...B].reverse().forEach(e=>{"transaction"===e.type&&"deleted"!==e.field?m(e.itemId,{[e.field]:e.oldValue}):"account"===e.type&&h(e.itemId,{[e.field]:e.oldValue})}),V([]),M(!1)}}),n.jsx(a,{isOpen:!!E,onClose:()=>{U(null),W(null)},option:E,onConfirm:async e=>{if(!E||!P)return;const{accountId:t,accountName:a,difference:s}=E,r=[];if("opening-balance"===e){const e=o.find(e=>e.id===t),n=e?.openingBalance||0,i=n+s;h(t,{openingBalance:i,openingBalanceDate:e?.openingBalanceDate||new Date}),r.push({id:`${Date.now()}-opening-balance`,type:"account",itemId:t,field:"openingBalance",oldValue:n,newValue:i,description:`${a}: Opening balance adjusted by ${j(s)} to reconcile account`,issueType:"Balance reconciliation - Opening Balance"})}else{let e=g.find(e=>"account-adjustments"===e.id);e||(g.find(e=>"sub-adjustments"===e.id)||(f({name:"Adjustments",type:"both",level:"sub",parentId:"type-expense",isSystem:!0}),await new Promise(e=>setTimeout(e,100))),f({name:"Account Adjustments",type:"both",level:"detail",parentId:"sub-adjustments",isSystem:!0}),await new Promise(e=>setTimeout(e,100)),e=g.find(e=>"Account Adjustments"===e.name));const i=e?.id||e?.name||"Account Adjustments",d=s>0?"income":"expense",l=`Balance adjustment - ${a}`,o={date:new Date,description:l,amount:Math.abs(s),category:i,accountId:t,type:d,cleared:!0};c.filter(e=>e.accountId===t);try{b(o),console.log("Transaction added successfully"),await new Promise(e=>setTimeout(e,500))}catch(n){console.error("Error adding transaction:",n)}r.push({id:`${Date.now()}-transaction`,type:"transaction",itemId:Date.now().toString(),field:"created",oldValue:"no transaction",newValue:`${d} ${j(Math.abs(s))}`,description:`Created ${d} transaction of ${j(Math.abs(s))} in "${a}" with category "Account Adjustments"`,issueType:"Balance reconciliation - Adjustment Transaction"})}P.resolve(r),U(null),W(null)}})]})}import{r,L as n}from"./chunk-Bcp2Zi4E.js";import{a as i,M as d,x as l,X as c,E as o,ao as g,v as x,bO as m,aj as u,aB as p,aa as y,aH as h,ak as b,k as f,C as j,i as v,bP as N,b0 as k,ac as w,a_ as C,ag as D}from"./index-LbveD3Go.js";import{u as I}from"./chunk-BlSolNAr.js";import"./chunk-oUGr0aFc.js";import"./chunk-a7oqB5tI.js";import"./chunk-B5pcS96K.js";export{s as default};
