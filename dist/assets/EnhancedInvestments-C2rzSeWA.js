function e({accountId:e,investmentId:s}){const[a,r]=P.useState([]),[l,n]=P.useState(null),[p,j]=P.useState([]),[v,f]=P.useState(!1),[N,k]=P.useState(null),[C,w]=P.useState("1y"),[S,D]=P.useState(""),{accounts:T}=i(),{currencySymbol:E}=R(),{formatCurrency:F}=A(),M=P.useMemo(()=>{const e=[];return T.forEach(t=>{"investment"===t.type&&t.holdings&&t.holdings.forEach(s=>{e.push({id:`${t.id}-${s.ticker}`,accountId:t.id,symbol:s.ticker,name:s.name,quantity:s.shares,purchasePrice:s.averageCost||0,purchaseDate:new Date,currentPrice:s.currentPrice,currentValue:s.marketValue||s.value,averageCost:s.averageCost||0,createdAt:new Date})})}),e},[T]);P.useEffect(()=>{V()},[e,s,C,S]);const V=()=>{let t;const a=new Date;switch(C){case"ytd":t=new Date(a.getFullYear(),0,1);break;case"1y":t=new Date(a.getFullYear()-1,a.getMonth(),a.getDate());break;case"3y":t=new Date(a.getFullYear()-3,a.getMonth(),a.getDate());break;case"all":t=void 0}const l={accountId:e,investmentId:s,symbol:S||void 0,startDate:t},i=_.getDividends(l);r(i);const d=_.getDividendSummary(t);n(d);const c=M.filter(t=>!e||t.accountId===e).map(e=>({symbol:e.symbol,shares:e.quantity,currentValue:e.currentValue})),o=_.getDividendProjections(c);j(o)},I=Array.from(new Set(M.map(e=>e.symbol))).sort(),B=e=>{confirm("Are you sure you want to delete this dividend record?")&&(_.deleteDividend(e),V())};return d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsxs("select",{value:C,onChange:e=>w(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[d.jsx("option",{value:"ytd",children:"Year to Date"}),d.jsx("option",{value:"1y",children:"Last 12 Months"}),d.jsx("option",{value:"3y",children:"Last 3 Years"}),d.jsx("option",{value:"all",children:"All Time"})]}),d.jsxs("select",{value:S,onChange:e=>D(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[d.jsx("option",{value:"",children:"All Symbols"}),I.map(e=>d.jsx("option",{value:e,children:e},e))]})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d.jsx(c,{size:20}),"Add Dividend"]}),d.jsx("button",{onClick:()=>{const e=_.exportToCSV(),t=new Blob([e],{type:"text/csv"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`dividends-${(new Date).toISOString().split("T")[0]}.csv`,a.click(),URL.revokeObjectURL(s)},className:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",title:"Export to CSV",children:d.jsx(o,{size:20})})]})]}),l&&d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[d.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Dividends"}),d.jsx("p",{className:"text-2xl font-bold",children:F(l.totalDividends.toNumber())})]}),d.jsx(m,{size:32,className:"text-green-600"})]})}),d.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Tax Withheld"}),d.jsx("p",{className:"text-2xl font-bold",children:F(l.totalTaxWithheld.toNumber())})]}),d.jsx(x,{size:32,className:"text-orange-600"})]})}),d.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Projected Annual"}),d.jsx("p",{className:"text-2xl font-bold",children:F(l.projectedAnnual.toNumber())})]}),d.jsx(g,{size:32,className:"text-blue-600"})]})}),d.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Unique Stocks"}),d.jsx("p",{className:"text-2xl font-bold",children:Object.keys(l.bySymbol).length})]}),d.jsx(h,{size:32,className:"text-purple-600"})]})})]}),p.length>0&&d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[d.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[d.jsx(u,{size:20}),"Projected Upcoming Dividends"]}),d.jsx("div",{className:"space-y-2",children:p.slice(0,5).map((e,t)=>d.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("span",{className:"font-medium",children:e.symbol}),d.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.nextPaymentDate.toLocaleDateString()}),d.jsxs("span",{className:"text-xs px-2 py-1 rounded "+("high"===e.confidence?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"medium"===e.confidence?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-gray-100 text-gray-700 dark:bg-gray-600 dark:text-gray-300"),children:[e.confidence," confidence"]})]}),d.jsxs("span",{className:"font-semibold text-green-600 dark:text-green-400",children:["+",F(e.estimatedAmount.toNumber())]})]},t))})]}),d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[d.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Dividend History"}),0===a.length?d.jsx("p",{className:"text-center text-gray-500 py-8",children:"No dividend records found"}):d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"sm:hidden space-y-3",children:a.map(e=>d.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[d.jsxs("div",{className:"flex justify-between items-start mb-3",children:[d.jsxs("div",{children:[d.jsx("p",{className:"font-medium text-gray-900 dark:text-white text-lg",children:e.symbol}),d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.paymentDate.toLocaleDateString()})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("button",{onClick:()=>k(e),className:"min-w-[44px] min-h-[44px] flex items-center justify-center text-blue-600 hover:text-blue-900 dark:text-blue-400",title:"Edit",children:d.jsx(b,{size:20})}),d.jsx("button",{onClick:()=>B(e.id),className:"min-w-[44px] min-h-[44px] flex items-center justify-center text-red-600 hover:text-red-900 dark:text-red-400",title:"Delete",children:d.jsx(y,{size:20})})]})]}),d.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[d.jsx("span",{className:"text-xs px-2 py-1 rounded "+("special"===e.type?"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400":"bg-gray-100 text-gray-700 dark:bg-gray-600 dark:text-gray-300"),children:e.type}),d.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.frequency})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs",children:"Amount"}),d.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:F(e.amount)})]}),d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs",children:"Per Share"}),d.jsxs("span",{className:"text-gray-900 dark:text-white",children:[E,e.amountPerShare.toFixed(4)]})]})]})]},e.id))}),d.jsx("div",{className:"hidden sm:block overflow-x-auto",children:d.jsxs("table",{className:"w-full",children:[d.jsx("thead",{className:"bg-secondary dark:bg-gray-700",children:d.jsxs("tr",{className:"border-b border-[#5A729A] dark:border-gray-600",children:[d.jsx("th",{className:"text-left py-3 px-4 text-white text-sm font-medium",children:"Date"}),d.jsx("th",{className:"text-left py-3 px-4 text-white text-sm font-medium",children:"Symbol"}),d.jsx("th",{className:"text-right py-3 px-4 text-white text-sm font-medium",children:"Amount"}),d.jsx("th",{className:"text-right py-3 px-4 text-white text-sm font-medium",children:"Per Share"}),d.jsx("th",{className:"text-center py-3 px-4 text-white text-sm font-medium",children:"Type"}),d.jsx("th",{className:"text-center py-3 px-4 text-white text-sm font-medium",children:"Frequency"}),d.jsx("th",{className:"text-right py-3 px-4 text-white text-sm font-medium",children:"Actions"})]})}),d.jsx("tbody",{children:a.map(e=>d.jsxs("tr",{className:"border-b dark:border-gray-700",children:[d.jsx("td",{className:"py-3 px-4",children:e.paymentDate.toLocaleDateString()}),d.jsx("td",{className:"py-3 px-4 font-medium",children:e.symbol}),d.jsx("td",{className:"py-3 px-4 text-right",children:F(e.amount)}),d.jsxs("td",{className:"py-3 px-4 text-right text-sm text-gray-600 dark:text-gray-400",children:[E,e.amountPerShare.toFixed(4)]}),d.jsx("td",{className:"py-3 px-4 text-center",children:d.jsx("span",{className:"text-xs px-2 py-1 rounded "+("special"===e.type?"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400":"bg-gray-100 text-gray-700 dark:bg-gray-600 dark:text-gray-300"),children:e.type})}),d.jsx("td",{className:"py-3 px-4 text-center text-sm",children:e.frequency}),d.jsx("td",{className:"py-3 px-4 text-right",children:d.jsxs("div",{className:"flex items-center justify-end gap-1",children:[d.jsx("button",{onClick:()=>k(e),className:"p-1 text-blue-600 hover:bg-blue-50 dark:hover:bg-gray-700 rounded",title:"Edit",children:d.jsx(b,{size:16})}),d.jsx("button",{onClick:()=>B(e.id),className:"p-1 text-red-600 hover:bg-red-50 dark:hover:bg-gray-700 rounded",title:"Delete",children:d.jsx(y,{size:16})})]})})]},e.id))})]})})]})]}),(v||N)&&d.jsx(t,{dividend:N,symbols:I,onSave:N?e=>{if(!N||!e)return;const t={...N,...e};_.updateDividend(t.id,t),V(),k(null)}:async e=>{if(!e.symbol||!e.amount)return;const t=M.find(t=>t.symbol===e.symbol);if(!t)return;const s={investmentId:t.id,accountId:t.accountId,symbol:e.symbol,amount:e.amount,amountPerShare:e.amountPerShare||e.amount/t.quantity,shares:t.quantity,currency:"USD",paymentDate:e.paymentDate||new Date,exDividendDate:e.exDividendDate||new Date,recordDate:e.recordDate,declarationDate:e.declarationDate,frequency:e.frequency||"quarterly",type:e.type||"regular",taxWithheld:e.taxWithheld,reinvested:e.reinvested||!1,reinvestmentPrice:e.reinvestmentPrice,reinvestmentShares:e.reinvestmentShares,notes:e.notes};_.addDividend(s),V(),f(!1)},onClose:()=>{f(!1),k(null)}})]})}function t({dividend:e,symbols:t,onSave:s,onClose:a}){const[r,l]=P.useState({symbol:e?.symbol||"",amount:e?.amount||0,amountPerShare:e?.amountPerShare||0,paymentDate:e?.paymentDate||new Date,exDividendDate:e?.exDividendDate||new Date,recordDate:e?.recordDate,declarationDate:e?.declarationDate,frequency:e?.frequency||"quarterly",type:e?.type||"regular",taxWithheld:e?.taxWithheld||0,reinvested:e?.reinvested||!1,reinvestmentPrice:e?.reinvestmentPrice||0,reinvestmentShares:e?.reinvestmentShares||0,notes:e?.notes||""});return d.jsx(p,{isOpen:!0,onClose:a,title:e?"Edit Dividend":"Add Dividend",children:d.jsxs("form",{onSubmit:t=>{t.preventDefault(),s({...e,...r})},children:[d.jsxs(j,{children:[d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1",children:"Symbol"}),d.jsxs("select",{value:r.symbol,onChange:e=>l({...r,symbol:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0,children:[d.jsx("option",{value:"",children:"Select symbol"}),t.map(e=>d.jsx("option",{value:e,children:e},e))]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1",children:"Total Amount"}),d.jsx("input",{type:"number",step:"0.01",value:r.amount,onChange:e=>l({...r,amount:parseFloat(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1",children:"Payment Date"}),d.jsx("input",{type:"date",value:r.paymentDate.toISOString().split("T")[0],onChange:e=>l({...r,paymentDate:new Date(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ex-Dividend Date"}),d.jsx("input",{type:"date",value:r.exDividendDate.toISOString().split("T")[0],onChange:e=>l({...r,exDividendDate:new Date(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1",children:"Frequency"}),d.jsxs("select",{value:r.frequency,onChange:e=>l({...r,frequency:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[d.jsx("option",{value:"monthly",children:"Monthly"}),d.jsx("option",{value:"quarterly",children:"Quarterly"}),d.jsx("option",{value:"semi-annual",children:"Semi-Annual"}),d.jsx("option",{value:"annual",children:"Annual"}),d.jsx("option",{value:"special",children:"Special"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1",children:"Type"}),d.jsxs("select",{value:r.type,onChange:e=>l({...r,type:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[d.jsx("option",{value:"regular",children:"Regular"}),d.jsx("option",{value:"special",children:"Special"}),d.jsx("option",{value:"qualified",children:"Qualified"}),d.jsx("option",{value:"non-qualified",children:"Non-Qualified"}),d.jsx("option",{value:"return-of-capital",children:"Return of Capital"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tax Withheld"}),d.jsx("input",{type:"number",step:"0.01",value:r.taxWithheld,onChange:e=>l({...r,taxWithheld:parseFloat(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700"})]}),d.jsx("div",{className:"flex items-center",children:d.jsxs("label",{className:"flex items-center gap-2",children:[d.jsx("input",{type:"checkbox",checked:r.reinvested,onChange:e=>l({...r,reinvested:e.target.checked}),className:"rounded"}),d.jsx("span",{className:"text-sm font-medium",children:"Reinvested"})]})})]}),d.jsxs("div",{className:"mt-4",children:[d.jsx("label",{className:"block text-sm font-medium mb-1",children:"Notes"}),d.jsx("textarea",{value:r.notes,onChange:e=>l({...r,notes:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",rows:2})]})]}),d.jsxs(v,{children:[d.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100",children:"Cancel"}),d.jsxs("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e?"Update":"Add"," Dividend"]})]})]})})}function s({accountId:e}){const[t,s]=P.useState([]),[r,l]=P.useState([]),[n,c]=P.useState([]),[o,m]=P.useState(null),[g,h]=P.useState(!1),[u,y]=P.useState(null),[p,j]=P.useState(!1),[v,w]=P.useState(0),[S,D]=P.useState(!0),{accounts:T}=i();R();const{formatCurrency:E}=A(),F=P.useMemo(()=>{const e=[];return T.forEach(t=>{"investment"===t.type&&t.holdings&&t.holdings.forEach(s=>{e.push({id:`${t.id}-${s.ticker}`,accountId:t.id,symbol:s.ticker,name:s.name,quantity:s.shares,purchasePrice:s.averageCost||0,purchaseDate:new Date,currentPrice:s.currentPrice,currentValue:s.marketValue||s.value,averageCost:s.averageCost||0,createdAt:new Date})})}),e},[T]);P.useEffect(()=>{M()},[e,F]);const M=()=>{const t=F.filter(t=>!e||t.accountId===e).map(e=>({symbol:e.symbol,name:e.name,shares:e.quantity,value:e.currentValue,price:e.currentPrice||e.currentValue/e.quantity}));if(0===t.length)return;const a=X.calculateCurrentAllocation(t);s(a);const r=X.getPortfolioTargets();c(r);const n=X.getActiveTarget();m(n);const i=X.isRebalancingNeeded(a);if(j(i),i&&n){const e=X.calculateRebalanceActions(t,v,S);l(e)}else l([])},U=t.map(e=>({name:e.assetClass,value:e.currentValue.toNumber(),percent:e.currentPercent})),O=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#6B7280"];return d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("h2",{className:"text-xl font-semibold",children:"Portfolio Rebalancing"}),p&&d.jsxs("span",{className:"flex items-center gap-1 px-3 py-1 bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400 rounded-full text-sm",children:[d.jsx(x,{size:16}),"Rebalancing Recommended"]})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-2 px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100",children:[d.jsx(f,{size:20}),"Manage Targets"]}),d.jsx("button",{onClick:M,className:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",title:"Refresh",children:d.jsx(N,{size:20})})]})]}),o&&d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h3",{className:"text-lg font-semibold",children:o.name}),d.jsx("button",{onClick:()=>{y(o),h(!0)},className:"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-gray-700 rounded-lg",children:d.jsx(b,{size:20})})]}),o.description&&d.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:o.description}),d.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:o.allocations.map(e=>d.jsxs("div",{children:[d.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[e.assetClass,":"]}),d.jsxs("span",{className:"ml-2 font-medium",children:[e.targetPercent,"%"]})]},e.assetClass))}),o.lastRebalanced&&d.jsxs("p",{className:"text-xs text-gray-500 mt-4",children:["Last rebalanced: ",o.lastRebalanced.toLocaleDateString()]})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[d.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Current Allocation"}),U.length>0?d.jsx(V,{width:"100%",height:300,children:d.jsxs(I,{children:[d.jsx(B,{data:U,cx:"50%",cy:"50%",outerRadius:100,fill:"#8884d8",dataKey:"value",label:({name:e,percent:t})=>`${e} ${(t??0).toFixed(1)}%`,children:U.map((e,t)=>d.jsx(q,{fill:O[t%O.length]},`cell-${t}`))}),d.jsx(L,{formatter:e=>E(e)})]})}):d.jsx("p",{className:"text-center text-gray-500 py-8",children:"No holdings to display"})]}),d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[d.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Allocation Details"}),d.jsx("div",{className:"space-y-2",children:t.map((e,t)=>d.jsxs("div",{className:"border-b dark:border-gray-700 pb-2",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:O[t%O.length]}}),d.jsx("span",{className:"font-medium",children:e.assetClass})]}),d.jsx("span",{className:"font-medium",children:E(e.currentValue.toNumber())})]}),d.jsxs("div",{className:"flex items-center justify-between mt-1 text-sm",children:[d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Current: ",e.currentPercent.toFixed(1),"%"]}),d.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Target: ",e.targetPercent.toFixed(1),"%"]})]}),d.jsxs("span",{className:"font-medium "+(Math.abs(e.differencePercent)<2?"text-green-600":Math.abs(e.differencePercent)<5?"text-yellow-600":"text-red-600"),children:[e.differencePercent>0?"+":"",e.differencePercent.toFixed(1),"%"]})]})]},e.assetClass))})]})]}),r.length>0&&d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h3",{className:"text-lg font-semibold",children:"Rebalancing Actions"}),d.jsxs("button",{onClick:()=>{o&&(alert("Rebalancing actions have been generated. Review and execute them through your broker."),X.markRebalanced(o.id),M())},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[d.jsx(k,{size:20}),"Mark as Rebalanced"]})]}),d.jsxs("div",{className:"mb-4 flex items-center gap-4",children:[d.jsxs("label",{className:"flex items-center gap-2",children:[d.jsx("input",{type:"number",step:"100",value:v,onChange:e=>w(parseFloat(e.target.value)||0),className:"w-32 px-3 py-1 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700",placeholder:"0"}),d.jsx("span",{className:"text-sm",children:"Cash Available"})]}),d.jsxs("label",{className:"flex items-center gap-2",children:[d.jsx("input",{type:"checkbox",checked:S,onChange:e=>D(e.target.checked),className:"rounded"}),d.jsx("span",{className:"text-sm",children:"Consider Tax Implications"})]})]}),d.jsx("div",{className:"sm:hidden space-y-3",children:r.map((e,t)=>d.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[d.jsxs("div",{className:"flex justify-between items-start mb-3",children:[d.jsxs("div",{children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-sm font-bold "+("buy"===e.action?"text-green-600":"text-red-600"),children:e.action.toUpperCase()}),d.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:e.symbol})]}),d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.name}),d.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:e.assetClass})]}),d.jsxs("span",{className:"text-xs px-2 py-1 rounded "+(e.priority<=2?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":3===e.priority?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-gray-100 text-gray-700 dark:bg-gray-600 dark:text-gray-300"),children:["Priority ",e.priority]})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs",children:"Shares"}),d.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:e.shares.toFixed(2)})]}),d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs",children:"Amount"}),d.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:E(e.amount.toNumber())})]})]})]},t))}),d.jsx("div",{className:"hidden sm:block overflow-x-auto",children:d.jsxs("table",{className:"w-full",children:[d.jsx("thead",{className:"bg-secondary dark:bg-gray-700",children:d.jsxs("tr",{className:"border-b border-[#5A729A] dark:border-gray-600",children:[d.jsx("th",{className:"text-left py-3 px-4 text-white text-sm font-medium",children:"Action"}),d.jsx("th",{className:"text-left py-3 px-4 text-white text-sm font-medium",children:"Symbol"}),d.jsx("th",{className:"text-left py-3 px-4 text-white text-sm font-medium",children:"Asset Class"}),d.jsx("th",{className:"text-right py-3 px-4 text-white text-sm font-medium",children:"Shares"}),d.jsx("th",{className:"text-right py-3 px-4 text-white text-sm font-medium",children:"Amount"}),d.jsx("th",{className:"text-center py-3 px-4 text-white text-sm font-medium",children:"Priority"})]})}),d.jsx("tbody",{children:r.map((e,t)=>d.jsxs("tr",{className:"border-b dark:border-gray-700",children:[d.jsx("td",{className:"py-3 px-4",children:d.jsx("span",{className:"text-sm font-medium "+("buy"===e.action?"text-green-600":"text-red-600"),children:e.action.toUpperCase()})}),d.jsx("td",{className:"py-3 px-4",children:d.jsxs("div",{children:[d.jsx("div",{className:"font-medium",children:e.symbol}),d.jsx("div",{className:"text-xs text-gray-500",children:e.name})]})}),d.jsx("td",{className:"py-3 px-4 text-sm",children:e.assetClass}),d.jsx("td",{className:"py-3 px-4 text-right",children:e.shares.toFixed(2)}),d.jsx("td",{className:"py-3 px-4 text-right",children:E(e.amount.toNumber())}),d.jsx("td",{className:"py-3 px-4 text-center",children:d.jsxs("span",{className:"text-xs px-2 py-1 rounded "+(e.priority<=2?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":3===e.priority?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-gray-100 text-gray-700 dark:bg-gray-600 dark:text-gray-300"),children:["P",e.priority]})})]},t))})]})}),d.jsx("div",{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:d.jsxs("div",{className:"flex items-start gap-2",children:[d.jsx(C,{size:20,className:"text-blue-600 mt-0.5"}),d.jsxs("div",{className:"text-sm text-blue-800 dark:text-blue-300",children:[d.jsx("p",{className:"font-medium mb-1",children:"How to execute:"}),d.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[d.jsx("li",{children:"Review the suggested actions above"}),d.jsx("li",{children:"Place orders through your broker"}),d.jsx("li",{children:'Once complete, click "Mark as Rebalanced"'})]})]})]})})]}),g&&d.jsx(a,{targets:n,editingTarget:u,onSave:e=>{const t=X.savePortfolioTarget({...e,id:u?.id,isActive:!0,allocations:e.allocations||[]});t.isActive&&n.forEach(e=>{e.id!==t.id&&e.isActive&&X.savePortfolioTarget({...e,isActive:!1})}),M(),h(!1),y(null)},onDelete:e=>{confirm("Are you sure you want to delete this portfolio target?")&&(X.deletePortfolioTarget(e),M())},onSetActive:e=>{n.forEach(e=>{X.savePortfolioTarget({...e,isActive:!1})}),X.savePortfolioTarget({...e,isActive:!0}),M()},onUseTemplate:e=>{y({...e,id:void 0,name:`${e.name} (Copy)`,isActive:!0}),h(!0)},onClose:()=>{h(!1),y(null)}})]})}function a({targets:e,editingTarget:t,onSave:s,onDelete:a,onSetActive:r,onUseTemplate:l,onClose:n}){const[i,o]=P.useState("targets"),[m,x]=P.useState(t||{name:"",description:"",allocations:[],rebalanceThreshold:5});P.useEffect(()=>{t&&(x(t),o("edit"))},[t]);const g=X.getPortfolioTemplates(),h=(e,t,s)=>{const a=[...m.allocations||[]];a[e]={...a[e],[t]:s},x({...m,allocations:a})};return d.jsx(p,{isOpen:!0,onClose:n,title:"Portfolio Targets",size:"lg",children:d.jsxs(j,{children:[d.jsxs("div",{className:"flex gap-4 mb-6 border-b dark:border-gray-700",children:[d.jsx("button",{onClick:()=>o("targets"),className:"pb-2 px-1 "+("targets"===i?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 dark:text-gray-400"),children:"My Targets"}),d.jsx("button",{onClick:()=>o("templates"),className:"pb-2 px-1 "+("templates"===i?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 dark:text-gray-400"),children:"Templates"}),d.jsxs("button",{onClick:()=>o("edit"),className:"pb-2 px-1 "+("edit"===i?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 dark:text-gray-400"),children:[t?"Edit":"Create"," Target"]})]}),"targets"===i&&d.jsx("div",{className:"space-y-4",children:0===e.length?d.jsx("p",{className:"text-center text-gray-500 py-8",children:"No portfolio targets created yet"}):e.map(e=>d.jsx("div",{className:"border dark:border-gray-700 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-start justify-between",children:[d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("h4",{className:"font-medium",children:e.name}),e.isActive&&d.jsx("span",{className:"text-xs px-2 py-1 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 rounded",children:"Active"})]}),e.description&&d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.description}),d.jsx("div",{className:"flex flex-wrap gap-4 mt-2 text-sm",children:e.allocations.map(e=>d.jsxs("span",{children:[e.assetClass,": ",e.targetPercent,"%"]},e.assetClass))})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[!e.isActive&&d.jsx("button",{onClick:()=>r(e),className:"text-sm text-blue-600 hover:text-blue-700",children:"Set Active"}),d.jsx("button",{onClick:()=>{x(e),o("edit")},className:"p-1 text-gray-600 hover:text-gray-900",children:d.jsx(b,{size:16})}),d.jsx("button",{onClick:()=>a(e.id),className:"p-1 text-red-600 hover:text-red-700",children:d.jsx(y,{size:16})})]})]})},e.id))}),"templates"===i&&d.jsx("div",{className:"space-y-4",children:g.map(e=>d.jsx("div",{className:"border dark:border-gray-700 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-start justify-between",children:[d.jsxs("div",{className:"flex-1",children:[d.jsx("h4",{className:"font-medium",children:e.name}),d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.description}),d.jsx("div",{className:"flex flex-wrap gap-4 mt-2 text-sm",children:e.allocations.map(e=>d.jsxs("span",{children:[e.assetClass,": ",e.targetPercent,"%"]},e.assetClass))})]}),d.jsx("button",{onClick:()=>l(e),className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700",children:"Use Template"})]})},e.id))}),"edit"===i&&d.jsxs("form",{onSubmit:e=>{e.preventDefault();const t=m.allocations?.reduce((e,t)=>e+t.targetPercent,0)||0;Math.abs(t-100)>.01?alert("Target allocations must sum to 100%"):s(m)},children:[d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1",children:"Name"}),d.jsx("input",{type:"text",value:m.name,onChange:e=>x({...m,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),d.jsx("textarea",{value:m.description||"",onChange:e=>x({...m,description:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",rows:2})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium mb-1",children:"Rebalance Threshold (%)"}),d.jsx("input",{type:"number",step:"0.5",value:m.rebalanceThreshold||5,onChange:e=>x({...m,rebalanceThreshold:parseFloat(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700"})]}),d.jsxs("div",{children:[d.jsxs("div",{className:"flex items-center justify-between mb-2",children:[d.jsx("label",{className:"text-sm font-medium",children:"Asset Allocations"}),d.jsxs("button",{type:"button",onClick:()=>{x({...m,allocations:[...m.allocations||[],{assetClass:"",targetPercent:0}]})},className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-700",children:[d.jsx(c,{size:16}),"Add Asset Class"]})]}),d.jsx("div",{className:"space-y-2",children:m.allocations?.map((e,t)=>d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("input",{type:"text",value:e.assetClass,onChange:e=>h(t,"assetClass",e.target.value),placeholder:"Asset Class",className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0}),d.jsx("input",{type:"number",step:"0.1",value:e.targetPercent,onChange:e=>h(t,"targetPercent",parseFloat(e.target.value)),placeholder:"0",className:"w-24 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0}),d.jsx("span",{className:"text-sm",children:"%"}),d.jsx("button",{type:"button",onClick:()=>(e=>{const t=[...m.allocations||[]];t.splice(e,1),x({...m,allocations:t})})(t),className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-gray-700 rounded",children:d.jsx(y,{size:16})})]},t))}),m.allocations&&m.allocations.length>0&&d.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:["Total: ",m.allocations.reduce((e,t)=>e+t.targetPercent,0).toFixed(1),"%"]})]})]}),d.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[d.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100",children:"Cancel"}),d.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Save Target"})]})]})]})})}function r({accountId:e}){const[t,s]=P.useState([]),[a,r]=P.useState("pie"),[l,n]=P.useState("assetClass"),[c,m]=P.useState(!0),{accounts:x}=i(),{formatCurrency:u}=A();R();const b=P.useMemo(()=>{const e=[];return x.forEach(t=>{"investment"===t.type&&t.holdings&&t.holdings.forEach(s=>{e.push({id:`${t.id}-${s.ticker}`,accountId:t.id,symbol:s.ticker,name:s.name,quantity:s.shares,purchasePrice:s.averageCost||0,purchaseDate:new Date,currentPrice:s.currentPrice,currentValue:s.marketValue||s.value,averageCost:s.averageCost||0,createdAt:new Date})})}),e},[x]);P.useEffect(()=>{y()},[e,b,l]);const y=()=>{if("assetClass"===l){const t=b.filter(t=>!e||t.accountId===e).map(e=>({symbol:e.symbol,value:e.currentValue,shares:e.quantity})),a=X.calculateCurrentAllocation(t);s(a)}else if("account"===l){const e={},t=b.reduce((e,t)=>e+t.currentValue,0);b.forEach(t=>{const s=x.find(e=>e.id===t.accountId),a=s?.name||"Unknown";e[a]=(e[a]||0)+t.currentValue});const a=Object.entries(e).map(([e,s])=>({assetClass:e,currentPercent:s/t*100,currentValue:{toNumber:()=>s},targetPercent:0,targetValue:{toNumber:()=>0},difference:{toNumber:()=>0},differencePercent:0}));s(a)}else{const e={},t=b.reduce((e,t)=>e+t.currentValue,0);b.forEach(t=>{e[t.symbol]||(e[t.symbol]={value:0,name:t.name}),e[t.symbol].value+=t.currentValue});const a=Object.entries(e).map(([e,s])=>({assetClass:`${e} - ${s.name}`,currentPercent:s.value/t*100,currentValue:{toNumber:()=>s.value},targetPercent:0,targetValue:{toNumber:()=>0},difference:{toNumber:()=>0},differencePercent:0}));s(a.sort((e,t)=>t.currentPercent-e.currentPercent))}},p=t.map(e=>({name:e.assetClass,value:e.currentValue.toNumber(),percent:e.currentPercent,target:e.targetPercent})),j=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#6B7280","#14B8A6","#F97316","#6366F1"],v=t.reduce((e,t)=>e+t.currentValue.toNumber(),0);return d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsxs("select",{value:l,onChange:e=>n(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[d.jsx("option",{value:"assetClass",children:"By Asset Class"}),d.jsx("option",{value:"account",children:"By Account"}),d.jsx("option",{value:"symbol",children:"By Symbol"})]}),d.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-600",children:[d.jsx("button",{onClick:()=>r("pie"),className:"px-3 py-1.5 rounded-l-lg transition-colors "+("pie"===a?"bg-blue-600 text-white":"text-gray-600 dark:text-gray-400"),title:"Pie Chart",children:d.jsx(h,{size:20})}),d.jsx("button",{onClick:()=>r("bar"),className:"px-3 py-1.5 transition-colors "+("bar"===a?"bg-blue-600 text-white":"text-gray-600 dark:text-gray-400"),title:"Bar Chart",children:d.jsx(w,{size:20})}),d.jsx("button",{onClick:()=>r("treemap"),className:"px-3 py-1.5 rounded-r-lg transition-colors "+("treemap"===a?"bg-blue-600 text-white":"text-gray-600 dark:text-gray-400"),title:"Treemap",children:d.jsx(g,{size:20})})]}),"assetClass"===l&&d.jsxs("label",{className:"flex items-center gap-2",children:[d.jsx("input",{type:"checkbox",checked:c,onChange:e=>m(e.target.checked),className:"rounded"}),d.jsx("span",{className:"text-sm",children:"Show Targets"})]})]}),d.jsxs("button",{onClick:()=>{const e=t.map(e=>({Category:e.assetClass,"Current %":e.currentPercent.toFixed(2),"Current Value":e.currentValue.toNumber().toFixed(2),"Target %":e.targetPercent.toFixed(2),"Difference %":e.differencePercent.toFixed(2)})),s=[Object.keys(e[0]).join(","),...e.map(e=>Object.values(e).join(","))].join("\n"),a=new Blob([s],{type:"text/csv"}),r=URL.createObjectURL(a),l=document.createElement("a");l.href=r,l.download=`allocation-analysis-${(new Date).toISOString().split("T")[0]}.csv`,l.click(),URL.revokeObjectURL(r)},className:"flex items-center gap-2 px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100",children:[d.jsx(o,{size:20}),"Export"]})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[d.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Value"}),d.jsx("p",{className:"text-2xl font-bold",children:u(v)})]}),d.jsx(h,{size:32,className:"text-blue-600"})]})}),d.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Categories"}),d.jsx("p",{className:"text-2xl font-bold",children:t.length})]}),d.jsx(f,{size:32,className:"text-green-600"})]})}),d.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:d.jsx("div",{className:"flex items-center justify-between",children:d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Largest Holding"}),d.jsx("p",{className:"text-lg font-bold",children:t[0]?.assetClass||"N/A"}),d.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[t[0]?.currentPercent?.toFixed(1)??"0.0","%"]})]})})}),d.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:d.jsx("div",{className:"flex items-center justify-between",children:d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Concentration"}),d.jsxs("p",{className:"text-lg font-bold",children:["Top 3: ",t.slice(0,3).reduce((e,t)=>e+t.currentPercent,0).toFixed(1),"%"]})]})})})]}),d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[d.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Allocation Visualization"}),"pie"===a&&d.jsx(V,{width:"100%",height:400,children:d.jsxs(I,{children:[d.jsx(B,{data:p,cx:"50%",cy:"50%",outerRadius:120,fill:"#8884d8",dataKey:"value",label:({name:e,percent:t})=>`${e}: ${void 0!==t?t.toFixed(1):"0.0"}%`,children:p.map((e,t)=>d.jsx(q,{fill:j[t%j.length]},`cell-${t}`))}),d.jsx(L,{formatter:e=>u(e)})]})}),"bar"===a&&d.jsx(V,{width:"100%",height:400,children:d.jsxs(U,{data:p,margin:{left:50,right:20,top:20,bottom:50},children:[d.jsx(O,{strokeDasharray:"3 3"}),d.jsx(z,{dataKey:"name",angle:-45,textAnchor:"end",height:100}),d.jsx($,{}),d.jsx(L,{formatter:e=>u(e)}),d.jsx(Y,{}),d.jsx(W,{dataKey:"percent",fill:"#3B82F6",name:"Current %"}),c&&"assetClass"===l&&d.jsx(W,{dataKey:"target",fill:"#10B981",name:"Target %"})]})}),"treemap"===a&&d.jsx(V,{width:"100%",height:400,children:d.jsx(G,{data:p,dataKey:"value",aspectRatio:4/3,stroke:"#fff",fill:"#3B82F6",children:d.jsx(L,{content:({active:e,payload:t})=>{if(e&&t&&t[0]){const e=t[0].payload;return d.jsxs("div",{className:"bg-white dark:bg-gray-800 p-2 border border-gray-300 dark:border-gray-600 rounded shadow",children:[d.jsx("p",{className:"font-medium",children:e.name}),d.jsx("p",{className:"text-sm",children:u(e.value)}),d.jsxs("p",{className:"text-sm",children:[void 0!==e.percent?e.percent.toFixed(1):"0.0","%"]})]})}return null}})})})]}),d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[d.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Allocation Details"}),d.jsx("div",{className:"overflow-x-auto",children:d.jsxs("table",{className:"w-full",children:[d.jsx("thead",{children:d.jsxs("tr",{className:"border-b dark:border-gray-700",children:[d.jsx("th",{className:"text-left py-2",children:"Category"}),d.jsx("th",{className:"text-right py-2",children:"Current %"}),d.jsx("th",{className:"text-right py-2",children:"Value"}),c&&"assetClass"===l&&d.jsxs(d.Fragment,{children:[d.jsx("th",{className:"text-right py-2",children:"Target %"}),d.jsx("th",{className:"text-right py-2",children:"Difference"})]})]})}),d.jsx("tbody",{children:t.map((e,t)=>d.jsxs("tr",{className:"border-b dark:border-gray-700",children:[d.jsx("td",{className:"py-2",children:d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:j[t%j.length]}}),d.jsx("span",{children:e.assetClass})]})}),d.jsxs("td",{className:"py-2 text-right font-medium",children:[e.currentPercent.toFixed(2),"%"]}),d.jsx("td",{className:"py-2 text-right",children:u(e.currentValue.toNumber())}),c&&"assetClass"===l&&d.jsxs(d.Fragment,{children:[d.jsxs("td",{className:"py-2 text-right",children:[e.targetPercent.toFixed(2),"%"]}),d.jsxs("td",{className:"py-2 text-right font-medium "+(Math.abs(e.differencePercent)<2?"text-green-600":Math.abs(e.differencePercent)<5?"text-yellow-600":"text-red-600"),children:[e.differencePercent>0?"+":"",e.differencePercent.toFixed(2),"%"]})]})]},t))})]})})]}),d.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-6",children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx(C,{size:24,className:"text-blue-600 dark:text-blue-400 mt-0.5"}),d.jsxs("div",{children:[d.jsx("h3",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"Allocation Insights"}),d.jsx("ul",{className:"space-y-2 text-sm text-blue-800 dark:text-blue-200",children:t.length>0&&d.jsxs(d.Fragment,{children:[d.jsxs("li",{children:["\u2022 Your portfolio is spread across ",t.length," different ","assetClass"===l?"asset classes":"account"===l?"accounts":"securities"]}),d.jsxs("li",{children:["\u2022 The top holding (",t[0].assetClass,") represents ",t[0].currentPercent.toFixed(1),"% of your portfolio"]}),t[0].currentPercent>30&&d.jsx("li",{className:"text-orange-700 dark:text-orange-400",children:"\u2022 Consider diversifying - your largest position exceeds 30% of the portfolio"}),"assetClass"===l&&t.some(e=>Math.abs(e.differencePercent)>5)&&d.jsx("li",{className:"text-orange-700 dark:text-orange-400",children:"\u2022 Some asset classes are significantly off target - consider rebalancing"}),t.filter(e=>e.currentPercent<5).length>5&&d.jsxs("li",{children:["\u2022 You have ",t.filter(e=>e.currentPercent<5).length," positions under 5% - consider consolidating small holdings"]})]})})]})]})})]})}function l(){const{investments:t=[],transactions:a}=i(),{formatCurrency:l}=A(),[n,c]=P.useState("allocation-analysis"),[o,x]=P.useState([]),[u,b]=P.useState(null),[y,p]=P.useState([]),[j,v]=P.useState([]),[k,T]=P.useState(null),[E,F]=P.useState([]);P.useEffect(()=>{t&&t.length>0&&(x(H.getRebalancingSuggestions(t)),b(H.calculateRiskMetrics(t)),p(H.trackDividends(t,a)),v(H.getESGScores(t)),T(H.compareWithBenchmarks(t)),F(H.generateInsights(t,a)))},[t,a]);const M=[{id:"allocation-analysis",label:"Allocation Analysis",icon:h},{id:"portfolio-rebalancer",label:"Portfolio Rebalancer",icon:f},{id:"dividend-tracker",label:"Dividend Tracker",icon:m},{id:"rebalancing",label:"Quick Suggestions",icon:N},{id:"risk",label:"Risk Analysis",icon:S},{id:"benchmarks",label:"Benchmarks",icon:w},{id:"esg",label:"ESG Scores",icon:D}];return d.jsx(K,{title:"Investment Analytics",children:d.jsxs("div",{className:"max-w-7xl mx-auto",children:[d.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 dark:from-purple-800 dark:to-indigo-800 rounded-2xl p-6 mb-6 text-white shadow-lg",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Enhanced Investment Analytics"}),d.jsx("p",{className:"text-purple-100",children:"Advanced tools for portfolio optimization and analysis"})]}),d.jsx(g,{size:48,className:"text-white/80"})]})}),E.length>0&&d.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mb-6",children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx(C,{size:20,className:"text-blue-600 dark:text-blue-400 mt-0.5"}),d.jsx("div",{className:"space-y-2",children:E.map((e,t)=>d.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:e},t))})]})}),d.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm mb-6",children:d.jsx("div",{className:"flex overflow-x-auto scrollbar-hide border-b border-gray-200 dark:border-gray-700",children:M.map(e=>{const t=e.icon;return d.jsxs("button",{onClick:()=>c(e.id),className:"flex items-center gap-2 px-6 py-3 font-medium text-sm whitespace-nowrap transition-colors "+(n===e.id?"text-[var(--color-primary)] border-b-2 border-[var(--color-primary)]":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:[d.jsx(t,{size:16}),e.label]},e.id)})})}),d.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-6",children:["allocation-analysis"===n&&d.jsx(r,{}),"portfolio-rebalancer"===n&&d.jsx(s,{}),"dividend-tracker"===n&&d.jsx(e,{}),"rebalancing"===n&&d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[d.jsx("h3",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"Portfolio Rebalancing"}),d.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-200",children:"Keep your portfolio aligned with your target asset allocation."})]}),0===o.length?d.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[d.jsx(f,{size:48,className:"mx-auto mb-4 opacity-50"}),d.jsx("p",{children:"Your portfolio is well-balanced!"})]}):d.jsx("div",{className:"space-y-4",children:o.map((e,t)=>d.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:d.jsxs("div",{className:"flex items-start justify-between",children:[d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[d.jsx("span",{className:"px-2 py-1 rounded text-xs font-semibold "+("buy"===e.action?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"),children:e.action.toUpperCase()}),d.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:e.name})]}),d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:e.reason}),d.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[d.jsxs("span",{className:"text-gray-700 dark:text-gray-300",children:["Amount: ",d.jsx("strong",{children:l(e.amount)})]}),d.jsxs("span",{className:"text-gray-700 dark:text-gray-300",children:["Shares: ",d.jsx("strong",{children:e.shares})]})]})]}),d.jsx("button",{className:"px-4 py-2 bg-[var(--color-primary)] text-white rounded-lg hover:bg-[var(--color-primary)]/90 text-sm",children:"Execute"})]})},t))})]}),"risk"===n&&d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[d.jsx("h3",{className:"font-semibold text-purple-900 dark:text-purple-100 mb-2",children:"Risk Analysis"}),d.jsx("p",{className:"text-sm text-purple-700 dark:text-purple-200",children:"Understanding your portfolio's risk profile and diversification."})]}),u&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4",children:[d.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Portfolio Beta"}),d.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:u.portfolioBeta.toFixed(2)}),d.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:u.portfolioBeta>1?"More volatile than market":"Less volatile than market"})]}),d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4",children:[d.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Sharpe Ratio"}),d.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:u.sharpeRatio.toFixed(2)}),d.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"Risk-adjusted returns"})]}),d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4",children:[d.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Volatility"}),d.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[u.standardDeviation.toFixed(1),"%"]}),d.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"Annual standard deviation"})]}),d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4",children:[d.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Diversification Score"}),d.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:u.diversificationScore}),d.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mt-2",children:d.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${u.diversificationScore}%`}})})]})]}),u.concentrationRisk.length>0&&d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4",children:[d.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Concentration Risk"}),d.jsx("div",{className:"space-y-2",children:u.concentrationRisk.map((e,t)=>d.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700/50 rounded",children:[d.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:e.symbol}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[e.percent.toFixed(1),"%"]}),d.jsx("span",{className:"px-2 py-1 rounded text-xs font-semibold "+("high"===e.risk?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400":"medium"===e.risk?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400"),children:e.risk.toUpperCase()})]})]},t))})]})]})]}),"benchmarks"===n&&d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4",children:[d.jsx("h3",{className:"font-semibold text-orange-900 dark:text-orange-100 mb-2",children:"Benchmark Comparison"}),d.jsx("p",{className:"text-sm text-orange-700 dark:text-orange-200",children:"Compare your portfolio performance against market indices."})]}),k&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6",children:[d.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Portfolio Performance"}),d.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Return"}),d.jsxs("p",{className:"text-2xl font-bold "+(k.portfolio.return>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[k.portfolio.return>=0?"+":"",k.portfolio.return.toFixed(2),"%"]})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Annualized"}),d.jsxs("p",{className:"text-2xl font-bold "+(k.portfolio.annualizedReturn>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[k.portfolio.annualizedReturn>=0?"+":"",k.portfolio.annualizedReturn.toFixed(2),"%"]})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Current Value"}),d.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:l(k.portfolio.totalValue)})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Start Value"}),d.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:l(k.portfolio.startValue)})]})]})]}),d.jsx("div",{className:"space-y-3",children:k.benchmarks.map((e,t)=>d.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:e.name}),d.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.symbol})]}),d.jsxs("div",{className:"text-right",children:[d.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[e.annualizedReturn.toFixed(2),"%"]}),d.jsxs("p",{className:"text-sm font-medium "+(e.outperformance>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[e.outperformance>=0?"Outperforming":"Underperforming"," by ",Math.abs(e.outperformance).toFixed(2),"%"]})]})]})},t))})]})]}),"esg"===n&&d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"bg-teal-50 dark:bg-teal-900/20 rounded-lg p-4",children:[d.jsx("h3",{className:"font-semibold text-teal-900 dark:text-teal-100 mb-2",children:"ESG Scoring"}),d.jsx("p",{className:"text-sm text-teal-700 dark:text-teal-200",children:"Environmental, Social, and Governance ratings for your investments."})]}),0===j.length?d.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[d.jsx(D,{size:48,className:"mx-auto mb-4 opacity-50"}),d.jsx("p",{children:"No ESG data available"})]}):d.jsx("div",{className:"space-y-4",children:j.map((e,t)=>d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4",children:[d.jsxs("div",{className:"flex items-start justify-between mb-4",children:[d.jsxs("div",{children:[d.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:e.name}),d.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.symbol})]}),d.jsx("div",{className:"px-3 py-1 rounded-lg text-sm font-semibold "+("AAA"===e.rating||"AA"===e.rating?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"A"===e.rating||"BBB"===e.rating?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"),children:e.rating})]}),d.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Environmental"}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("div",{className:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:d.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${e.environmental}%`}})}),d.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:e.environmental})]})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Social"}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("div",{className:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:d.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${e.social}%`}})}),d.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:e.social})]})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Governance"}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("div",{className:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:d.jsx("div",{className:"bg-purple-500 h-2 rounded-full",style:{width:`${e.governance}%`}})}),d.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:e.governance})]})]})]}),e.controversies.length>0&&d.jsx("div",{className:"mt-3 p-2 bg-red-50 dark:bg-red-900/20 rounded",children:d.jsxs("p",{className:"text-xs text-red-700 dark:text-red-300",children:["\u26a0\ufe0f ",e.controversies.join(", ")]})})]},t))})]})]})]})})}import{F as n,g as i,j as d,ag as c,aS as o,aB as m,ar as x,T as g,L as h,r as u,Q as b,V as y,M as p,m as j,q as v,aL as f,at as N,O as k,ah as C,B as w,e as S,bP as D}from"./index-Pkjq0qn3.js";import{a as P}from"./chunk-BWx9oMeS.js";import{u as A}from"./chunk-BYFRQ0Wn.js";import{e as T,E,a as F,v as M}from"./chunk-CpxUZIWP.js";import{u as R}from"./chunk-S7gbZ2pr.js";import{R as V,P as I,a as B,C as q,T as L,B as U,b as O,X as z,Y as $,L as Y,c as W,d as G}from"./chunk-BN8kgYrt.js";import{P as K}from"./chunk-BnYLBI7x.js";import"./chunk-Drd-K-oK.js";const J={"US Stocks":40,"International Stocks":20,Bonds:25,"Real Estate":10,Commodities:5},Q=[{name:"S&P 500",symbol:"SPY",annualReturn:10.5},{name:"FTSE All-World",symbol:"VT",annualReturn:8.2},{name:"US Total Bond",symbol:"BND",annualReturn:3.5},{name:"60/40 Portfolio",symbol:"BALANCED",annualReturn:7.8}],H=new class{getRebalancingSuggestions(e,t=J){const s=[],a=this.calculateTotalPortfolioValue(e);if(a.isZero())return s;const r=this.calculateCurrentAllocations(e);return Object.entries(t).forEach(([t,l])=>{const i=r[t]||0,d=l-i;if(Math.abs(d)>5){const r=a.times(l).dividedBy(100),c=a.times(i).dividedBy(100),o=r.minus(c),m=e.filter(e=>this.getInvestmentCategory(e)===t);if(d>0)s.push({symbol:t,name:`${t} ETF`,action:"buy",amount:o.abs(),shares:Math.ceil(o.abs().dividedBy(n(100)).toNumber()),reason:`Underweight in ${t} by ${Math.abs(d).toFixed(1)}%`});else if(m.length>0){const e=m.reduce((e,t)=>n(e.currentValue).greaterThan(n(t.currentValue))?e:t);s.push({symbol:e.symbol,name:e.name,action:"sell",amount:o.abs(),shares:Math.ceil(o.abs().dividedBy(n(e.currentPrice||100)).toNumber()),reason:`Overweight in ${t} by ${Math.abs(d).toFixed(1)}%`})}}}),s}calculateRiskMetrics(e){const t=this.calculateTotalPortfolioValue(e),s=[];return e.forEach(e=>{const a=n(e.currentValue).dividedBy(t).times(100).toNumber();a>5&&s.push({symbol:e.symbol,percent:a,risk:a>20?"high":a>10?"medium":"low"})}),{portfolioBeta:1.05,sharpeRatio:.85,standardDeviation:12.5,diversificationScore:Math.min(100,10*e.length),concentrationRisk:s.sort((e,t)=>t.percent-e.percent)}}trackDividends(e,t){const s=[];return e.forEach(e=>{const a=t.filter(t=>"income"===t.type&&"investment-income"===t.category&&t.description.toLowerCase().includes(e.symbol.toLowerCase())&&t.description.toLowerCase().includes("dividend")).reduce((e,t)=>e.plus(n(t.amount)),n(0)),r=n(e.currentValue).times(.02);s.push({symbol:e.symbol,name:e.name,annualDividend:r,yield:2,frequency:"quarterly",totalReceived:a,projectedAnnual:r,exDividendDate:new Date(Date.now()+2592e6),paymentDate:new Date(Date.now()+3888e6)})}),s}compareWithBenchmarks(e,t=new Date(Date.now()-31536e6)){const s=this.calculateTotalPortfolioValue(e),a=e.reduce((e,t)=>e.plus(n(t.purchasePrice).times(t.quantity)),n(0)),r=s.minus(a).dividedBy(a).times(100).toNumber(),l=(Date.now()-t.getTime())/31536e6,i=r/l,d=Q.map(e=>({name:e.name,symbol:e.symbol,return:e.annualReturn*l,annualizedReturn:e.annualReturn,outperformance:i-e.annualReturn}));return{portfolio:{return:r,annualizedReturn:i,totalValue:s,startValue:a},benchmarks:d}}getESGScores(e){return e.map(e=>{const t=Math.floor(40*Math.random())+60,s=Math.floor(40*Math.random())+60,a=Math.floor(40*Math.random())+60,r=Math.floor((t+s+a)/3),l=r>=80?"AAA":r>=70?"AA":r>=60?"A":r>=50?"BBB":r>=40?"BB":r>=30?"B":"CCC";return{symbol:e.symbol,name:e.name,environmental:t,social:s,governance:a,overall:r,rating:l,controversies:r<60?["Environmental concerns reported"]:[]}})}calculateTotalPortfolioValue(e){return e.reduce((e,t)=>e.plus(n(t.currentValue)),n(0))}calculateCurrentAllocations(e){const t=this.calculateTotalPortfolioValue(e),s={};return e.forEach(e=>{const a=this.getInvestmentCategory(e),r=n(e.currentValue).dividedBy(t).times(100).toNumber();s[a]=(s[a]||0)+r}),s}getInvestmentCategory(e){const t=e.symbol.toUpperCase();return["VOO","SPY","VTI","IVV"].includes(t)?"US Stocks":["VEA","IEFA","VWO","IEMG"].includes(t)?"International Stocks":["BND","AGG","TLT","IEF"].includes(t)?"Bonds":["VNQ","IYR","XLRE"].includes(t)?"Real Estate":["GLD","SLV","DBC","PDBC"].includes(t)?"Commodities":"US Stocks"}generateInsights(e,t){const s=[],a=this.calculateRiskMetrics(e),r=this.getRebalancingSuggestions(e),l=this.trackDividends(e,t);a.diversificationScore<50&&s.push("\ud83c\udfaf Your portfolio needs more diversification. Consider adding different asset classes."),a.concentrationRisk.some(e=>"high"===e.risk)&&s.push("\u26a0\ufe0f High concentration risk detected. No single holding should exceed 20% of your portfolio."),r.length>0&&s.push(`\ud83d\udd04 Portfolio rebalancing recommended: ${r.length} adjustments needed.`);const i=l.reduce((e,t)=>e.plus(t.projectedAnnual),n(0));return i.greaterThan(0)&&s.push(`\ud83d\udcb0 Projected annual dividend income: $${i.toFixed(2)}`),s}},_=new class{dividends=[];storageKey="wealthtracker_dividends";yieldData={};constructor(){this.loadDividends(),this.loadYieldData()}loadDividends(){try{const e=localStorage.getItem(this.storageKey);if(e){const t=JSON.parse(e);this.dividends=t.map(e=>({...e,paymentDate:new Date(e.paymentDate),exDividendDate:new Date(e.exDividendDate),recordDate:e.recordDate?new Date(e.recordDate):void 0,declarationDate:e.declarationDate?new Date(e.declarationDate):void 0}))}}catch(e){console.error("Failed to load dividends:",e),this.dividends=[]}}saveDividends(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.dividends))}catch(e){T.handleError(e,{category:F.STORAGE,severity:E.HIGH,context:{dividendCount:this.dividends.length},userMessage:"Failed to save dividend data. Your changes may not persist.",recoverable:!0})}}loadYieldData(){this.yieldData={AAPL:.44,MSFT:.72,JNJ:2.85,KO:3.06,VZ:6.48,T:6.15,PG:2.35,JPM:2.82,XOM:3.23,CVX:3.48,O:5.51,SCHD:3.41,VYM:2.91,DVY:3.68,VIG:1.57}}addDividend(e){try{M(e,[{test:e=>e.amount>0,message:"Dividend amount must be positive"},{test:e=>e.amountPerShare>0,message:"Amount per share must be positive"},{test:e=>e.shares>0,message:"Number of shares must be positive"},{test:e=>e.paymentDate instanceof Date&&!isNaN(e.paymentDate.getTime()),message:"Valid payment date is required"},{test:e=>!e.taxWithheld||e.taxWithheld>=0,message:"Tax withheld cannot be negative"}]);const t={...e,id:`div-${Date.now()}-${Math.random().toString(36).substr(2,9)}`};return this.dividends.push(t),this.saveDividends(),t}catch(t){throw T.handleError(t,{category:F.VALIDATION,severity:E.MEDIUM,context:{dividend:e},userMessage:"Invalid dividend data. Please check your input."}),t}}getDividends(e){let t=[...this.dividends];return e&&(e.accountId&&(t=t.filter(t=>t.accountId===e.accountId)),e.investmentId&&(t=t.filter(t=>t.investmentId===e.investmentId)),e.symbol&&(t=t.filter(t=>t.symbol===e.symbol)),e.startDate&&(t=t.filter(t=>t.paymentDate>=e.startDate)),e.endDate&&(t=t.filter(t=>t.paymentDate<=e.endDate)),e.type&&(t=t.filter(t=>t.type===e.type))),t.sort((e,t)=>t.paymentDate.getTime()-e.paymentDate.getTime())}updateDividend(e,t){const s=this.dividends.findIndex(t=>t.id===e);return-1!==s&&(this.dividends[s]={...this.dividends[s],...t,id:this.dividends[s].id},this.saveDividends(),!0)}deleteDividend(e){const t=this.dividends.findIndex(t=>t.id===e);return-1!==t&&(this.dividends.splice(t,1),this.saveDividends(),!0)}getDividendSummary(e,t){const s=this.getDividends({startDate:e,endDate:t}),a={totalDividends:n(0),totalTaxWithheld:n(0),bySymbol:{},byFrequency:{},byType:{},byMonth:{},projectedAnnual:n(0)};return s.forEach(e=>{const t=n(e.amount);a.totalDividends=a.totalDividends.plus(t),e.taxWithheld&&(a.totalTaxWithheld=a.totalTaxWithheld.plus(n(e.taxWithheld))),a.bySymbol[e.symbol]||(a.bySymbol[e.symbol]={total:n(0),count:0,lastPayment:e.paymentDate,averagePerPayment:n(0)}),a.bySymbol[e.symbol].total=a.bySymbol[e.symbol].total.plus(t),a.bySymbol[e.symbol].count++,e.paymentDate>a.bySymbol[e.symbol].lastPayment&&(a.bySymbol[e.symbol].lastPayment=e.paymentDate),a.byFrequency[e.frequency]||(a.byFrequency[e.frequency]=n(0)),a.byFrequency[e.frequency]=a.byFrequency[e.frequency].plus(t),a.byType[e.type]||(a.byType[e.type]=n(0)),a.byType[e.type]=a.byType[e.type].plus(t);const s=`${e.paymentDate.getFullYear()}-${String(e.paymentDate.getMonth()+1).padStart(2,"0")}`;a.byMonth[s]||(a.byMonth[s]=n(0)),a.byMonth[s]=a.byMonth[s].plus(t)}),Object.keys(a.bySymbol).forEach(e=>{const t=a.bySymbol[e];t.averagePerPayment=t.total.div(n(t.count))}),a.projectedAnnual=this.calculateProjectedAnnualIncome(),a}calculateProjectedAnnualIncome(){const e=this.getDividends({startDate:new Date(Date.now()-31536e6)}),t={};e.forEach(e=>{t[e.symbol]||(t[e.symbol]={total:n(0),frequency:e.frequency,count:0}),t[e.symbol].total=t[e.symbol].total.plus(n(e.amount)),t[e.symbol].count++});let s=n(0);return Object.entries(t).forEach(([e,t])=>{let a=1;switch(t.frequency){case"monthly":a=12;break;case"quarterly":a=4;break;case"semi-annual":a=2;break;case"annual":a=1;break;default:a=t.count}const r=t.total.div(n(t.count));s=s.plus(r.times(n(a)))}),s}getDividendProjections(e){const t=[],s=new Date;return e.forEach(e=>{const a=this.getDividends({symbol:e.symbol,startDate:new Date(s.getFullYear()-1,s.getMonth(),s.getDate())});if(a.length>0){const r=a[0],l=new Date(r.paymentDate);switch(r.frequency){case"monthly":l.setMonth(l.getMonth()+1);break;case"quarterly":l.setMonth(l.getMonth()+3);break;case"semi-annual":l.setMonth(l.getMonth()+6);break;case"annual":l.setFullYear(l.getFullYear()+1)}if(l>s){const s=n(r.amountPerShare).times(n(e.shares));t.push({symbol:e.symbol,nextPaymentDate:l,estimatedAmount:s,confidence:a.length>=4?"high":"medium",basedOn:"history"})}}else if(this.yieldData[e.symbol]){const a=this.yieldData[e.symbol]/100,r=n(e.currentValue).times(n(a)).div(n(4)),l=new Date(s),i=s.getMonth(),d=3*Math.ceil((i+1)/3)-1;l.setMonth(d),l.setDate(15),t.push({symbol:e.symbol,nextPaymentDate:l,estimatedAmount:r,confidence:"low",basedOn:"yield"})}}),t.sort((e,t)=>e.nextPaymentDate.getTime()-t.nextPaymentDate.getTime())}importFromTransactions(e,t){const s=["dividend","div","distribution","capital gain"],a=[];return e.forEach(e=>{const r=e.description.toLowerCase();if((s.some(e=>r.includes(e))||"Investment Income"===e.category)&&e.amount>0){let s="",r="";const l=e.description.match(/\b([A-Z]{1,5})\b/);if(l){s=l[1];for(const[e,a]of Object.entries(t))if(a.symbol===s){r=e;break}}if(s&&r){const l=t[r],n={investmentId:r,accountId:e.accountId,symbol:s,amount:e.amount,amountPerShare:e.amount/l.shares,shares:l.shares,currency:"USD",paymentDate:e.date,exDividendDate:new Date(e.date.getTime()-1728e5),frequency:"quarterly",type:"regular",reinvested:!1,notes:`Imported from transaction: ${e.description}`};this.dividends.some(t=>t.symbol===s&&t.paymentDate.toDateString()===e.date.toDateString()&&Math.abs(t.amount-e.amount)<.01)||a.push(this.addDividend(n))}}}),a}getDividendYield(e,t){const s=new Date;s.setFullYear(s.getFullYear()-1);const a=this.getDividends({symbol:e,startDate:s});return a.length>0?a.reduce((e,t)=>e+t.amountPerShare,0)/t*100:this.yieldData[e]||null}updateYieldData(e,t){this.yieldData[e]=t,localStorage.setItem("wealthtracker_yield_data",JSON.stringify(this.yieldData))}exportToCSV(){return[["Date","Symbol","Amount","Amount Per Share","Shares","Type","Frequency","Tax Withheld","Reinvested","Notes"],...this.dividends.map(e=>[e.paymentDate.toISOString().split("T")[0],e.symbol,e.amount.toFixed(2),e.amountPerShare.toFixed(4),e.shares.toString(),e.type,e.frequency,e.taxWithheld?.toFixed(2)||"",e.reinvested?"Yes":"No",e.notes||""])].map(e=>e.join(",")).join("\n")}},X=new class{targets=[];assetMappings=[];storageKey="wealthtracker_portfolio_targets";mappingsKey="wealthtracker_asset_mappings";constructor(){this.loadTargets(),this.loadMappings(),this.initializeDefaultMappings()}loadTargets(){try{const e=localStorage.getItem(this.storageKey);if(e){const t=JSON.parse(e);this.targets=t.map(e=>({...e,createdAt:new Date(e.createdAt),lastRebalanced:e.lastRebalanced?new Date(e.lastRebalanced):void 0}))}}catch(e){console.error("Failed to load portfolio targets:",e),this.targets=[]}}saveTargets(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.targets))}catch(e){console.error("Failed to save portfolio targets:",e)}}loadMappings(){try{const e=localStorage.getItem(this.mappingsKey);e&&(this.assetMappings=JSON.parse(e))}catch(e){console.error("Failed to load asset mappings:",e),this.assetMappings=[]}}saveMappings(){try{localStorage.setItem(this.mappingsKey,JSON.stringify(this.assetMappings))}catch(e){console.error("Failed to save asset mappings:",e)}}initializeDefaultMappings(){[{symbol:"AAPL",assetClass:"US Stocks",subClass:"Large Cap"},{symbol:"MSFT",assetClass:"US Stocks",subClass:"Large Cap"},{symbol:"GOOGL",assetClass:"US Stocks",subClass:"Large Cap"},{symbol:"AMZN",assetClass:"US Stocks",subClass:"Large Cap"},{symbol:"META",assetClass:"US Stocks",subClass:"Large Cap"},{symbol:"NVDA",assetClass:"US Stocks",subClass:"Large Cap"},{symbol:"TSLA",assetClass:"US Stocks",subClass:"Large Cap"},{symbol:"BRK.B",assetClass:"US Stocks",subClass:"Large Cap"},{symbol:"JPM",assetClass:"US Stocks",subClass:"Large Cap"},{symbol:"JNJ",assetClass:"US Stocks",subClass:"Large Cap"},{symbol:"SPY",assetClass:"US Stocks",subClass:"Large Cap ETF"},{symbol:"VOO",assetClass:"US Stocks",subClass:"Large Cap ETF"},{symbol:"VTI",assetClass:"US Stocks",subClass:"Total Market ETF"},{symbol:"IWM",assetClass:"US Stocks",subClass:"Small Cap ETF"},{symbol:"QQQ",assetClass:"US Stocks",subClass:"Tech ETF"},{symbol:"DIA",assetClass:"US Stocks",subClass:"Large Cap ETF"},{symbol:"VXUS",assetClass:"International Stocks",subClass:"Developed Markets"},{symbol:"VEA",assetClass:"International Stocks",subClass:"Developed Markets"},{symbol:"VWO",assetClass:"International Stocks",subClass:"Emerging Markets"},{symbol:"EFA",assetClass:"International Stocks",subClass:"Developed Markets"},{symbol:"EEM",assetClass:"International Stocks",subClass:"Emerging Markets"},{symbol:"BND",assetClass:"Bonds",subClass:"Total Bond Market"},{symbol:"AGG",assetClass:"Bonds",subClass:"Total Bond Market"},{symbol:"TLT",assetClass:"Bonds",subClass:"Long-Term Treasury"},{symbol:"IEF",assetClass:"Bonds",subClass:"Intermediate Treasury"},{symbol:"SHY",assetClass:"Bonds",subClass:"Short-Term Treasury"},{symbol:"LQD",assetClass:"Bonds",subClass:"Corporate Bonds"},{symbol:"HYG",assetClass:"Bonds",subClass:"High Yield Bonds"},{symbol:"VNQ",assetClass:"Real Estate",subClass:"REIT ETF"},{symbol:"O",assetClass:"Real Estate",subClass:"REIT"},{symbol:"STOR",assetClass:"Real Estate",subClass:"REIT"},{symbol:"SPG",assetClass:"Real Estate",subClass:"REIT"},{symbol:"GLD",assetClass:"Commodities",subClass:"Gold"},{symbol:"SLV",assetClass:"Commodities",subClass:"Silver"},{symbol:"DBC",assetClass:"Commodities",subClass:"Broad Commodities"},{symbol:"USO",assetClass:"Commodities",subClass:"Oil"},{symbol:"GBTC",assetClass:"Alternative",subClass:"Crypto"},{symbol:"BITO",assetClass:"Alternative",subClass:"Crypto"}].forEach(e=>{this.assetMappings.find(t=>t.symbol===e.symbol)||this.assetMappings.push(e)}),this.saveMappings()}getAssetClass(e){const t=this.assetMappings.find(t=>t.symbol===e);return t?t.assetClass:e.includes("BND")||e.includes("AGG")||e.includes("TLT")?"Bonds":e.includes("VNQ")||e.endsWith("REIT")?"Real Estate":e.includes("GLD")||e.includes("SLV")?"Commodities":e.includes("VEA")||e.includes("VWO")||e.includes("EFA")?"International Stocks":"US Stocks"}setAssetClass(e,t,s){const a=this.assetMappings.findIndex(t=>t.symbol===e);a>=0?this.assetMappings[a]={symbol:e,assetClass:t,subClass:s}:this.assetMappings.push({symbol:e,assetClass:t,subClass:s}),this.saveMappings()}savePortfolioTarget(e){const t={...e,id:`target-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,createdAt:new Date},s=this.targets.findIndex(e=>e.id===t.id);return s>=0?this.targets[s]={...this.targets[s],...t}:this.targets.push(t),this.saveTargets(),t}getPortfolioTargets(){return[...this.targets]}getActiveTarget(){return this.targets.find(e=>e.isActive)||null}deletePortfolioTarget(e){const t=this.targets.findIndex(t=>t.id===e);return-1!==t&&(this.targets.splice(t,1),this.saveTargets(),!0)}calculateCurrentAllocation(e){const t=e.reduce((e,t)=>e.plus(n(t.value)),n(0));if(t.isZero())return[];const s={};e.forEach(e=>{const t=this.getAssetClass(e.symbol);s[t]||(s[t]=n(0)),s[t]=s[t].plus(n(e.value))});const a=this.getActiveTarget(),r=[];return Object.entries(s).forEach(([e,s])=>{const l=s.div(t).times(n(100)).toNumber(),i=a?.allocations.find(t=>t.assetClass===e),d=i?.targetPercent||0,c=t.times(n(d)).div(n(100)),o=c.minus(s),m=d-l;r.push({assetClass:e,targetPercent:d,currentPercent:l,currentValue:s,targetValue:c,difference:o,differencePercent:m})}),a&&a.allocations.forEach(e=>{if(!r.find(t=>t.assetClass===e.assetClass)){const s=t.times(n(e.targetPercent)).div(n(100));r.push({assetClass:e.assetClass,targetPercent:e.targetPercent,currentPercent:0,currentValue:n(0),targetValue:s,difference:s,differencePercent:e.targetPercent})}}),r.sort((e,t)=>t.currentValue.toNumber()-e.currentValue.toNumber())}calculateRebalanceActions(e,t=0,s=!1){const a=this.getActiveTarget();if(!a)return[];const r=e.reduce((e,t)=>e+t.value,0)+t,l=[],i={};a.allocations.forEach(e=>{i[e.assetClass]=r*e.targetPercent/100});const d={};return e.forEach(e=>{const t=this.getAssetClass(e.symbol);d[t]||(d[t]=[]),d[t].push(e)}),Object.entries(i).forEach(([e,t])=>{const a=d[e]||[],r=a.reduce((e,t)=>e+t.value,0),i=t-r;if(!(Math.abs(i)<50))if(i>0)a.length>0?a.forEach(t=>{const s=t.value/(r||1),a=n(i*s),d=a.div(n(t.price));d.toNumber()>=.1&&l.push({symbol:t.symbol,name:t.name,action:"buy",shares:d,amount:a,currentShares:n(t.shares),targetShares:n(t.shares).plus(d),currentValue:n(t.value),targetValue:n(t.value).plus(a),assetClass:e,priority:2})}):l.push({symbol:`NEW_${e.toUpperCase().replace(/\s+/g,"_")}`,name:`New ${e} Investment`,action:"buy",shares:n(0),amount:n(i),currentShares:n(0),targetShares:n(0),currentValue:n(0),targetValue:n(i),assetClass:e,priority:3});else{let t=Math.abs(i);[...a].sort((e,t)=>t.value-e.value).forEach(a=>{if(t<=0)return;const r=Math.min(a.value,t),i=n(r).div(n(a.price));let d=2;s&&(d=4),i.toNumber()>=.1&&(l.push({symbol:a.symbol,name:a.name,action:"sell",shares:i,amount:n(r),currentShares:n(a.shares),targetShares:n(a.shares).minus(i),currentValue:n(a.value),targetValue:n(a.value).minus(n(r)),assetClass:e,priority:d}),t-=r)})}}),l.sort((e,t)=>e.priority!==t.priority?e.priority-t.priority:t.amount.toNumber()-e.amount.toNumber())}isRebalancingNeeded(e,t){const s=this.getActiveTarget();if(!s)return!1;const a=t||s.rebalanceThreshold||5;return e.some(e=>{const t=s.allocations.find(t=>t.assetClass===e.assetClass),r=t?.tolerance||a;return Math.abs(e.differencePercent)>r})}getPortfolioTemplates(){return[{id:"template-conservative",name:"Conservative",description:"Focus on capital preservation with modest growth",allocations:[{assetClass:"Bonds",targetPercent:70},{assetClass:"US Stocks",targetPercent:20},{assetClass:"International Stocks",targetPercent:5},{assetClass:"Real Estate",targetPercent:5}],rebalanceThreshold:5,isActive:!1,createdAt:new Date},{id:"template-moderate",name:"Moderate",description:"Balanced approach between growth and stability",allocations:[{assetClass:"US Stocks",targetPercent:40},{assetClass:"Bonds",targetPercent:40},{assetClass:"International Stocks",targetPercent:15},{assetClass:"Real Estate",targetPercent:5}],rebalanceThreshold:5,isActive:!1,createdAt:new Date},{id:"template-aggressive",name:"Aggressive",description:"Focus on growth with higher volatility",allocations:[{assetClass:"US Stocks",targetPercent:60},{assetClass:"International Stocks",targetPercent:25},{assetClass:"Bonds",targetPercent:10},{assetClass:"Real Estate",targetPercent:5}],rebalanceThreshold:7,isActive:!1,createdAt:new Date},{id:"template-three-fund",name:"Three-Fund Portfolio",description:"Simple, diversified portfolio with low costs",allocations:[{assetClass:"US Stocks",targetPercent:60},{assetClass:"International Stocks",targetPercent:20},{assetClass:"Bonds",targetPercent:20}],rebalanceThreshold:5,isActive:!1,createdAt:new Date},{id:"template-all-weather",name:"All Weather",description:"Ray Dalio's strategy for all economic conditions",allocations:[{assetClass:"US Stocks",targetPercent:30},{assetClass:"Bonds",targetPercent:55},{assetClass:"Commodities",targetPercent:7.5},{assetClass:"Real Estate",targetPercent:7.5}],rebalanceThreshold:5,isActive:!1,createdAt:new Date}]}markRebalanced(e){const t=this.targets.find(t=>t.id===e);t&&(t.lastRebalanced=new Date,this.saveTargets())}};export{l as default};
