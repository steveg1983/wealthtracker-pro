const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pdfExport-Dby-sc7S.js","assets/chunk-ddLY9KjI.js","assets/chunk-DowOIOga.js","assets/vendor-B-C1h4S3.css"])))=>i.map(i=>d[i]);
function e({report:e,onSave:a,onCancel:r}){i();const{addNotification:s}=l(),[n,m]=o.useState(e?.name||""),[g,u]=o.useState(e?.description||""),[y,p]=o.useState(e?.components||[]),[h,x]=o.useState(e?.filters||{dateRange:"month"}),[b,k]=o.useState(null),[N,w]=o.useState(!1),R=(e,t)=>{const a="up"===t?e-1:e+1;if(a<0||a>=y.length)return;const r=Array.from(y),[s]=r.splice(e,1);r.splice(a,0,s),p(r)};return d.jsxs("div",{className:"flex flex-col h-full",children:[d.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:e?"Edit Report":"Create Custom Report"}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("button",{onClick:r,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:"Cancel"}),d.jsxs("button",{onClick:()=>{if(!n.trim())return void s({type:"error",title:"Report name required",message:"Please enter a name for your report"});const t={id:e?.id||`report-${Date.now()}`,name:n,description:g,components:y,filters:h,createdAt:e?.createdAt||new Date,updatedAt:new Date};a(t)},className:"flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90",children:[d.jsx(c,{size:16}),"Save Report"]})]})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Report Name"}),d.jsx("input",{type:"text",value:n,onChange:e=>m(e.target.value),className:"w-full px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Monthly Financial Summary"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),d.jsx("input",{type:"text",value:g,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Overview of monthly income, expenses, and savings"})]})]})]}),d.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800/50 border-b border-gray-200 dark:border-gray-700",children:[d.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Report Filters"}),d.jsxs("div",{className:"flex flex-wrap gap-3",children:[d.jsxs("select",{value:h.dateRange,onChange:e=>x({...h,dateRange:e.target.value}),className:"px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-sm",children:[d.jsx("option",{value:"month",children:"This Month"}),d.jsx("option",{value:"quarter",children:"This Quarter"}),d.jsx("option",{value:"year",children:"This Year"}),d.jsx("option",{value:"custom",children:"Custom Range"})]}),"custom"===h.dateRange&&d.jsxs(d.Fragment,{children:[d.jsx("input",{type:"date",value:h.customStartDate||"",onChange:e=>x({...h,customStartDate:e.target.value}),className:"px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-sm"}),d.jsx("input",{type:"date",value:h.customEndDate||"",onChange:e=>x({...h,customEndDate:e.target.value}),className:"px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-sm"})]})]})]}),d.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[d.jsx("div",{className:"space-y-4 min-h-[200px]",children:y.map((e,a)=>d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsxs("div",{className:"flex flex-col gap-1",children:[d.jsx("button",{onClick:()=>R(a,"up"),disabled:0===a,className:"p-1 text-gray-400 hover:text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",title:"Move up",children:"\u25b2"}),d.jsx("button",{onClick:()=>R(a,"down"),disabled:a===y.length-1,className:"p-1 text-gray-400 hover:text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",title:"Move down",children:"\u25bc"})]}),d.jsxs("div",{children:[d.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:e.title}),d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:W.find(t=>t.type===e.type)?.description})]})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsxs("select",{value:e.width,onChange:t=>{return a=e.id,r={width:t.target.value},void p(y.map(e=>e.id===a?{...e,...r}:e));var a,r},className:"px-2 py-1 text-sm bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded",children:[d.jsx("option",{value:"full",children:"Full Width"}),d.jsx("option",{value:"half",children:"Half Width"}),d.jsx("option",{value:"third",children:"Third Width"})]}),d.jsx("button",{onClick:()=>k(e.id),className:"p-1.5 text-gray-600 dark:text-gray-400 hover:text-primary",title:"Configure",children:d.jsx(f,{size:16})}),d.jsx("button",{onClick:()=>{return t=e.id,void p(y.filter(e=>e.id!==t));var t},className:"p-1.5 text-gray-600 dark:text-gray-400 hover:text-red-600",title:"Remove",children:d.jsx(v,{size:16})})]})]}),d.jsx("div",{className:"p-4",children:d.jsx(t,{component:e})})]},e.id))}),0===y.length&&d.jsx("div",{className:"text-center py-12",children:d.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Start building your report by adding components"})}),d.jsxs("button",{onClick:()=>w(!0),className:"mt-4 w-full py-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg hover:border-primary hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[d.jsx(j,{size:24,className:"mx-auto text-gray-400 dark:text-gray-600"}),d.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Add Component"})]})]}),N&&d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl max-w-3xl w-full max-h-[80vh] overflow-hidden",children:[d.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Add Report Component"}),d.jsx("button",{onClick:()=>w(!1),className:"text-gray-400 hover:text-gray-600",children:d.jsx(v,{size:20})})]})}),d.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:W.map(e=>d.jsxs("button",{onClick:()=>(e=>{const t=W.find(t=>t.type===e);if(!t)return;const a={id:`component-${Date.now()}`,type:e,title:t.name,config:{...t.defaultConfig},width:"full"};p([...y,a]),w(!1)})(e.type),className:"flex items-start gap-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-left",children:[d.jsx("div",{className:"p-2 bg-white dark:bg-gray-800 rounded-lg",children:d.jsx(e.icon,{size:24,className:"text-primary"})}),d.jsxs("div",{children:[d.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.description})]})]},e.type))})})]})})]})}function t({component:e}){const t=W.find(t=>t.type===e.type)?.icon||h;return d.jsxs("div",{className:"flex items-center justify-center py-8 text-gray-400 dark:text-gray-600",children:[d.jsx(t,{size:48}),d.jsx("p",{className:"ml-4 text-sm",children:"Preview will be shown when report is generated"})]})}function a(){const{transactions:e,accounts:t,budgets:a,categories:s}=i(),{addNotification:n}=l(),[c,m]=o.useState([]),[g,u]=o.useState([]),[y,p]=o.useState(!1),[h,x]=o.useState(null),[f,v]=o.useState(null);o.useEffect(()=>(k(),B.initialize(),()=>{B.destroy()}),[]);const k=()=>{m(B.getScheduledReports()),u(P.getCustomReports())};return d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Scheduled Reports"}),d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Automate report generation and delivery"})]}),d.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90",children:[d.jsx(j,{size:16}),"Schedule Report"]})]}),0===c.length?d.jsxs("div",{className:"text-center py-12 bg-gray-50 dark:bg-gray-800/50 rounded-lg",children:[d.jsx(b,{size:48,className:"mx-auto text-gray-400 mb-4"}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No scheduled reports yet"}),d.jsx("button",{onClick:()=>p(!0),className:"mt-4 text-primary hover:underline",children:"Create your first scheduled report"})]}):d.jsx("div",{className:"space-y-4",children:c.map(r=>{const o=g.find(e=>e.id===r.customReportId);return d.jsx("div",{className:"p-4 rounded-lg border "+(r.enabled?"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700":"bg-gray-50 dark:bg-gray-900 border-gray-300 dark:border-gray-800 opacity-60"),children:d.jsxs("div",{className:"flex items-start justify-between",children:[d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[d.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:r.reportName}),!r.enabled&&d.jsx("span",{className:"text-xs px-2 py-1 bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded",children:"Disabled"})]}),d.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-600 dark:text-gray-400",children:[d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx(N,{size:16}),d.jsxs("span",{children:["daily"===r.frequency&&"Daily","weekly"===r.frequency&&`Weekly on ${["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][r.dayOfWeek||1]}`,"monthly"===r.frequency&&`Monthly on day ${r.dayOfMonth||1}`,"quarterly"===r.frequency&&"Quarterly","yearly"===r.frequency&&"Yearly"," at ",r.time]})]}),d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx("span",{className:"font-medium",children:"Format:"}),d.jsx("span",{children:r.deliveryFormat.toUpperCase()})]}),r.emailRecipients&&r.emailRecipients.length>0&&d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx(w,{size:16}),d.jsx("span",{children:r.emailRecipients.join(", ")})]})]}),d.jsxs("div",{className:"flex gap-4 mt-2 text-xs text-gray-500 dark:text-gray-500",children:[d.jsxs("span",{children:["Next run: ",$(new Date(r.nextRun),"MMM d, yyyy HH:mm")]}),r.lastRun&&d.jsxs("span",{children:["Last run: ",$(new Date(r.lastRun),"MMM d, yyyy HH:mm")]})]}),!o&&d.jsx("div",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:"\u26a0\ufe0f Custom report not found"})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("button",{onClick:()=>(async r=>{v(r.id);try{await B.runScheduledReport(r,{transactions:e,accounts:t,budgets:a,categories:s}),n({type:"success",title:"Report Generated",message:`${r.reportName} has been generated successfully`}),k()}catch(o){n({type:"error",title:"Report Failed",message:`Failed to generate ${r.reportName}`})}finally{v(null)}})(r),disabled:f===r.id||!o,className:"p-2 text-gray-600 dark:text-gray-400 hover:text-primary disabled:opacity-50",title:"Run now",children:f===r.id?d.jsx("div",{className:"animate-spin",children:"\u23f3"}):d.jsx(R,{size:16})}),d.jsx("button",{onClick:()=>x(r),className:"p-2 text-gray-600 dark:text-gray-400 hover:text-primary",title:"Edit",children:d.jsx(D,{size:16})}),d.jsx("button",{onClick:()=>(e=>{const t={...e,enabled:!e.enabled};B.saveScheduledReport(t),k()})(r),className:"p-2 text-gray-600 dark:text-gray-400 hover:text-primary",title:r.enabled?"Disable":"Enable",children:r.enabled?d.jsx(C,{size:20,className:"text-green-600"}):d.jsx(S,{size:20})}),d.jsx("button",{onClick:()=>{return e=r.id,void(confirm("Are you sure you want to delete this scheduled report?")&&(B.deleteScheduledReport(e),k(),n({type:"success",title:"Schedule Deleted",message:"The scheduled report has been deleted"})));var e},className:"p-2 text-gray-600 dark:text-gray-400 hover:text-red-600",title:"Delete",children:d.jsx(M,{size:16})})]})]})},r.id)})}),(y||h)&&d.jsx(r,{scheduledReport:h,customReports:g,onSave:e=>{B.saveScheduledReport(e),k(),p(!1),x(null),n({type:"success",title:"Schedule Saved",message:`${e.reportName} has been scheduled successfully`})},onClose:()=>{p(!1),x(null)}})]})}function r({scheduledReport:e,customReports:t,onSave:a,onClose:r}){const[s,n]=o.useState({customReportId:e?.customReportId||"",reportName:e?.reportName||"",frequency:e?.frequency||"monthly",dayOfWeek:e?.dayOfWeek||1,dayOfMonth:e?.dayOfMonth||1,time:e?.time||"09:00",deliveryFormat:e?.deliveryFormat||"pdf",emailRecipients:e?.emailRecipients||[],enabled:e?.enabled??!0}),[i,l]=o.useState("");o.useEffect(()=>{if(s.customReportId&&!e){const e=t.find(e=>e.id===s.customReportId);e&&n(t=>({...t,reportName:e.name}))}},[s.customReportId,t,e]);const c=()=>{i&&i.includes("@")&&(n(e=>({...e,emailRecipients:[...e.emailRecipients||[],i]})),l(""))};return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:d.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl max-w-lg w-full max-h-[90vh] overflow-hidden",children:d.jsxs("form",{onSubmit:t=>{t.preventDefault();const r={id:e?.id||`scheduled-${Date.now()}`,customReportId:s.customReportId,reportName:s.reportName,frequency:s.frequency,dayOfWeek:s.dayOfWeek,dayOfMonth:s.dayOfMonth,time:s.time,deliveryFormat:s.deliveryFormat,emailRecipients:s.emailRecipients,enabled:s.enabled,nextRun:B.calculateNextRun({frequency:s.frequency,dayOfWeek:s.dayOfWeek,dayOfMonth:s.dayOfMonth,time:s.time}),createdAt:e?.createdAt||new Date,updatedAt:new Date};a(r)},children:[d.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:d.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e?"Edit Scheduled Report":"Schedule New Report"})}),d.jsxs("div",{className:"p-6 space-y-4 overflow-y-auto max-h-[60vh]",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Report Template"}),d.jsxs("select",{value:s.customReportId,onChange:e=>n({...s,customReportId:e.target.value}),className:"w-full px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg",required:!0,children:[d.jsx("option",{value:"",children:"Select a report..."}),t.map(e=>d.jsx("option",{value:e.id,children:e.name},e.id))]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Schedule Name"}),d.jsx("input",{type:"text",value:s.reportName,onChange:e=>n({...s,reportName:e.target.value}),className:"w-full px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg",required:!0})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Frequency"}),d.jsxs("select",{value:s.frequency,onChange:e=>n({...s,frequency:e.target.value}),className:"w-full px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg",children:[d.jsx("option",{value:"daily",children:"Daily"}),d.jsx("option",{value:"weekly",children:"Weekly"}),d.jsx("option",{value:"monthly",children:"Monthly"}),d.jsx("option",{value:"quarterly",children:"Quarterly"}),d.jsx("option",{value:"yearly",children:"Yearly"})]})]}),"weekly"===s.frequency&&d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Day of Week"}),d.jsxs("select",{value:s.dayOfWeek,onChange:e=>n({...s,dayOfWeek:parseInt(e.target.value)}),className:"w-full px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg",children:[d.jsx("option",{value:"0",children:"Sunday"}),d.jsx("option",{value:"1",children:"Monday"}),d.jsx("option",{value:"2",children:"Tuesday"}),d.jsx("option",{value:"3",children:"Wednesday"}),d.jsx("option",{value:"4",children:"Thursday"}),d.jsx("option",{value:"5",children:"Friday"}),d.jsx("option",{value:"6",children:"Saturday"})]})]}),"monthly"===s.frequency&&d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Day of Month"}),d.jsx("input",{type:"number",min:"1",max:"31",value:s.dayOfMonth,onChange:e=>n({...s,dayOfMonth:parseInt(e.target.value)}),className:"w-full px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Time"}),d.jsx("input",{type:"time",value:s.time,onChange:e=>n({...s,time:e.target.value}),className:"w-full px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Delivery Format"}),d.jsxs("select",{value:s.deliveryFormat,onChange:e=>n({...s,deliveryFormat:e.target.value}),className:"w-full px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg",children:[d.jsx("option",{value:"pdf",children:"PDF"}),d.jsx("option",{value:"csv",children:"CSV"}),d.jsx("option",{value:"excel",children:"Excel"}),d.jsx("option",{value:"email",children:"Email (with PDF attachment)"})]})]}),"email"===s.deliveryFormat&&d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email Recipients"}),d.jsxs("div",{className:"flex gap-2 mb-2",children:[d.jsx("input",{type:"email",value:i,onChange:e=>l(e.target.value),onKeyPress:e=>"Enter"===e.key&&(e.preventDefault(),c()),className:"flex-1 px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg",placeholder:"email@example.com"}),d.jsx("button",{type:"button",onClick:c,className:"px-3 py-2 bg-primary text-white rounded-lg hover:bg-primary/90",children:"Add"})]}),s.emailRecipients&&s.emailRecipients.length>0&&d.jsx("div",{className:"space-y-1",children:s.emailRecipients.map(e=>d.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-100 dark:bg-gray-700 rounded",children:[d.jsx("span",{className:"text-sm",children:e}),d.jsx("button",{type:"button",onClick:()=>(e=>{n(t=>({...t,emailRecipients:t.emailRecipients?.filter(t=>t!==e)||[]}))})(e),className:"text-red-600 hover:text-red-700",children:d.jsx(v,{size:16})})]},e))})]})]}),d.jsxs("div",{className:"p-6 border-t border-gray-200 dark:border-gray-700 flex gap-3 justify-end",children:[d.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:"Cancel"}),d.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90",children:e?"Save Changes":"Create Schedule"})]})]})})})}function s(){const{transactions:t,accounts:r,budgets:s,categories:n}=i(),{addNotification:c}=l(),[m,g]=o.useState([]),[u,y]=o.useState(!1),[p,x]=o.useState(),[f,v]=o.useState(null),[k,N]=o.useState(null);o.useEffect(()=>{w()},[]);const w=()=>{const e=P.getCustomReports();g(e)};return u||p?d.jsx(e,{report:p,onSave:e=>{P.saveCustomReport(e),w(),y(!1),x(void 0),c({type:"success",title:"Report Saved",message:`${e.name} has been saved successfully`})},onCancel:()=>{y(!1),x(void 0)}}):d.jsxs("div",{className:"space-y-6",children:[d.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Custom Reports"}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Create and manage your personalized financial reports"})]}),d.jsxs("button",{onClick:()=>y(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90",children:[d.jsx(j,{size:20}),"Create Report"]})]})}),d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6",children:[d.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Quick Start Templates"}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[d.jsxs("button",{onClick:()=>{x({id:"",name:"Monthly Summary",description:"Overview of income, expenses, and savings",components:[{id:"stats",type:"summary-stats",title:"Key Metrics",config:{metrics:["income","expenses","netIncome","savingsRate"]},width:"full"},{id:"trend",type:"line-chart",title:"Income vs Expenses Trend",config:{dataType:"income-vs-expenses"},width:"full"},{id:"categories",type:"pie-chart",title:"Spending by Category",config:{dataType:"expenses-by-category"},width:"half"}],filters:{dateRange:"month"},createdAt:new Date,updatedAt:new Date})},className:"p-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg hover:border-primary hover:bg-gray-50 dark:hover:bg-gray-700 text-left",children:[d.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Monthly Summary"}),d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Income, expenses, and category breakdown"})]}),d.jsxs("button",{onClick:()=>{x({id:"",name:"Budget vs Actual",description:"Compare budgeted amounts with actual spending",components:[{id:"budget",type:"category-breakdown",title:"Budget Performance",config:{showSubcategories:!0,comparisonType:"budget"},width:"full"}],filters:{dateRange:"month"},createdAt:new Date,updatedAt:new Date})},className:"p-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg hover:border-primary hover:bg-gray-50 dark:hover:bg-gray-700 text-left",children:[d.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Budget vs Actual"}),d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Track budget performance by category"})]}),d.jsxs("button",{onClick:()=>{x({id:"",name:"Year-over-Year",description:"Compare current year with previous year",components:[{id:"comparison",type:"date-comparison",title:"Year Comparison",config:{periods:["current","previous"],metric:"all"},width:"full"}],filters:{dateRange:"year"},createdAt:new Date,updatedAt:new Date})},className:"p-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg hover:border-primary hover:bg-gray-50 dark:hover:bg-gray-700 text-left",children:[d.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Year-over-Year"}),d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Annual comparison and trends"})]})]})]}),d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6",children:[d.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Your Reports"}),0===m.length?d.jsxs("div",{className:"text-center py-12",children:[d.jsx(h,{size:48,className:"mx-auto text-gray-400 mb-4"}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No custom reports yet. Create your first report to get started."})]}):d.jsx("div",{className:"space-y-4",children:m.map(e=>d.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[d.jsxs("div",{children:[d.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.description}),d.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-gray-500 dark:text-gray-500",children:[d.jsxs("span",{className:"flex items-center gap-1",children:[d.jsx(b,{size:14}),"Created ",$(new Date(e.createdAt),"MMM d, yyyy")]}),d.jsxs("span",{children:[e.components.length," component",1!==e.components.length?"s":""]})]})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("button",{onClick:()=>(async e=>{v(e.id);try{const a=await P.generateReportData(e,{transactions:t,accounts:r,budgets:s,categories:n});N(a),c({type:"success",title:"Report Generated",message:"Your report has been generated successfully"})}catch(a){c({type:"error",title:"Generation Failed",message:"Failed to generate the report"})}finally{v(null)}})(e),disabled:f===e.id,className:"p-2 text-primary hover:bg-gray-100 dark:hover:bg-gray-600 rounded-lg disabled:opacity-50",title:"Generate Report",children:f===e.id?d.jsx("div",{className:"animate-spin",children:"\u23f3"}):d.jsx(R,{size:18})}),d.jsx("button",{onClick:()=>x(e),className:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-lg",title:"Edit",children:d.jsx(D,{size:18})}),d.jsx("button",{onClick:()=>(e=>{const t={...e,id:`report-${Date.now()}`,name:`${e.name} (Copy)`,createdAt:new Date,updatedAt:new Date};P.saveCustomReport(t),w(),c({type:"success",title:"Report Duplicated",message:"The report has been duplicated"})})(e),className:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-lg",title:"Duplicate",children:d.jsx(T,{size:18})}),d.jsx("button",{onClick:()=>{return t=e.id,void(confirm("Are you sure you want to delete this report?")&&(P.deleteCustomReport(t),w(),c({type:"success",title:"Report Deleted",message:"The report has been deleted"})));var t},className:"p-2 text-gray-600 dark:text-gray-400 hover:text-red-600 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-lg",title:"Delete",children:d.jsx(M,{size:18})})]})]},e.id))})]}),d.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6",children:d.jsx(a,{})})]})}import{bP as n,r as o,H as d}from"./chunk-DowOIOga.js";import{a as i,as as l,aG as c,T as m,ah as g,q as u,B as y,aw as p,aH as h,ak as x,C as b,r as f,X as v,$ as j,aI as k,aF as N,aJ as w,al as R,E as D,_ as C,Z as S,D as M,an as T}from"./index-qHm2isZb.js";import{p as I,s as E,j as O,k as A,l as F,m as _,e as z,h as q,f as $}from"./chunk-B5pcS96K.js";import{_ as Y}from"./chunk-ddLY9KjI.js";const P=new class{STORAGE_KEY="money_management_custom_reports";getCustomReports(){try{const e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load custom reports:",e),[]}}saveCustomReport(e){const t=this.getCustomReports(),a=t.findIndex(t=>t.id===e.id);a>=0?t[a]=e:t.push(e),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}deleteCustomReport(e){const t=this.getCustomReports().filter(t=>t.id!==e);localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}async generateReportData(e,t){const{startDate:a,endDate:r}=this.getDateRange(e.filters.dateRange,{start:e.filters.customStartDate,end:e.filters.customEndDate});let s=t.transactions.filter(e=>{const t=new Date(e.date);return t>=a&&t<=r});e.filters.accounts&&e.filters.accounts.length>0&&(s=s.filter(t=>e.filters.accounts.includes(t.accountId))),e.filters.categories&&e.filters.categories.length>0&&(s=s.filter(t=>e.filters.categories.includes(t.category))),e.filters.tags&&e.filters.tags.length>0&&(s=s.filter(t=>t.tags&&t.tags.some(t=>e.filters.tags.includes(t))));const n={};for(const o of e.components)n[o.id]=await this.generateComponentData(o,{transactions:s,accounts:t.accounts,budgets:t.budgets,categories:t.categories,dateRange:{startDate:a,endDate:r}});return{report:e,dateRange:{startDate:a,endDate:r},data:n}}getDateRange(e,t){const a=new Date;switch(e){case"month":return{startDate:q(a),endDate:z(a)};case"quarter":return{startDate:_(a),endDate:F(a)};case"year":return{startDate:A(a),endDate:O(a)};case"custom":return{startDate:t?.start?I(t.start):E(a,1),endDate:t?.end?I(t.end):a}}}async generateComponentData(e,t){const{transactions:a,accounts:r,budgets:s,categories:n,dateRange:o}=t;switch(e.type){case"summary-stats":return this.generateSummaryStats(a,e.config);case"line-chart":return this.generateLineChartData(a,o,e.config);case"pie-chart":return this.generatePieChartData(a,n,e.config);case"bar-chart":return this.generateBarChartData(a,o,e.config);case"table":return this.generateTableData(a,r,e.config);case"text-block":return{content:e.config.content||""};case"category-breakdown":return this.generateCategoryBreakdown(a,n,s,e.config);case"date-comparison":return this.generateDateComparison(a,o,e.config);default:return null}}generateSummaryStats(e,t){const a=e.filter(e=>"income"===e.type).reduce((e,t)=>e.plus(t.amount),new n(0)),r=e.filter(e=>"expense"===e.type).reduce((e,t)=>e.plus(Math.abs(t.amount)),new n(0)),s=a.minus(r),o=a.gt(0)?s.div(a).mul(100):new n(0),d={income:a.toNumber(),expenses:r.toNumber(),netIncome:s.toNumber(),savingsRate:o.toNumber(),transactionCount:e.length,avgTransaction:e.length>0?r.div(e.filter(e=>"expense"===e.type).length).toNumber():0};return t.metrics&&Array.isArray(t.metrics)?Object.keys(d).filter(e=>t.metrics.includes(e)).reduce((e,t)=>({...e,[t]:d[t]}),{}):d}generateLineChartData(e,t,a){const r=new Map;e.forEach(e=>{const t=$(new Date(e.date),"yyyy-MM");r.has(t)||r.set(t,{income:new n(0),expenses:new n(0)});const a=r.get(t);"income"===e.type?a.income=a.income.plus(e.amount):"expense"===e.type&&(a.expenses=a.expenses.plus(Math.abs(e.amount)))});const s=Array.from(r.keys()).sort(),o=[];return"income-vs-expenses"!==a.dataType&&"both"!==a.dataType||(o.push({label:"Income",data:s.map(e=>r.get(e).income.toNumber()),borderColor:"rgb(34, 197, 94)",backgroundColor:"rgba(34, 197, 94, 0.1)"}),o.push({label:"Expenses",data:s.map(e=>r.get(e).expenses.toNumber()),borderColor:"rgb(239, 68, 68)",backgroundColor:"rgba(239, 68, 68, 0.1)"})),{labels:s,datasets:o}}generatePieChartData(e,t,a){const r=new Map;e.filter(e=>"expense"===e.type).forEach(e=>{const t=r.get(e.category)||new n(0);r.set(e.category,t.plus(Math.abs(e.amount)))});const s=Array.from(r.entries()).sort((e,t)=>t[1].toNumber()-e[1].toNumber()).slice(0,a.limit||10);if(r.size>s.length){const e=Array.from(r.entries()).slice(s.length).reduce((e,[t,a])=>e.plus(a),new n(0));e.gt(0)&&s.push(["Other",e])}return{labels:s.map(([e])=>t.find(t=>t.id===e)?.name||e),data:s.map(([e,t])=>t.toNumber())}}generateBarChartData(e,t,a){const r=new Map;e.filter(e=>"expense"===e.type).forEach(e=>{const t=$(new Date(e.date),"MMM yyyy"),a=r.get(t)||new n(0);r.set(t,a.plus(Math.abs(e.amount)))});const s=Array.from(r.keys()).sort((e,t)=>new Date(e).getTime()-new Date(t).getTime());return{labels:s,datasets:[{label:"Monthly Expenses",data:s.map(e=>r.get(e).toNumber()),backgroundColor:"rgba(99, 102, 241, 0.5)",borderColor:"rgb(99, 102, 241)",borderWidth:1}]}}generateTableData(e,t,a){let r=[...e];return a.sortBy&&r.sort((e,t)=>{const r=e[a.sortBy],s=t[a.sortBy];return"desc"===a.sortOrder?r>s?-1:1:r>s?1:-1}),a.limit&&(r=r.slice(0,a.limit)),r.map(e=>({date:$(new Date(e.date),"MMM d, yyyy"),description:e.description,category:e.category,account:t.find(t=>t.id===e.accountId)?.name||"Unknown",amount:e.amount,type:e.type}))}generateCategoryBreakdown(e,t,a,r){const s=new Map;return e.filter(e=>"expense"===e.type).forEach(e=>{const t=s.get(e.category)||{actual:new n(0),budget:new n(0),count:0};t.actual=t.actual.plus(Math.abs(e.amount)),t.count++,s.set(e.category,t)}),a.forEach(e=>{const t=s.get(e.category)||{actual:new n(0),budget:new n(0),count:0};t.budget=new n(e.amount),s.set(e.category,t)}),Array.from(s.entries()).map(([e,a])=>{const r=t.find(t=>t.id===e),s=a.budget.gt(0)?a.actual.minus(a.budget).div(a.budget).mul(100):new n(0);return{category:r?.name||e,actual:a.actual.toNumber(),budget:a.budget.toNumber(),variance:s.toNumber(),count:a.count,status:a.actual.lte(a.budget)?"under":"over"}})}generateDateComparison(e,t,a){const r=Math.round((t.endDate.getTime()-t.startDate.getTime())/864e5),s=new Date(t.startDate);s.setDate(s.getDate()-r);const o=new Date(t.startDate);o.setDate(o.getDate()-1);const d=e.filter(e=>{const a=new Date(e.date);return a>=t.startDate&&a<=t.endDate}),i=e.filter(e=>{const t=new Date(e.date);return t>=s&&t<=o}),l=e=>{const t=e.filter(e=>"income"===e.type).reduce((e,t)=>e.plus(t.amount),new n(0)),a=e.filter(e=>"expense"===e.type).reduce((e,t)=>e.plus(Math.abs(t.amount)),new n(0));return{income:t.toNumber(),expenses:a.toNumber(),netIncome:t.minus(a).toNumber(),transactionCount:e.length}},c=l(d),m=l(i);return{current:c,previous:m,changes:{income:m.income>0?(c.income-m.income)/m.income*100:0,expenses:m.expenses>0?(c.expenses-m.expenses)/m.expenses*100:0,netIncome:0!==m.netIncome?(c.netIncome-m.netIncome)/Math.abs(m.netIncome)*100:0},periodLabel:{current:`${$(t.startDate,"MMM d")} - ${$(t.endDate,"MMM d, yyyy")}`,previous:`${$(s,"MMM d")} - ${$(o,"MMM d, yyyy")}`}}}},W=[{type:"summary-stats",name:"Summary Statistics",description:"Key financial metrics overview",icon:m,defaultConfig:{metrics:["income","expenses","netIncome","savingsRate"]}},{type:"line-chart",name:"Line Chart",description:"Trends over time",icon:g,defaultConfig:{dataType:"income-vs-expenses",showLegend:!0,showDataLabels:!1}},{type:"pie-chart",name:"Pie Chart",description:"Category breakdown",icon:u,defaultConfig:{dataType:"expenses-by-category",showPercentages:!0,limit:10}},{type:"bar-chart",name:"Bar Chart",description:"Comparisons",icon:y,defaultConfig:{dataType:"monthly-expenses",orientation:"vertical"}},{type:"table",name:"Data Table",description:"Detailed tabular data",icon:p,defaultConfig:{dataType:"top-transactions",limit:20,sortBy:"amount",sortOrder:"desc"}},{type:"text-block",name:"Text Block",description:"Custom text or notes",icon:h,defaultConfig:{content:"",fontSize:"medium"}},{type:"category-breakdown",name:"Category Analysis",description:"Detailed category breakdown",icon:x,defaultConfig:{showSubcategories:!0,comparisonType:"budget"}},{type:"date-comparison",name:"Period Comparison",description:"Compare different time periods",icon:b,defaultConfig:{periods:["current","previous"],metric:"netIncome"}}],B=new class{STORAGE_KEY="money_management_scheduled_custom_reports";checkInterval=null;initialize(){this.checkInterval=setInterval(()=>{this.checkAndRunDueReports()},6e4),this.checkAndRunDueReports()}destroy(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)}getScheduledReports(){try{const e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load scheduled reports:",e),[]}}saveScheduledReport(e){const t=this.getScheduledReports(),a=t.findIndex(t=>t.id===e.id);a>=0?t[a]=e:t.push(e),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}deleteScheduledReport(e){const t=this.getScheduledReports().filter(t=>t.id!==e);localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}calculateNextRun(e,t=new Date){const[a,r]=e.time.split(":").map(Number),s=new Date(t);switch(s.setHours(a,r,0,0),s<=t&&s.setDate(s.getDate()+1),e.frequency){case"daily":break;case"weekly":{const t=e.dayOfWeek||1;for(;s.getDay()!==t;)s.setDate(s.getDate()+1);break}case"monthly":{const a=e.dayOfMonth||1;s.setDate(a),s<=t&&s.setMonth(s.getMonth()+1);break}case"quarterly":{const e=Math.floor(s.getMonth()/3)+1;s.setMonth(3*e,1);break}case"yearly":s.setMonth(0,1),s<=t&&s.setFullYear(s.getFullYear()+1)}return s}async checkAndRunDueReports(){const e=this.getScheduledReports(),t=new Date;for(const a of e)a.enabled&&new Date(a.nextRun)<=t&&await this.runScheduledReport(a)}async runScheduledReport(e,t){try{console.log(`[ScheduledReports] Running report: ${e.reportName}`);const a=P.getCustomReports().find(t=>t.id===e.customReportId);if(!a)throw new Error("Custom report not found");t||(t=this.getDataFromStorage());const r=await P.generateReportData(a,t);let s;switch(e.deliveryFormat){case"pdf":s=await this.exportToPDF(r,a);break;case"csv":s=await this.exportToCSV(r,t);break;case"excel":s=await this.exportToExcel(r,t);break;case"email":s=await this.exportToPDF(r,a),this.notifyEmailReady(e,s)}e.lastRun=new Date,e.nextRun=this.calculateNextRun(e),this.saveScheduledReport(e),this.addToHistory({reportId:e.id,reportName:e.reportName,runTime:new Date,success:!0,format:e.deliveryFormat}),console.log(`[ScheduledReports] Report completed: ${e.reportName}`)}catch(a){console.error(`[ScheduledReports] Report failed: ${e.reportName}`,a),this.addToHistory({reportId:e.id,reportName:e.reportName,runTime:new Date,success:!1,error:a instanceof Error?a.message:"Unknown error"})}}getDataFromStorage(){return{transactions:JSON.parse(localStorage.getItem("money_management_transactions")||"[]"),accounts:JSON.parse(localStorage.getItem("money_management_accounts")||"[]"),budgets:JSON.parse(localStorage.getItem("money_management_budgets")||"[]"),categories:JSON.parse(localStorage.getItem("money_management_categories")||"[]")}}async exportToPDF(e,t){const{generatePDFReport:a}=await Y(async()=>{const{generatePDFReport:e}=await import("./pdfExport-Dby-sc7S.js");return{generatePDFReport:e}},__vite__mapDeps([0,1,2,3])),r={title:t.name,dateRange:`${$(e.dateRange.startDate,"MMM d, yyyy")} - ${$(e.dateRange.endDate,"MMM d, yyyy")}`,components:e.data,customReport:t};return await a(r,[])}async exportToCSV(e,t){return await k.exportData({transactions:t.transactions,accounts:t.accounts,investments:[],budgets:t.budgets},{startDate:e.dateRange.startDate,endDate:e.dateRange.endDate,format:"csv",includeTransactions:!0,includeAccounts:!0,includeBudgets:!0})}async exportToExcel(e,t){return await k.exportData({transactions:t.transactions,accounts:t.accounts,investments:[],budgets:t.budgets},{startDate:e.dateRange.startDate,endDate:e.dateRange.endDate,format:"xlsx",includeTransactions:!0,includeAccounts:!0,includeBudgets:!0})}notifyEmailReady(e,t){new Notification("Report Ready for Email",{body:`${e.reportName} has been generated and is ready to email to ${e.emailRecipients?.join(", ")}`,icon:"/icon-192.png",tag:"scheduled-report-email"})}addToHistory(e){const t="money_management_report_history",a=JSON.parse(localStorage.getItem(t)||"[]");a.unshift(e),a.length>100&&a.splice(100),localStorage.setItem(t,JSON.stringify(a))}getReportHistory(){return JSON.parse(localStorage.getItem("money_management_report_history")||"[]")}};export{s as default};
