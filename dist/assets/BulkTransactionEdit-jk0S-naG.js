function e({isOpen:e,onClose:v,preSelectedIds:f=[]}){const{transactions:N,accounts:k,categories:w,updateTransaction:C}=a(),{formatCurrency:S}=j(),[z,T]=b.useState(new Set(f)),[R,A]=b.useState({appendNote:!1}),[I,O]=b.useState(!1),[D,M]=b.useState(!1),[E,L]=b.useState(!1),[$,U]=b.useState(0),[F,K]=b.useState([]),[Y,B]=b.useState(-1),[G,H]=b.useState({dateRange:{start:null,end:null},accounts:[],categories:[],types:[],searchTerm:"",amountRange:{min:null,max:null}}),V=b.useMemo(()=>N.filter(e=>{if(G.dateRange.start||G.dateRange.end){const a=e.date instanceof Date?e.date:new Date(e.date);if(G.dateRange.start&&a<G.dateRange.start)return!1;if(G.dateRange.end&&a>G.dateRange.end)return!1}if(G.accounts.length>0&&!G.accounts.includes(e.accountId))return!1;if(G.categories.length>0&&!G.categories.includes(e.category))return!1;if(G.types.length>0&&!G.types.includes(e.type))return!1;if(G.searchTerm){const a=G.searchTerm.toLowerCase();if(!(e.description.toLowerCase().includes(a)||e.category.toLowerCase().includes(a)||e.notes&&e.notes.toLowerCase().includes(a)||e.tags&&e.tags.some(e=>e.toLowerCase().includes(a))))return!1}if(null!==G.amountRange.min||null!==G.amountRange.max){const a="number"==typeof e.amount?e.amount:e.amount.toNumber();if(null!==G.amountRange.min&&a<G.amountRange.min)return!1;if(null!==G.amountRange.max&&a>G.amountRange.max)return!1}return!0}),[N,G]),X=b.useMemo(()=>V.filter(e=>z.has(e.id)),[V,z]),Z=b.useMemo(()=>{if(0===X.length)return null;const e=X[0].category;return X.every(a=>a.category===e)?e:null},[X]),_=b.useMemo(()=>{if(0===X.length)return[];const e=X.map(e=>new Set(e.tags||[])).reduce((e,a)=>new Set([...e].filter(e=>a.has(e))));return Array.from(e)},[X]),q=b.useMemo(()=>{const e=[];return X.forEach(a=>{const s=[];if(void 0!==R.category&&R.category!==a.category&&s.push(`Category \u2192 ${R.category||"Uncategorized"}`),void 0!==R.tags&&s.push(`Tags \u2192 ${R.tags.join(", ")||"None"}`),void 0!==R.cleared&&R.cleared!==a.cleared&&s.push("Cleared \u2192 "+(R.cleared?"Yes":"No")),void 0!==R.notes&&(R.appendNote?s.push(`Note \u2192 Append "${R.notes}"`):s.push(`Note \u2192 "${R.notes}"`)),void 0!==R.moveToAccount&&R.moveToAccount!==a.accountId){const e=k.find(e=>e.id===R.moveToAccount);s.push(`Account \u2192 ${e?.name||"Unknown"}`)}s.length>0&&e.push({transaction:a,updates:s})}),e},[X,R,k]),J=Y>0,P=Y<F.length-1;return s.jsxs(t,{isOpen:e,onClose:v,title:"Bulk Edit Transactions",size:"full",children:[s.jsxs("div",{className:"flex h-[80vh]",children:[s.jsxs("div",{className:"w-2/3 border-r border-gray-200 dark:border-gray-700 p-6 overflow-y-auto",children:[s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-medium",children:"Select Transactions"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>{if(Y>0){const e=F[Y-1];A(e.changes),T(e.selectedIds),B(Y-1)}},disabled:!J,className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:"Undo (Ctrl+Z)",children:s.jsx(r,{size:16})}),s.jsx("button",{onClick:()=>{if(Y<F.length-1){const e=F[Y+1];A(e.changes),T(e.selectedIds),B(Y+1)}},disabled:!P,className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:"Redo (Ctrl+Y)",children:s.jsx(n,{size:16})}),s.jsx("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600"}),s.jsxs("button",{onClick:()=>O(!I),className:"flex items-center gap-2 px-3 py-1 rounded-lg text-sm\n                           "+(I?"bg-primary text-white":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[s.jsx(l,{size:16}),"Filters"]}),s.jsxs("button",{onClick:()=>{const e=new Set(V.map(e=>e.id));T(e)},className:"flex items-center gap-2 px-3 py-1 text-sm text-gray-700 \n                           dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:[s.jsx(d,{size:16}),"Select All"]}),s.jsxs("button",{onClick:()=>{T(new Set)},className:"flex items-center gap-2 px-3 py-1 text-sm text-gray-700 \n                           dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:[s.jsx(c,{size:16}),"Clear"]})]})]}),I&&s.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 mb-4 space-y-3",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Date Range"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"date",value:G.dateRange.start?.toISOString().split("T")[0]||"",onChange:e=>H({...G,dateRange:{...G.dateRange,start:e.target.value?new Date(e.target.value):null}}),className:"flex-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 \n                                 rounded bg-white dark:bg-gray-700"}),s.jsx("span",{className:"self-center",children:"to"}),s.jsx("input",{type:"date",value:G.dateRange.end?.toISOString().split("T")[0]||"",onChange:e=>H({...G,dateRange:{...G.dateRange,end:e.target.value?new Date(e.target.value):null}}),className:"flex-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 \n                                 rounded bg-white dark:bg-gray-700"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Search"}),s.jsx("input",{type:"text",placeholder:"Search descriptions, notes, tags...",value:G.searchTerm,onChange:e=>H({...G,searchTerm:e.target.value}),className:"w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 \n                               rounded bg-white dark:bg-gray-700"})]})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Accounts"}),s.jsx("select",{multiple:!0,value:G.accounts,onChange:e=>H({...G,accounts:Array.from(e.target.selectedOptions,e=>e.value)}),className:"w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 \n                               rounded bg-white dark:bg-gray-700",size:3,children:k.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Categories"}),s.jsx("select",{multiple:!0,value:G.categories,onChange:e=>H({...G,categories:Array.from(e.target.selectedOptions,e=>e.value)}),className:"w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 \n                               rounded bg-white dark:bg-gray-700",size:3,children:w.map(e=>s.jsx("option",{value:e.name,children:e.name},e.id))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Type"}),s.jsxs("div",{className:"space-y-1",children:[s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:G.types.includes("income"),onChange:e=>{e.target.checked?H({...G,types:[...G.types,"income"]}):H({...G,types:G.types.filter(e=>"income"!==e)})},className:"rounded"}),s.jsx("span",{className:"text-sm",children:"Income"})]}),s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:G.types.includes("expense"),onChange:e=>{e.target.checked?H({...G,types:[...G.types,"expense"]}):H({...G,types:G.types.filter(e=>"expense"!==e)})},className:"rounded"}),s.jsx("span",{className:"text-sm",children:"Expense"})]}),s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:G.types.includes("transfer"),onChange:e=>{e.target.checked?H({...G,types:[...G.types,"transfer"]}):H({...G,types:G.types.filter(e=>"transfer"!==e)})},className:"rounded"}),s.jsx("span",{className:"text-sm",children:"Transfer"})]})]})]})]})]}),s.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[z.size," of ",V.length," transactions selected"]})]}),s.jsx("div",{className:"space-y-2",children:V.map(e=>{const a=e.date instanceof Date?e.date:new Date(e.date),t=k.find(a=>a.id===e.accountId);return s.jsx("label",{className:"block p-3 rounded-lg border cursor-pointer transition-colors\n                           "+(z.has(e.id)?"border-primary bg-primary/10":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"),children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("input",{type:"checkbox",checked:z.has(e.id),onChange:()=>(e=>{const a=new Set(z);a.has(e)?a.delete(e):a.add(e),T(a)})(e.id),className:"mt-1"}),s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:e.description}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400 mt-1",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(i,{size:14}),a.toLocaleDateString()]}),s.jsx("span",{children:e.category}),s.jsx("span",{children:t?.name}),e.tags&&e.tags.length>0&&s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(o,{size:14}),e.tags.join(", ")]})]})]}),s.jsxs("div",{className:"font-medium "+("income"===e.type?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:["income"===e.type?"+":"-",S(e.amount)]})]})})]})},e.id)})})]}),s.jsxs("div",{className:"w-1/3 p-6",children:[s.jsx("h3",{className:"text-lg font-medium mb-4",children:"Edit Selected Transactions"}),0===z.size?s.jsx("div",{className:"text-center py-8 text-gray-500",children:"Select transactions to edit"}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[s.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:["Editing ",z.size," transaction",z.size>1?"s":""]}),s.jsxs("div",{className:"text-xs text-gray-500",children:["Total: ",S(X.reduce((e,a)=>e+("number"==typeof a.amount?a.amount:a.amount.toNumber()),0))]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium mb-2",children:[s.jsx(g,{size:16,className:"inline mr-1"}),"Category"]}),s.jsxs("select",{value:R.category??Z??"",onChange:e=>A({...R,category:e.target.value||void 0}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg\n                             bg-white dark:bg-gray-800",children:[s.jsx("option",{value:"",children:"Keep existing"}),w.map(e=>s.jsx("option",{value:e.name,children:e.name},e.id))]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium mb-2",children:[s.jsx(o,{size:16,className:"inline mr-1"}),"Tags"]}),s.jsx("input",{type:"text",placeholder:"Enter tags separated by commas",value:R.tags?.join(", ")??_.join(", "),onChange:e=>A({...R,tags:e.target.value?e.target.value.split(",").map(e=>e.trim()):[]}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg\n                             bg-white dark:bg-gray-800"})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium mb-2",children:[s.jsx(d,{size:16,className:"inline mr-1"}),"Cleared Status"]}),s.jsxs("select",{value:void 0!==R.cleared?R.cleared.toString():"",onChange:e=>A({...R,cleared:""===e.target.value?void 0:"true"===e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg\n                             bg-white dark:bg-gray-800",children:[s.jsx("option",{value:"",children:"Keep existing"}),s.jsx("option",{value:"true",children:"Mark as Cleared"}),s.jsx("option",{value:"false",children:"Mark as Uncleared"})]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium mb-2",children:[s.jsx(m,{size:16,className:"inline mr-1"}),"Notes"]}),s.jsx("textarea",{placeholder:"Add notes to all selected transactions",value:R.notes??"",onChange:e=>A({...R,notes:e.target.value||void 0}),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg\n                             bg-white dark:bg-gray-800"}),s.jsxs("label",{className:"flex items-center gap-2 mt-2",children:[s.jsx("input",{type:"checkbox",checked:R.appendNote||!1,onChange:e=>A({...R,appendNote:e.target.checked}),className:"rounded"}),s.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Append to existing notes instead of replacing"})]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium mb-2",children:[s.jsx(x,{size:16,className:"inline mr-1"}),"Move to Account"]}),s.jsxs("select",{value:R.moveToAccount??"",onChange:e=>A({...R,moveToAccount:e.target.value||void 0}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg\n                             bg-white dark:bg-gray-800",children:[s.jsx("option",{value:"",children:"Keep in current account"}),k.map(e=>s.jsxs("option",{value:e.id,children:[e.name," (",S(e.balance),")"]},e.id))]})]})]}),Object.keys(R).filter(e=>"appendNote"!==e).length>0&&s.jsxs("div",{className:"space-y-3",children:[s.jsxs("button",{onClick:()=>M(!D),className:"flex items-center gap-2 text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300",children:[s.jsx(u,{size:16}),D?"Hide":"Show"," preview of changes"]}),D&&q.length>0&&s.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3 max-h-48 overflow-y-auto",children:s.jsxs("div",{className:"space-y-2 text-xs",children:[q.slice(0,5).map(({transaction:e,updates:a})=>s.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 last:border-0 pb-2 last:pb-0",children:[s.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:e.description}),s.jsx("div",{className:"text-gray-600 dark:text-gray-400 mt-1",children:a.join(" \u2022 ")})]},e.id)),q.length>5&&s.jsxs("div",{className:"text-gray-500 dark:text-gray-400 italic",children:["...and ",q.length-5," more transactions"]})]})}),s.jsx("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-3",children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(p,{className:"text-orange-600 dark:text-orange-400 mt-0.5",size:16}),s.jsxs("div",{className:"text-sm text-orange-800 dark:text-orange-200",children:["These changes will be applied to all ",z.size," selected transactions."]})]})})]})]})]})]}),s.jsxs("div",{className:"flex justify-between items-center px-6 py-4 border-t border-gray-200 dark:border-gray-700",children:[s.jsx("button",{onClick:v,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 \n                   dark:hover:bg-gray-700 rounded-lg",children:"Cancel"}),s.jsx("button",{onClick:async()=>{if(0!==z.size&&0!==Object.keys(R).filter(e=>"appendNote"!==e).length){L(!0),U(0);try{let e=0;for(const a of z){const s=N.find(e=>e.id===a);if(!s)continue;const t={};void 0!==R.category&&(t.category=R.category),void 0!==R.tags&&(t.tags=R.tags),void 0!==R.cleared&&(t.cleared=R.cleared),void 0!==R.notes&&(R.appendNote&&s.notes?t.notes=s.notes+"\n"+R.notes:t.notes=R.notes),void 0!==R.moveToAccount&&(t.accountId=R.moveToAccount),await C(a,t),e++,U(e)}(()=>{const e={changes:{...R},selectedIds:new Set(z),timestamp:Date.now()},a=F.slice(0,Y+1);a.push(e),K(a),B(a.length-1)})(),T(new Set),A({appendNote:!1}),v()}catch(e){console.error("Error applying bulk changes:",e)}finally{L(!1)}}},disabled:0===z.size||0===Object.keys(R).filter(e=>"appendNote"!==e).length||E,className:"flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg\n                   hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed",children:E?s.jsxs(s.Fragment,{children:[s.jsx(h,{size:20,className:"animate-spin"}),"Applying (",$,"/",z.size,")..."]}):s.jsxs(s.Fragment,{children:[s.jsx(y,{size:20}),"Apply Changes"]})})]})]})}import{g as a,j as s,M as t,co as r,aG as n,aa as l,O as d,X as c,r as i,A as o,bn as g,b2 as m,aA as x,ax as u,ar as p,at as h,_ as y}from"./index-Pkjq0qn3.js";import{a as b}from"./chunk-BWx9oMeS.js";import{u as j}from"./chunk-BYFRQ0Wn.js";import"./chunk-BN8kgYrt.js";import"./chunk-Drd-K-oK.js";export{e as default};
