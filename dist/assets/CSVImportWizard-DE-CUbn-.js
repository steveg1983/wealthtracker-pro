function e({isOpen:e,onClose:y,type:u}){const{accounts:b,transactions:j,addTransaction:k,categories:f}=r(),[v,N]=p.useState("upload"),[w,C]=p.useState(""),[S,B]=p.useState([]),[M,z]=p.useState([]),[F,A]=p.useState([]),[I,D]=p.useState(null),[T,L]=p.useState(!1),[P,V]=p.useState(null),[O,U]=p.useState(!0),[R,W]=p.useState(90),E=p.useCallback(e=>{const a=e.target.files?.[0];if(!a)return;const r=new FileReader;r.onload=e=>{const a=e.target?.result;C(a);const r=h.parseCSV(a);B(r.headers),z(r.data);const t=h.suggestMappings(r.headers,u);A(t),N("mapping")},r.readAsText(a)},[u]),K=p.useCallback(e=>{e.preventDefault();const a=e.dataTransfer.files[0];if(a&&"text/csv"===a.type){const e=new FileReader;e.onload=e=>{const a=e.target?.result;C(a);const r=h.parseCSV(a);B(r.headers),z(r.data);const t=h.suggestMappings(r.headers,u);A(t),N("mapping")},e.readAsText(a)}},[u]),H=(e,a,r)=>{const t=[...F];t[e]={...t[e],[a]:r},A(t)},Q="transaction"===u?["date","description","amount","category","accountName","tags","notes","balance"]:["name","type","balance","currency","institution"];return t.jsx(s,{isOpen:e,onClose:y,title:"CSV Import Wizard",size:"xl",children:t.jsxs("div",{className:"flex flex-col h-[600px]",children:[t.jsx("div",{className:"flex items-center justify-center mb-6",children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx(a,{label:"Upload",isActive:"upload"===v,isComplete:["mapping","preview","result"].includes(v)}),t.jsx(i,{size:16,className:"text-gray-400"}),t.jsx(a,{label:"Map Columns",isActive:"mapping"===v,isComplete:["preview","result"].includes(v)}),t.jsx(i,{size:16,className:"text-gray-400"}),t.jsx(a,{label:"Preview",isActive:"preview"===v,isComplete:"result"===v}),t.jsx(i,{size:16,className:"text-gray-400"}),t.jsx(a,{label:"Import",isActive:"result"===v,isComplete:!1})]})}),t.jsxs("div",{className:"flex-1 overflow-y-auto",children:["upload"===v&&t.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8",children:[t.jsxs("div",{className:"w-full max-w-md p-8 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg text-center hover:border-primary transition-colors cursor-pointer",onDrop:K,onDragOver:e=>e.preventDefault(),children:[t.jsx(l,{size:48,className:"mx-auto text-gray-400 mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Upload CSV File"}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Drag and drop your CSV file here, or click to browse"}),t.jsx("input",{type:"file",accept:".csv",onChange:E,className:"hidden",id:"csv-upload"}),t.jsxs("label",{htmlFor:"csv-upload",className:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-secondary cursor-pointer",children:[t.jsx(n,{size:20}),"Select File"]})]}),t.jsxs("div",{className:"mt-8 w-full max-w-4xl",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Quick Start with Bank Templates"}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-4",children:"Select your bank to auto-configure column mappings. Supports 40+ bank formats worldwide."}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("h5",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:"UK Major Banks"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:["Barclays","HSBC","Lloyds","NatWest","Santander","Halifax","RBS","TSB"].map(e=>t.jsx("button",{className:"px-3 py-2 text-sm bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors text-left",onClick:()=>{const a=h.getBankMappings(e.toLowerCase());A(a),N("mapping")},children:e},e))})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("h5",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:"UK Building Societies"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:["Nationwide","Yorkshire","Coventry","Skipton"].map(e=>t.jsx("button",{className:"px-3 py-2 text-sm bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors text-left",onClick:()=>{const a=h.getBankMappings(e.toLowerCase());A(a),N("mapping")},children:e},e))})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("h5",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Digital Banks"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:["Monzo","Starling","Revolut","Metro"].map(e=>t.jsx("button",{className:"px-3 py-2 text-sm bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors text-left",onClick:()=>{const a=h.getBankMappings(e.toLowerCase());A(a),N("mapping")},children:e},e))})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("h5",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Other UK Banks"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:["First Direct","Co-op","Virgin","Tesco"].map(e=>t.jsx("button",{className:"px-3 py-2 text-sm bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors text-left",onClick:()=>{const a=h.getBankMappings(e.toLowerCase().replace(" ","-"));A(a),N("mapping")},children:e},e))})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("h5",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:"European Banks"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:["Deutsche Bank","BNP Paribas","ING"].map(e=>t.jsx("button",{className:"px-3 py-2 text-sm bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors text-left",onClick:()=>{const a=h.getBankMappings(e.toLowerCase().replace(" ","-"));A(a),N("mapping")},children:e},e))})]})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("h5",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:"US Banks"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:["Chase","Bank of America","Wells Fargo","Citibank","TD Bank"].map(e=>t.jsx("button",{className:"px-3 py-2 text-sm bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors text-left",onClick:()=>{const a=h.getBankMappings(e.toLowerCase().replace(" ","-"));A(a),N("mapping")},children:e},e))})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("h5",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Australian Banks"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:["ANZ","Commonwealth","Westpac","NAB"].map(e=>t.jsx("button",{className:"px-3 py-2 text-sm bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors text-left",onClick:()=>{const a=h.getBankMappings(e.toLowerCase());A(a),N("mapping")},children:e},e))})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("h5",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Online Payment Services"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:["PayPal","Wise","Stripe"].map(e=>t.jsx("button",{className:"px-3 py-2 text-sm bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors text-left",onClick:()=>{const a=h.getBankMappings(e.toLowerCase());A(a),N("mapping")},children:e},e))})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("h5",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Accounting Software"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:["QuickBooks","Mint","Wave"].map(e=>t.jsx("button",{className:"px-3 py-2 text-sm bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors text-left",onClick:()=>{const a=h.getBankMappings(e.toLowerCase());A(a),N("mapping")},children:e},e))})]})]})]})]})]}),"mapping"===v&&t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Column Mapping"}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Map your CSV columns to the appropriate fields"})]}),t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Import Profiles"}),t.jsxs("button",{onClick:()=>{const e=prompt("Enter a name for this import profile:");if(!e)return;const a={id:`profile-${Date.now()}`,name:e,type:u,mappings:F,lastUsed:new Date};h.saveProfile(a),D(a)},className:"text-sm text-primary hover:text-secondary transition-colors",children:[t.jsx(d,{size:16,className:"inline mr-1"}),"Save Current"]})]}),t.jsxs("select",{value:I?.id||"",onChange:e=>{const a=h.getProfiles(u).find(a=>a.id===e.target.value);a&&(e=>{D(e),A(e.mappings)})(a)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white",children:[t.jsx("option",{value:"",children:"Select a saved profile..."}),h.getProfiles(u).map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})]}),t.jsx("div",{className:"space-y-3",children:F.map((e,a)=>t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("select",{value:e.sourceColumn,onChange:e=>H(a,"sourceColumn",e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white",children:[t.jsx("option",{value:"",children:"Select CSV column..."}),S.map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsx("span",{className:"text-gray-500",children:"\u2192"}),t.jsxs("select",{value:e.targetField,onChange:e=>H(a,"targetField",e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white",children:[t.jsx("option",{value:"",children:"Select target field..."}),Q.map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsx("button",{onClick:()=>(e=>{A(F.filter((a,r)=>r!==e))})(a),className:"p-2 text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300",children:t.jsx(o,{size:20})})]},a))}),t.jsx("button",{onClick:()=>{A([...F,{sourceColumn:"",targetField:""}])},className:"mt-4 text-sm text-primary hover:text-secondary transition-colors",children:"+ Add Mapping"})]}),"preview"===v&&t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Preview Import"}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Review the first few rows to ensure correct mapping"})]}),t.jsx("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:O,onChange:e=>U(e.target.checked),className:"rounded border-gray-300 text-primary focus:ring-primary"}),t.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Skip duplicate transactions"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("label",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Threshold:"}),t.jsx("input",{type:"number",value:R,onChange:e=>W(Number(e.target.value)),min:"50",max:"100",className:"w-16 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white"}),t.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"%"})]})]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-600",children:[t.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:t.jsx("tr",{children:Q.filter(e=>F.some(a=>a.targetField===e)).map(e=>t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:e},e))})}),t.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-600",children:M.slice(0,5).map((e,a)=>t.jsx("tr",{children:Q.filter(e=>F.some(a=>a.targetField===e)).map(a=>{const r=F.find(e=>e.targetField===a),s=r?S.indexOf(r.sourceColumn||""):-1,i=s>=0?e[s]:"";return t.jsx("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-white",children:r?.transform?r.transform(i)?.toString()??"":i},a)})},a))})]})}),M.length>5&&t.jsxs("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:["Showing 5 of ",M.length," rows"]})]}),"result"===v&&P&&t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"text-center mb-6",children:[t.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full mb-4",children:t.jsx(c,{size:32,className:"text-green-600 dark:text-green-400"})}),t.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Import Complete!"})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[t.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 text-center",children:[t.jsx("p",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:P.success}),t.jsx("p",{className:"text-sm text-green-800 dark:text-green-300",children:"Imported"})]}),P.duplicates>0&&t.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 text-center",children:[t.jsx("p",{className:"text-3xl font-bold text-yellow-600 dark:text-yellow-400",children:P.duplicates}),t.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-300",children:"Skipped"})]}),P.failed>0&&t.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 text-center",children:[t.jsx("p",{className:"text-3xl font-bold text-red-600 dark:text-red-400",children:P.failed}),t.jsx("p",{className:"text-sm text-red-800 dark:text-red-300",children:"Failed"})]})]}),P.errors.length>0&&t.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:[t.jsx("h4",{className:"font-semibold text-red-900 dark:text-red-300 mb-2",children:"Import Errors"}),t.jsxs("ul",{className:"text-sm text-red-800 dark:text-red-200 space-y-1",children:[P.errors.slice(0,5).map((e,a)=>t.jsxs("li",{children:["Row ",e.row,": ",e.error]},a)),P.errors.length>5&&t.jsxs("li",{children:["... and ",P.errors.length-5," more errors"]})]})]})]})]}),t.jsxs("div",{className:"flex justify-between items-center p-6 border-t border-gray-200 dark:border-gray-600",children:[t.jsxs("button",{onClick:"upload"===v?y:()=>{const e=["upload","mapping","preview","result"],a=e.indexOf(v);a>0&&N(e[a-1])},className:"flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:[t.jsx(g,{size:20}),"upload"===v?"Cancel":"Back"]}),t.jsx("div",{className:"flex gap-3",children:"result"===v?t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>{N("upload"),C(""),B([]),z([]),A([]),D(null),V(null)},className:"flex items-center gap-2 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600",children:[t.jsx(x,{size:20}),"Import More"]}),t.jsx("button",{onClick:y,className:"px-6 py-2 bg-primary text-white rounded-lg hover:bg-secondary",children:"Done"})]}):t.jsx(m,{isLoading:T,onClick:()=>{"mapping"===v?N("preview"):"preview"===v&&(async()=>{L(!0);try{if("transaction"===u){const e=new Map(b.map(e=>[e.name,e.id])),a=await h.importTransactions(w,F,j,e,{skipDuplicates:O,duplicateThreshold:R,categories:f||[],autoCategorize:!0,categoryConfidenceThreshold:.7});for(const r of a.items)"date"in r&&"amount"in r&&"description"in r&&"category"in r&&"accountId"in r&&"type"in r&&k({date:r.date,amount:r.amount,description:r.description,category:r.category,accountId:r.accountId,type:r.type,tags:r.tags,notes:r.notes});V(a)}N("result")}catch(e){console.error("Import error:",e)}finally{L(!1)}})()},className:"flex items-center gap-2 px-6 py-2 bg-primary text-white rounded-lg hover:bg-secondary disabled:opacity-50",disabled:"mapping"===v&&0===F.length||T,children:"preview"===v?t.jsxs(t.Fragment,{children:[t.jsx(l,{size:20}),"Import"]}):t.jsxs(t.Fragment,{children:["Next",t.jsx(i,{size:20})]})})})]})]})})}function a({label:e,isActive:a,isComplete:r}){return t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center transition-colors "+(r?"bg-green-500 text-white":a?"bg-primary text-white":"bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400"),children:r?t.jsx(c,{size:20}):e.charAt(0)}),t.jsx("span",{className:"text-xs mt-1 "+(a?"text-primary font-medium":"text-gray-500 dark:text-gray-400"),children:e})]})}import{g as r,j as t,M as s,a7 as i,bo as l,b2 as n,b1 as d,X as o,_ as c,a6 as g,at as x,aw as m}from"./index-Pkjq0qn3.js";import{a as p}from"./chunk-BWx9oMeS.js";import{e as h}from"./chunk-5nUEduVz.js";import"./chunk-BN8kgYrt.js";import"./chunk-Drd-K-oK.js";import"./chunk-CkYa08k9.js";import"./chunk-BUNwFMNM.js";export{e as default};
