var e=(e=>(e.LOW="low",e.MEDIUM="medium",e.HIGH="high",e.CRITICAL="critical",e))(e||{}),r=(e=>(e.NETWORK="network",e.VALIDATION="validation",e.STORAGE="storage",e.CALCULATION="calculation",e.AUTHENTICATION="authentication",e.AUTHORIZATION="authorization",e.INTEGRATION="integration",e.UNKNOWN="unknown",e))(r||{});const t=new class{errors=[];handlers=new Map;maxErrors=100;storageKey="wealthtracker_error_log";constructor(){this.setupGlobalErrorHandlers(),this.loadErrors()}setupGlobalErrorHandlers(){window.addEventListener("unhandledrejection",e=>{this.handleError(new Error(e.reason),{category:"unknown",severity:"high",context:{type:"unhandledRejection"}}),e.preventDefault()}),window.addEventListener("error",e=>{this.handleError(e.error||new Error(e.message),{category:"unknown",severity:"high",context:{type:"globalError",filename:e.filename,lineno:e.lineno,colno:e.colno}})})}loadErrors(){try{const e=localStorage.getItem(this.storageKey);if(e){const r=JSON.parse(e);this.errors=r.map(e=>({...e,timestamp:new Date(e.timestamp)})).slice(-this.maxErrors)}}catch(e){console.error("Failed to load error log:",e)}}saveErrors(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.errors.slice(-this.maxErrors)))}catch(e){console.error("Failed to save error log:",e)}}handleError(e,r={}){const t={id:`err-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,message:e instanceof Error?e.message:e,category:r.category||this.categorizeError(e),severity:r.severity||"medium",timestamp:new Date,context:r.context,stack:e instanceof Error?e.stack:void 0,userMessage:r.userMessage||this.getUserMessage(e,r.category),recoverable:!1!==r.recoverable,retryable:r.retryable||!1};return this.errors.push(t),this.saveErrors(),(this.handlers.get(t.category)||[]).forEach(e=>{try{e(t)}catch(r){console.error("Error in error handler:",r)}}),t}categorizeError(e){const r=(e instanceof Error?e.message:e).toLowerCase();return r.includes("network")||r.includes("fetch")?"network":r.includes("validation")||r.includes("invalid")?"validation":r.includes("storage")||r.includes("indexeddb")||r.includes("localstorage")?"storage":r.includes("calculation")||r.includes("decimal")?"calculation":r.includes("auth")?"authentication":"unknown"}getUserMessage(e,r){const t=e instanceof Error?e.message:e;if(t.toLowerCase().includes("failed to fetch")||t.toLowerCase().includes("network")||t.toLowerCase().includes("offline"))return"The app is running in local-only mode. All data is stored in your browser.";switch(r){case"network":return t.includes("localhost")||t.includes("127.0.0.1")?"No backend server detected. The app is working in local-only mode.":"Network connection error. The app will continue to work offline.";case"validation":return`Invalid data: ${t}`;case"storage":return"Failed to save data. Please check your browser storage settings.";case"calculation":return"Calculation error. Please verify your input data.";case"authentication":return"Authentication required. Please log in again.";case"authorization":return"You don't have permission to perform this action.";case"integration":return t.includes("bank")||t.includes("plaid")?"Bank connection service unavailable. Manual account management is still available.":"External service unavailable. Core features remain functional.";default:return"An unexpected error occurred. Please try again."}}registerHandler(e,r){this.handlers.has(e)||this.handlers.set(e,[]),this.handlers.get(e).push(r)}getRecentErrors(e=10){return this.errors.slice(-e).reverse()}getErrorsByCategory(e){return this.errors.filter(r=>r.category===e)}clearErrors(){this.errors=[],this.saveErrors()}async retryWithBackoff(e,r={}){const{maxRetries:t=3,initialDelay:a=1e3,maxDelay:o=1e4,factor:n=2,onRetry:s}=r;let i;for(let c=0;c<=t;c++)try{return await e()}catch(l){if(i=l,c<t){const e=Math.min(a*Math.pow(n,c),o);s&&s(c+1,i),await new Promise(r=>setTimeout(r,e))}}throw i}wrapAsync(e,r={}){return async(...t)=>{try{return await e(...t)}catch(a){if(this.handleError(a,r),void 0!==r.fallback)return r.fallback;throw a}}}validate(e,r){for(const t of r)if(!t.test(e))throw new Error(t.message)}};t.handleError.bind(t);const a=t.retryWithBackoff.bind(t);t.wrapAsync.bind(t);const o=t.validate.bind(t);export{e as E,r as a,t as e,a as r,o as v};
