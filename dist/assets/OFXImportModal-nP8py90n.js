function e({isOpen:e,onClose:h}){const{accounts:p,transactions:b,categories:y,addTransaction:j}=t(),[f,k]=g.useState(null),[N,v]=g.useState(!1),[w,F]=g.useState(null),[A,I]=g.useState(null),[C,z]=g.useState(""),[O,S]=g.useState(!0),D=g.useCallback(e=>{const t=e.target.files?.[0];t&&(t.name.toLowerCase().endsWith(".ofx")?(k(t),F(null),I(null),T(t)):alert("Please select an OFX file"))},[]),X=g.useCallback(e=>{e.preventDefault();const t=e.dataTransfer.files[0];t&&t.name.toLowerCase().endsWith(".ofx")&&(k(t),F(null),I(null),T(t))},[]),T=async e=>{v(!0);try{const t=await e.text(),a=await u.importTransactions(t,p,b,{skipDuplicates:!1,categories:y,autoCategorize:!0});F(a),a.matchedAccount&&z(a.matchedAccount.id)}catch(t){console.error("Error parsing OFX file:",t),alert("Error parsing OFX file. Please check the file format.")}finally{v(!1)}},E=()=>{k(null),F(null),I(null),z("")};return a.jsx(s,{isOpen:e,onClose:h,title:"Import OFX File",size:"lg",children:a.jsxs("div",{className:"p-6",children:[!w&&!A&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-primary transition-colors cursor-pointer",onDrop:X,onDragOver:e=>e.preventDefault(),children:[a.jsx(r,{size:48,className:"mx-auto text-gray-400 mb-4"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Upload OFX File"}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Drag and drop your .ofx file here, or click to browse"}),a.jsx("input",{type:"file",accept:".ofx",onChange:D,className:"hidden",id:"ofx-upload"}),a.jsxs("label",{htmlFor:"ofx-upload",className:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-secondary cursor-pointer",children:[a.jsx(n,{size:20}),"Select OFX File"]})]}),a.jsx("div",{className:"mt-6 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(l,{className:"text-blue-600 dark:text-blue-400 mt-0.5",size:20}),a.jsxs("div",{className:"text-sm",children:[a.jsx("h4",{className:"font-semibold text-blue-900 dark:text-blue-300 mb-1",children:"About OFX Files"}),a.jsx("p",{className:"text-blue-800 dark:text-blue-200 mb-2",children:"OFX (Open Financial Exchange) files contain standardized financial data exported from banks and credit card companies."}),a.jsxs("ul",{className:"text-blue-700 dark:text-blue-300 space-y-1",children:[a.jsx("li",{children:"\u2022 Automatic duplicate detection using transaction IDs"}),a.jsx("li",{children:"\u2022 Smart account matching based on account numbers"}),a.jsx("li",{children:"\u2022 Preserves transaction reference numbers"}),a.jsx("li",{children:"\u2022 Imports cleared transactions with exact dates"})]})]})]})})]}),w&&!A&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center gap-3 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[a.jsx(n,{className:"text-gray-600 dark:text-gray-400",size:24}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:f?.name}),a.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[w.transactions.length," transactions found"]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Import to Account"}),w.matchedAccount?a.jsx("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(c,{className:"text-green-600 dark:text-green-400 mt-0.5",size:20}),a.jsxs("div",{children:[a.jsxs("p",{className:"font-medium text-green-900 dark:text-green-300",children:["Automatically matched to: ",w.matchedAccount.name]}),a.jsxs("p",{className:"text-sm text-green-800 dark:text-green-200 mt-1",children:["Based on account number ending in ",w.unmatchedAccount?.accountId.slice(-4)]})]})]})}):a.jsxs(a.Fragment,{children:[w.unmatchedAccount&&a.jsx("div",{className:"p-4 mb-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(d,{className:"text-yellow-600 dark:text-yellow-400 mt-0.5",size:20}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-yellow-900 dark:text-yellow-300",children:"No matching account found"}),a.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200 mt-1",children:["OFX Account: ****",w.unmatchedAccount.accountId.slice(-4),w.unmatchedAccount.bankId&&` (Sort code: ${w.unmatchedAccount.bankId.slice(-6)})`]})]})]})}),a.jsxs("select",{value:C,onChange:e=>z(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white",required:!0,children:[a.jsx("option",{value:"",children:"Select an account..."}),p.map(e=>a.jsxs("option",{value:e.id,children:[e.name," (",e.type,")"]},e.id))]})]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",checked:O,onChange:e=>S(e.target.checked),className:"rounded border-gray-300 text-primary focus:ring-primary"}),a.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Skip duplicate transactions"})]}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 ml-6 mt-1",children:"Uses unique transaction IDs to prevent importing the same transaction twice"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[a.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:w.transactions.length}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Transactions"})]}),a.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[a.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:w.duplicates||0}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Duplicates Found"})]})]}),a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsx("button",{onClick:E,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"Cancel"}),a.jsxs(i,{isLoading:N,onClick:async()=>{if(w&&f){v(!0);try{const e=await f.text(),t=await u.importTransactions(e,p,b,{accountId:C||void 0,skipDuplicates:O,categories:y,autoCategorize:!0});for(const a of t.transactions)j(a);I({success:!0,imported:t.newTransactions,duplicates:t.duplicates,account:t.matchedAccount||p.find(e=>e.id===C)})}catch(e){console.error("Import error:",e),I({success:!1,error:e instanceof Error?e.message:"Import failed"})}finally{v(!1)}}},disabled:!C&&!w.matchedAccount,className:"flex items-center gap-2 px-6 py-2 bg-primary text-white rounded-lg hover:bg-secondary disabled:opacity-50",children:[a.jsx(r,{size:20}),"Import Transactions"]})]})]}),A&&a.jsxs("div",{className:"text-center",children:[A.success?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full mb-4",children:a.jsx(o,{size:32,className:"text-green-600 dark:text-green-400"})}),a.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Import Successful!"}),a.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:["Imported ",A.imported," transactions to ",A.account?.name]}),A.duplicates>0&&a.jsxs("p",{className:"text-sm text-yellow-600 dark:text-yellow-400 mb-6",children:["Skipped ",A.duplicates," duplicate transactions"]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full mb-4",children:a.jsx(x,{size:32,className:"text-red-600 dark:text-red-400"})}),a.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Import Failed"}),a.jsx("p",{className:"text-red-600 dark:text-red-400 mb-6",children:A.error})]}),a.jsxs("div",{className:"flex justify-center gap-3",children:[a.jsxs("button",{onClick:E,className:"flex items-center gap-2 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600",children:[a.jsx(m,{size:20}),"Import Another File"]}),a.jsx("button",{onClick:h,className:"px-6 py-2 bg-primary text-white rounded-lg hover:bg-secondary",children:"Done"})]})]})]})})}import{g as t,j as a,M as s,bo as r,b2 as n,ah as l,br as c,cn as d,aw as i,_ as o,ar as x,at as m}from"./index-CgJz7Gw0.js";import{a as g}from"./chunk-BWx9oMeS.js";import{o as u}from"./chunk-BfKHasoP.js";import"./chunk-BN8kgYrt.js";import"./chunk-C1eKK5Oc.js";import"./chunk-CkYa08k9.js";export{e as default};
