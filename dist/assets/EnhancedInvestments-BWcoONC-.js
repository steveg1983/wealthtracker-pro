function e({accountId:e,investmentId:s}){const[a,r]=n.useState([]),[l,d]=n.useState(null),[j,v]=n.useState([]),[f,N]=n.useState(!1),[k,C]=n.useState(null),[w,S]=n.useState("1y"),[D,P]=n.useState(""),{accounts:T}=c(),{currencySymbol:E}=R(),{formatCurrency:F}=A(),M=n.useMemo(()=>{const e=[];return T.forEach(t=>{"investment"===t.type&&t.holdings&&t.holdings.forEach(s=>{e.push({id:`${t.id}-${s.ticker}`,accountId:t.id,symbol:s.ticker,name:s.name,quantity:s.shares,purchasePrice:s.averageCost||0,purchaseDate:new Date,currentPrice:s.currentPrice,currentValue:s.marketValue||s.value,averageCost:s.averageCost||0,createdAt:new Date})})}),e},[T]);n.useEffect(()=>{I()},[e,s,w,D]);const I=()=>{let t;const a=new Date;switch(w){case"ytd":t=new Date(a.getFullYear(),0,1);break;case"1y":t=new Date(a.getFullYear()-1,a.getMonth(),a.getDate());break;case"3y":t=new Date(a.getFullYear()-3,a.getMonth(),a.getDate());break;case"all":t=void 0}const l={accountId:e,investmentId:s,symbol:D||void 0,startDate:t},n=_.getDividends(l);r(n);const i=_.getDividendSummary(t);d(i);const c=M.filter(t=>!e||t.accountId===e).map(e=>({symbol:e.symbol,shares:e.quantity,currentValue:e.currentValue})),o=_.getDividendProjections(c);v(o)},V=Array.from(new Set(M.map(e=>e.symbol))).sort(),B=e=>{confirm("Are you sure you want to delete this dividend record?")&&(_.deleteDividend(e),I())};return i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("select",{value:w,onChange:e=>S(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[i.jsx("option",{value:"ytd",children:"Year to Date"}),i.jsx("option",{value:"1y",children:"Last 12 Months"}),i.jsx("option",{value:"3y",children:"Last 3 Years"}),i.jsx("option",{value:"all",children:"All Time"})]}),i.jsxs("select",{value:D,onChange:e=>P(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[i.jsx("option",{value:"",children:"All Symbols"}),V.map(e=>i.jsx("option",{value:e,children:e},e))]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("button",{onClick:()=>N(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[i.jsx(o,{size:20}),"Add Dividend"]}),i.jsx("button",{onClick:()=>{const e=_.exportToCSV(),t=new Blob([e],{type:"text/csv"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`dividends-${(new Date).toISOString().split("T")[0]}.csv`,a.click(),URL.revokeObjectURL(s)},className:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",title:"Export to CSV",children:i.jsx(m,{size:20})})]})]}),l&&i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[i.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Dividends"}),i.jsx("p",{className:"text-2xl font-bold",children:F(l.totalDividends.toNumber())})]}),i.jsx(x,{size:32,className:"text-green-600"})]})}),i.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Tax Withheld"}),i.jsx("p",{className:"text-2xl font-bold",children:F(l.totalTaxWithheld.toNumber())})]}),i.jsx(g,{size:32,className:"text-orange-600"})]})}),i.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Projected Annual"}),i.jsx("p",{className:"text-2xl font-bold",children:F(l.projectedAnnual.toNumber())})]}),i.jsx(h,{size:32,className:"text-blue-600"})]})}),i.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Unique Stocks"}),i.jsx("p",{className:"text-2xl font-bold",children:Object.keys(l.bySymbol).length})]}),i.jsx(u,{size:32,className:"text-purple-600"})]})})]}),j.length>0&&i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[i.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[i.jsx(b,{size:20}),"Projected Upcoming Dividends"]}),i.jsx("div",{className:"space-y-2",children:j.slice(0,5).map((e,t)=>i.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"font-medium",children:e.symbol}),i.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.nextPaymentDate.toLocaleDateString()}),i.jsxs("span",{className:"text-xs px-2 py-1 rounded "+("high"===e.confidence?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"medium"===e.confidence?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-gray-100 text-gray-700 dark:bg-gray-600 dark:text-gray-300"),children:[e.confidence," confidence"]})]}),i.jsxs("span",{className:"font-semibold text-green-600 dark:text-green-400",children:["+",F(e.estimatedAmount.toNumber())]})]},t))})]}),i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[i.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Dividend History"}),0===a.length?i.jsx("p",{className:"text-center text-gray-500 py-8",children:"No dividend records found"}):i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"sm:hidden space-y-3",children:a.map(e=>i.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[i.jsxs("div",{className:"flex justify-between items-start mb-3",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-gray-900 dark:text-white text-lg",children:e.symbol}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.paymentDate.toLocaleDateString()})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:()=>C(e),className:"min-w-[44px] min-h-[44px] flex items-center justify-center text-blue-600 hover:text-blue-900 dark:text-blue-400",title:"Edit",children:i.jsx(y,{size:20})}),i.jsx("button",{onClick:()=>B(e.id),className:"min-w-[44px] min-h-[44px] flex items-center justify-center text-red-600 hover:text-red-900 dark:text-red-400",title:"Delete",children:i.jsx(p,{size:20})})]})]}),i.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[i.jsx("span",{className:"text-xs px-2 py-1 rounded "+("special"===e.type?"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400":"bg-gray-100 text-gray-700 dark:bg-gray-600 dark:text-gray-300"),children:e.type}),i.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.frequency})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs",children:"Amount"}),i.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:F(e.amount)})]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs",children:"Per Share"}),i.jsxs("span",{className:"text-gray-900 dark:text-white",children:[E,e.amountPerShare.toFixed(4)]})]})]})]},e.id))}),i.jsx("div",{className:"hidden sm:block overflow-x-auto",children:i.jsxs("table",{className:"w-full",children:[i.jsx("thead",{className:"bg-secondary dark:bg-gray-700",children:i.jsxs("tr",{className:"border-b border-[#5A729A] dark:border-gray-600",children:[i.jsx("th",{className:"text-left py-3 px-4 text-white text-sm font-medium",children:"Date"}),i.jsx("th",{className:"text-left py-3 px-4 text-white text-sm font-medium",children:"Symbol"}),i.jsx("th",{className:"text-right py-3 px-4 text-white text-sm font-medium",children:"Amount"}),i.jsx("th",{className:"text-right py-3 px-4 text-white text-sm font-medium",children:"Per Share"}),i.jsx("th",{className:"text-center py-3 px-4 text-white text-sm font-medium",children:"Type"}),i.jsx("th",{className:"text-center py-3 px-4 text-white text-sm font-medium",children:"Frequency"}),i.jsx("th",{className:"text-right py-3 px-4 text-white text-sm font-medium",children:"Actions"})]})}),i.jsx("tbody",{children:a.map(e=>i.jsxs("tr",{className:"border-b dark:border-gray-700",children:[i.jsx("td",{className:"py-3 px-4",children:e.paymentDate.toLocaleDateString()}),i.jsx("td",{className:"py-3 px-4 font-medium",children:e.symbol}),i.jsx("td",{className:"py-3 px-4 text-right",children:F(e.amount)}),i.jsxs("td",{className:"py-3 px-4 text-right text-sm text-gray-600 dark:text-gray-400",children:[E,e.amountPerShare.toFixed(4)]}),i.jsx("td",{className:"py-3 px-4 text-center",children:i.jsx("span",{className:"text-xs px-2 py-1 rounded "+("special"===e.type?"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400":"bg-gray-100 text-gray-700 dark:bg-gray-600 dark:text-gray-300"),children:e.type})}),i.jsx("td",{className:"py-3 px-4 text-center text-sm",children:e.frequency}),i.jsx("td",{className:"py-3 px-4 text-right",children:i.jsxs("div",{className:"flex items-center justify-end gap-1",children:[i.jsx("button",{onClick:()=>C(e),className:"p-1 text-blue-600 hover:bg-blue-50 dark:hover:bg-gray-700 rounded",title:"Edit",children:i.jsx(y,{size:16})}),i.jsx("button",{onClick:()=>B(e.id),className:"p-1 text-red-600 hover:bg-red-50 dark:hover:bg-gray-700 rounded",title:"Delete",children:i.jsx(p,{size:16})})]})})]},e.id))})]})})]})]}),(f||k)&&i.jsx(t,{dividend:k,symbols:V,onSave:k?e=>{if(!k||!e)return;const t={...k,...e};_.updateDividend(t.id,t),I(),C(null)}:async e=>{if(!e.symbol||!e.amount)return;const t=M.find(t=>t.symbol===e.symbol);if(!t)return;const s={investmentId:t.id,accountId:t.accountId,symbol:e.symbol,amount:e.amount,amountPerShare:e.amountPerShare||e.amount/t.quantity,shares:t.quantity,currency:"USD",paymentDate:e.paymentDate||new Date,exDividendDate:e.exDividendDate||new Date,recordDate:e.recordDate,declarationDate:e.declarationDate,frequency:e.frequency||"quarterly",type:e.type||"regular",taxWithheld:e.taxWithheld,reinvested:e.reinvested||!1,reinvestmentPrice:e.reinvestmentPrice,reinvestmentShares:e.reinvestmentShares,notes:e.notes};_.addDividend(s),I(),N(!1)},onClose:()=>{N(!1),C(null)}})]})}function t({dividend:e,symbols:t,onSave:s,onClose:a}){const[r,l]=n.useState({symbol:e?.symbol||"",amount:e?.amount||0,amountPerShare:e?.amountPerShare||0,paymentDate:e?.paymentDate||new Date,exDividendDate:e?.exDividendDate||new Date,recordDate:e?.recordDate,declarationDate:e?.declarationDate,frequency:e?.frequency||"quarterly",type:e?.type||"regular",taxWithheld:e?.taxWithheld||0,reinvested:e?.reinvested||!1,reinvestmentPrice:e?.reinvestmentPrice||0,reinvestmentShares:e?.reinvestmentShares||0,notes:e?.notes||""});return i.jsx(j,{isOpen:!0,onClose:a,title:e?"Edit Dividend":"Add Dividend",children:i.jsxs("form",{onSubmit:t=>{t.preventDefault(),s({...e,...r})},children:[i.jsxs(v,{children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Symbol"}),i.jsxs("select",{value:r.symbol,onChange:e=>l({...r,symbol:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0,children:[i.jsx("option",{value:"",children:"Select symbol"}),t.map(e=>i.jsx("option",{value:e,children:e},e))]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Total Amount"}),i.jsx("input",{type:"number",step:"0.01",value:r.amount,onChange:e=>l({...r,amount:parseFloat(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Payment Date"}),i.jsx("input",{type:"date",value:r.paymentDate.toISOString().split("T")[0],onChange:e=>l({...r,paymentDate:new Date(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ex-Dividend Date"}),i.jsx("input",{type:"date",value:r.exDividendDate.toISOString().split("T")[0],onChange:e=>l({...r,exDividendDate:new Date(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Frequency"}),i.jsxs("select",{value:r.frequency,onChange:e=>l({...r,frequency:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[i.jsx("option",{value:"monthly",children:"Monthly"}),i.jsx("option",{value:"quarterly",children:"Quarterly"}),i.jsx("option",{value:"semi-annual",children:"Semi-Annual"}),i.jsx("option",{value:"annual",children:"Annual"}),i.jsx("option",{value:"special",children:"Special"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Type"}),i.jsxs("select",{value:r.type,onChange:e=>l({...r,type:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[i.jsx("option",{value:"regular",children:"Regular"}),i.jsx("option",{value:"special",children:"Special"}),i.jsx("option",{value:"qualified",children:"Qualified"}),i.jsx("option",{value:"non-qualified",children:"Non-Qualified"}),i.jsx("option",{value:"return-of-capital",children:"Return of Capital"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tax Withheld"}),i.jsx("input",{type:"number",step:"0.01",value:r.taxWithheld,onChange:e=>l({...r,taxWithheld:parseFloat(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700"})]}),i.jsx("div",{className:"flex items-center",children:i.jsxs("label",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"checkbox",checked:r.reinvested,onChange:e=>l({...r,reinvested:e.target.checked}),className:"rounded"}),i.jsx("span",{className:"text-sm font-medium",children:"Reinvested"})]})})]}),i.jsxs("div",{className:"mt-4",children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Notes"}),i.jsx("textarea",{value:r.notes,onChange:e=>l({...r,notes:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",rows:2})]})]}),i.jsxs(f,{children:[i.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100",children:"Cancel"}),i.jsxs("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e?"Update":"Add"," Dividend"]})]})]})})}function s({accountId:e}){const[t,s]=n.useState([]),[r,l]=n.useState([]),[d,o]=n.useState([]),[m,x]=n.useState(null),[h,u]=n.useState(!1),[b,p]=n.useState(null),[j,v]=n.useState(!1),[f,S]=n.useState(0),[D,P]=n.useState(!0),{accounts:T}=c();R();const{formatCurrency:E}=A(),F=n.useMemo(()=>{const e=[];return T.forEach(t=>{"investment"===t.type&&t.holdings&&t.holdings.forEach(s=>{e.push({id:`${t.id}-${s.ticker}`,accountId:t.id,symbol:s.ticker,name:s.name,quantity:s.shares,purchasePrice:s.averageCost||0,purchaseDate:new Date,currentPrice:s.currentPrice,currentValue:s.marketValue||s.value,averageCost:s.averageCost||0,createdAt:new Date})})}),e},[T]);n.useEffect(()=>{M()},[e,F]);const M=()=>{const t=F.filter(t=>!e||t.accountId===e).map(e=>({symbol:e.symbol,name:e.name,shares:e.quantity,value:e.currentValue,price:e.currentPrice||e.currentValue/e.quantity}));if(0===t.length)return;const a=X.calculateCurrentAllocation(t);s(a);const r=X.getPortfolioTargets();o(r);const n=X.getActiveTarget();x(n);const i=X.isRebalancingNeeded(a);if(v(i),i&&n){const e=X.calculateRebalanceActions(t,f,D);l(e)}else l([])},L=t.map(e=>({name:e.assetClass,value:e.currentValue.toNumber(),percent:e.currentPercent})),O=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#6B7280"];return i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("h2",{className:"text-xl font-semibold",children:"Portfolio Rebalancing"}),j&&i.jsxs("span",{className:"flex items-center gap-1 px-3 py-1 bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400 rounded-full text-sm",children:[i.jsx(g,{size:16}),"Rebalancing Recommended"]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("button",{onClick:()=>u(!0),className:"flex items-center gap-2 px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100",children:[i.jsx(N,{size:20}),"Manage Targets"]}),i.jsx("button",{onClick:M,className:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",title:"Refresh",children:i.jsx(k,{size:20})})]})]}),m&&i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h3",{className:"text-lg font-semibold",children:m.name}),i.jsx("button",{onClick:()=>{p(m),u(!0)},className:"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-gray-700 rounded-lg",children:i.jsx(y,{size:20})})]}),m.description&&i.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:m.description}),i.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:m.allocations.map(e=>i.jsxs("div",{children:[i.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[e.assetClass,":"]}),i.jsxs("span",{className:"ml-2 font-medium",children:[e.targetPercent,"%"]})]},e.assetClass))}),m.lastRebalanced&&i.jsxs("p",{className:"text-xs text-gray-500 mt-4",children:["Last rebalanced: ",m.lastRebalanced.toLocaleDateString()]})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[i.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Current Allocation"}),L.length>0?i.jsx(I,{width:"100%",height:300,children:i.jsxs(V,{children:[i.jsx(B,{data:L,cx:"50%",cy:"50%",outerRadius:100,fill:"#8884d8",dataKey:"value",label:({name:e,percent:t})=>`${e} ${(t??0).toFixed(1)}%`,children:L.map((e,t)=>i.jsx(q,{fill:O[t%O.length]},`cell-${t}`))}),i.jsx(U,{formatter:e=>E(e)})]})}):i.jsx("p",{className:"text-center text-gray-500 py-8",children:"No holdings to display"})]}),i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[i.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Allocation Details"}),i.jsx("div",{className:"space-y-2",children:t.map((e,t)=>i.jsxs("div",{className:"border-b dark:border-gray-700 pb-2",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:O[t%O.length]}}),i.jsx("span",{className:"font-medium",children:e.assetClass})]}),i.jsx("span",{className:"font-medium",children:E(e.currentValue.toNumber())})]}),i.jsxs("div",{className:"flex items-center justify-between mt-1 text-sm",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Current: ",e.currentPercent.toFixed(1),"%"]}),i.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Target: ",e.targetPercent.toFixed(1),"%"]})]}),i.jsxs("span",{className:"font-medium "+(Math.abs(e.differencePercent)<2?"text-green-600":Math.abs(e.differencePercent)<5?"text-yellow-600":"text-red-600"),children:[e.differencePercent>0?"+":"",e.differencePercent.toFixed(1),"%"]})]})]},e.assetClass))})]})]}),r.length>0&&i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h3",{className:"text-lg font-semibold",children:"Rebalancing Actions"}),i.jsxs("button",{onClick:()=>{m&&(alert("Rebalancing actions have been generated. Review and execute them through your broker."),X.markRebalanced(m.id),M())},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[i.jsx(C,{size:20}),"Mark as Rebalanced"]})]}),i.jsxs("div",{className:"mb-4 flex items-center gap-4",children:[i.jsxs("label",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"number",step:"100",value:f,onChange:e=>S(parseFloat(e.target.value)||0),className:"w-32 px-3 py-1 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700",placeholder:"0"}),i.jsx("span",{className:"text-sm",children:"Cash Available"})]}),i.jsxs("label",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"checkbox",checked:D,onChange:e=>P(e.target.checked),className:"rounded"}),i.jsx("span",{className:"text-sm",children:"Consider Tax Implications"})]})]}),i.jsx("div",{className:"sm:hidden space-y-3",children:r.map((e,t)=>i.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[i.jsxs("div",{className:"flex justify-between items-start mb-3",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-sm font-bold "+("buy"===e.action?"text-green-600":"text-red-600"),children:e.action.toUpperCase()}),i.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:e.symbol})]}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.name}),i.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:e.assetClass})]}),i.jsxs("span",{className:"text-xs px-2 py-1 rounded "+(e.priority<=2?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":3===e.priority?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-gray-100 text-gray-700 dark:bg-gray-600 dark:text-gray-300"),children:["Priority ",e.priority]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs",children:"Shares"}),i.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:e.shares.toFixed(2)})]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs",children:"Amount"}),i.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:E(e.amount.toNumber())})]})]})]},t))}),i.jsx("div",{className:"hidden sm:block overflow-x-auto",children:i.jsxs("table",{className:"w-full",children:[i.jsx("thead",{className:"bg-secondary dark:bg-gray-700",children:i.jsxs("tr",{className:"border-b border-[#5A729A] dark:border-gray-600",children:[i.jsx("th",{className:"text-left py-3 px-4 text-white text-sm font-medium",children:"Action"}),i.jsx("th",{className:"text-left py-3 px-4 text-white text-sm font-medium",children:"Symbol"}),i.jsx("th",{className:"text-left py-3 px-4 text-white text-sm font-medium",children:"Asset Class"}),i.jsx("th",{className:"text-right py-3 px-4 text-white text-sm font-medium",children:"Shares"}),i.jsx("th",{className:"text-right py-3 px-4 text-white text-sm font-medium",children:"Amount"}),i.jsx("th",{className:"text-center py-3 px-4 text-white text-sm font-medium",children:"Priority"})]})}),i.jsx("tbody",{children:r.map((e,t)=>i.jsxs("tr",{className:"border-b dark:border-gray-700",children:[i.jsx("td",{className:"py-3 px-4",children:i.jsx("span",{className:"text-sm font-medium "+("buy"===e.action?"text-green-600":"text-red-600"),children:e.action.toUpperCase()})}),i.jsx("td",{className:"py-3 px-4",children:i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:e.symbol}),i.jsx("div",{className:"text-xs text-gray-500",children:e.name})]})}),i.jsx("td",{className:"py-3 px-4 text-sm",children:e.assetClass}),i.jsx("td",{className:"py-3 px-4 text-right",children:e.shares.toFixed(2)}),i.jsx("td",{className:"py-3 px-4 text-right",children:E(e.amount.toNumber())}),i.jsx("td",{className:"py-3 px-4 text-center",children:i.jsxs("span",{className:"text-xs px-2 py-1 rounded "+(e.priority<=2?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":3===e.priority?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-gray-100 text-gray-700 dark:bg-gray-600 dark:text-gray-300"),children:["P",e.priority]})})]},t))})]})}),i.jsx("div",{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx(w,{size:20,className:"text-blue-600 mt-0.5"}),i.jsxs("div",{className:"text-sm text-blue-800 dark:text-blue-300",children:[i.jsx("p",{className:"font-medium mb-1",children:"How to execute:"}),i.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[i.jsx("li",{children:"Review the suggested actions above"}),i.jsx("li",{children:"Place orders through your broker"}),i.jsx("li",{children:'Once complete, click "Mark as Rebalanced"'})]})]})]})})]}),h&&i.jsx(a,{targets:d,editingTarget:b,onSave:e=>{const t=X.savePortfolioTarget({...e,id:b?.id,isActive:!0,allocations:e.allocations||[]});t.isActive&&d.forEach(e=>{e.id!==t.id&&e.isActive&&X.savePortfolioTarget({...e,isActive:!1})}),M(),u(!1),p(null)},onDelete:e=>{confirm("Are you sure you want to delete this portfolio target?")&&(X.deletePortfolioTarget(e),M())},onSetActive:e=>{d.forEach(e=>{X.savePortfolioTarget({...e,isActive:!1})}),X.savePortfolioTarget({...e,isActive:!0}),M()},onUseTemplate:e=>{p({...e,id:void 0,name:`${e.name} (Copy)`,isActive:!0}),u(!0)},onClose:()=>{u(!1),p(null)}})]})}function a({targets:e,editingTarget:t,onSave:s,onDelete:a,onSetActive:r,onUseTemplate:l,onClose:d}){const[c,m]=n.useState("targets"),[x,g]=n.useState(t||{name:"",description:"",allocations:[],rebalanceThreshold:5});n.useEffect(()=>{t&&(g(t),m("edit"))},[t]);const h=X.getPortfolioTemplates(),u=(e,t,s)=>{const a=[...x.allocations||[]];a[e]={...a[e],[t]:s},g({...x,allocations:a})};return i.jsx(j,{isOpen:!0,onClose:d,title:"Portfolio Targets",size:"lg",children:i.jsxs(v,{children:[i.jsxs("div",{className:"flex gap-4 mb-6 border-b dark:border-gray-700",children:[i.jsx("button",{onClick:()=>m("targets"),className:"pb-2 px-1 "+("targets"===c?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 dark:text-gray-400"),children:"My Targets"}),i.jsx("button",{onClick:()=>m("templates"),className:"pb-2 px-1 "+("templates"===c?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 dark:text-gray-400"),children:"Templates"}),i.jsxs("button",{onClick:()=>m("edit"),className:"pb-2 px-1 "+("edit"===c?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 dark:text-gray-400"),children:[t?"Edit":"Create"," Target"]})]}),"targets"===c&&i.jsx("div",{className:"space-y-4",children:0===e.length?i.jsx("p",{className:"text-center text-gray-500 py-8",children:"No portfolio targets created yet"}):e.map(e=>i.jsx("div",{className:"border dark:border-gray-700 rounded-lg p-4",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("h4",{className:"font-medium",children:e.name}),e.isActive&&i.jsx("span",{className:"text-xs px-2 py-1 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 rounded",children:"Active"})]}),e.description&&i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.description}),i.jsx("div",{className:"flex flex-wrap gap-4 mt-2 text-sm",children:e.allocations.map(e=>i.jsxs("span",{children:[e.assetClass,": ",e.targetPercent,"%"]},e.assetClass))})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[!e.isActive&&i.jsx("button",{onClick:()=>r(e),className:"text-sm text-blue-600 hover:text-blue-700",children:"Set Active"}),i.jsx("button",{onClick:()=>{g(e),m("edit")},className:"p-1 text-gray-600 hover:text-gray-900",children:i.jsx(y,{size:16})}),i.jsx("button",{onClick:()=>a(e.id),className:"p-1 text-red-600 hover:text-red-700",children:i.jsx(p,{size:16})})]})]})},e.id))}),"templates"===c&&i.jsx("div",{className:"space-y-4",children:h.map(e=>i.jsx("div",{className:"border dark:border-gray-700 rounded-lg p-4",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("h4",{className:"font-medium",children:e.name}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.description}),i.jsx("div",{className:"flex flex-wrap gap-4 mt-2 text-sm",children:e.allocations.map(e=>i.jsxs("span",{children:[e.assetClass,": ",e.targetPercent,"%"]},e.assetClass))})]}),i.jsx("button",{onClick:()=>l(e),className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700",children:"Use Template"})]})},e.id))}),"edit"===c&&i.jsxs("form",{onSubmit:e=>{e.preventDefault();const t=x.allocations?.reduce((e,t)=>e+t.targetPercent,0)||0;Math.abs(t-100)>.01?alert("Target allocations must sum to 100%"):s(x)},children:[i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Name"}),i.jsx("input",{type:"text",value:x.name,onChange:e=>g({...x,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),i.jsx("textarea",{value:x.description||"",onChange:e=>g({...x,description:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",rows:2})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Rebalance Threshold (%)"}),i.jsx("input",{type:"number",step:"0.5",value:x.rebalanceThreshold||5,onChange:e=>g({...x,rebalanceThreshold:parseFloat(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700"})]}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("label",{className:"text-sm font-medium",children:"Asset Allocations"}),i.jsxs("button",{type:"button",onClick:()=>{g({...x,allocations:[...x.allocations||[],{assetClass:"",targetPercent:0}]})},className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-700",children:[i.jsx(o,{size:16}),"Add Asset Class"]})]}),i.jsx("div",{className:"space-y-2",children:x.allocations?.map((e,t)=>i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"text",value:e.assetClass,onChange:e=>u(t,"assetClass",e.target.value),placeholder:"Asset Class",className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0}),i.jsx("input",{type:"number",step:"0.1",value:e.targetPercent,onChange:e=>u(t,"targetPercent",parseFloat(e.target.value)),placeholder:"0",className:"w-24 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0}),i.jsx("span",{className:"text-sm",children:"%"}),i.jsx("button",{type:"button",onClick:()=>(e=>{const t=[...x.allocations||[]];t.splice(e,1),g({...x,allocations:t})})(t),className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-gray-700 rounded",children:i.jsx(p,{size:16})})]},t))}),x.allocations&&x.allocations.length>0&&i.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:["Total: ",x.allocations.reduce((e,t)=>e+t.targetPercent,0).toFixed(1),"%"]})]})]}),i.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[i.jsx("button",{type:"button",onClick:d,className:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100",children:"Cancel"}),i.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Save Target"})]})]})]})})}function r({accountId:e}){const[t,s]=n.useState([]),[a,r]=n.useState("pie"),[l,d]=n.useState("assetClass"),[o,x]=n.useState(!0),{accounts:g}=c(),{formatCurrency:b}=A();R();const y=n.useMemo(()=>{const e=[];return g.forEach(t=>{"investment"===t.type&&t.holdings&&t.holdings.forEach(s=>{e.push({id:`${t.id}-${s.ticker}`,accountId:t.id,symbol:s.ticker,name:s.name,quantity:s.shares,purchasePrice:s.averageCost||0,purchaseDate:new Date,currentPrice:s.currentPrice,currentValue:s.marketValue||s.value,averageCost:s.averageCost||0,createdAt:new Date})})}),e},[g]);n.useEffect(()=>{p()},[e,y,l]);const p=()=>{if("assetClass"===l){const t=y.filter(t=>!e||t.accountId===e).map(e=>({symbol:e.symbol,value:e.currentValue,shares:e.quantity})),a=X.calculateCurrentAllocation(t);s(a)}else if("account"===l){const e={},t=y.reduce((e,t)=>e+t.currentValue,0);y.forEach(t=>{const s=g.find(e=>e.id===t.accountId),a=s?.name||"Unknown";e[a]=(e[a]||0)+t.currentValue});const a=Object.entries(e).map(([e,s])=>({assetClass:e,currentPercent:s/t*100,currentValue:{toNumber:()=>s},targetPercent:0,targetValue:{toNumber:()=>0},difference:{toNumber:()=>0},differencePercent:0}));s(a)}else{const e={},t=y.reduce((e,t)=>e+t.currentValue,0);y.forEach(t=>{e[t.symbol]||(e[t.symbol]={value:0,name:t.name}),e[t.symbol].value+=t.currentValue});const a=Object.entries(e).map(([e,s])=>({assetClass:`${e} - ${s.name}`,currentPercent:s.value/t*100,currentValue:{toNumber:()=>s.value},targetPercent:0,targetValue:{toNumber:()=>0},difference:{toNumber:()=>0},differencePercent:0}));s(a.sort((e,t)=>t.currentPercent-e.currentPercent))}},j=t.map(e=>({name:e.assetClass,value:e.currentValue.toNumber(),percent:e.currentPercent,target:e.targetPercent})),v=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#6B7280","#14B8A6","#F97316","#6366F1"],f=t.reduce((e,t)=>e+t.currentValue.toNumber(),0);return i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("select",{value:l,onChange:e=>d(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[i.jsx("option",{value:"assetClass",children:"By Asset Class"}),i.jsx("option",{value:"account",children:"By Account"}),i.jsx("option",{value:"symbol",children:"By Symbol"})]}),i.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-600",children:[i.jsx("button",{onClick:()=>r("pie"),className:"px-3 py-1.5 rounded-l-lg transition-colors "+("pie"===a?"bg-blue-600 text-white":"text-gray-600 dark:text-gray-400"),title:"Pie Chart",children:i.jsx(u,{size:20})}),i.jsx("button",{onClick:()=>r("bar"),className:"px-3 py-1.5 transition-colors "+("bar"===a?"bg-blue-600 text-white":"text-gray-600 dark:text-gray-400"),title:"Bar Chart",children:i.jsx(S,{size:20})}),i.jsx("button",{onClick:()=>r("treemap"),className:"px-3 py-1.5 rounded-r-lg transition-colors "+("treemap"===a?"bg-blue-600 text-white":"text-gray-600 dark:text-gray-400"),title:"Treemap",children:i.jsx(h,{size:20})})]}),"assetClass"===l&&i.jsxs("label",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"checkbox",checked:o,onChange:e=>x(e.target.checked),className:"rounded"}),i.jsx("span",{className:"text-sm",children:"Show Targets"})]})]}),i.jsxs("button",{onClick:()=>{const e=t.map(e=>({Category:e.assetClass,"Current %":e.currentPercent.toFixed(2),"Current Value":e.currentValue.toNumber().toFixed(2),"Target %":e.targetPercent.toFixed(2),"Difference %":e.differencePercent.toFixed(2)})),s=[Object.keys(e[0]).join(","),...e.map(e=>Object.values(e).join(","))].join("\n"),a=new Blob([s],{type:"text/csv"}),r=URL.createObjectURL(a),l=document.createElement("a");l.href=r,l.download=`allocation-analysis-${(new Date).toISOString().split("T")[0]}.csv`,l.click(),URL.revokeObjectURL(r)},className:"flex items-center gap-2 px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100",children:[i.jsx(m,{size:20}),"Export"]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[i.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Value"}),i.jsx("p",{className:"text-2xl font-bold",children:b(f)})]}),i.jsx(u,{size:32,className:"text-blue-600"})]})}),i.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Categories"}),i.jsx("p",{className:"text-2xl font-bold",children:t.length})]}),i.jsx(N,{size:32,className:"text-green-600"})]})}),i.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:i.jsx("div",{className:"flex items-center justify-between",children:i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Largest Holding"}),i.jsx("p",{className:"text-lg font-bold",children:t[0]?.assetClass||"N/A"}),i.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[t[0]?.currentPercent?.toFixed(1)??"0.0","%"]})]})})}),i.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:i.jsx("div",{className:"flex items-center justify-between",children:i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Concentration"}),i.jsxs("p",{className:"text-lg font-bold",children:["Top 3: ",t.slice(0,3).reduce((e,t)=>e+t.currentPercent,0).toFixed(1),"%"]})]})})})]}),i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[i.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Allocation Visualization"}),"pie"===a&&i.jsx(I,{width:"100%",height:400,children:i.jsxs(V,{children:[i.jsx(B,{data:j,cx:"50%",cy:"50%",outerRadius:120,fill:"#8884d8",dataKey:"value",label:({name:e,percent:t})=>`${e}: ${void 0!==t?t.toFixed(1):"0.0"}%`,children:j.map((e,t)=>i.jsx(q,{fill:v[t%v.length]},`cell-${t}`))}),i.jsx(U,{formatter:e=>b(e)})]})}),"bar"===a&&i.jsx(I,{width:"100%",height:400,children:i.jsxs(L,{data:j,margin:{left:50,right:20,top:20,bottom:50},children:[i.jsx(O,{strokeDasharray:"3 3"}),i.jsx(z,{dataKey:"name",angle:-45,textAnchor:"end",height:100}),i.jsx($,{}),i.jsx(U,{formatter:e=>b(e)}),i.jsx(Y,{}),i.jsx(W,{dataKey:"percent",fill:"#3B82F6",name:"Current %"}),o&&"assetClass"===l&&i.jsx(W,{dataKey:"target",fill:"#10B981",name:"Target %"})]})}),"treemap"===a&&i.jsx(I,{width:"100%",height:400,children:i.jsx(G,{data:j,dataKey:"value",aspectRatio:4/3,stroke:"#fff",fill:"#3B82F6",children:i.jsx(U,{content:({active:e,payload:t})=>{if(e&&t&&t[0]){const e=t[0].payload;return i.jsxs("div",{className:"bg-white dark:bg-gray-800 p-2 border border-gray-300 dark:border-gray-600 rounded shadow",children:[i.jsx("p",{className:"font-medium",children:e.name}),i.jsx("p",{className:"text-sm",children:b(e.value)}),i.jsxs("p",{className:"text-sm",children:[void 0!==e.percent?e.percent.toFixed(1):"0.0","%"]})]})}return null}})})})]}),i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[i.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Allocation Details"}),i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"w-full",children:[i.jsx("thead",{children:i.jsxs("tr",{className:"border-b dark:border-gray-700",children:[i.jsx("th",{className:"text-left py-2",children:"Category"}),i.jsx("th",{className:"text-right py-2",children:"Current %"}),i.jsx("th",{className:"text-right py-2",children:"Value"}),o&&"assetClass"===l&&i.jsxs(i.Fragment,{children:[i.jsx("th",{className:"text-right py-2",children:"Target %"}),i.jsx("th",{className:"text-right py-2",children:"Difference"})]})]})}),i.jsx("tbody",{children:t.map((e,t)=>i.jsxs("tr",{className:"border-b dark:border-gray-700",children:[i.jsx("td",{className:"py-2",children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:v[t%v.length]}}),i.jsx("span",{children:e.assetClass})]})}),i.jsxs("td",{className:"py-2 text-right font-medium",children:[e.currentPercent.toFixed(2),"%"]}),i.jsx("td",{className:"py-2 text-right",children:b(e.currentValue.toNumber())}),o&&"assetClass"===l&&i.jsxs(i.Fragment,{children:[i.jsxs("td",{className:"py-2 text-right",children:[e.targetPercent.toFixed(2),"%"]}),i.jsxs("td",{className:"py-2 text-right font-medium "+(Math.abs(e.differencePercent)<2?"text-green-600":Math.abs(e.differencePercent)<5?"text-yellow-600":"text-red-600"),children:[e.differencePercent>0?"+":"",e.differencePercent.toFixed(2),"%"]})]})]},t))})]})})]}),i.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-6",children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(w,{size:24,className:"text-blue-600 dark:text-blue-400 mt-0.5"}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"Allocation Insights"}),i.jsx("ul",{className:"space-y-2 text-sm text-blue-800 dark:text-blue-200",children:t.length>0&&i.jsxs(i.Fragment,{children:[i.jsxs("li",{children:["\u2022 Your portfolio is spread across ",t.length," different ","assetClass"===l?"asset classes":"account"===l?"accounts":"securities"]}),i.jsxs("li",{children:["\u2022 The top holding (",t[0].assetClass,") represents ",t[0].currentPercent.toFixed(1),"% of your portfolio"]}),t[0].currentPercent>30&&i.jsx("li",{className:"text-orange-700 dark:text-orange-400",children:"\u2022 Consider diversifying - your largest position exceeds 30% of the portfolio"}),"assetClass"===l&&t.some(e=>Math.abs(e.differencePercent)>5)&&i.jsx("li",{className:"text-orange-700 dark:text-orange-400",children:"\u2022 Some asset classes are significantly off target - consider rebalancing"}),t.filter(e=>e.currentPercent<5).length>5&&i.jsxs("li",{children:["\u2022 You have ",t.filter(e=>e.currentPercent<5).length," positions under 5% - consider consolidating small holdings"]})]})})]})]})})]})}function l(){const{investments:t=[],transactions:a}=c(),{formatCurrency:l}=A(),[d,o]=n.useState("allocation-analysis"),[m,g]=n.useState([]),[b,y]=n.useState(null),[p,j]=n.useState([]),[v,f]=n.useState([]),[C,T]=n.useState(null),[E,F]=n.useState([]);n.useEffect(()=>{t&&t.length>0&&(g(H.getRebalancingSuggestions(t)),y(H.calculateRiskMetrics(t)),j(H.trackDividends(t,a)),f(H.getESGScores(t)),T(H.compareWithBenchmarks(t)),F(H.generateInsights(t,a)))},[t,a]);const M=[{id:"allocation-analysis",label:"Allocation Analysis",icon:u},{id:"portfolio-rebalancer",label:"Portfolio Rebalancer",icon:N},{id:"dividend-tracker",label:"Dividend Tracker",icon:x},{id:"rebalancing",label:"Quick Suggestions",icon:k},{id:"risk",label:"Risk Analysis",icon:D},{id:"benchmarks",label:"Benchmarks",icon:S},{id:"esg",label:"ESG Scores",icon:P}];return i.jsx(K,{title:"Investment Analytics",children:i.jsxs("div",{className:"max-w-7xl mx-auto",children:[i.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 dark:from-purple-800 dark:to-indigo-800 rounded-2xl p-6 mb-6 text-white shadow-lg",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Enhanced Investment Analytics"}),i.jsx("p",{className:"text-purple-100",children:"Advanced tools for portfolio optimization and analysis"})]}),i.jsx(h,{size:48,className:"text-white/80"})]})}),E.length>0&&i.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mb-6",children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(w,{size:20,className:"text-blue-600 dark:text-blue-400 mt-0.5"}),i.jsx("div",{className:"space-y-2",children:E.map((e,t)=>i.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:e},t))})]})}),i.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm mb-6",children:i.jsx("div",{className:"flex overflow-x-auto scrollbar-hide border-b border-gray-200 dark:border-gray-700",children:M.map(e=>{const t=e.icon;return i.jsxs("button",{onClick:()=>o(e.id),className:"flex items-center gap-2 px-6 py-3 font-medium text-sm whitespace-nowrap transition-colors "+(d===e.id?"text-[var(--color-primary)] border-b-2 border-[var(--color-primary)]":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:[i.jsx(t,{size:16}),e.label]},e.id)})})}),i.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-6",children:["allocation-analysis"===d&&i.jsx(r,{}),"portfolio-rebalancer"===d&&i.jsx(s,{}),"dividend-tracker"===d&&i.jsx(e,{}),"rebalancing"===d&&i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[i.jsx("h3",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"Portfolio Rebalancing"}),i.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-200",children:"Keep your portfolio aligned with your target asset allocation."})]}),0===m.length?i.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[i.jsx(N,{size:48,className:"mx-auto mb-4 opacity-50"}),i.jsx("p",{children:"Your portfolio is well-balanced!"})]}):i.jsx("div",{className:"space-y-4",children:m.map((e,t)=>i.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("span",{className:"px-2 py-1 rounded text-xs font-semibold "+("buy"===e.action?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"),children:e.action.toUpperCase()}),i.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:e.name})]}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:e.reason}),i.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[i.jsxs("span",{className:"text-gray-700 dark:text-gray-300",children:["Amount: ",i.jsx("strong",{children:l(e.amount)})]}),i.jsxs("span",{className:"text-gray-700 dark:text-gray-300",children:["Shares: ",i.jsx("strong",{children:e.shares})]})]})]}),i.jsx("button",{className:"px-4 py-2 bg-[var(--color-primary)] text-white rounded-lg hover:bg-[var(--color-primary)]/90 text-sm",children:"Execute"})]})},t))})]}),"risk"===d&&i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[i.jsx("h3",{className:"font-semibold text-purple-900 dark:text-purple-100 mb-2",children:"Risk Analysis"}),i.jsx("p",{className:"text-sm text-purple-700 dark:text-purple-200",children:"Understanding your portfolio's risk profile and diversification."})]}),b&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4",children:[i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Portfolio Beta"}),i.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:b.portfolioBeta.toFixed(2)}),i.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:b.portfolioBeta>1?"More volatile than market":"Less volatile than market"})]}),i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4",children:[i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Sharpe Ratio"}),i.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:b.sharpeRatio.toFixed(2)}),i.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"Risk-adjusted returns"})]}),i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4",children:[i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Volatility"}),i.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[b.standardDeviation.toFixed(1),"%"]}),i.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"Annual standard deviation"})]}),i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4",children:[i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Diversification Score"}),i.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:b.diversificationScore}),i.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mt-2",children:i.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${b.diversificationScore}%`}})})]})]}),b.concentrationRisk.length>0&&i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4",children:[i.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Concentration Risk"}),i.jsx("div",{className:"space-y-2",children:b.concentrationRisk.map((e,t)=>i.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700/50 rounded",children:[i.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:e.symbol}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[e.percent.toFixed(1),"%"]}),i.jsx("span",{className:"px-2 py-1 rounded text-xs font-semibold "+("high"===e.risk?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400":"medium"===e.risk?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400"),children:e.risk.toUpperCase()})]})]},t))})]})]})]}),"benchmarks"===d&&i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4",children:[i.jsx("h3",{className:"font-semibold text-orange-900 dark:text-orange-100 mb-2",children:"Benchmark Comparison"}),i.jsx("p",{className:"text-sm text-orange-700 dark:text-orange-200",children:"Compare your portfolio performance against market indices."})]}),C&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6",children:[i.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Portfolio Performance"}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Return"}),i.jsxs("p",{className:"text-2xl font-bold "+(C.portfolio.return>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[C.portfolio.return>=0?"+":"",C.portfolio.return.toFixed(2),"%"]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Annualized"}),i.jsxs("p",{className:"text-2xl font-bold "+(C.portfolio.annualizedReturn>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[C.portfolio.annualizedReturn>=0?"+":"",C.portfolio.annualizedReturn.toFixed(2),"%"]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Current Value"}),i.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:l(C.portfolio.totalValue)})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Start Value"}),i.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:l(C.portfolio.startValue)})]})]})]}),i.jsx("div",{className:"space-y-3",children:C.benchmarks.map((e,t)=>i.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:e.name}),i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.symbol})]}),i.jsxs("div",{className:"text-right",children:[i.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[e.annualizedReturn.toFixed(2),"%"]}),i.jsxs("p",{className:"text-sm font-medium "+(e.outperformance>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[e.outperformance>=0?"Outperforming":"Underperforming"," by ",Math.abs(e.outperformance).toFixed(2),"%"]})]})]})},t))})]})]}),"esg"===d&&i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"bg-teal-50 dark:bg-teal-900/20 rounded-lg p-4",children:[i.jsx("h3",{className:"font-semibold text-teal-900 dark:text-teal-100 mb-2",children:"ESG Scoring"}),i.jsx("p",{className:"text-sm text-teal-700 dark:text-teal-200",children:"Environmental, Social, and Governance ratings for your investments."})]}),0===v.length?i.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[i.jsx(P,{size:48,className:"mx-auto mb-4 opacity-50"}),i.jsx("p",{children:"No ESG data available"})]}):i.jsx("div",{className:"space-y-4",children:v.map((e,t)=>i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4",children:[i.jsxs("div",{className:"flex items-start justify-between mb-4",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:e.name}),i.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.symbol})]}),i.jsx("div",{className:"px-3 py-1 rounded-lg text-sm font-semibold "+("AAA"===e.rating||"AA"===e.rating?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"A"===e.rating||"BBB"===e.rating?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"),children:e.rating})]}),i.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Environmental"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:i.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${e.environmental}%`}})}),i.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:e.environmental})]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Social"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:i.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${e.social}%`}})}),i.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:e.social})]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Governance"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:i.jsx("div",{className:"bg-purple-500 h-2 rounded-full",style:{width:`${e.governance}%`}})}),i.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:e.governance})]})]})]}),e.controversies.length>0&&i.jsx("div",{className:"mt-3 p-2 bg-red-50 dark:bg-red-900/20 rounded",children:i.jsxs("p",{className:"text-xs text-red-700 dark:text-red-300",children:["\u26a0\ufe0f ",e.controversies.join(", ")]})})]},t))})]})]})]})})}import{r as n,L as i}from"./chunk-Bcp2Zi4E.js";import{t as d,a as c,$ as o,ay as m,ak as x,aa as g,T as h,q as u,C as b,E as y,D as p,M as j,d as v,e as f,au as N,ac as k,v as C,a0 as w,B as S,S as D,bl as P}from"./index-LbveD3Go.js";import{u as A}from"./chunk-BlSolNAr.js";import{e as T,E,a as F,v as M}from"./chunk-CpxUZIWP.js";import{u as R}from"./chunk-McDmceUv.js";import{R as I,P as V,a as B,C as q,T as U,B as L,b as O,X as z,Y as $,L as Y,c as W,d as G}from"./chunk-SCqr5tpD.js";import{P as K}from"./chunk-zHRn0GaW.js";import"./chunk-oUGr0aFc.js";import"./chunk-a7oqB5tI.js";import"./chunk-B5pcS96K.js";const J={"US Stocks":40,"International Stocks":20,Bonds:25,"Real Estate":10,Commodities:5},Q=[{name:"S&P 500",symbol:"SPY",annualReturn:10.5},{name:"FTSE All-World",symbol:"VT",annualReturn:8.2},{name:"US Total Bond",symbol:"BND",annualReturn:3.5},{name:"60/40 Portfolio",symbol:"BALANCED",annualReturn:7.8}],H=new class{getRebalancingSuggestions(e,t=J){const s=[],a=this.calculateTotalPortfolioValue(e);if(a.isZero())return s;const r=this.calculateCurrentAllocations(e);return Object.entries(t).forEach(([t,l])=>{const n=r[t]||0,i=l-n;if(Math.abs(i)>5){const r=a.times(l).dividedBy(100),c=a.times(n).dividedBy(100),o=r.minus(c),m=e.filter(e=>this.getInvestmentCategory(e)===t);if(i>0)s.push({symbol:t,name:`${t} ETF`,action:"buy",amount:o.abs(),shares:Math.ceil(o.abs().dividedBy(d(100)).toNumber()),reason:`Underweight in ${t} by ${Math.abs(i).toFixed(1)}%`});else if(m.length>0){const e=m.reduce((e,t)=>d(e.currentValue).greaterThan(d(t.currentValue))?e:t);s.push({symbol:e.symbol,name:e.name,action:"sell",amount:o.abs(),shares:Math.ceil(o.abs().dividedBy(d(e.currentPrice||100)).toNumber()),reason:`Overweight in ${t} by ${Math.abs(i).toFixed(1)}%`})}}}),s}calculateRiskMetrics(e){const t=this.calculateTotalPortfolioValue(e),s=[];return e.forEach(e=>{const a=d(e.currentValue).dividedBy(t).times(100).toNumber();a>5&&s.push({symbol:e.symbol,percent:a,risk:a>20?"high":a>10?"medium":"low"})}),{portfolioBeta:1.05,sharpeRatio:.85,standardDeviation:12.5,diversificationScore:Math.min(100,10*e.length),concentrationRisk:s.sort((e,t)=>t.percent-e.percent)}}trackDividends(e,t){const s=[];return e.forEach(e=>{const a=t.filter(t=>"income"===t.type&&"investment-income"===t.category&&t.description.toLowerCase().includes(e.symbol.toLowerCase())&&t.description.toLowerCase().includes("dividend")).reduce((e,t)=>e.plus(d(t.amount)),d(0)),r=d(e.currentValue).times(.02);s.push({symbol:e.symbol,name:e.name,annualDividend:r,yield:2,frequency:"quarterly",totalReceived:a,projectedAnnual:r,exDividendDate:new Date(Date.now()+2592e6),paymentDate:new Date(Date.now()+3888e6)})}),s}compareWithBenchmarks(e,t=new Date(Date.now()-31536e6)){const s=this.calculateTotalPortfolioValue(e),a=e.reduce((e,t)=>e.plus(d(t.purchasePrice).times(t.quantity)),d(0)),r=s.minus(a).dividedBy(a).times(100).toNumber(),l=(Date.now()-t.getTime())/31536e6,n=r/l,i=Q.map(e=>({name:e.name,symbol:e.symbol,return:e.annualReturn*l,annualizedReturn:e.annualReturn,outperformance:n-e.annualReturn}));return{portfolio:{return:r,annualizedReturn:n,totalValue:s,startValue:a},benchmarks:i}}getESGScores(e){return e.map(e=>{const t=Math.floor(40*Math.random())+60,s=Math.floor(40*Math.random())+60,a=Math.floor(40*Math.random())+60,r=Math.floor((t+s+a)/3),l=r>=80?"AAA":r>=70?"AA":r>=60?"A":r>=50?"BBB":r>=40?"BB":r>=30?"B":"CCC";return{symbol:e.symbol,name:e.name,environmental:t,social:s,governance:a,overall:r,rating:l,controversies:r<60?["Environmental concerns reported"]:[]}})}calculateTotalPortfolioValue(e){return e.reduce((e,t)=>e.plus(d(t.currentValue)),d(0))}calculateCurrentAllocations(e){const t=this.calculateTotalPortfolioValue(e),s={};return e.forEach(e=>{const a=this.getInvestmentCategory(e),r=d(e.currentValue).dividedBy(t).times(100).toNumber();s[a]=(s[a]||0)+r}),s}getInvestmentCategory(e){const t=e.symbol.toUpperCase();return["VOO","SPY","VTI","IVV"].includes(t)?"US Stocks":["VEA","IEFA","VWO","IEMG"].includes(t)?"International Stocks":["BND","AGG","TLT","IEF"].includes(t)?"Bonds":["VNQ","IYR","XLRE"].includes(t)?"Real Estate":["GLD","SLV","DBC","PDBC"].includes(t)?"Commodities":"US Stocks"}generateInsights(e,t){const s=[],a=this.calculateRiskMetrics(e),r=this.getRebalancingSuggestions(e),l=this.trackDividends(e,t);a.diversificationScore<50&&s.push("\ud83c\udfaf Your portfolio needs more diversification. Consider adding different asset classes."),a.concentrationRisk.some(e=>"high"===e.risk)&&s.push("\u26a0\ufe0f High concentration risk detected. No single holding should exceed 20% of your portfolio."),r.length>0&&s.push(`\ud83d\udd04 Portfolio rebalancing recommended: ${r.length} adjustments needed.`);const n=l.reduce((e,t)=>e.plus(t.projectedAnnual),d(0));return n.greaterThan(0)&&s.push(`\ud83d\udcb0 Projected annual dividend income: $${n.toFixed(2)}`),s}},_=new class{dividends=[];storageKey="wealthtracker_dividends";yieldData={};constructor(){this.loadDividends(),this.loadYieldData()}loadDividends(){try{const e=localStorage.getItem(this.storageKey);if(e){const t=JSON.parse(e);this.dividends=t.map(e=>({...e,paymentDate:new Date(e.paymentDate),exDividendDate:new Date(e.exDividendDate),recordDate:e.recordDate?new Date(e.recordDate):void 0,declarationDate:e.declarationDate?new Date(e.declarationDate):void 0}))}}catch(e){console.error("Failed to load dividends:",e),this.dividends=[]}}saveDividends(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.dividends))}catch(e){T.handleError(e,{category:F.STORAGE,severity:E.HIGH,context:{dividendCount:this.dividends.length},userMessage:"Failed to save dividend data. Your changes may not persist.",recoverable:!0})}}loadYieldData(){this.yieldData={AAPL:.44,MSFT:.72,JNJ:2.85,KO:3.06,VZ:6.48,T:6.15,PG:2.35,JPM:2.82,XOM:3.23,CVX:3.48,O:5.51,SCHD:3.41,VYM:2.91,DVY:3.68,VIG:1.57}}addDividend(e){try{M(e,[{test:e=>e.amount>0,message:"Dividend amount must be positive"},{test:e=>e.amountPerShare>0,message:"Amount per share must be positive"},{test:e=>e.shares>0,message:"Number of shares must be positive"},{test:e=>e.paymentDate instanceof Date&&!isNaN(e.paymentDate.getTime()),message:"Valid payment date is required"},{test:e=>!e.taxWithheld||e.taxWithheld>=0,message:"Tax withheld cannot be negative"}]);const t={...e,id:`div-${Date.now()}-${Math.random().toString(36).substr(2,9)}`};return this.dividends.push(t),this.saveDividends(),t}catch(t){throw T.handleError(t,{category:F.VALIDATION,severity:E.MEDIUM,context:{dividend:e},userMessage:"Invalid dividend data. Please check your input."}),t}}getDividends(e){let t=[...this.dividends];return e&&(e.accountId&&(t=t.filter(t=>t.accountId===e.accountId)),e.investmentId&&(t=t.filter(t=>t.investmentId===e.investmentId)),e.symbol&&(t=t.filter(t=>t.symbol===e.symbol)),e.startDate&&(t=t.filter(t=>t.paymentDate>=e.startDate)),e.endDate&&(t=t.filter(t=>t.paymentDate<=e.endDate)),e.type&&(t=t.filter(t=>t.type===e.type))),t.sort((e,t)=>t.paymentDate.getTime()-e.paymentDate.getTime())}updateDividend(e,t){const s=this.dividends.findIndex(t=>t.id===e);return-1!==s&&(this.dividends[s]={...this.dividends[s],...t,id:this.dividends[s].id},this.saveDividends(),!0)}deleteDividend(e){const t=this.dividends.findIndex(t=>t.id===e);return-1!==t&&(this.dividends.splice(t,1),this.saveDividends(),!0)}getDividendSummary(e,t){const s=this.getDividends({startDate:e,endDate:t}),a={totalDividends:d(0),totalTaxWithheld:d(0),bySymbol:{},byFrequency:{},byType:{},byMonth:{},projectedAnnual:d(0)};return s.forEach(e=>{const t=d(e.amount);a.totalDividends=a.totalDividends.plus(t),e.taxWithheld&&(a.totalTaxWithheld=a.totalTaxWithheld.plus(d(e.taxWithheld))),a.bySymbol[e.symbol]||(a.bySymbol[e.symbol]={total:d(0),count:0,lastPayment:e.paymentDate,averagePerPayment:d(0)}),a.bySymbol[e.symbol].total=a.bySymbol[e.symbol].total.plus(t),a.bySymbol[e.symbol].count++,e.paymentDate>a.bySymbol[e.symbol].lastPayment&&(a.bySymbol[e.symbol].lastPayment=e.paymentDate),a.byFrequency[e.frequency]||(a.byFrequency[e.frequency]=d(0)),a.byFrequency[e.frequency]=a.byFrequency[e.frequency].plus(t),a.byType[e.type]||(a.byType[e.type]=d(0)),a.byType[e.type]=a.byType[e.type].plus(t);const s=`${e.paymentDate.getFullYear()}-${String(e.paymentDate.getMonth()+1).padStart(2,"0")}`;a.byMonth[s]||(a.byMonth[s]=d(0)),a.byMonth[s]=a.byMonth[s].plus(t)}),Object.keys(a.bySymbol).forEach(e=>{const t=a.bySymbol[e];t.averagePerPayment=t.total.div(d(t.count))}),a.projectedAnnual=this.calculateProjectedAnnualIncome(),a}calculateProjectedAnnualIncome(){const e=this.getDividends({startDate:new Date(Date.now()-31536e6)}),t={};e.forEach(e=>{t[e.symbol]||(t[e.symbol]={total:d(0),frequency:e.frequency,count:0}),t[e.symbol].total=t[e.symbol].total.plus(d(e.amount)),t[e.symbol].count++});let s=d(0);return Object.entries(t).forEach(([e,t])=>{let a=1;switch(t.frequency){case"monthly":a=12;break;case"quarterly":a=4;break;case"semi-annual":a=2;break;case"annual":a=1;break;default:a=t.count}const r=t.total.div(d(t.count));s=s.plus(r.times(d(a)))}),s}getDividendProjections(e){const t=[],s=new Date;return e.forEach(e=>{const a=this.getDividends({symbol:e.symbol,startDate:new Date(s.getFullYear()-1,s.getMonth(),s.getDate())});if(a.length>0){const r=a[0],l=new Date(r.paymentDate);switch(r.frequency){case"monthly":l.setMonth(l.getMonth()+1);break;case"quarterly":l.setMonth(l.getMonth()+3);break;case"semi-annual":l.setMonth(l.getMonth()+6);break;case"annual":l.setFullYear(l.getFullYear()+1)}if(l>s){const s=d(r.amountPerShare).times(d(e.shares));t.push({symbol:e.symbol,nextPaymentDate:l,estimatedAmount:s,confidence:a.length>=4?"high":"medium",basedOn:"history"})}}else if(this.yieldData[e.symbol]){const a=this.yieldData[e.symbol]/100,r=d(e.currentValue).times(d(a)).div(d(4)),l=new Date(s),n=s.getMonth(),i=3*Math.ceil((n+1)/3)-1;l.setMonth(i),l.setDate(15),t.push({symbol:e.symbol,nextPaymentDate:l,estimatedAmount:r,confidence:"low",basedOn:"yield"})}}),t.sort((e,t)=>e.nextPaymentDate.getTime()-t.nextPaymentDate.getTime())}importFromTransactions(e,t){const s=["dividend","div","distribution","capital gain"],a=[];return e.forEach(e=>{const r=e.description.toLowerCase();if((s.some(e=>r.includes(e))||"Investment Income"===e.category)&&e.amount>0){let s="",r="";const l=e.description.match(/\b([A-Z]{1,5})\b/);if(l){s=l[1];for(const[e,a]of Object.entries(t))if(a.symbol===s){r=e;break}}if(s&&r){const l=t[r],n={investmentId:r,accountId:e.accountId,symbol:s,amount:e.amount,amountPerShare:e.amount/l.shares,shares:l.shares,currency:"USD",paymentDate:e.date,exDividendDate:new Date(e.date.getTime()-1728e5),frequency:"quarterly",type:"regular",reinvested:!1,notes:`Imported from transaction: ${e.description}`};this.dividends.some(t=>t.symbol===s&&t.paymentDate.toDateString()===e.date.toDateString()&&Math.abs(t.amount-e.amount)<.01)||a.push(this.addDividend(n))}}}),a}getDividendYield(e,t){const s=new Date;s.setFullYear(s.getFullYear()-1);const a=this.getDividends({symbol:e,startDate:s});return a.length>0?a.reduce((e,t)=>e+t.amountPerShare,0)/t*100:this.yieldData[e]||null}updateYieldData(e,t){this.yieldData[e]=t,localStorage.setItem("wealthtracker_yield_data",JSON.stringify(this.yieldData))}exportToCSV(){return[["Date","Symbol","Amount","Amount Per Share","Shares","Type","Frequency","Tax Withheld","Reinvested","Notes"],...this.dividends.map(e=>[e.paymentDate.toISOString().split("T")[0],e.symbol,e.amount.toFixed(2),e.amountPerShare.toFixed(4),e.shares.toString(),e.type,e.frequency,e.taxWithheld?.toFixed(2)||"",e.reinvested?"Yes":"No",e.notes||""])].map(e=>e.join(",")).join("\n")}},X=new class{targets=[];assetMappings=[];storageKey="wealthtracker_portfolio_targets";mappingsKey="wealthtracker_asset_mappings";constructor(){this.loadTargets(),this.loadMappings(),this.initializeDefaultMappings()}loadTargets(){try{const e=localStorage.getItem(this.storageKey);if(e){const t=JSON.parse(e);this.targets=t.map(e=>({...e,createdAt:new Date(e.createdAt),lastRebalanced:e.lastRebalanced?new Date(e.lastRebalanced):void 0}))}}catch(e){console.error("Failed to load portfolio targets:",e),this.targets=[]}}saveTargets(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.targets))}catch(e){console.error("Failed to save portfolio targets:",e)}}loadMappings(){try{const e=localStorage.getItem(this.mappingsKey);e&&(this.assetMappings=JSON.parse(e))}catch(e){console.error("Failed to load asset mappings:",e),this.assetMappings=[]}}saveMappings(){try{localStorage.setItem(this.mappingsKey,JSON.stringify(this.assetMappings))}catch(e){console.error("Failed to save asset mappings:",e)}}initializeDefaultMappings(){[{symbol:"AAPL",assetClass:"US Stocks",subClass:"Large Cap"},{symbol:"MSFT",assetClass:"US Stocks",subClass:"Large Cap"},{symbol:"GOOGL",assetClass:"US Stocks",subClass:"Large Cap"},{symbol:"AMZN",assetClass:"US Stocks",subClass:"Large Cap"},{symbol:"META",assetClass:"US Stocks",subClass:"Large Cap"},{symbol:"NVDA",assetClass:"US Stocks",subClass:"Large Cap"},{symbol:"TSLA",assetClass:"US Stocks",subClass:"Large Cap"},{symbol:"BRK.B",assetClass:"US Stocks",subClass:"Large Cap"},{symbol:"JPM",assetClass:"US Stocks",subClass:"Large Cap"},{symbol:"JNJ",assetClass:"US Stocks",subClass:"Large Cap"},{symbol:"SPY",assetClass:"US Stocks",subClass:"Large Cap ETF"},{symbol:"VOO",assetClass:"US Stocks",subClass:"Large Cap ETF"},{symbol:"VTI",assetClass:"US Stocks",subClass:"Total Market ETF"},{symbol:"IWM",assetClass:"US Stocks",subClass:"Small Cap ETF"},{symbol:"QQQ",assetClass:"US Stocks",subClass:"Tech ETF"},{symbol:"DIA",assetClass:"US Stocks",subClass:"Large Cap ETF"},{symbol:"VXUS",assetClass:"International Stocks",subClass:"Developed Markets"},{symbol:"VEA",assetClass:"International Stocks",subClass:"Developed Markets"},{symbol:"VWO",assetClass:"International Stocks",subClass:"Emerging Markets"},{symbol:"EFA",assetClass:"International Stocks",subClass:"Developed Markets"},{symbol:"EEM",assetClass:"International Stocks",subClass:"Emerging Markets"},{symbol:"BND",assetClass:"Bonds",subClass:"Total Bond Market"},{symbol:"AGG",assetClass:"Bonds",subClass:"Total Bond Market"},{symbol:"TLT",assetClass:"Bonds",subClass:"Long-Term Treasury"},{symbol:"IEF",assetClass:"Bonds",subClass:"Intermediate Treasury"},{symbol:"SHY",assetClass:"Bonds",subClass:"Short-Term Treasury"},{symbol:"LQD",assetClass:"Bonds",subClass:"Corporate Bonds"},{symbol:"HYG",assetClass:"Bonds",subClass:"High Yield Bonds"},{symbol:"VNQ",assetClass:"Real Estate",subClass:"REIT ETF"},{symbol:"O",assetClass:"Real Estate",subClass:"REIT"},{symbol:"STOR",assetClass:"Real Estate",subClass:"REIT"},{symbol:"SPG",assetClass:"Real Estate",subClass:"REIT"},{symbol:"GLD",assetClass:"Commodities",subClass:"Gold"},{symbol:"SLV",assetClass:"Commodities",subClass:"Silver"},{symbol:"DBC",assetClass:"Commodities",subClass:"Broad Commodities"},{symbol:"USO",assetClass:"Commodities",subClass:"Oil"},{symbol:"GBTC",assetClass:"Alternative",subClass:"Crypto"},{symbol:"BITO",assetClass:"Alternative",subClass:"Crypto"}].forEach(e=>{this.assetMappings.find(t=>t.symbol===e.symbol)||this.assetMappings.push(e)}),this.saveMappings()}getAssetClass(e){const t=this.assetMappings.find(t=>t.symbol===e);return t?t.assetClass:e.includes("BND")||e.includes("AGG")||e.includes("TLT")?"Bonds":e.includes("VNQ")||e.endsWith("REIT")?"Real Estate":e.includes("GLD")||e.includes("SLV")?"Commodities":e.includes("VEA")||e.includes("VWO")||e.includes("EFA")?"International Stocks":"US Stocks"}setAssetClass(e,t,s){const a=this.assetMappings.findIndex(t=>t.symbol===e);a>=0?this.assetMappings[a]={symbol:e,assetClass:t,subClass:s}:this.assetMappings.push({symbol:e,assetClass:t,subClass:s}),this.saveMappings()}savePortfolioTarget(e){const t={...e,id:`target-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,createdAt:new Date},s=this.targets.findIndex(e=>e.id===t.id);return s>=0?this.targets[s]={...this.targets[s],...t}:this.targets.push(t),this.saveTargets(),t}getPortfolioTargets(){return[...this.targets]}getActiveTarget(){return this.targets.find(e=>e.isActive)||null}deletePortfolioTarget(e){const t=this.targets.findIndex(t=>t.id===e);return-1!==t&&(this.targets.splice(t,1),this.saveTargets(),!0)}calculateCurrentAllocation(e){const t=e.reduce((e,t)=>e.plus(d(t.value)),d(0));if(t.isZero())return[];const s={};e.forEach(e=>{const t=this.getAssetClass(e.symbol);s[t]||(s[t]=d(0)),s[t]=s[t].plus(d(e.value))});const a=this.getActiveTarget(),r=[];return Object.entries(s).forEach(([e,s])=>{const l=s.div(t).times(d(100)).toNumber(),n=a?.allocations.find(t=>t.assetClass===e),i=n?.targetPercent||0,c=t.times(d(i)).div(d(100)),o=c.minus(s),m=i-l;r.push({assetClass:e,targetPercent:i,currentPercent:l,currentValue:s,targetValue:c,difference:o,differencePercent:m})}),a&&a.allocations.forEach(e=>{if(!r.find(t=>t.assetClass===e.assetClass)){const s=t.times(d(e.targetPercent)).div(d(100));r.push({assetClass:e.assetClass,targetPercent:e.targetPercent,currentPercent:0,currentValue:d(0),targetValue:s,difference:s,differencePercent:e.targetPercent})}}),r.sort((e,t)=>t.currentValue.toNumber()-e.currentValue.toNumber())}calculateRebalanceActions(e,t=0,s=!1){const a=this.getActiveTarget();if(!a)return[];const r=e.reduce((e,t)=>e+t.value,0)+t,l=[],n={};a.allocations.forEach(e=>{n[e.assetClass]=r*e.targetPercent/100});const i={};return e.forEach(e=>{const t=this.getAssetClass(e.symbol);i[t]||(i[t]=[]),i[t].push(e)}),Object.entries(n).forEach(([e,t])=>{const a=i[e]||[],r=a.reduce((e,t)=>e+t.value,0),n=t-r;if(!(Math.abs(n)<50))if(n>0)a.length>0?a.forEach(t=>{const s=t.value/(r||1),a=d(n*s),i=a.div(d(t.price));i.toNumber()>=.1&&l.push({symbol:t.symbol,name:t.name,action:"buy",shares:i,amount:a,currentShares:d(t.shares),targetShares:d(t.shares).plus(i),currentValue:d(t.value),targetValue:d(t.value).plus(a),assetClass:e,priority:2})}):l.push({symbol:`NEW_${e.toUpperCase().replace(/\s+/g,"_")}`,name:`New ${e} Investment`,action:"buy",shares:d(0),amount:d(n),currentShares:d(0),targetShares:d(0),currentValue:d(0),targetValue:d(n),assetClass:e,priority:3});else{let t=Math.abs(n);[...a].sort((e,t)=>t.value-e.value).forEach(a=>{if(t<=0)return;const r=Math.min(a.value,t),n=d(r).div(d(a.price));let i=2;s&&(i=4),n.toNumber()>=.1&&(l.push({symbol:a.symbol,name:a.name,action:"sell",shares:n,amount:d(r),currentShares:d(a.shares),targetShares:d(a.shares).minus(n),currentValue:d(a.value),targetValue:d(a.value).minus(d(r)),assetClass:e,priority:i}),t-=r)})}}),l.sort((e,t)=>e.priority!==t.priority?e.priority-t.priority:t.amount.toNumber()-e.amount.toNumber())}isRebalancingNeeded(e,t){const s=this.getActiveTarget();if(!s)return!1;const a=t||s.rebalanceThreshold||5;return e.some(e=>{const t=s.allocations.find(t=>t.assetClass===e.assetClass),r=t?.tolerance||a;return Math.abs(e.differencePercent)>r})}getPortfolioTemplates(){return[{id:"template-conservative",name:"Conservative",description:"Focus on capital preservation with modest growth",allocations:[{assetClass:"Bonds",targetPercent:70},{assetClass:"US Stocks",targetPercent:20},{assetClass:"International Stocks",targetPercent:5},{assetClass:"Real Estate",targetPercent:5}],rebalanceThreshold:5,isActive:!1,createdAt:new Date},{id:"template-moderate",name:"Moderate",description:"Balanced approach between growth and stability",allocations:[{assetClass:"US Stocks",targetPercent:40},{assetClass:"Bonds",targetPercent:40},{assetClass:"International Stocks",targetPercent:15},{assetClass:"Real Estate",targetPercent:5}],rebalanceThreshold:5,isActive:!1,createdAt:new Date},{id:"template-aggressive",name:"Aggressive",description:"Focus on growth with higher volatility",allocations:[{assetClass:"US Stocks",targetPercent:60},{assetClass:"International Stocks",targetPercent:25},{assetClass:"Bonds",targetPercent:10},{assetClass:"Real Estate",targetPercent:5}],rebalanceThreshold:7,isActive:!1,createdAt:new Date},{id:"template-three-fund",name:"Three-Fund Portfolio",description:"Simple, diversified portfolio with low costs",allocations:[{assetClass:"US Stocks",targetPercent:60},{assetClass:"International Stocks",targetPercent:20},{assetClass:"Bonds",targetPercent:20}],rebalanceThreshold:5,isActive:!1,createdAt:new Date},{id:"template-all-weather",name:"All Weather",description:"Ray Dalio's strategy for all economic conditions",allocations:[{assetClass:"US Stocks",targetPercent:30},{assetClass:"Bonds",targetPercent:55},{assetClass:"Commodities",targetPercent:7.5},{assetClass:"Real Estate",targetPercent:7.5}],rebalanceThreshold:5,isActive:!1,createdAt:new Date}]}markRebalanced(e){const t=this.targets.find(t=>t.id===e);t&&(t.lastRebalanced=new Date,this.saveTargets())}};export{l as default};
