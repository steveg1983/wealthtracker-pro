function e(){const{transactions:e,categories:t,addBudget:s,addGoal:u}=a(),{formatCurrency:x}=j(),[b]=f.useState(N.getHousehold()),[p]=f.useState(b?.members[0]),[y,v]=f.useState([]),[k,A]=f.useState([]),[S,I]=f.useState([]),[C,E]=f.useState([]),[D,M]=f.useState("budgets"),[B,T]=f.useState(!1),[G,q]=f.useState(!1),[_,V]=f.useState({name:"",category:"",amount:"",period:"monthly",approvalRequired:!1,approvalThreshold:"100"}),[O,R]=f.useState({name:"",targetAmount:"",targetDate:"",category:"",description:"",isHouseholdGoal:!0});f.useEffect(()=>{b&&H()},[b,e]);const H=()=>{if(!b)return;const e=w.getHouseholdBudgets(b.id,p?.id);v(e);const t=w.getHouseholdGoals(b.id,p?.id);A(t);const s=w.getPendingApprovals(b.id);I(s);const a=w.getRecentActivities(b.id);E(a)},z=(e,t)=>{if(p)try{w.reviewApproval(e,p.id,t,t?"Approved":"Rejected"),H()}catch(s){alert(s.message)}};return b?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"bg-gradient-to-r from-purple-500 to-indigo-500 rounded-2xl p-6 text-white",children:[r.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Shared Finances"}),r.jsxs("p",{className:"text-purple-100",children:["Collaborate on budgets and goals with your ",b.name," members"]})]}),S.length>0&&"viewer"!==p?.role&&r.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-xl p-4",children:[r.jsx("h3",{className:"font-semibold text-yellow-900 dark:text-yellow-200 mb-3",children:"Pending Approvals"}),r.jsx("div",{className:"space-y-2",children:S.map(e=>r.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-gray-800 rounded-lg",children:[r.jsxs("div",{children:[r.jsxs("p",{className:"font-medium",children:[e.requestedByName," requested to change budget to ",x(e.amount)]}),r.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.reason," \u2022 ",d(e.requestedAt,"MMM d, h:mm a")]})]}),"owner"===p.role||"admin"===p.role?r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>z(e.id,!0),className:"p-2 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 rounded hover:bg-green-200",children:r.jsx(n,{size:16})}),r.jsx("button",{onClick:()=>z(e.id,!1),className:"p-2 bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 rounded hover:bg-red-200",children:r.jsx(o,{size:16})})]}):r.jsx("span",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"Pending"})]},e.id))})]}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-1 flex",children:[r.jsxs("button",{onClick:()=>M("budgets"),className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg transition-colors "+("budgets"===D?"bg-indigo-600 text-white":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[r.jsx(l,{size:20}),r.jsx("span",{className:"font-medium",children:"Shared Budgets"})]}),r.jsxs("button",{onClick:()=>M("goals"),className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg transition-colors "+("goals"===D?"bg-purple-600 text-white":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[r.jsx(c,{size:20}),r.jsx("span",{className:"font-medium",children:"Shared Goals"})]})]}),"budgets"===D?r.jsxs("div",{className:"space-y-4",children:[p?.permissions.canEditBudgets&&r.jsxs("button",{onClick:()=>T(!0),className:"w-full p-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl text-gray-600 dark:text-gray-400 hover:border-gray-400 dark:hover:border-gray-500 transition-colors flex items-center justify-center gap-2",children:[r.jsx(m,{size:20}),"Create Shared Budget"]}),y.map(s=>{const a=(t=>{const s=new Date,a=w.calculateBudgetSpending(t.id,e,s);let r=0;return a.forEach(e=>r+=e),r})(s),i=(t=>{const s=new Date;return w.calculateBudgetSpending(t.id,e,s)})(s),d=a/s.amount*100,n=a>s.amount;return r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-6",children:[r.jsxs("div",{className:"flex items-start justify-between mb-4",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold",children:s.name}),r.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[t.find(e=>e.id===s.category)?.name," \u2022 ",s.period]})]}),r.jsxs("div",{className:"text-right",children:[r.jsxs("p",{className:"text-2xl font-bold",children:[x(a)," / ",x(s.amount)]}),r.jsxs("p",{className:"text-sm "+(n?"text-red-600":"text-gray-600"),children:[d.toFixed(0),"% used"]})]})]}),r.jsx("div",{className:"mb-4",children:r.jsx("div",{className:"bg-gray-200 dark:bg-gray-700 rounded-full h-3 overflow-hidden",children:r.jsx("div",{className:"h-full transition-all duration-300 "+(n?"bg-red-500":d>80?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(d,100)}%`}})})}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Member Spending:"}),b.members.map(e=>{const t=i.get(e.id)||0;return r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-white text-xs font-semibold",style:{backgroundColor:e.color},children:e.name.charAt(0)}),r.jsx("span",{children:e.name})]}),r.jsx("span",{className:"font-medium",children:x(t)})]},e.id)})]}),s.approvalRequired&&r.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:r.jsxs("p",{className:"text-xs text-gray-500",children:[r.jsx(h,{size:12,className:"inline mr-1"}),"Changes over ",x(s.approvalThreshold)," require approval"]})})]},s.id)}),0===y.length&&r.jsx("div",{className:"text-center py-8 text-gray-500",children:"No shared budgets yet"})]}):r.jsxs("div",{className:"space-y-4",children:[p?.permissions.canEditGoals&&r.jsxs("button",{onClick:()=>q(!0),className:"w-full p-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl text-gray-600 dark:text-gray-400 hover:border-gray-400 dark:hover:border-gray-500 transition-colors flex items-center justify-center gap-2",children:[r.jsx(m,{size:20}),"Create Shared Goal"]}),k.map(e=>{const t=e.currentAmount/e.targetAmount*100,s=Math.ceil((new Date(e.targetDate).getTime()-Date.now())/864e5),a=e.contributors.find(e=>e.memberId===p?.id);return r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-6",children:[r.jsxs("div",{className:"flex items-start justify-between mb-4",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold",children:e.name}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.description})]}),r.jsxs("div",{className:"text-right",children:[r.jsxs("p",{className:"text-2xl font-bold",children:[x(e.currentAmount)," / ",x(e.targetAmount)]}),r.jsx("p",{className:"text-sm "+(s<30?"text-orange-600":"text-gray-600"),children:s>0?`${s} days left`:"Overdue"})]})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("div",{className:"bg-gray-200 dark:bg-gray-700 rounded-full h-3 overflow-hidden",children:r.jsx("div",{className:"h-full transition-all duration-300 "+(e.isCompleted?"bg-green-500":"bg-purple-500"),style:{width:`${Math.min(t,100)}%`}})}),r.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[t.toFixed(0),"% complete"]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Contributors:"}),e.contributors.map(e=>r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-white text-xs font-semibold",style:{backgroundColor:b.members.find(t=>t.id===e.memberId)?.color},children:e.memberName.charAt(0)}),r.jsx("span",{children:e.memberName})]}),r.jsxs("div",{className:"text-right",children:[r.jsxs("p",{className:"font-medium",children:[x(e.currentAmount)," / ",x(e.targetAmount)]}),r.jsxs("p",{className:"text-xs text-gray-500",children:[(e.currentAmount/e.targetAmount*100).toFixed(0),"%"]})]})]},e.memberId))]}),!e.isCompleted&&a&&p?.permissions.canEditGoals&&r.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:r.jsx("div",{className:"flex gap-2",children:[10,25,50,100].map(t=>r.jsxs("button",{onClick:()=>((e,t)=>{if(p)try{w.updateGoalProgress(e,p.id,p.name,t),H()}catch(s){alert(s.message)}})(e.id,t),className:"px-3 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded hover:bg-purple-200 dark:hover:bg-purple-900/50 text-sm",children:["+$",t]},t))})}),e.isCompleted&&r.jsx("div",{className:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",children:r.jsxs("p",{className:"text-sm text-green-800 dark:text-green-200 font-medium",children:[r.jsx(n,{size:16,className:"inline mr-1"}),"Goal achieved on ",d(e.completedAt,"MMM d, yyyy"),"!"]})})]},e.id)}),0===k.length&&r.jsx("div",{className:"text-center py-8 text-gray-500",children:"No shared goals yet"})]}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-6",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Recent Activity"}),r.jsx("div",{className:"space-y-3",children:C.slice(0,5).map(e=>r.jsxs("div",{className:"flex items-start gap-3 text-sm",children:[r.jsx(g,{size:16,className:"text-gray-400 mt-0.5"}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("p",{children:[r.jsx("span",{className:"font-medium",children:e.memberName})," ",r.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:e.details})]}),r.jsx("p",{className:"text-xs text-gray-500",children:d(e.timestamp,"MMM d, h:mm a")})]})]},e.id))})]}),B&&r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full p-6",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Create Shared Budget"}),r.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),b&&p)try{w.createSharedBudget({name:_.name,category:_.category,amount:Number(_.amount),period:_.period,isActive:!0},b.id,p.id,p.name,void 0,[p.id],_.approvalRequired,Number(_.approvalThreshold)),s({name:_.name,category:_.category,amount:Number(_.amount),period:_.period}),T(!1),V({name:"",category:"",amount:"",period:"monthly",approvalRequired:!1,approvalThreshold:"100"}),H()}catch(t){alert(t.message)}},className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Budget Name"}),r.jsx("input",{type:"text",value:_.name,onChange:e=>V({..._,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Category"}),r.jsxs("select",{value:_.category,onChange:e=>V({..._,category:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0,children:[r.jsx("option",{value:"",children:"Select category"}),t.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Amount"}),r.jsx("input",{type:"number",value:_.amount,onChange:e=>V({..._,amount:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Period"}),r.jsxs("select",{value:_.period,onChange:e=>V({..._,period:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[r.jsx("option",{value:"monthly",children:"Monthly"}),r.jsx("option",{value:"weekly",children:"Weekly"}),r.jsx("option",{value:"yearly",children:"Yearly"})]})]}),r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:_.approvalRequired,onChange:e=>V({..._,approvalRequired:e.target.checked}),className:"rounded text-indigo-600"}),r.jsx("span",{className:"text-sm",children:"Require approval for changes"})]}),_.approvalRequired&&r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Approval Threshold"}),r.jsx("input",{type:"number",value:_.approvalThreshold,onChange:e=>V({..._,approvalThreshold:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700"})]}),r.jsxs("div",{className:"flex gap-3 pt-4",children:[r.jsx("button",{type:"button",onClick:()=>T(!1),className:"flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),r.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:"Create"})]})]})]})}),G&&r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full p-6",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Create Shared Goal"}),r.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),b&&p)try{w.createSharedGoal({name:O.name,targetAmount:Number(O.targetAmount),currentAmount:0,targetDate:new Date(O.targetDate),category:O.category,description:O.description,isCompleted:!1},b.id,p.id,p.name,O.isHouseholdGoal),u({name:O.name,targetAmount:Number(O.targetAmount),targetDate:new Date(O.targetDate),category:O.category,description:O.description}),q(!1),R({name:"",targetAmount:"",targetDate:"",category:"",description:"",isHouseholdGoal:!0}),H()}catch(t){alert(t.message)}},className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Goal Name"}),r.jsx("input",{type:"text",value:O.name,onChange:e=>R({...O,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Target Amount"}),r.jsx("input",{type:"number",value:O.targetAmount,onChange:e=>R({...O,targetAmount:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Target Date"}),r.jsx("input",{type:"date",value:O.targetDate,onChange:e=>R({...O,targetDate:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Category"}),r.jsxs("select",{value:O.category,onChange:e=>R({...O,category:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0,children:[r.jsx("option",{value:"",children:"Select category"}),r.jsx("option",{value:"Savings",children:"Savings"}),r.jsx("option",{value:"Vacation",children:"Vacation"}),r.jsx("option",{value:"Emergency Fund",children:"Emergency Fund"}),r.jsx("option",{value:"Home",children:"Home"}),r.jsx("option",{value:"Other",children:"Other"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),r.jsx("textarea",{value:O.description,onChange:e=>R({...O,description:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",rows:3})]}),r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:O.isHouseholdGoal,onChange:e=>R({...O,isHouseholdGoal:e.target.checked}),className:"rounded text-indigo-600"}),r.jsx("span",{className:"text-sm",children:"Shared equally among all members"})]}),r.jsxs("div",{className:"flex gap-3 pt-4",children:[r.jsx("button",{type:"button",onClick:()=>q(!1),className:"flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),r.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Create"})]})]})]})})]}):r.jsxs("div",{className:"text-center py-12",children:[r.jsx(i,{className:"mx-auto text-gray-400 mb-4",size:48}),r.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Household Selected"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Create or join a household to use shared budgets and goals"})]})}function t(){const{transactions:t}=a(),{formatCurrency:s}=j(),[n,c]=f.useState(null),[h,g]=f.useState(null),[v,w]=f.useState(!1),[k,A]=f.useState(!1),[S,I]=f.useState(!1),[C,E]=f.useState([]),[D,M]=f.useState([]),[B,T]=f.useState([]),[G,q]=f.useState("overview"),[_,V]=f.useState(""),[O,R]=f.useState(""),[H,z]=f.useState(""),[F,Y]=f.useState(""),[P,K]=f.useState("member");f.useEffect(()=>{$()},[]),f.useEffect(()=>{if(n&&t){const e=N.calculateMemberContributions(t);T(e)}},[n,t]);const $=()=>{const e=N.getHousehold();e&&(c(e),g(e.members[0]),E(N.getRecentActivities()),M(N.getPendingInvites()))},J=e=>{if(e.preventDefault(),F&&h)try{const e=N.inviteMember(F,P,h.id,h.name);M([...D,e]),A(!1),Y(""),K("member"),$()}catch(t){alert(t.message)}},L=e=>{if(h&&confirm("Are you sure you want to remove this member?"))try{N.removeMember(e,h.id,h.name),$()}catch(t){alert(t.message)}},U=e=>{N.cancelInvite(e),M(D.filter(t=>t.id!==e))},W=(e,t)=>{if(h)try{N.updateMemberRole(e,t,h.id),$()}catch(s){alert(s.message)}},Z=e=>{switch(e){case"owner":return r.jsx(y,{size:16,className:"text-purple-600"});case"admin":return r.jsx(x,{size:16,className:"text-blue-600"});case"member":return r.jsx(x,{size:16,className:"text-green-600"});case"viewer":return r.jsx(x,{size:16,className:"text-gray-600"})}},Q=e=>{switch(e){case"owner":return"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400";case"admin":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400";case"member":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"viewer":return"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400"}};return n?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-500 rounded-2xl p-6 text-white",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold mb-1",children:n.name}),r.jsxs("p",{className:"text-indigo-100",children:[n.members.length," member",1!==n.members.length?"s":""," \u2022 Created ",d(n.createdAt,"MMM d, yyyy")]})]}),r.jsx("button",{onClick:()=>I(!S),className:"p-2 bg-white/20 rounded-lg hover:bg-white/30 transition-colors",children:r.jsx(u,{size:20})})]}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:B.slice(0,3).map(e=>r.jsxs("div",{className:"bg-white/20 rounded-lg p-3",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white font-semibold",style:{backgroundColor:n.members.find(t=>t.id===e.memberId)?.color},children:e.memberName.charAt(0)}),r.jsx("span",{className:"font-medium",children:e.memberName})]}),r.jsxs("p",{className:"text-sm text-indigo-100",children:[s(e.totalExpenses)," spent"]}),r.jsxs("p",{className:"text-xs text-indigo-200",children:[e.percentageOfHousehold.toFixed(0),"% of household"]})]},e.memberId))})]}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-1 flex",children:[r.jsxs("button",{onClick:()=>q("overview"),className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg transition-colors "+("overview"===G?"bg-indigo-600 text-white":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[r.jsx(i,{size:20}),r.jsx("span",{className:"font-medium",children:"Overview"})]}),r.jsxs("button",{onClick:()=>q("members"),className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg transition-colors "+("members"===G?"bg-indigo-600 text-white":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[r.jsx(x,{size:20}),r.jsx("span",{className:"font-medium",children:"Members"})]}),r.jsxs("button",{onClick:()=>q("finances"),className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg transition-colors "+("finances"===G?"bg-indigo-600 text-white":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[r.jsx(l,{size:20}),r.jsx("span",{className:"font-medium",children:"Shared Finances"})]})]}),"overview"===G&&r.jsxs(r.Fragment,{children:[S&&r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Household Settings"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Member Visibility"}),r.jsxs("select",{value:n.settings.memberVisibility,onChange:e=>N.updateHouseholdSettings({memberVisibility:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[r.jsx("option",{value:"all",children:"All transactions visible"}),r.jsx("option",{value:"summary",children:"Summary only"}),r.jsx("option",{value:"none",children:"Private transactions"})]})]}),r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:n.settings.requireApprovalForLargeTransactions,onChange:e=>N.updateHouseholdSettings({requireApprovalForLargeTransactions:e.target.checked}),className:"rounded text-indigo-600"}),r.jsx("span",{className:"text-sm",children:"Require approval for large transactions"})]}),n.settings.requireApprovalForLargeTransactions&&r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Large Transaction Threshold"}),r.jsx("input",{type:"number",value:n.settings.largeTransactionThreshold,onChange:e=>N.updateHouseholdSettings({largeTransactionThreshold:Number(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700"})]})]})]}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold",children:"Members"}),h?.permissions.canInviteMembers&&r.jsxs("button",{onClick:()=>A(!0),className:"flex items-center gap-2 px-3 py-1 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded-lg hover:bg-indigo-200 dark:hover:bg-indigo-900/50",children:[r.jsx(m,{size:16}),"Invite Member"]})]}),k&&r.jsx("form",{onSubmit:J,className:"mb-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[r.jsx("input",{type:"email",value:F,onChange:e=>Y(e.target.value),placeholder:"Email address",className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0}),r.jsxs("select",{value:P,onChange:e=>K(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[r.jsx("option",{value:"admin",children:"Admin"}),r.jsx("option",{value:"member",children:"Member"}),r.jsx("option",{value:"viewer",children:"Viewer"})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:"Send Invite"}),r.jsx("button",{type:"button",onClick:()=>A(!1),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"})]})]})}),r.jsx("div",{className:"space-y-3",children:n.members.map(e=>r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-semibold",style:{backgroundColor:e.color},children:e.name.charAt(0)}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"font-medium",children:e.name}),r.jsxs("span",{className:`px-2 py-0.5 text-xs rounded-full ${Q(e.role)}`,children:[Z(e.role),e.role]})]}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.email})]})]}),"owner"===h?.role&&e.id!==h.id&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("select",{value:e.role,onChange:t=>W(e.id,t.target.value),className:"px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700",children:[r.jsx("option",{value:"admin",children:"Admin"}),r.jsx("option",{value:"member",children:"Member"}),r.jsx("option",{value:"viewer",children:"Viewer"})]}),r.jsx("button",{onClick:()=>L(e.id),className:"p-1 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",children:r.jsx(o,{size:16})})]})]},e.id))}),D.length>0&&r.jsxs("div",{className:"mt-4",children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Pending Invites"}),r.jsx("div",{className:"space-y-2",children:D.map(e=>r.jsxs("div",{className:"flex items-center justify-between p-2 bg-yellow-50 dark:bg-yellow-900/20 rounded",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(b,{size:16,className:"text-yellow-600"}),r.jsx("span",{className:"text-sm",children:e.email}),r.jsxs("span",{className:"text-xs text-gray-500",children:["\u2022 ",e.role]})]}),r.jsx("button",{onClick:()=>U(e.id),className:"text-xs text-red-600 hover:underline",children:"Cancel"})]},e.id))})]})]}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-6",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Recent Activity"}),0===C.length?r.jsx("p",{className:"text-center text-gray-500 py-8",children:"No recent activity"}):r.jsx("div",{className:"space-y-3",children:C.map(e=>r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"mt-1",children:r.jsx(p,{size:16,className:"text-gray-400"})}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("p",{className:"text-sm",children:[r.jsx("span",{className:"font-medium",children:e.memberName})," ",r.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:e.details})]}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:d(e.timestamp,"MMM d, h:mm a")})]})]},e.id))})]}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-6",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Monthly Contributions"}),r.jsx("div",{className:"space-y-4",children:B.map(e=>r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white font-semibold text-sm",style:{backgroundColor:n.members.find(t=>t.id===e.memberId)?.color},children:e.memberName.charAt(0)}),r.jsx("span",{className:"font-medium",children:e.memberName})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("p",{className:"font-medium",children:e.netContribution>=0?r.jsxs("span",{className:"text-green-600 dark:text-green-400",children:["+",s(e.netContribution)]}):r.jsx("span",{className:"text-red-600 dark:text-red-400",children:s(e.netContribution)})}),r.jsxs("p",{className:"text-xs text-gray-500",children:[e.transactionCount," transactions"]})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Income:"}),r.jsx("span",{className:"font-medium text-green-600 dark:text-green-400",children:s(e.totalIncome)})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Expenses:"}),r.jsx("span",{className:"font-medium text-red-600 dark:text-red-400",children:s(e.totalExpenses)})]})]}),r.jsx("div",{className:"bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden",children:r.jsx("div",{className:"h-full transition-all duration-300",style:{width:`${e.percentageOfHousehold}%`,backgroundColor:n.members.find(t=>t.id===e.memberId)?.color}})})]},e.memberId))})]})]}),"members"===G&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold",children:"Members"}),h?.permissions.canInviteMembers&&r.jsxs("button",{onClick:()=>A(!0),className:"flex items-center gap-2 px-3 py-1 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded-lg hover:bg-indigo-200 dark:hover:bg-indigo-900/50",children:[r.jsx(m,{size:16}),"Invite Member"]})]}),k&&r.jsx("form",{onSubmit:J,className:"mb-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[r.jsx("input",{type:"email",value:F,onChange:e=>Y(e.target.value),placeholder:"Email address",className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0}),r.jsxs("select",{value:P,onChange:e=>K(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[r.jsx("option",{value:"admin",children:"Admin"}),r.jsx("option",{value:"member",children:"Member"}),r.jsx("option",{value:"viewer",children:"Viewer"})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:"Send Invite"}),r.jsx("button",{type:"button",onClick:()=>A(!1),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"})]})]})}),r.jsx("div",{className:"space-y-3",children:n.members.map(e=>r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-semibold",style:{backgroundColor:e.color},children:e.name.charAt(0)}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"font-medium",children:e.name}),r.jsxs("span",{className:`px-2 py-0.5 text-xs rounded-full ${Q(e.role)}`,children:[Z(e.role),e.role]})]}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.email})]})]}),"owner"===h?.role&&e.id!==h.id&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("select",{value:e.role,onChange:t=>W(e.id,t.target.value),className:"px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700",children:[r.jsx("option",{value:"admin",children:"Admin"}),r.jsx("option",{value:"member",children:"Member"}),r.jsx("option",{value:"viewer",children:"Viewer"})]}),r.jsx("button",{onClick:()=>L(e.id),className:"p-1 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",children:r.jsx(o,{size:16})})]})]},e.id))}),D.length>0&&r.jsxs("div",{className:"mt-4",children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Pending Invites"}),r.jsx("div",{className:"space-y-2",children:D.map(e=>r.jsxs("div",{className:"flex items-center justify-between p-2 bg-yellow-50 dark:bg-yellow-900/20 rounded",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(b,{size:16,className:"text-yellow-600"}),r.jsx("span",{className:"text-sm",children:e.email}),r.jsxs("span",{className:"text-xs text-gray-500",children:["\u2022 ",e.role]})]}),r.jsx("button",{onClick:()=>U(e.id),className:"text-xs text-red-600 hover:underline",children:"Cancel"})]},e.id))})]})]}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-6",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Recent Activity"}),0===C.length?r.jsx("p",{className:"text-center text-gray-500 py-8",children:"No recent activity"}):r.jsx("div",{className:"space-y-3",children:C.map(e=>r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"mt-1",children:r.jsx(p,{size:16,className:"text-gray-400"})}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("p",{className:"text-sm",children:[r.jsx("span",{className:"font-medium",children:e.memberName})," ",r.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:e.details})]}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:d(e.timestamp,"MMM d, h:mm a")})]})]},e.id))})]})]}),"finances"===G&&r.jsx(e,{})]}):r.jsx("div",{className:"max-w-2xl mx-auto",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8 text-center",children:[r.jsx(i,{className:"mx-auto text-gray-400 mb-4",size:64}),r.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Create a Household"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Share your finances with family members and collaborate on budgets and goals"}),v?r.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!_||!O||!H)return;const t=N.createHousehold(_,H,O);c(t),g(t.members[0]),w(!1),V(""),R(""),z(""),$()},className:"max-w-md mx-auto space-y-4 text-left",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Household Name"}),r.jsx("input",{type:"text",value:_,onChange:e=>V(e.target.value),placeholder:"e.g., Smith Family",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Your Name"}),r.jsx("input",{type:"text",value:O,onChange:e=>R(e.target.value),placeholder:"John Smith",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Your Email"}),r.jsx("input",{type:"email",value:H,onChange:e=>z(e.target.value),placeholder:"john@example.com",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",required:!0})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:"Create"}),r.jsx("button",{type:"button",onClick:()=>w(!1),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"})]})]}):r.jsx("button",{onClick:()=>w(!0),className:"px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:"Create Household"})]})})}function s(){return r.jsx(v,{title:"Household Management",rightContent:r.jsx("div",{className:"cursor-pointer",title:"Household Management",children:r.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",className:"transition-all duration-200 hover:scale-110 drop-shadow-lg hover:drop-shadow-xl",style:{filter:"drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1))"},children:[r.jsx("circle",{cx:"24",cy:"24",r:"24",fill:"#6366F1",className:"transition-all duration-200",onMouseEnter:e=>e.currentTarget.setAttribute("fill","#4F46E5"),onMouseLeave:e=>e.currentTarget.setAttribute("fill","#6366F1")}),r.jsx("g",{transform:"translate(12, 12)",children:r.jsx(i,{size:24,className:"text-white"})})]})}),children:r.jsx(t,{})})}import{g as a,j as r,f as i,ab as d,_ as n,X as o,aL as l,bQ as c,ag as m,ar as h,aZ as g,N as u,by as x,b4 as b,av as p,e as y}from"./index-Pkjq0qn3.js";import{P as v}from"./chunk-BnYLBI7x.js";import{a as f}from"./chunk-BWx9oMeS.js";import{u as j}from"./chunk-S7gbZ2pr.js";import"./chunk-BN8kgYrt.js";import"./chunk-Drd-K-oK.js";const N=new class{STORAGE_KEY="household_data";INVITES_KEY="household_invites";ACTIVITIES_KEY="household_activities";household=null;invites=[];activities=[];constructor(){this.loadData()}loadData(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(e){const t=JSON.parse(e);this.household={...t,createdAt:new Date(t.createdAt),members:t.members.map(e=>({...e,joinedAt:new Date(e.joinedAt),lastActive:e.lastActive?new Date(e.lastActive):void 0}))}}const t=localStorage.getItem(this.INVITES_KEY);t&&(this.invites=JSON.parse(t).map(e=>({...e,invitedAt:new Date(e.invitedAt),expiresAt:new Date(e.expiresAt)})));const s=localStorage.getItem(this.ACTIVITIES_KEY);s&&(this.activities=JSON.parse(s).map(e=>({...e,timestamp:new Date(e.timestamp)})))}catch(e){console.error("Failed to load household data:",e)}}saveData(){try{this.household&&localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.household)),localStorage.setItem(this.INVITES_KEY,JSON.stringify(this.invites)),localStorage.setItem(this.ACTIVITIES_KEY,JSON.stringify(this.activities))}catch(e){console.error("Failed to save household data:",e)}}createHousehold(e,t,s){const a={id:this.generateId(),name:s,email:t,role:"owner",color:this.generateMemberColor(0),joinedAt:new Date,permissions:this.getDefaultPermissions("owner")};return this.household={id:this.generateId(),name:e,createdAt:new Date,createdBy:a.id,members:[a],settings:{currency:"USD",timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,fiscalYearStart:1,allowMemberExpenses:!0,requireApprovalForLargeTransactions:!1,largeTransactionThreshold:1e3,sharedCategories:!0,memberVisibility:"all"}},this.saveData(),this.logActivity(a.id,a.name,"joined_household","Created the household"),this.household}getHousehold(){return this.household}updateHouseholdSettings(e){this.household&&(this.household.settings={...this.household.settings,...e},this.saveData())}inviteMember(e,t,s,a){if(!this.household)throw new Error("No household exists");if(this.household.members.some(t=>t.email===e))throw new Error("User is already a member");if(this.invites.find(t=>t.email===e&&"pending"===t.status&&t.householdId===this.household.id))throw new Error("An invitation is already pending for this email");const r={id:this.generateId(),householdId:this.household.id,email:e,role:t,invitedBy:s,invitedAt:new Date,expiresAt:new Date(Date.now()+6048e5),status:"pending",token:this.generateToken()};return this.invites.push(r),this.saveData(),this.logActivity(s,a,"joined_household",`Invited ${e} to join as ${t}`),r}acceptInvite(e,t){const s=this.invites.find(t=>t.token===e&&"pending"===t.status);if(!s)throw new Error("Invalid or expired invitation");if(new Date>s.expiresAt)throw s.status="expired",this.saveData(),new Error("Invitation has expired");if(!this.household||this.household.id!==s.householdId)throw new Error("Household not found");const a={id:this.generateId(),name:t,email:s.email,role:s.role,color:this.generateMemberColor(this.household.members.length),joinedAt:new Date,permissions:this.getDefaultPermissions(s.role)};return this.household.members.push(a),s.status="accepted",this.saveData(),this.logActivity(a.id,a.name,"joined_household","Joined the household"),a}removeMember(e,t,s){if(!this.household)return;const a=this.household.members.find(t=>t.id===e);if(!a)throw new Error("Member not found");if("owner"===a.role)throw new Error("Cannot remove the household owner");const r=this.household.members.find(e=>e.id===t);if(!r||!r.permissions.canRemoveMembers)throw new Error("Insufficient permissions to remove members");this.household.members=this.household.members.filter(t=>t.id!==e),this.saveData(),this.logActivity(t,s,"joined_household",`Removed ${a.name} from household`)}updateMemberRole(e,t,s){if(!this.household)return;const a=this.household.members.find(t=>t.id===e);if(!a)throw new Error("Member not found");const r=this.household.members.find(e=>e.id===s);if(!r||"owner"!==r.role)throw new Error("Only the owner can change member roles");if("owner"===a.role&&"owner"!==t)throw new Error("Cannot change owner role. Transfer ownership first.");a.role=t,a.permissions=this.getDefaultPermissions(t),this.saveData()}getMemberById(e){return this.household?.members.find(t=>t.id===e)}logActivity(e,t,s,a,r,i){const d={id:this.generateId(),memberId:e,memberName:t,action:s,details:a,timestamp:new Date,entityId:r,entityType:i};this.activities.unshift(d),this.activities.length>100&&(this.activities=this.activities.slice(0,100)),this.saveData()}getRecentActivities(e=20){return this.activities.slice(0,e)}calculateMemberContributions(e){if(!this.household)return[];const t=new Map;let s=0;return this.household.members.forEach(e=>{t.set(e.id,{memberId:e.id,memberName:e.name,totalIncome:0,totalExpenses:0,netContribution:0,transactionCount:0,percentageOfHousehold:0})}),e.forEach(e=>{const a=e.addedBy||this.household.createdBy,r=t.get(a);r&&(r.transactionCount++,"income"===e.type?r.totalIncome+=Math.abs(e.amount):"expense"===e.type&&(r.totalExpenses+=Math.abs(e.amount),s+=Math.abs(e.amount)))}),t.forEach(e=>{e.netContribution=e.totalIncome-e.totalExpenses,s>0&&(e.percentageOfHousehold=e.totalExpenses/s*100)}),Array.from(t.values())}canMemberPerformAction(e,t){const s=this.household?.members.find(t=>t.id===e);return!!s&&s.permissions[t]}getDefaultPermissions(e){switch(e){case"owner":return{canViewAccounts:!0,canEditAccounts:!0,canViewTransactions:!0,canEditTransactions:!0,canViewBudgets:!0,canEditBudgets:!0,canViewGoals:!0,canEditGoals:!0,canInviteMembers:!0,canRemoveMembers:!0};case"admin":return{canViewAccounts:!0,canEditAccounts:!0,canViewTransactions:!0,canEditTransactions:!0,canViewBudgets:!0,canEditBudgets:!0,canViewGoals:!0,canEditGoals:!0,canInviteMembers:!0,canRemoveMembers:!1};case"member":return{canViewAccounts:!0,canEditAccounts:!1,canViewTransactions:!0,canEditTransactions:!0,canViewBudgets:!0,canEditBudgets:!1,canViewGoals:!0,canEditGoals:!1,canInviteMembers:!1,canRemoveMembers:!1};case"viewer":return{canViewAccounts:!0,canEditAccounts:!1,canViewTransactions:!0,canEditTransactions:!1,canViewBudgets:!0,canEditBudgets:!1,canViewGoals:!0,canEditGoals:!1,canInviteMembers:!1,canRemoveMembers:!1}}}generateMemberColor(e){const t=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#06B6D4","#F97316","#EC4899"];return t[e%t.length]}generateId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}generateToken(){return Math.random().toString(36).substr(2)+Math.random().toString(36).substr(2)}transferOwnership(e,t){if(!this.household)return;const s=this.household.members.find(t=>t.id===e),a=this.household.members.find(e=>e.id===t);if(!s||"owner"!==s.role)throw new Error("Only the current owner can transfer ownership");if(!a)throw new Error("New owner not found");s.role="admin",s.permissions=this.getDefaultPermissions("admin"),a.role="owner",a.permissions=this.getDefaultPermissions("owner"),this.household.createdBy=t,this.saveData()}leaveHousehold(e){if(!this.household)return;const t=this.household.members.find(t=>t.id===e);if(t){if("owner"===t.role&&this.household.members.length>1)throw new Error("Owner must transfer ownership before leaving");1===this.household.members.length?(this.household=null,this.invites=[],this.activities=[],localStorage.removeItem(this.STORAGE_KEY),localStorage.removeItem(this.INVITES_KEY),localStorage.removeItem(this.ACTIVITIES_KEY)):(this.household.members=this.household.members.filter(t=>t.id!==e),this.saveData())}}getPendingInvites(){return this.household?this.invites.filter(e=>e.householdId===this.household.id&&"pending"===e.status&&new Date<=e.expiresAt):[]}cancelInvite(e){const t=this.invites.find(t=>t.id===e);t&&"pending"===t.status&&(t.status="declined",this.saveData())}},w=new class{BUDGETS_KEY="shared_budgets";GOALS_KEY="shared_goals";APPROVALS_KEY="budget_approvals";ACTIVITIES_KEY="shared_finance_activities";sharedBudgets=[];sharedGoals=[];approvals=[];activities=[];constructor(){this.loadData()}loadData(){try{const e=localStorage.getItem(this.BUDGETS_KEY);e&&(this.sharedBudgets=JSON.parse(e).map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:e.updatedAt?new Date(e.updatedAt):void 0,lastModifiedAt:e.lastModifiedAt?new Date(e.lastModifiedAt):void 0})));const t=localStorage.getItem(this.GOALS_KEY);t&&(this.sharedGoals=JSON.parse(t).map(e=>({...e,createdAt:new Date(e.createdAt),targetDate:new Date(e.targetDate),lastModifiedAt:e.lastModifiedAt?new Date(e.lastModifiedAt):void 0,contributors:e.contributors.map(e=>({...e,lastContribution:e.lastContribution?new Date(e.lastContribution):void 0}))})));const s=localStorage.getItem(this.APPROVALS_KEY);s&&(this.approvals=JSON.parse(s).map(e=>({...e,requestedAt:new Date(e.requestedAt),reviewedAt:e.reviewedAt?new Date(e.reviewedAt):void 0})));const a=localStorage.getItem(this.ACTIVITIES_KEY);a&&(this.activities=JSON.parse(a).map(e=>({...e,timestamp:new Date(e.timestamp)})))}catch(e){console.error("Failed to load shared finance data:",e)}}saveData(){try{localStorage.setItem(this.BUDGETS_KEY,JSON.stringify(this.sharedBudgets)),localStorage.setItem(this.GOALS_KEY,JSON.stringify(this.sharedGoals)),localStorage.setItem(this.APPROVALS_KEY,JSON.stringify(this.approvals)),localStorage.setItem(this.ACTIVITIES_KEY,JSON.stringify(this.activities))}catch(e){console.error("Failed to save shared finance data:",e)}}createSharedBudget(e,t,s,a,r,i,d=!1,n=0){const o=N.getHousehold();if(!o||o.id!==t)throw new Error("Invalid household");const l={...e,id:this.generateId(),createdAt:new Date,householdId:t,createdBy:s,createdByName:a,sharedWith:r||o.members.map(e=>e.id),editors:i||[s],approvalRequired:d,approvalThreshold:n,isActive:!0};return this.sharedBudgets.push(l),this.saveData(),this.logActivity("budget_created",l.id,"budget",e.name||`${e.category} Budget`,s,a,`Created shared budget for ${e.category}`,e.amount),l}updateSharedBudget(e,t,s,a){const r=this.sharedBudgets.find(t=>t.id===e);if(!r)throw new Error("Budget not found");if(!r.editors.includes(s))throw new Error("Insufficient permissions to edit budget");if(t.amount&&r.approvalRequired&&Math.abs(t.amount-r.amount)>r.approvalThreshold)throw this.requestBudgetApproval(e,t.amount,s,a,"Budget amount change requires approval"),new Error("Budget change requires approval");return Object.assign(r,{...t,lastModifiedBy:s,lastModifiedAt:new Date,updatedAt:new Date}),this.saveData(),this.logActivity("budget_modified",e,"budget",r.name||`${r.category} Budget`,s,a,"Updated shared budget",r.amount),r}createSharedGoal(e,t,s,a,r=!0,i){const d=N.getHousehold();if(!d||d.id!==t)throw new Error("Invalid household");if(!i||0===i.length){const t=d.members.length,s=e.targetAmount/t;i=d.members.map(e=>({memberId:e.id,memberName:e.name,targetAmount:s,currentAmount:0,percentage:100/t,lastContribution:void 0}))}const n={...e,id:this.generateId(),createdAt:new Date,householdId:t,createdBy:s,createdByName:a,sharedWith:d.members.map(e=>e.id),contributors:i,isHouseholdGoal:r,approvalRequired:!1,isCompleted:!1};return this.sharedGoals.push(n),this.saveData(),this.logActivity("goal_created",n.id,"goal",e.name,s,a,`Created shared goal: ${e.name}`,e.targetAmount),n}updateGoalProgress(e,t,s,a){const r=this.sharedGoals.find(t=>t.id===e);if(!r)throw new Error("Goal not found");const i=r.contributors.find(e=>e.memberId===t);if(!i)throw new Error("Member is not a contributor to this goal");i.currentAmount+=a,i.lastContribution=new Date;const d=r.contributors.reduce((e,t)=>e+t.currentAmount,0);return r.currentAmount=d,r.progress=d/r.targetAmount*100,d>=r.targetAmount&&!r.isCompleted?(r.isCompleted=!0,r.completedAt=new Date,this.logActivity("goal_achieved",e,"goal",r.name,t,s,`Goal achieved: ${r.name}!`,r.targetAmount)):this.logActivity("goal_progress",e,"goal",r.name,t,s,`Contributed ${a} to goal`,a),r.lastModifiedBy=t,r.lastModifiedAt=new Date,this.saveData(),r}getHouseholdBudgets(e,t){return this.sharedBudgets.filter(s=>s.householdId===e&&!(t&&!s.sharedWith.includes(t))&&s.isActive)}getHouseholdGoals(e,t){return this.sharedGoals.filter(s=>!(s.householdId!==e||t&&!s.sharedWith.includes(t)||s.isDeleted))}calculateBudgetSpending(e,t,s){const a=this.sharedBudgets.find(t=>t.id===e);if(!a)return new Map;const r=new Map,i=new Date(s.getFullYear(),s.getMonth(),1),d=new Date(s.getFullYear(),s.getMonth()+1,0);return t.filter(e=>e.category===a.category&&"expense"===e.type&&new Date(e.date)>=i&&new Date(e.date)<=d).forEach(e=>{const t=e.addedBy||"unknown",s=r.get(t)||0;r.set(t,s+Math.abs(e.amount))}),r}requestBudgetApproval(e,t,s,a,r){const i={id:this.generateId(),budgetId:e,requestedBy:s,requestedByName:a,requestedAt:new Date,amount:t,reason:r,status:"pending"};return this.approvals.push(i),this.saveData(),this.logActivity("approval_requested",e,"budget","Budget",s,a,"Requested approval for budget change",t),i}reviewApproval(e,t,s,a){const r=this.approvals.find(t=>t.id===e);if(!r)throw new Error("Approval not found");if("pending"!==r.status)throw new Error("Approval already reviewed");if(r.status=s?"approved":"rejected",r.reviewedBy=t,r.reviewedAt=new Date,r.comments=a,s){const e=this.sharedBudgets.find(e=>e.id===r.budgetId);e&&(e.amount=r.amount,e.lastModifiedBy=r.requestedBy,e.lastModifiedAt=new Date,this.logActivity("approval_granted",r.budgetId,"budget",e.name||"Budget",t,"Reviewer",`Approved budget change to ${r.amount}`,r.amount))}this.saveData()}getPendingApprovals(e){const t=this.sharedBudgets.filter(t=>t.householdId===e).map(e=>e.id);return this.approvals.filter(e=>"pending"===e.status&&t.includes(e.budgetId))}getRecentActivities(e,t=20){const s=this.sharedBudgets.filter(t=>t.householdId===e).map(e=>e.id),a=this.sharedGoals.filter(t=>t.householdId===e).map(e=>e.id);return this.activities.filter(e=>"budget"===e.entityType&&s.includes(e.entityId)||"goal"===e.entityType&&a.includes(e.entityId)).slice(0,t)}checkBudgetExceeded(e,t,s,a){const r=this.sharedBudgets.find(t=>t.id===e);return!!r&&t>r.amount&&!r.isExceeded&&(r.isExceeded=!0,this.logActivity("budget_exceeded",e,"budget",r.name||`${r.category} Budget`,s,a,`Budget exceeded! Spent ${t} of ${r.amount}`,t),this.saveData(),!0)}deleteSharedBudget(e,t){const s=this.sharedBudgets.find(t=>t.id===e);if(s){if(!s.editors.includes(t)&&s.createdBy!==t)throw new Error("Insufficient permissions to delete budget");s.isActive=!1,this.saveData()}}deleteSharedGoal(e,t){const s=this.sharedGoals.find(t=>t.id===e);if(s){if(s.createdBy!==t){const e=N.getMemberById(t);if(!e||"owner"!==e.role)throw new Error("Insufficient permissions to delete goal")}s.isDeleted=!0,this.saveData()}}logActivity(e,t,s,a,r,i,d,n){const o={id:this.generateId(),type:e,entityId:t,entityType:s,entityName:a,memberId:r,memberName:i,timestamp:new Date,details:d,amount:n};this.activities.unshift(o),this.activities.length>200&&(this.activities=this.activities.slice(0,200))}generateId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}};export{s as default};
