const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunk-ddLY9KjI.js","assets/chunk-DowOIOga.js","assets/vendor-B-C1h4S3.css","assets/Login-BQOM3qFs.js","assets/Welcome-CK97tJfu.js","assets/chunk-B5pcS96K.js","assets/Dashboard-CKYEzZh9.js","assets/chunk-r7IQz9KP.js","assets/Accounts-DWAHY6JV.js","assets/chunk-EvPoNOTO.js","assets/chunk-ByFoKVyi.js","assets/chunk-BDkVMup3.js","assets/chunk-Cl45ftLB.js","assets/chunk-zIucmNL9.js","assets/TransactionsComparison-xFnX20kn.js","assets/VirtualizedTransactionList-DphhPAUU.js","assets/EditTransactionModal-CLO_33ql.js","assets/chunk-DBtIkPjn.js","assets/chunk-D0OZ1rzO.js","assets/chunk-DUFDJ-wW.js","assets/Reconciliation-BEG42rr4.js","assets/Investments-CKGQFPIi.js","assets/chunk-CpxUZIWP.js","assets/chunk-B-g8QhCB.js","assets/Budget-C5Sxc-SB.js","assets/chunk-CSFgP5a1.js","assets/Goals-CKPqtF9Z.js","assets/Analytics-DvOGMZoC.js","assets/AdvancedAnalytics-3zCkBTdG.js","assets/AIFeatures-BIZ9RYX-.js","assets/SmartCategorizationSettings-Bq6fJsU1.js","assets/chunk-CkYa08k9.js","assets/CustomReports-CveoPPjF.js","assets/TaxPlanning-fxiutPR7.js","assets/Settings-BVzvAdlF.js","assets/AppSettings-DezeLrio.js","assets/DataManagement-SI4p66IV.js","assets/Categories-DM42StY8.js","assets/Tags-Bdon49t2.js","assets/DeletedAccounts-Cn6cOMzp.js","assets/SecuritySettings-C85EcfZ4.js","assets/chunk-Cvxg0-1j.js","assets/AuditLogs-5XgCSMNl.js","assets/chunk-BZWfXafZ.js","assets/Notifications-B6eA2A1f.js","assets/AccessibilitySettings-Cg027gg4.js","assets/AccessibilityDashboard-BCbH7IOI.js","assets/AccountTransactions-DxdtMyyl.js","assets/FinancialSummaries-CKQcTEjI.js","assets/EnhancedInvestments-lgSu_GaN.js","assets/chunk-DoYVaa8Y.js","assets/HouseholdManagement-C0MgbNrl.js","assets/MobileFeatures-jfZlg_xK.js","assets/BusinessFeatures-PcUgKcan.js","assets/FinancialPlanning-IzJU2LJd.js","assets/DataIntelligence-jO6BSNjB.js","assets/ExportManager-DnB7ZSsv.js","assets/Advanced-BGjf7M7I.js","assets/EnhancedImport-CH1BCUTd.js","assets/chunk-BUNwFMNM.js","assets/chunk-5nUEduVz.js","assets/chunk-BfKHasoP.js","assets/chunk-tZvAe11p.js","assets/ImportRulesManager-C3Ynnh9P.js","assets/BatchImportModal-CuigJSg2.js","assets/Documents-BcLEVGQa.js","assets/OCRTest-BmxmDO80.js","assets/OpenBanking-C5Uu6nDH.js","assets/Performance-DbpfWd86.js","assets/Subscription-CC8vFUyZ.js","assets/csrf-protection-Cy0XUYjU.js"])))=>i.map(i=>d[i]);
async function e(e,t,a){try{const n=localStorage.getItem(e);if(!n)return;const r=JSON.parse(n),s=Array.isArray(r)?r:[r];for(const e of s){const n=a?a(e):e;await zr.put(t,n)}console.log(`Migrated ${s.length} items from localStorage to IndexedDB`)}catch(n){console.error(`Failed to migrate ${e}:`,n)}}async function t(){const e=es.getCurrentDatabaseUserId();if(e)return e;let t=null;if("undefined"!=typeof window&&window.Clerk){const e=window.Clerk.user;t=e?.id||null}return t||"undefined"==typeof window||(t=sessionStorage.getItem("current_user_id")||null),t?await es.getDatabaseUserId(t):null}function a({error:e,resetError:t}){return pt.jsx("div",{className:"min-h-[400px] flex items-center justify-center p-4",children:pt.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:[pt.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full",children:pt.jsx(On,{className:"w-6 h-6 text-red-600"})}),pt.jsx("h3",{className:"mt-4 text-lg font-semibold text-center text-gray-900",children:"Something went wrong"}),pt.jsx("p",{className:"mt-2 text-sm text-center text-gray-600",children:e.message||"An unexpected error occurred"}),pt.jsxs("div",{className:"mt-6 flex gap-3",children:[pt.jsx("button",{onClick:t,className:"flex-1 px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Try again"}),pt.jsx("button",{onClick:()=>window.location.reload(),className:"flex-1 px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"Reload page"})]})]})})}function n({children:e,initialAccounts:t=[]}){const[a,n]=gt.useState(()=>{const e=localStorage.getItem("money_management_accounts");if(e)try{return JSON.parse(e).map(e=>({...e,lastUpdated:new Date(e.lastUpdated),openingBalanceDate:e.openingBalanceDate?new Date(e.openingBalanceDate):void 0}))}catch(a){return console.error("Error parsing saved accounts:",a),t}return t});return gt.useEffect(()=>{localStorage.setItem("money_management_accounts",JSON.stringify(a))},[a]),pt.jsx(pc.Provider,{value:{accounts:a,addAccount:e=>{const t={...e,id:Bn(),lastUpdated:new Date};n(e=>[...e,t])},updateAccount:(e,t)=>{n(a=>a.map(a=>a.id===e?{...a,...t,lastUpdated:new Date}:a))},deleteAccount:e=>{n(t=>t.filter(t=>t.id!==e))},getAccount:e=>a.find(t=>t.id===e)},children:e})}function r({children:e,initialTransactions:t=[],initialRecurringTransactions:a=[]}){const[n,r]=gt.useState(()=>{const e=localStorage.getItem("money_management_transactions");if(e)try{return JSON.parse(e).map(e=>({...e,date:new Date(e.date),reconciledDate:e.reconciledDate?new Date(e.reconciledDate):void 0}))}catch(a){return console.error("Error parsing saved transactions:",a),t}return t}),[s,o]=gt.useState(()=>{const e=localStorage.getItem("money_management_recurring_transactions");if(e)try{return JSON.parse(e)}catch(t){return console.error("Error parsing saved recurring transactions:",t),a}return a});gt.useEffect(()=>{localStorage.setItem("money_management_transactions",JSON.stringify(n))},[n]),gt.useEffect(()=>{localStorage.setItem("money_management_recurring_transactions",JSON.stringify(s))},[s]);const i=gt.useMemo(()=>e=>n.filter(t=>t.accountId===e),[n]),c=gt.useMemo(()=>e=>n.filter(t=>t.category===e),[n]);return pt.jsx(hc.Provider,{value:{transactions:n,recurringTransactions:s,addTransaction:e=>{const t={...e,id:Bn()};r(e=>[...e,t])},updateTransaction:(e,t)=>{r(a=>a.map(a=>a.id===e?{...a,...t}:a))},deleteTransaction:e=>{r(t=>t.filter(t=>t.id!==e))},addRecurringTransaction:e=>{const t={...e,id:e.id||Bn()};o(e=>[...e,t])},updateRecurringTransaction:(e,t)=>{o(a=>a.map(a=>a.id===e?{...a,...t}:a))},deleteRecurringTransaction:e=>{o(t=>t.filter(t=>t.id!==e))},importTransactions:e=>{const t=e.map(e=>({...e,id:Bn(),isImported:!0}));r(e=>[...e,...t])},getTransactionsByAccount:i,getTransactionsByCategory:c},children:e})}function s({children:e,initialBudgets:t=[]}){const[a,n]=gt.useState(()=>{const e=localStorage.getItem("money_management_budgets");if(e)try{return JSON.parse(e)}catch(a){return console.error("Error parsing saved budgets:",a),t}return t});return gt.useEffect(()=>{localStorage.setItem("money_management_budgets",JSON.stringify(a))},[a]),pt.jsx(yc.Provider,{value:{budgets:a,addBudget:e=>{const t={...e,id:Bn(),isActive:!1!==e.isActive,createdAt:new Date};n(e=>[...e,t])},updateBudget:(e,t)=>{n(a=>a.map(a=>a.id===e?{...a,...t}:a))},deleteBudget:e=>{n(t=>t.filter(t=>t.id!==e))},getBudgetByCategory:e=>a.find(t=>t.category===e&&!1!==t.isActive)},children:e})}function o(){const e=gt.useContext(yc);if(!e)throw new Error("useBudgets must be used within BudgetProvider");return e}function i({children:e,initialCategories:t}){const[a,n]=gt.useState(()=>{const e=localStorage.getItem("money_management_categories");if(e)try{return JSON.parse(e)}catch(a){return console.error("Error parsing saved categories:",a),t||[{id:"type-income",name:"Income",type:"income",level:"type",isSystem:!0},{id:"type-expense",name:"Expense",type:"expense",level:"type",isSystem:!0},{id:"type-transfer",name:"Transfer",type:"both",level:"type",isSystem:!0},{id:"sub-salary",name:"Salary & Wages",type:"income",level:"sub",parentId:"type-income",isSystem:!0},{id:"sub-business",name:"Business Income",type:"income",level:"sub",parentId:"type-income",isSystem:!0},{id:"sub-investment-income",name:"Investment Income",type:"income",level:"sub",parentId:"type-income",isSystem:!0},{id:"sub-other-income",name:"Other Income",type:"income",level:"sub",parentId:"type-income",isSystem:!0},{id:"salary",name:"Regular Salary",type:"income",level:"detail",parentId:"sub-salary"},{id:"bonus",name:"Bonus",type:"income",level:"detail",parentId:"sub-salary"},{id:"overtime",name:"Overtime",type:"income",level:"detail",parentId:"sub-salary"},{id:"freelance",name:"Freelance Income",type:"income",level:"detail",parentId:"sub-business"},{id:"dividends",name:"Dividends",type:"income",level:"detail",parentId:"sub-investment-income"},{id:"interest",name:"Interest",type:"income",level:"detail",parentId:"sub-investment-income"},{id:"capital-gains",name:"Capital Gains",type:"income",level:"detail",parentId:"sub-investment-income"},{id:"rental-income",name:"Rental Income",type:"income",level:"detail",parentId:"sub-other-income"},{id:"gifts-received",name:"Gifts Received",type:"income",level:"detail",parentId:"sub-other-income"},{id:"sub-housing",name:"Housing",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-transport",name:"Transport",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-food",name:"Food & Dining",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-utilities",name:"Utilities",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-healthcare",name:"Healthcare",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-entertainment",name:"Entertainment",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-shopping",name:"Shopping",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-education",name:"Education",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-personal",name:"Personal Care",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-insurance",name:"Insurance",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-savings",name:"Savings & Investments",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-taxes",name:"Taxes",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-other-expense",name:"Other Expenses",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-adjustments",name:"Adjustments",type:"both",level:"sub",parentId:"type-expense",isSystem:!0},{id:"rent",name:"Rent",type:"expense",level:"detail",parentId:"sub-housing"},{id:"mortgage",name:"Mortgage",type:"expense",level:"detail",parentId:"sub-housing"},{id:"property-tax",name:"Property Tax",type:"expense",level:"detail",parentId:"sub-housing"},{id:"home-maintenance",name:"Home Maintenance",type:"expense",level:"detail",parentId:"sub-housing"},{id:"home-insurance",name:"Home Insurance",type:"expense",level:"detail",parentId:"sub-insurance"},{id:"fuel",name:"Fuel",type:"expense",level:"detail",parentId:"sub-transport"},{id:"public-transport",name:"Public Transport",type:"expense",level:"detail",parentId:"sub-transport"},{id:"car-maintenance",name:"Car Maintenance",type:"expense",level:"detail",parentId:"sub-transport"},{id:"car-insurance",name:"Car Insurance",type:"expense",level:"detail",parentId:"sub-insurance"},{id:"parking",name:"Parking",type:"expense",level:"detail",parentId:"sub-transport"},{id:"tolls",name:"Tolls",type:"expense",level:"detail",parentId:"sub-transport"},{id:"groceries",name:"Groceries",type:"expense",level:"detail",parentId:"sub-food"},{id:"restaurants",name:"Restaurants",type:"expense",level:"detail",parentId:"sub-food"},{id:"takeout",name:"Takeout/Delivery",type:"expense",level:"detail",parentId:"sub-food"},{id:"coffee-shops",name:"Coffee Shops",type:"expense",level:"detail",parentId:"sub-food"},{id:"electricity",name:"Electricity",type:"expense",level:"detail",parentId:"sub-utilities"},{id:"water",name:"Water",type:"expense",level:"detail",parentId:"sub-utilities"},{id:"gas",name:"Gas",type:"expense",level:"detail",parentId:"sub-utilities"},{id:"internet",name:"Internet",type:"expense",level:"detail",parentId:"sub-utilities"},{id:"phone",name:"Phone",type:"expense",level:"detail",parentId:"sub-utilities"},{id:"tv",name:"TV/Streaming",type:"expense",level:"detail",parentId:"sub-utilities"},{id:"health-insurance",name:"Health Insurance",type:"expense",level:"detail",parentId:"sub-insurance"},{id:"doctor",name:"Doctor Visits",type:"expense",level:"detail",parentId:"sub-healthcare"},{id:"dentist",name:"Dental Care",type:"expense",level:"detail",parentId:"sub-healthcare"},{id:"pharmacy",name:"Pharmacy",type:"expense",level:"detail",parentId:"sub-healthcare"},{id:"vision",name:"Vision Care",type:"expense",level:"detail",parentId:"sub-healthcare"},{id:"movies",name:"Movies & Shows",type:"expense",level:"detail",parentId:"sub-entertainment"},{id:"concerts",name:"Concerts & Events",type:"expense",level:"detail",parentId:"sub-entertainment"},{id:"sports",name:"Sports & Recreation",type:"expense",level:"detail",parentId:"sub-entertainment"},{id:"hobbies",name:"Hobbies",type:"expense",level:"detail",parentId:"sub-entertainment"},{id:"subscriptions",name:"Subscriptions",type:"expense",level:"detail",parentId:"sub-entertainment"},{id:"clothing",name:"Clothing",type:"expense",level:"detail",parentId:"sub-shopping"},{id:"electronics",name:"Electronics",type:"expense",level:"detail",parentId:"sub-shopping"},{id:"household",name:"Household Items",type:"expense",level:"detail",parentId:"sub-shopping"},{id:"gifts",name:"Gifts",type:"expense",level:"detail",parentId:"sub-shopping"},{id:"account-adjustments",name:"Account Adjustments",type:"both",level:"detail",parentId:"sub-adjustments",isSystem:!0},{id:"transfer-in",name:"Transfer In",type:"both",level:"detail",parentId:"type-transfer",isSystem:!0},{id:"transfer-out",name:"Transfer Out",type:"both",level:"detail",parentId:"type-transfer",isSystem:!0}]}return t||[{id:"type-income",name:"Income",type:"income",level:"type",isSystem:!0},{id:"type-expense",name:"Expense",type:"expense",level:"type",isSystem:!0},{id:"type-transfer",name:"Transfer",type:"both",level:"type",isSystem:!0},{id:"sub-salary",name:"Salary & Wages",type:"income",level:"sub",parentId:"type-income",isSystem:!0},{id:"sub-business",name:"Business Income",type:"income",level:"sub",parentId:"type-income",isSystem:!0},{id:"sub-investment-income",name:"Investment Income",type:"income",level:"sub",parentId:"type-income",isSystem:!0},{id:"sub-other-income",name:"Other Income",type:"income",level:"sub",parentId:"type-income",isSystem:!0},{id:"salary",name:"Regular Salary",type:"income",level:"detail",parentId:"sub-salary"},{id:"bonus",name:"Bonus",type:"income",level:"detail",parentId:"sub-salary"},{id:"overtime",name:"Overtime",type:"income",level:"detail",parentId:"sub-salary"},{id:"freelance",name:"Freelance Income",type:"income",level:"detail",parentId:"sub-business"},{id:"dividends",name:"Dividends",type:"income",level:"detail",parentId:"sub-investment-income"},{id:"interest",name:"Interest",type:"income",level:"detail",parentId:"sub-investment-income"},{id:"capital-gains",name:"Capital Gains",type:"income",level:"detail",parentId:"sub-investment-income"},{id:"rental-income",name:"Rental Income",type:"income",level:"detail",parentId:"sub-other-income"},{id:"gifts-received",name:"Gifts Received",type:"income",level:"detail",parentId:"sub-other-income"},{id:"sub-housing",name:"Housing",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-transport",name:"Transport",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-food",name:"Food & Dining",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-utilities",name:"Utilities",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-healthcare",name:"Healthcare",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-entertainment",name:"Entertainment",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-shopping",name:"Shopping",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-education",name:"Education",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-personal",name:"Personal Care",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-insurance",name:"Insurance",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-savings",name:"Savings & Investments",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-taxes",name:"Taxes",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-other-expense",name:"Other Expenses",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-adjustments",name:"Adjustments",type:"both",level:"sub",parentId:"type-expense",isSystem:!0},{id:"rent",name:"Rent",type:"expense",level:"detail",parentId:"sub-housing"},{id:"mortgage",name:"Mortgage",type:"expense",level:"detail",parentId:"sub-housing"},{id:"property-tax",name:"Property Tax",type:"expense",level:"detail",parentId:"sub-housing"},{id:"home-maintenance",name:"Home Maintenance",type:"expense",level:"detail",parentId:"sub-housing"},{id:"home-insurance",name:"Home Insurance",type:"expense",level:"detail",parentId:"sub-insurance"},{id:"fuel",name:"Fuel",type:"expense",level:"detail",parentId:"sub-transport"},{id:"public-transport",name:"Public Transport",type:"expense",level:"detail",parentId:"sub-transport"},{id:"car-maintenance",name:"Car Maintenance",type:"expense",level:"detail",parentId:"sub-transport"},{id:"car-insurance",name:"Car Insurance",type:"expense",level:"detail",parentId:"sub-insurance"},{id:"parking",name:"Parking",type:"expense",level:"detail",parentId:"sub-transport"},{id:"tolls",name:"Tolls",type:"expense",level:"detail",parentId:"sub-transport"},{id:"groceries",name:"Groceries",type:"expense",level:"detail",parentId:"sub-food"},{id:"restaurants",name:"Restaurants",type:"expense",level:"detail",parentId:"sub-food"},{id:"takeout",name:"Takeout/Delivery",type:"expense",level:"detail",parentId:"sub-food"},{id:"coffee-shops",name:"Coffee Shops",type:"expense",level:"detail",parentId:"sub-food"},{id:"electricity",name:"Electricity",type:"expense",level:"detail",parentId:"sub-utilities"},{id:"water",name:"Water",type:"expense",level:"detail",parentId:"sub-utilities"},{id:"gas",name:"Gas",type:"expense",level:"detail",parentId:"sub-utilities"},{id:"internet",name:"Internet",type:"expense",level:"detail",parentId:"sub-utilities"},{id:"phone",name:"Phone",type:"expense",level:"detail",parentId:"sub-utilities"},{id:"tv",name:"TV/Streaming",type:"expense",level:"detail",parentId:"sub-utilities"},{id:"health-insurance",name:"Health Insurance",type:"expense",level:"detail",parentId:"sub-insurance"},{id:"doctor",name:"Doctor Visits",type:"expense",level:"detail",parentId:"sub-healthcare"},{id:"dentist",name:"Dental Care",type:"expense",level:"detail",parentId:"sub-healthcare"},{id:"pharmacy",name:"Pharmacy",type:"expense",level:"detail",parentId:"sub-healthcare"},{id:"vision",name:"Vision Care",type:"expense",level:"detail",parentId:"sub-healthcare"},{id:"movies",name:"Movies & Shows",type:"expense",level:"detail",parentId:"sub-entertainment"},{id:"concerts",name:"Concerts & Events",type:"expense",level:"detail",parentId:"sub-entertainment"},{id:"sports",name:"Sports & Recreation",type:"expense",level:"detail",parentId:"sub-entertainment"},{id:"hobbies",name:"Hobbies",type:"expense",level:"detail",parentId:"sub-entertainment"},{id:"subscriptions",name:"Subscriptions",type:"expense",level:"detail",parentId:"sub-entertainment"},{id:"clothing",name:"Clothing",type:"expense",level:"detail",parentId:"sub-shopping"},{id:"electronics",name:"Electronics",type:"expense",level:"detail",parentId:"sub-shopping"},{id:"household",name:"Household Items",type:"expense",level:"detail",parentId:"sub-shopping"},{id:"gifts",name:"Gifts",type:"expense",level:"detail",parentId:"sub-shopping"},{id:"account-adjustments",name:"Account Adjustments",type:"both",level:"detail",parentId:"sub-adjustments",isSystem:!0},{id:"transfer-in",name:"Transfer In",type:"both",level:"detail",parentId:"type-transfer",isSystem:!0},{id:"transfer-out",name:"Transfer Out",type:"both",level:"detail",parentId:"type-transfer",isSystem:!0}]});gt.useEffect(()=>{localStorage.setItem("money_management_categories",JSON.stringify(a))},[a]);const r=gt.useMemo(()=>{const e=new Map;return t=>{if(!t)return"Uncategorized";if(e.has(t))return e.get(t);const n=a.find(e=>e.id===t);if(!n)return"Uncategorized";let r=n.name,s=n;for(;s.parentId;){const e=a.find(e=>e.id===s.parentId);if(!e)break;r=`${e.name} > ${r}`,s=e}return e.set(t,r),r}},[a]);return pt.jsx(fc.Provider,{value:{categories:a,addCategory:e=>{const t={...e,id:Bn()};n(e=>[...e,t])},updateCategory:(e,t)=>{n(a=>a.map(a=>a.id===e?{...a,...t}:a))},deleteCategory:e=>{const t=a.find(t=>t.id===e);t?.isSystem||n(t=>t.filter(t=>t.id!==e))},getCategoryById:e=>a.find(t=>t.id===e),getCategoryPath:r,getSubCategories:e=>a.filter(t=>t.parentId===e&&"sub"===t.level),getDetailCategories:e=>a.filter(t=>t.parentId===e&&"detail"===t.level)},children:e})}function c({children:e,initialGoals:t=[]}){const[a,n]=gt.useState(()=>{const e=localStorage.getItem("money_management_goals");if(e)try{return JSON.parse(e).map(e=>({...e,targetDate:new Date(e.targetDate),createdAt:new Date(e.createdAt)}))}catch(a){return console.error("Error parsing saved goals:",a),t}return t});return gt.useEffect(()=>{localStorage.setItem("money_management_goals",JSON.stringify(a))},[a]),pt.jsx(bc.Provider,{value:{goals:a,addGoal:e=>{const t={...e,id:Bn(),createdAt:new Date};n(e=>[...e,t])},updateGoal:(e,t)=>{n(a=>a.map(a=>a.id===e?{...a,...t}:a))},deleteGoal:e=>{n(t=>t.filter(t=>t.id!==e))},getGoalById:e=>a.find(t=>t.id===e),getActiveGoals:()=>a.filter(e=>e.isActive)},children:e})}function l({children:e}){const[t,a]=gt.useState(()=>{try{const e=localStorage.getItem("money_management_compact_view");return null===e||"true"===e}catch(e){return console.error("Error reading compactView from localStorage:",e),!0}}),[n,r]=gt.useState(()=>{try{return localStorage.getItem("money_management_currency")||"GBP"}catch(e){return console.error("Error reading currency from localStorage:",e),"GBP"}}),[s,o]=gt.useState(()=>{try{const e=localStorage.getItem("money_management_theme");return e?["light","dark","auto","scheduled"].includes(e)?e:"light":(localStorage.setItem("money_management_theme","light"),"light")}catch(e){return console.error("Error reading theme from localStorage:",e),"light"}}),[i,c]=gt.useState(()=>{try{const e=localStorage.getItem("money_management_color_theme");return e&&["blue","green","red","pink"].includes(e)?e:(localStorage.setItem("money_management_color_theme","blue"),"blue")}catch(e){return console.error("Error reading colorTheme from localStorage:",e),"blue"}}),[l,d]=gt.useState(()=>{try{return localStorage.getItem("money_management_first_name")||""}catch(e){return console.error("Error reading firstName from localStorage:",e),""}}),[u,m]=gt.useState(()=>{try{return"false"!==localStorage.getItem("money_management_show_budget")}catch(e){return console.error("Error reading showBudget from localStorage:",e),!0}}),[g,p]=gt.useState(()=>{try{return"false"!==localStorage.getItem("money_management_show_goals")}catch(e){return console.error("Error reading showGoals from localStorage:",e),!0}}),[h,y]=gt.useState(()=>{try{return"false"!==localStorage.getItem("money_management_show_analytics")}catch(e){return console.error("Error reading showAnalytics from localStorage:",e),!0}}),[f,b]=gt.useState(()=>{try{return"false"!==localStorage.getItem("money_management_goal_celebrations")}catch(e){return console.error("Error reading enableGoalCelebrations from localStorage:",e),!0}}),[x,w]=gt.useState(()=>{try{return"false"!==localStorage.getItem("money_management_show_investments")}catch(e){return console.error("Error reading showInvestments from localStorage:",e),!0}}),[v,S]=gt.useState(()=>{try{return"false"!==localStorage.getItem("money_management_show_enhanced_investments")}catch(e){return console.error("Error reading showEnhancedInvestments from localStorage:",e),!0}}),[k,I]=gt.useState(()=>{try{return"false"!==localStorage.getItem("money_management_show_ai_analytics")}catch(e){return console.error("Error reading showAIAnalytics from localStorage:",e),!0}}),[j,C]=gt.useState(()=>{try{return"false"!==localStorage.getItem("money_management_show_tax_planning")}catch(e){return console.error("Error reading showTaxPlanning from localStorage:",e),!0}}),[N,D]=gt.useState(()=>{try{return"false"!==localStorage.getItem("money_management_show_household")}catch(e){return console.error("Error reading showHousehold from localStorage:",e),!0}}),[E,A]=gt.useState(()=>{try{return"false"!==localStorage.getItem("money_management_show_business_features")}catch(e){return console.error("Error reading showBusinessFeatures from localStorage:",e),!0}}),[T,_]=gt.useState(()=>{try{return"false"!==localStorage.getItem("money_management_show_financial_planning")}catch(e){return console.error("Error reading showFinancialPlanning from localStorage:",e),!0}}),[L,P]=gt.useState(()=>{try{return"false"!==localStorage.getItem("money_management_show_data_intelligence")}catch(e){return console.error("Error reading showDataIntelligence from localStorage:",e),!0}}),[M,O]=gt.useState(()=>{try{return"false"!==localStorage.getItem("money_management_show_summaries")}catch(e){return console.error("Error reading showSummaries from localStorage:",e),!0}}),[B,R]=gt.useState(()=>{try{const e=localStorage.getItem("money_management_theme_schedule");return e?JSON.parse(e):{enabled:!1,lightStartTime:"06:00",darkStartTime:"18:00"}}catch(e){return console.error("Error reading theme schedule from localStorage:",e),{enabled:!1,lightStartTime:"06:00",darkStartTime:"18:00"}}}),[F,U]=gt.useState("light"),z=gt.useCallback(()=>{let e="light";if("dark"===s)e="dark";else if("auto"===s)e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";else if("scheduled"===s&&B.enabled){const t=new Date,a=t.getHours().toString().padStart(2,"0")+":"+t.getMinutes().toString().padStart(2,"0"),n=B.lightStartTime;e=a>=B.darkStartTime||a<n?"dark":"light"}else e="light";U(e)},[s,B]);return gt.useEffect(()=>{if(z(),"auto"===s){const e=window.matchMedia("(prefers-color-scheme: dark)"),t=()=>z();return e.addEventListener("change",t),()=>e.removeEventListener("change",t)}if("scheduled"===s&&B.enabled){const e=setInterval(z,6e4);return()=>clearInterval(e)}},[s,B,z]),gt.useEffect(()=>{const e=()=>{const e=document.documentElement;e.classList.remove("dark"),requestAnimationFrame(()=>{"dark"===F?e.classList.add("dark"):e.classList.remove("dark")})};e();const t=setTimeout(e,100);return()=>clearTimeout(t)},[F]),gt.useEffect(()=>{const e=document.documentElement;["theme-blue","theme-green","theme-red","theme-pink"].forEach(t=>{e.classList.remove(t)}),e.classList.add(`theme-${i}`)},[i]),gt.useEffect(()=>{const e=setTimeout(()=>{localStorage.setItem("money_management_compact_view",t.toString()),localStorage.setItem("money_management_currency",n),localStorage.setItem("money_management_theme",s),localStorage.setItem("money_management_color_theme",i),localStorage.setItem("money_management_first_name",l),localStorage.setItem("money_management_show_budget",u.toString()),localStorage.setItem("money_management_show_goals",g.toString()),localStorage.setItem("money_management_show_analytics",h.toString()),localStorage.setItem("money_management_show_investments",x.toString()),localStorage.setItem("money_management_show_enhanced_investments",v.toString()),localStorage.setItem("money_management_show_ai_analytics",k.toString()),localStorage.setItem("money_management_show_tax_planning",j.toString()),localStorage.setItem("money_management_show_household",N.toString()),localStorage.setItem("money_management_show_business_features",E.toString()),localStorage.setItem("money_management_show_financial_planning",T.toString()),localStorage.setItem("money_management_show_data_intelligence",L.toString()),localStorage.setItem("money_management_show_summaries",M.toString()),localStorage.setItem("money_management_theme_schedule",JSON.stringify(B)),localStorage.setItem("money_management_goal_celebrations",f.toString())},300);return()=>clearTimeout(e)},[t,n,s,i,l,u,g,h,x,v,k,j,N,E,T,L,M,B,f]),pt.jsx(xc.Provider,{value:{compactView:t,setCompactView:a,currency:n,setCurrency:r,theme:s,setTheme:o,actualTheme:F,colorTheme:i,setColorTheme:c,firstName:l,setFirstName:d,themeSchedule:B,setThemeSchedule:R,showBudget:u,setShowBudget:m,showGoals:g,setShowGoals:p,showAnalytics:h,setShowAnalytics:y,showInvestments:x,setShowInvestments:w,showEnhancedInvestments:v,setShowEnhancedInvestments:S,showAIAnalytics:k,setShowAIAnalytics:I,showTaxPlanning:j,setShowTaxPlanning:C,showHousehold:N,setShowHousehold:D,showBusinessFeatures:E,setShowBusinessFeatures:A,showFinancialPlanning:T,setShowFinancialPlanning:_,showDataIntelligence:L,setShowDataIntelligence:P,showSummaries:M,setShowSummaries:O,enableGoalCelebrations:f,setEnableGoalCelebrations:b},children:e})}function d(){const e=gt.useContext(xc);if(!e)throw new Error("usePreferences must be used within PreferencesProvider");return e}function u({children:e}){const[t,a]=gt.useState(!1);return pt.jsx(wc.Provider,{value:{isWideView:t,setIsWideView:a},children:e})}function m(){const e=gt.useContext(wc);if(void 0===e)throw new Error("useLayout must be used within a LayoutProvider");return e}function g(e,t){return new Date(e,t+1,0)}function p(e,t,a){const n=[];let r=a,s=0,o=0;const i=new Date(e,t,1),c=g(e,t).getDate();n.push({id:"t"+r++,date:i,description:"Monthly Salary",amount:6e3,type:"income",category:"Salary",accountId:"1",cleared:!0}),n.push({id:"t"+r++,date:i,description:"Mortgage Payment",amount:-1200,type:"transfer",category:"transfer",accountId:"1",cleared:!0}),n.push({id:"t"+r++,date:i,description:"Mortgage Payment",amount:1200,type:"transfer",category:"transfer",accountId:"8",cleared:!0}),Ic.forEach(e=>{n.push({id:"t"+r++,date:i,description:e.description,amount:-e.amount,type:"expense",category:e.category,accountId:"1",cleared:!0})});for(let l=1;l<=c;l++){const a=new Date(e,t,l),i=a.getDay();Math.random()>.85||Object.entries(vc).forEach(([e,t])=>{let d=!1;if(t.frequency>=1){const e=Math.floor(7/t.frequency);d=i%e===0}else{const e=Math.floor(1/t.frequency);d=l===e}if(d&&Math.random()<.8){const i=(u=t.min,m=t.max,Math.round(100*(Math.random()*(m-u)+u))/100),d=t.cards[Math.floor(Math.random()*t.cards.length)],g=kc[e],p=g[Math.floor(Math.random()*g.length)];n.push({id:"t"+r++,date:a,description:p,amount:-i,type:"expense",category:Sc[e],accountId:d,cleared:l<c-2}),"5"===d?s+=i:"6"===d&&(o+=i)}var u,m})}return{transactions:n,creditCardBalances:{natwest:s,amex:o},nextId:r}}function h(e,t,a,n){const r=[];let s=n;const o=new Date(e,t,14);return a.natwest>0&&(r.push({id:"t"+s++,date:o,description:"Credit Card Payment - Natwest",amount:-a.natwest,type:"transfer",category:"transfer",accountId:"1",cleared:!0}),r.push({id:"t"+s++,date:o,description:"Credit Card Payment - Natwest",amount:a.natwest,type:"transfer",category:"transfer",accountId:"5",cleared:!0})),a.amex>0&&(r.push({id:"t"+s++,date:o,description:"Credit Card Payment - American Express",amount:-a.amex,type:"transfer",category:"transfer",accountId:"1",cleared:!0}),r.push({id:"t"+s++,date:o,description:"Credit Card Payment - American Express",amount:a.amex,type:"transfer",category:"transfer",accountId:"6",cleared:!0})),{transactions:r,nextId:s}}function y(e,t){return e.filter(e=>e.accountId===t).reduce((e,t)=>"income"===t.type||"transfer"===t.type&&t.amount>0?e+t.amount:e-Math.abs(t.amount),0)}function f(e,t,a,n){const r=[];let s=n;const o=g(e,t);if(a>.01)r.push({id:"t"+s++,date:o,description:"Balance Sweep to Savings",amount:-a,type:"transfer",category:"transfer",accountId:"1",cleared:!0}),r.push({id:"t"+s++,date:o,description:"Balance Sweep from Current",amount:a,type:"transfer",category:"transfer",accountId:"3",cleared:!0});else if(a<-.01){const e=Math.abs(a);r.push({id:"t"+s++,date:o,description:"Balance Transfer from Savings",amount:-e,type:"transfer",category:"transfer",accountId:"3",cleared:!0}),r.push({id:"t"+s++,date:o,description:"Balance Transfer to Current",amount:e,type:"transfer",category:"transfer",accountId:"1",cleared:!0})}return{transactions:r,nextId:s}}function b(e,t){return new Date(e,t+1,0)}function x({children:e,useTestData:t=!1}){const a=t?[{id:"1",name:"Natwest Current Account",type:"current",balance:0,currency:"GBP",institution:"Natwest",lastUpdated:new Date,openingBalance:0,openingBalanceDate:jc},{id:"2",name:"Monzo Current Account",type:"current",balance:0,currency:"GBP",institution:"Monzo",lastUpdated:new Date,openingBalance:0,openingBalanceDate:jc},{id:"3",name:"Natwest Savings Account",type:"savings",balance:0,currency:"GBP",institution:"Natwest",lastUpdated:new Date,openingBalance:0,openingBalanceDate:jc},{id:"4",name:"NS&I Premium Bonds",type:"savings",balance:0,currency:"GBP",institution:"NS&I",lastUpdated:new Date,openingBalance:0,openingBalanceDate:jc},{id:"5",name:"Natwest Credit Card",type:"credit",balance:0,currency:"GBP",institution:"Natwest",lastUpdated:new Date,openingBalance:0,openingBalanceDate:jc},{id:"6",name:"American Express Gold",type:"credit",balance:0,currency:"GBP",institution:"American Express",lastUpdated:new Date,openingBalance:0,openingBalanceDate:jc},{id:"7",name:"Natwest Personal Loan",type:"loan",balance:0,currency:"GBP",institution:"Natwest",lastUpdated:new Date,openingBalance:0,openingBalanceDate:jc},{id:"8",name:"Natwest Mortgage",type:"mortgage",balance:0,currency:"GBP",institution:"Natwest",lastUpdated:new Date,openingBalance:0,openingBalanceDate:jc},{id:"9",name:"Hargreaves Lansdown SIPP",type:"investment",balance:0,currency:"GBP",institution:"Hargreaves Lansdown",lastUpdated:new Date,openingBalance:0,openingBalanceDate:jc,holdings:Cc(Nc().filter(e=>"9"===e.accountId))},{id:"10",name:"Hargreaves Lansdown ISA",type:"investment",balance:0,currency:"GBP",institution:"Hargreaves Lansdown",lastUpdated:new Date,openingBalance:0,openingBalanceDate:jc},{id:"11",name:"City Trader Account",type:"investment",balance:1e4,currency:"GBP",institution:"City Trading",lastUpdated:new Date,openingBalance:1e4,openingBalanceDate:jc},{id:"12",name:"Primary Residence",type:"asset",balance:0,currency:"GBP",institution:"Property",lastUpdated:new Date,openingBalance:0,openingBalanceDate:jc}]:[],o=t?(()=>{const e=[];let t=1;const a=new Date("2024-07-01");e.push({id:"t"+t++,date:a,description:"Mortgage Loan",amount:-2e5,type:"transfer",category:"transfer",accountId:"8",cleared:!0}),e.push({id:"t"+t++,date:a,description:"Mortgage Loan",amount:2e5,type:"transfer",category:"transfer",accountId:"12",cleared:!0}),e.push({id:"t"+t++,date:a,description:"Personal Loan",amount:-5e4,type:"transfer",category:"transfer",accountId:"7",cleared:!0}),e.push({id:"t"+t++,date:a,description:"Personal Loan",amount:5e4,type:"transfer",category:"transfer",accountId:"1",cleared:!0}),e.push({id:"t"+t++,date:a,description:"House Deposit",amount:-2e4,type:"transfer",category:"transfer",accountId:"1",cleared:!0}),e.push({id:"t"+t++,date:a,description:"House Deposit",amount:2e4,type:"transfer",category:"transfer",accountId:"12",cleared:!0}),e.push({id:"t"+t++,date:a,description:"Hargreaves ISA",amount:-2e4,type:"transfer",category:"transfer",accountId:"1",cleared:!0}),e.push({id:"t"+t++,date:a,description:"Hargreaves ISA",amount:2e4,type:"transfer",category:"transfer",accountId:"10",cleared:!0}),e.push({id:"t"+t++,date:a,description:"NS&I Premium Bonds",amount:-1e4,type:"transfer",category:"transfer",accountId:"1",cleared:!0}),e.push({id:"t"+t++,date:a,description:"NS&I Premium Bonds",amount:1e4,type:"transfer",category:"transfer",accountId:"4",cleared:!0}),Nc().forEach(n=>{const r=n.quantity*n.purchasePrice,s=n.symbol.endsWith(".L")?.005*r:0,o=r+24.95+s;e.push({id:"t"+t++,date:a,description:`Buy ${n.quantity} ${n.symbol}`,amount:-o,type:"expense",category:"Investments",accountId:n.accountId,cleared:!0,investmentData:{symbol:n.symbol,quantity:n.quantity,pricePerShare:n.purchasePrice,transactionFee:24.95,stampDuty:s,totalCost:o}})});let n={natwest:0,amex:0};for(let r=0;r<12;r++){const a=2024+Math.floor((6+r)/12),s=(6+r)%12;if(new Date(a,s,1)>new Date)break;const o=p(a,s,t);if(e.push(...o.transactions),t=o.nextId,r>0){const r=h(a,s,n,t);e.push(...r.transactions),t=r.nextId}const i=y(e.filter(e=>new Date(e.date)<=b(a,s)),"1"),c=f(a,s,i,t);e.push(...c.transactions),t=c.nextId,n=o.creditCardBalances}return e})():[],d=t?[{id:"1",category:"Groceries",amount:600,period:"monthly",isActive:!0,createdAt:jc},{id:"2",category:"Transport",amount:300,period:"monthly",isActive:!0,createdAt:jc},{id:"3",category:"Utilities",amount:200,period:"monthly",isActive:!0,createdAt:jc},{id:"4",category:"Entertainment",amount:400,period:"monthly",isActive:!0,createdAt:jc}]:[],m=t?[{id:"1",name:"Emergency Fund",targetAmount:2e4,currentAmount:1e4,targetDate:new Date("2025-12-31"),type:"savings",createdAt:jc,isActive:!0},{id:"2",name:"Holiday Fund",targetAmount:5e3,currentAmount:2e3,targetDate:new Date("2025-08-01"),type:"savings",createdAt:jc,isActive:!0}]:[];return pt.jsx(l,{children:pt.jsx(u,{children:pt.jsx(i,{children:pt.jsx(n,{initialAccounts:a,children:pt.jsx(r,{initialTransactions:o,initialRecurringTransactions:[],children:pt.jsx(s,{initialBudgets:d,children:pt.jsx(c,{initialGoals:m,children:e})})})})})})})}function w(e){return{id:e.id,name:e.name,type:"checking"===e.type?"current":e.type,balance:e.balance,currency:e.currency,institution:e.institution||"",isActive:e.is_active,initialBalance:e.initial_balance,openingBalance:e.initial_balance,createdAt:e.created_at,updatedAt:e.updated_at,lastUpdated:e.updated_at||e.created_at,icon:e.icon,color:e.color}}async function v(e){try{if(!Qr)throw new Error("Supabase not configured");let t=e;if(e.startsWith("user_")&&(t=await es.getDatabaseUserId(e),!t))return console.log("[SimpleAccountService] No user found for Clerk ID:",e),[];const{data:a,error:n}=await Qr.from("accounts").select("*").eq("user_id",t).eq("is_active",!0).order("created_at",{ascending:!0});if(n)throw console.error("[SimpleAccountService] Error fetching accounts:",n),n;return(a||[]).map(w)}catch(t){return await Vr.get(Gr)||[]}}function S(e){return new Rn(null==e?0:e)}function k(e){return e.reduce((e,t)=>e.plus(S(t)),new Rn(0))}function I(e){return{...e,balance:S(e.balance),openingBalance:void 0!==e.openingBalance?S(e.openingBalance):void 0,holdings:e.holdings?.map(N)}}function j(e){return{...e,amount:S(e.amount)}}function C(e){return{...e,targetAmount:S(e.targetAmount),currentAmount:S(e.currentAmount)}}function N(e){return{...e,shares:S(e.shares),value:S(e.value),averageCost:void 0!==e.averageCost?S(e.averageCost):void 0,currentPrice:void 0!==e.currentPrice?S(e.currentPrice):void 0,marketValue:void 0!==e.marketValue?S(e.marketValue):void 0,gain:void 0!==e.gain?S(e.gain):void 0,gainPercent:void 0!==e.gainPercent?S(e.gainPercent):void 0}}function D({children:e}){const{user:t,isLoaded:a}=Fn(),[n,r]=gt.useState([]),[s,o]=gt.useState([]),[i,c]=gt.useState([]),[l,d]=gt.useState([]),[u,m]=gt.useState([]),[g,p]=gt.useState([]),[h,y]=gt.useState([]),[f,b]=gt.useState(!0),[x,S]=gt.useState(!1),[k,N]=gt.useState(null),[D,E]=gt.useState(null),[A,T]=gt.useState(!1),_=gt.useRef(null),L=gt.useRef(null);gt.useEffect(()=>{a&&(async()=>{b(!0),E(null);try{if(console.log("[AppContext] Initializing with user:",t?.id),t){console.log("[AppContext] User found, initializing services");const e=await es.ensureUserExists(t.id,t.emailAddresses[0]?.emailAddress||"",t.firstName||void 0,t.lastName||void 0);if(e){console.log("[AppContext] Database user ID resolved:",e),await _c.initialize(t.id),await Ac.initialize(t.id,t.emailAddresses[0]?.emailAddress||"",t.firstName||void 0,t.lastName||void 0),console.log("[AppContext] Loading app data...");const a=await v(e);console.log("[AppContext] Accounts loaded:",a.length),r(a)}else console.warn("[AppContext] Failed to resolve database user ID - no data will be loaded"),r([])}else console.log("[AppContext] No user logged in"),r([]);const e=await Ac.loadAppData();if(o(e.transactions),c(e.budgets),d(e.goals),0===e.categories.length?m([{id:"type-income",name:"Income",type:"income",level:"type",isSystem:!0},{id:"type-expense",name:"Expense",type:"expense",level:"type",isSystem:!0},{id:"type-transfer",name:"Transfer",type:"both",level:"type",isSystem:!0},{id:"sub-salary",name:"Salary & Wages",type:"income",level:"sub",parentId:"type-income",isSystem:!0},{id:"sub-business",name:"Business Income",type:"income",level:"sub",parentId:"type-income",isSystem:!0},{id:"sub-investment-income",name:"Investment Income",type:"income",level:"sub",parentId:"type-income",isSystem:!0},{id:"sub-other-income",name:"Other Income",type:"income",level:"sub",parentId:"type-income",isSystem:!0},{id:"salary",name:"Regular Salary",type:"income",level:"detail",parentId:"sub-salary"},{id:"bonus",name:"Bonus",type:"income",level:"detail",parentId:"sub-salary"},{id:"overtime",name:"Overtime",type:"income",level:"detail",parentId:"sub-salary"},{id:"freelance",name:"Freelance Income",type:"income",level:"detail",parentId:"sub-business"},{id:"dividends",name:"Dividends",type:"income",level:"detail",parentId:"sub-investment-income"},{id:"interest",name:"Interest",type:"income",level:"detail",parentId:"sub-investment-income"},{id:"capital-gains",name:"Capital Gains",type:"income",level:"detail",parentId:"sub-investment-income"},{id:"rental-income",name:"Rental Income",type:"income",level:"detail",parentId:"sub-other-income"},{id:"gifts-received",name:"Gifts Received",type:"income",level:"detail",parentId:"sub-other-income"},{id:"sub-housing",name:"Housing",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-transport",name:"Transport",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-food",name:"Food & Dining",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-utilities",name:"Utilities",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-healthcare",name:"Healthcare",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-entertainment",name:"Entertainment",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-shopping",name:"Shopping",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-education",name:"Education",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-personal",name:"Personal Care",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-insurance",name:"Insurance",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-savings",name:"Savings & Investments",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-taxes",name:"Taxes",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-other-expense",name:"Other Expenses",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-adjustments",name:"Adjustments",type:"both",level:"sub",parentId:"type-expense",isSystem:!0},{id:"rent",name:"Rent",type:"expense",level:"detail",parentId:"sub-housing"},{id:"mortgage",name:"Mortgage",type:"expense",level:"detail",parentId:"sub-housing"},{id:"property-tax",name:"Property Tax",type:"expense",level:"detail",parentId:"sub-housing"},{id:"home-maintenance",name:"Home Maintenance",type:"expense",level:"detail",parentId:"sub-housing"},{id:"home-insurance",name:"Home Insurance",type:"expense",level:"detail",parentId:"sub-insurance"},{id:"fuel",name:"Fuel",type:"expense",level:"detail",parentId:"sub-transport"},{id:"public-transport",name:"Public Transport",type:"expense",level:"detail",parentId:"sub-transport"},{id:"car-maintenance",name:"Car Maintenance",type:"expense",level:"detail",parentId:"sub-transport"},{id:"car-insurance",name:"Car Insurance",type:"expense",level:"detail",parentId:"sub-insurance"},{id:"parking",name:"Parking",type:"expense",level:"detail",parentId:"sub-transport"},{id:"tolls",name:"Tolls",type:"expense",level:"detail",parentId:"sub-transport"},{id:"groceries",name:"Groceries",type:"expense",level:"detail",parentId:"sub-food"},{id:"restaurants",name:"Restaurants",type:"expense",level:"detail",parentId:"sub-food"},{id:"takeout",name:"Takeout/Delivery",type:"expense",level:"detail",parentId:"sub-food"},{id:"coffee-shops",name:"Coffee Shops",type:"expense",level:"detail",parentId:"sub-food"},{id:"electricity",name:"Electricity",type:"expense",level:"detail",parentId:"sub-utilities"},{id:"water",name:"Water",type:"expense",level:"detail",parentId:"sub-utilities"},{id:"gas",name:"Gas",type:"expense",level:"detail",parentId:"sub-utilities"},{id:"internet",name:"Internet",type:"expense",level:"detail",parentId:"sub-utilities"},{id:"phone",name:"Phone",type:"expense",level:"detail",parentId:"sub-utilities"},{id:"tv",name:"TV/Streaming",type:"expense",level:"detail",parentId:"sub-utilities"},{id:"health-insurance",name:"Health Insurance",type:"expense",level:"detail",parentId:"sub-insurance"},{id:"doctor",name:"Doctor Visits",type:"expense",level:"detail",parentId:"sub-healthcare"},{id:"dentist",name:"Dental Care",type:"expense",level:"detail",parentId:"sub-healthcare"},{id:"pharmacy",name:"Pharmacy",type:"expense",level:"detail",parentId:"sub-healthcare"},{id:"vision",name:"Vision Care",type:"expense",level:"detail",parentId:"sub-healthcare"},{id:"movies",name:"Movies & Shows",type:"expense",level:"detail",parentId:"sub-entertainment"},{id:"concerts",name:"Concerts & Events",type:"expense",level:"detail",parentId:"sub-entertainment"},{id:"sports",name:"Sports & Recreation",type:"expense",level:"detail",parentId:"sub-entertainment"},{id:"hobbies",name:"Hobbies",type:"expense",level:"detail",parentId:"sub-entertainment"},{id:"subscriptions",name:"Subscriptions",type:"expense",level:"detail",parentId:"sub-entertainment"},{id:"clothing",name:"Clothing",type:"expense",level:"detail",parentId:"sub-shopping"},{id:"electronics",name:"Electronics",type:"expense",level:"detail",parentId:"sub-shopping"},{id:"household",name:"Household Items",type:"expense",level:"detail",parentId:"sub-shopping"},{id:"gifts",name:"Gifts",type:"expense",level:"detail",parentId:"sub-shopping"},{id:"account-adjustments",name:"Account Adjustments",type:"both",level:"detail",parentId:"sub-adjustments",isSystem:!0},{id:"transfer-in",name:"Transfer In",type:"both",level:"detail",parentId:"type-transfer",isSystem:!0},{id:"transfer-out",name:"Transfer Out",type:"both",level:"detail",parentId:"type-transfer",isSystem:!0}]):m(e.categories),T(Ac.isUsingSupabase()),N(new Date),Ac.isUsingSupabase()&&t){const e=(e,t)=>{const a=Date.now();_.current&&_.current.type===e&&a-_.current.timestamp<1e3?console.log(`[AppContext] Skipping duplicate ${e} update`):(L.current&&clearTimeout(L.current),L.current=setTimeout(async()=>{_.current={type:e,timestamp:a},await t()},200))},a=async function(a){if(!Qr)return()=>{};try{const n=await es.getDatabaseUserId(a);if(!n)return console.warn("[SimpleAccountService] No database user found for Clerk ID:",a),()=>{};console.log("[SimpleAccountService] Database user ID:",n);const s=Qr.channel(`accounts-${n}`).on("postgres_changes",{event:"*",schema:"public",table:"accounts",filter:`user_id=eq.${n}`},a=>{console.log("\ud83d\udd14 [SimpleAccountService] Real-time update received!"),console.log("   Event type:",a.eventType),console.log("   Table:",a.table),console.log("   Schema:",a.schema),console.log("   Old record:",a.old),console.log("   New record:",a.new),console.log("   Commit timestamp:",a.commit_timestamp),console.log("   Full payload:",a),(async a=>{console.log("[AppContext] Real-time account update received:",a),console.log("[AppContext] Update type:",a.eventType),"UPDATE"===a.eventType&&a.new&&!a.new.is_active&&console.log("[AppContext] Account was soft-deleted (is_active = false)"),e("account",async()=>{console.log("[AppContext] Reloading accounts after real-time update");const e=await v(t.id);console.log("[AppContext] Updated accounts:",e.length,"accounts"),r(e),N(new Date);const a=await Ac.getTransactions();o(a)})})(a)}).subscribe((e,t)=>{if(console.log(`\ud83d\udce1 [SimpleAccountService] Subscription status: ${e}`),t&&console.error("\u274c [SimpleAccountService] Subscription error:",t),"SUBSCRIBED"===e){console.log("\u2705 [SimpleAccountService] Successfully subscribed!"),console.log("   Channel:",`accounts-${n}`),console.log("   Filter:",`user_id=eq.${n}`),console.log("   Database user ID:",n);const e=Qr.getChannels();console.log(`\ud83d\udcca [SimpleAccountService] Total active channels: ${e.length}`),e.forEach((e,t)=>{console.log(`   ${t+1}. ${e.topic} - State: ${e.state}`)})}else"CHANNEL_ERROR"===e?(console.error("\u274c [SimpleAccountService] Channel error - check if realtime is enabled in Supabase"),console.error("   You may need to enable realtime for the accounts table in Supabase dashboard"),console.error("   Go to: Table Editor > accounts > Replication (toggle on)")):"TIMED_OUT"===e?console.error("\u23f1\ufe0f [SimpleAccountService] Subscription timed out"):"CLOSED"===e&&console.log("\ud83d\udd12 [SimpleAccountService] Channel closed")});return()=>{console.log("[SimpleAccountService] Unsubscribing from real-time updates"),Qr.removeChannel(s)}}catch(n){return console.error("[SimpleAccountService] Error setting up subscription:",n),()=>{}}}(t.id),n=await a,s=Ac.subscribeToUpdates({onTransactionUpdate:async t=>{console.log("[AppContext] Transaction update:",t),e("transaction",async()=>{const e=await Ac.getTransactions();o(e);const t=await Ac.getAccounts();r(t),N(new Date)})}});return()=>{L.current&&clearTimeout(L.current),n(),s()}}}catch(e){console.error("[AppContext] Failed to initialize data:",e),console.error("[AppContext] Error details:",{message:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0}),E("Failed to load data. Using offline mode.")}finally{b(!1)}})()},[t,a]),gt.useCallback(async()=>{S(!0);try{const e=await Ac.refreshData();r(e.accounts),o(e.transactions),c(e.budgets),d(e.goals),e.categories.length>0&&m(e.categories),N(new Date),E(null)}catch(e){console.error("Failed to refresh data:",e),E("Failed to sync data")}finally{S(!1)}},[]);const P=gt.useCallback(async e=>{try{if(console.log("[AppContext] Adding account:",e),!t?.id)throw new Error("User not authenticated");const a={...e,balance:e.initialBalance||e.balance||0,initialBalance:e.initialBalance||e.balance||0,isActive:void 0===e.isActive||e.isActive},n=await async function(e,t){let a=await es.getDatabaseUserId(e);try{if(!Qr)throw new Error("Supabase not configured - using localStorage");if(a)console.log("[SimpleAccountService] Using existing user:",a);else{if(a=await es.ensureUserExists(e,"user@example.com",void 0,void 0),!a)throw new Error("Failed to get or create database user");console.log("[SimpleAccountService] Created user via userIdService:",a)}const n={user_id:a,name:t.name,type:"current"===t.type?"checking":t.type,currency:t.currency||"GBP",balance:t.balance||0,initial_balance:t.initialBalance||t.balance||0,is_active:!1!==t.isActive,institution:t.institution||null,icon:t.icon||null,color:t.color||null};console.log("[SimpleAccountService] Creating account with data:",n);const{data:r,error:s}=await Qr.from("accounts").insert(n).select().single();if(s)throw console.error("[SimpleAccountService] Failed to create account:",s),console.error("[SimpleAccountService] Error details:",{message:s.message,details:s.details,hint:s.hint,code:s.code}),s;if(!r)throw console.error("[SimpleAccountService] No data returned from account creation"),new Error("Account creation returned no data");return console.log("[SimpleAccountService] Account created successfully:",r),w(r)}catch(n){console.error("[SimpleAccountService] Error creating account, falling back to localStorage:",n);const e={...t,id:crypto.randomUUID(),createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},a=await Vr.get(Gr)||[];return a.push(e),await Vr.set(Gr,a),e}}(t.id,a);return console.log("[AppContext] Account created:",n),r(e=>[...e,n]),n}catch(a){throw console.error("[AppContext] Failed to add account:",a),a}},[t]),M=gt.useCallback(async(e,t)=>{try{const a=await Ac.updateAccount(e,t);r(t=>t.map(t=>t.id===e?a:t))}catch(a){throw console.error("Failed to update account:",a),a}},[]),O=gt.useCallback(async e=>{try{await Ac.deleteAccount(e),r(t=>t.filter(t=>t.id!==e)),o(t=>t.filter(t=>t.accountId!==e))}catch(t){throw console.error("Failed to delete account:",t),t}},[]),B=gt.useCallback(async e=>{try{const t=await Ac.createTransaction(e);o(e=>[...e,t]),r(t=>t.map(t=>t.id===e.accountId?{...t,balance:(t.balance||0)+e.amount}:t))}catch(t){throw console.error("Failed to add transaction:",t),t}},[]),R=gt.useCallback(async(e,t)=>{try{const a=s.find(t=>t.id===e),n=await Ac.updateTransaction(e,t);if(o(t=>t.map(t=>t.id===e?n:t)),a&&void 0!==t.amount&&t.amount!==a.amount){const e=t.amount-a.amount;r(t=>t.map(t=>t.id===a.accountId?{...t,balance:(t.balance||0)+e}:t))}}catch(a){throw console.error("Failed to update transaction:",a),a}},[s]),F=gt.useCallback(async e=>{try{const t=s.find(t=>t.id===e);await Ac.deleteTransaction(e),o(t=>t.filter(t=>t.id!==e)),t&&r(e=>e.map(e=>e.id===t.accountId?{...e,balance:(e.balance||0)-t.amount}:e))}catch(t){throw console.error("Failed to delete transaction:",t),t}},[s]),U=gt.useCallback(e=>{const t={...e,id:crypto.randomUUID(),spent:0};c(e=>[...e,t])},[]),z=gt.useCallback((e,t)=>{c(a=>a.map(a=>a.id===e?{...a,...t}:a))},[]),$=gt.useCallback(e=>{c(t=>t.filter(t=>t.id!==e))},[]),G=gt.useCallback(e=>{const t={...e,id:crypto.randomUUID(),progress:0};d(e=>[...e,t])},[]),q=gt.useCallback((e,t)=>{d(a=>a.map(a=>a.id===e?{...a,...t}:a))},[]),H=gt.useCallback(e=>{d(t=>t.filter(t=>t.id!==e))},[]),W=gt.useCallback((e,t)=>{d(a=>a.map(a=>{if(a.id===e){const e=Math.min((a.progress||0)+t,a.targetAmount);return{...a,progress:e}}return a}))},[]),Y=gt.useCallback(e=>{const t={...e,id:crypto.randomUUID()};m(e=>[...e,t])},[]),V=gt.useCallback((e,t)=>{m(a=>a.map(a=>a.id===e?{...a,...t}:a))},[]),Q=gt.useCallback(e=>{m(t=>t.filter(t=>t.id!==e&&t.parentId!==e))},[]),J=gt.useCallback(e=>u.filter(t=>t.parentId===e),[u]),K=gt.useCallback(e=>u.filter(t=>t.parentId===e),[u]),Z=gt.useCallback(e=>{const t={...e,id:crypto.randomUUID(),createdAt:new Date,updatedAt:new Date};p(e=>[...e,t])},[]),X=gt.useCallback((e,t)=>{p(a=>a.map(a=>a.id===e?{...a,...t,updatedAt:new Date}:a))},[]),ee=gt.useCallback(e=>{p(t=>t.filter(t=>t.id!==e))},[]),te=gt.useCallback(e=>s.filter(t=>t.tags?.includes(e)??!1).length,[s]),ae=gt.useCallback(()=>{const e=new Set;return s.forEach(t=>{t.tags&&t.tags.forEach(t=>e.add(t))}),Array.from(e)},[s]),ne=gt.useCallback(e=>{e.accounts&&r(e.accounts),e.transactions&&o(e.transactions),e.budgets&&c(e.budgets),e.goals&&d(e.goals),e.categories&&m(e.categories),e.tags&&p(e.tags),e.recurringTransactions&&y(e.recurringTransactions)},[]),re=gt.useCallback(()=>({accounts:n,transactions:s,budgets:i,goals:l,categories:u,tags:g,recurringTransactions:h}),[n,s,i,l,u,g,h]),se=gt.useCallback(()=>s.map(j),[s]),oe=gt.useCallback(()=>n.map(I),[n]),ie=gt.useCallback(()=>l.map(C),[l]),ce=gt.useCallback(()=>{r([]),o([]),c([]),d([]),m([{id:"type-income",name:"Income",type:"income",level:"type",isSystem:!0},{id:"type-expense",name:"Expense",type:"expense",level:"type",isSystem:!0},{id:"type-transfer",name:"Transfer",type:"both",level:"type",isSystem:!0},{id:"sub-salary",name:"Salary & Wages",type:"income",level:"sub",parentId:"type-income",isSystem:!0},{id:"sub-business",name:"Business Income",type:"income",level:"sub",parentId:"type-income",isSystem:!0},{id:"sub-investment-income",name:"Investment Income",type:"income",level:"sub",parentId:"type-income",isSystem:!0},{id:"sub-other-income",name:"Other Income",type:"income",level:"sub",parentId:"type-income",isSystem:!0},{id:"salary",name:"Regular Salary",type:"income",level:"detail",parentId:"sub-salary"},{id:"bonus",name:"Bonus",type:"income",level:"detail",parentId:"sub-salary"},{id:"overtime",name:"Overtime",type:"income",level:"detail",parentId:"sub-salary"},{id:"freelance",name:"Freelance Income",type:"income",level:"detail",parentId:"sub-business"},{id:"dividends",name:"Dividends",type:"income",level:"detail",parentId:"sub-investment-income"},{id:"interest",name:"Interest",type:"income",level:"detail",parentId:"sub-investment-income"},{id:"capital-gains",name:"Capital Gains",type:"income",level:"detail",parentId:"sub-investment-income"},{id:"rental-income",name:"Rental Income",type:"income",level:"detail",parentId:"sub-other-income"},{id:"gifts-received",name:"Gifts Received",type:"income",level:"detail",parentId:"sub-other-income"},{id:"sub-housing",name:"Housing",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-transport",name:"Transport",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-food",name:"Food & Dining",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-utilities",name:"Utilities",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-healthcare",name:"Healthcare",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-entertainment",name:"Entertainment",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-shopping",name:"Shopping",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-education",name:"Education",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-personal",name:"Personal Care",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-insurance",name:"Insurance",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-savings",name:"Savings & Investments",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-taxes",name:"Taxes",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-other-expense",name:"Other Expenses",type:"expense",level:"sub",parentId:"type-expense",isSystem:!0},{id:"sub-adjustments",name:"Adjustments",type:"both",level:"sub",parentId:"type-expense",isSystem:!0},{id:"rent",name:"Rent",type:"expense",level:"detail",parentId:"sub-housing"},{id:"mortgage",name:"Mortgage",type:"expense",level:"detail",parentId:"sub-housing"},{id:"property-tax",name:"Property Tax",type:"expense",level:"detail",parentId:"sub-housing"},{id:"home-maintenance",name:"Home Maintenance",type:"expense",level:"detail",parentId:"sub-housing"},{id:"home-insurance",name:"Home Insurance",type:"expense",level:"detail",parentId:"sub-insurance"},{id:"fuel",name:"Fuel",type:"expense",level:"detail",parentId:"sub-transport"},{id:"public-transport",name:"Public Transport",type:"expense",level:"detail",parentId:"sub-transport"},{id:"car-maintenance",name:"Car Maintenance",type:"expense",level:"detail",parentId:"sub-transport"},{id:"car-insurance",name:"Car Insurance",type:"expense",level:"detail",parentId:"sub-insurance"},{id:"parking",name:"Parking",type:"expense",level:"detail",parentId:"sub-transport"},{id:"tolls",name:"Tolls",type:"expense",level:"detail",parentId:"sub-transport"},{id:"groceries",name:"Groceries",type:"expense",level:"detail",parentId:"sub-food"},{id:"restaurants",name:"Restaurants",type:"expense",level:"detail",parentId:"sub-food"},{id:"takeout",name:"Takeout/Delivery",type:"expense",level:"detail",parentId:"sub-food"},{id:"coffee-shops",name:"Coffee Shops",type:"expense",level:"detail",parentId:"sub-food"},{id:"electricity",name:"Electricity",type:"expense",level:"detail",parentId:"sub-utilities"},{id:"water",name:"Water",type:"expense",level:"detail",parentId:"sub-utilities"},{id:"gas",name:"Gas",type:"expense",level:"detail",parentId:"sub-utilities"},{id:"internet",name:"Internet",type:"expense",level:"detail",parentId:"sub-utilities"},{id:"phone",name:"Phone",type:"expense",level:"detail",parentId:"sub-utilities"},{id:"tv",name:"TV/Streaming",type:"expense",level:"detail",parentId:"sub-utilities"},{id:"health-insurance",name:"Health Insurance",type:"expense",level:"detail",parentId:"sub-insurance"},{id:"doctor",name:"Doctor Visits",type:"expense",level:"detail",parentId:"sub-healthcare"},{id:"dentist",name:"Dental Care",type:"expense",level:"detail",parentId:"sub-healthcare"},{id:"pharmacy",name:"Pharmacy",type:"expense",level:"detail",parentId:"sub-healthcare"},{id:"vision",name:"Vision Care",type:"expense",level:"detail",parentId:"sub-healthcare"},{id:"movies",name:"Movies & Shows",type:"expense",level:"detail",parentId:"sub-entertainment"},{id:"concerts",name:"Concerts & Events",type:"expense",level:"detail",parentId:"sub-entertainment"},{id:"sports",name:"Sports & Recreation",type:"expense",level:"detail",parentId:"sub-entertainment"},{id:"hobbies",name:"Hobbies",type:"expense",level:"detail",parentId:"sub-entertainment"},{id:"subscriptions",name:"Subscriptions",type:"expense",level:"detail",parentId:"sub-entertainment"},{id:"clothing",name:"Clothing",type:"expense",level:"detail",parentId:"sub-shopping"},{id:"electronics",name:"Electronics",type:"expense",level:"detail",parentId:"sub-shopping"},{id:"household",name:"Household Items",type:"expense",level:"detail",parentId:"sub-shopping"},{id:"gifts",name:"Gifts",type:"expense",level:"detail",parentId:"sub-shopping"},{id:"account-adjustments",name:"Account Adjustments",type:"both",level:"detail",parentId:"sub-adjustments",isSystem:!0},{id:"transfer-in",name:"Transfer In",type:"both",level:"detail",parentId:"type-transfer",isSystem:!0},{id:"transfer-out",name:"Transfer Out",type:"both",level:"detail",parentId:"type-transfer",isSystem:!0}]),p([]),y([])},[]),le={accounts:n,transactions:s,budgets:i,goals:l,categories:u,tags:g,recurringTransactions:h,addAccount:P,updateAccount:M,deleteAccount:O,addTransaction:B,updateTransaction:R,deleteTransaction:F,addBudget:U,updateBudget:z,deleteBudget:$,addGoal:G,updateGoal:q,deleteGoal:H,contributeToGoal:W,addCategory:Y,updateCategory:V,deleteCategory:Q,getSubCategories:J,getDetailCategories:K,addTag:Z,updateTag:X,deleteTag:ee,getTagUsageCount:te,getAllUsedTags:ae,importData:ne,exportData:re,clearAllData:ce,getDecimalTransactions:se,getDecimalAccounts:oe,getDecimalGoals:ie,isLoading:f,isSyncing:x,lastSyncTime:k,syncError:D,isUsingSupabase:A};return pt.jsx(Lc.Provider,{value:le,children:e})}function E(){const e=gt.useContext(Lc);if(void 0===e)throw console.error("useApp called outside of AppProvider"),new Error("useApp must be used within an AppProvider");return e}function A({children:e}){const[t,a]=gt.useState(()=>{try{const e=localStorage.getItem("money_management_notifications"),t=e?JSON.parse(e):[],a=Date.now()-6048e5;return(Array.isArray(t)?t.filter(e=>{try{return new Date(e.timestamp).getTime()>a}catch{return!1}}):[]).slice(0,20)}catch{return[]}}),[n,r]=gt.useState(()=>{try{return"true"===localStorage.getItem("money_management_budget_alerts_enabled")}catch{return!0}}),[s,o]=gt.useState(()=>{try{const e=localStorage.getItem("money_management_alert_threshold");return e?parseInt(e,10):80}catch{return 80}}),[i,c]=gt.useState(()=>{try{return"true"===localStorage.getItem("money_management_large_transaction_alerts_enabled")}catch{return!0}}),[l,d]=gt.useState(()=>{try{const e=localStorage.getItem("money_management_large_transaction_threshold");return e?parseInt(e,10):500}catch{return 500}}),u=t.filter(e=>!e.read).length;gt.useEffect(()=>{localStorage.setItem("money_management_notifications",JSON.stringify(t))},[t]),gt.useEffect(()=>{localStorage.setItem("money_management_budget_alerts_enabled",n.toString())},[n]),gt.useEffect(()=>{localStorage.setItem("money_management_alert_threshold",s.toString())},[s]),gt.useEffect(()=>{localStorage.setItem("money_management_large_transaction_alerts_enabled",i.toString())},[i]),gt.useEffect(()=>{localStorage.setItem("money_management_large_transaction_threshold",l.toString())},[l]);const m=gt.useCallback(e=>{const t={...e,id:`notification-${Date.now()}`,timestamp:new Date,read:!1};a(e=>[t,...e].slice(0,50))},[]),g=gt.useCallback(e=>{a(t=>[...e,...t].slice(0,50))},[]),p=gt.useCallback(e=>{a(t=>t.map(t=>t.id===e?{...t,read:!0}:t))},[]),h=gt.useCallback(()=>{a(e=>e.map(e=>({...e,read:!0})))},[]),y=gt.useCallback(e=>{a(t=>t.filter(t=>t.id!==e))},[]),f=gt.useCallback(()=>{a([])},[]),b=gt.useCallback(e=>{if(!n)return;const a=new Set(t.filter(e=>e.timestamp>new Date(Date.now()-864e5)).map(e=>e.message));e.forEach(e=>{const t=`budget-${e.budgetId}-${e.percentage}`;if(!a.has(t)){const a="danger"===e.type?"error":"warning",n="danger"===e.type?`Budget Exceeded: ${e.categoryName}`:`Budget Warning: ${e.categoryName}`;"danger"===e.type?(e.percentage,e.period,new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(e.spent),new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(e.budget)):(e.percentage,e.period),m({type:a,title:n,message:t,action:{label:"View Budget",onClick:()=>{window.location.href="/budget"}}})}})},[n,t,m]),x=gt.useCallback((e,t)=>{i&&e>=l&&m({type:"warning",title:"Large Transaction Detected",message:`A large transaction of ${new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(e)} was added: ${t}`,action:{label:"View Transactions",onClick:()=>{window.location.href="/transactions"}}})},[i,l,m]),w=gt.useCallback((e,t,a)=>{if(!n)return;const r=Pc.checkBudgetAlerts(e,t,a);r.length>0&&g(r)},[n,g]),v=gt.useCallback((e,t)=>{if(!i)return;const a=Pc.checkTransactionAlerts(e,t);a.length>0&&g(a)},[i,g]),S=gt.useCallback((e,t)=>{const a=Pc.checkGoalProgress(e,t);a.length>0&&g(a)},[g]);return pt.jsx(Mc.Provider,{value:{notifications:t,unreadCount:u,budgetAlertsEnabled:n,setBudgetAlertsEnabled:r,alertThreshold:s,setAlertThreshold:o,largeTransactionAlertsEnabled:i,setLargeTransactionAlertsEnabled:c,largeTransactionThreshold:l,setLargeTransactionThreshold:d,addNotification:m,addNotifications:g,markAsRead:p,markAllAsRead:h,removeNotification:y,clearAll:f,checkBudgetAlerts:b,checkLargeTransaction:x,checkEnhancedBudgetAlerts:w,checkEnhancedTransactionAlerts:v,checkGoalProgress:S},children:e})}function T(){const e=gt.useContext(Mc);if(!e)throw new Error("useNotifications must be used within a NotificationProvider");return e}function _(e){return vl[e]||vl.lightBlue}function L(e){const t=document.documentElement;Object.entries(e.colors).forEach(([e,a])=>{Object.entries(a).forEach(([a,n])=>{t.style.setProperty(`--color-${e}-${a}`,n)})}),Object.entries(ul).forEach(([e,a])=>{t.style.setProperty(`--font-size-${e}`,a)}),Object.entries(ml).forEach(([e,a])=>{t.style.setProperty(`--font-weight-${e}`,a)}),Object.entries(gl).forEach(([e,a])=>{t.style.setProperty(`--line-height-${e}`,a)}),Object.entries(pl).forEach(([e,a])=>{const n=e.replace(".","-");t.style.setProperty(`--spacing-${n}`,a)}),Object.entries(hl).forEach(([e,a])=>{t.style.setProperty(`--radius-${e}`,a)}),Object.entries(yl).forEach(([e,a])=>{t.style.setProperty(`--shadow-${e}`,a)}),Object.entries(fl).forEach(([e,a])=>{t.style.setProperty(`--duration-${e}`,a)}),Object.entries(bl).forEach(([e,a])=>{t.style.setProperty(`--easing-${e}`,a)}),t.setAttribute("data-theme",e.id),t.setAttribute("data-theme-mode",e.isDark?"dark":"light"),e.isDark?t.classList.add("dark"):t.classList.remove("dark")}function P({children:e,defaultTheme:t="lightBlue",storageKey:a="wealthtracker-theme"}){const[n,r]=gt.useState(()=>"undefined"!=typeof window&&localStorage.getItem(a)||t),[s,o]=gt.useState(()=>{if("undefined"!=typeof window){const e=localStorage.getItem(`${a}-custom`);if(e)try{return JSON.parse(e)}catch{return[]}}return[]}),i=_(n)||s.find(e=>e.id===n)||_(t),c=gt.useCallback(e=>{r(e),localStorage.setItem(a,e);const t=_(e)||s.find(t=>t.id===e);t&&L(t)},[a,s]),l=gt.useCallback((e,t)=>{const a=function(e,t){const a=`${t?"dark":"light"}${e.charAt(0).toUpperCase()+e.slice(1)}`;return vl[a]||(t?vl.darkBlue:vl.lightBlue)}(e,t);c(a.id)},[c]),d=gt.useCallback((e,t,n)=>{const r=_(t),i={id:`custom-${Date.now()}`,name:e,description:`Custom theme based on ${r.name}`,isDark:r.isDark,colors:{...r.colors,...n}},l=[...s,i];o(l),localStorage.setItem(`${a}-custom`,JSON.stringify(l)),c(i.id)},[s,a,c]);gt.useEffect(()=>{L(i)},[i]),gt.useEffect(()=>{const e=window.matchMedia("(prefers-color-scheme: dark)"),t=e=>{if("auto"===localStorage.getItem("theme-mode")){const t=localStorage.getItem("color-theme")||"blue";l(t,e.matches)}};return e.addEventListener("change",t),()=>e.removeEventListener("change",t)},[l]);const u={theme:i,setTheme:c,setThemeByMode:l,availableThemes:vl,createCustomTheme:d,customThemes:s};return pt.jsx(Sl.Provider,{value:u,children:e})}function M({children:e}){const{user:t,isLoaded:a}=Fn(),{signOut:n}=Un(),{session:r}=zn(),[s,o]=gt.useState(null),[i,c]=gt.useState(0),[l,d]=gt.useState([]);gt.useEffect(()=>{if(a&&t){const e=kl.mapClerkUser(t);o(e),c(kl.getSecurityScore(e)),d(kl.getSecurityRecommendations(e)),async function(e,t,a){const{userIdService:n}=await jr(async()=>{const{userIdService:e}=await Promise.resolve().then(()=>ts);return{userIdService:e}},void 0);return null!==await n.ensureUserExists(e,t,a?.split(" ")[0],a?.split(" ")[1])}(t.id,t.primaryEmailAddress?.emailAddress||"",t.fullName||void 0).then(e=>{})}else a&&!t&&(o(null),c(0),d([]))},[t,a]);const u={user:s,isLoading:!a,isAuthenticated:!!s,securityScore:i,securityRecommendations:l,signOut:async()=>{await n(),o(null)},refreshSession:async()=>{r&&await r.reload()}};return pt.jsx(Il.Provider,{value:u,children:e})}function O(){const e=gt.useContext(Il);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e}function B(e,t,a){const n=e.filter(e=>e.accountId===t);let r=new Rn(a);for(const s of n){const e=new Rn(s.amount);"income"===s.type?r=r.plus(e):"expense"===s.type?r=r.minus(e):"transfer"===s.type&&(r=r.plus(e))}return r.toNumber()}function R(e,t){return e.filter(e=>"expense"===e.type&&e.category===t.category&&F(e.date,t)).reduce((e,t)=>new Rn(e).plus(t.amount).toNumber(),0)}function F(e,t){const a=new Date(e),n=new Date;switch(t.period){case"monthly":return a.getMonth()===n.getMonth()&&a.getFullYear()===n.getFullYear();case"quarterly":return Math.floor(a.getMonth()/3)===Math.floor(n.getMonth()/3)&&a.getFullYear()===n.getFullYear();case"yearly":return a.getFullYear()===n.getFullYear();default:return!1}}function U(e,t,a){const n=t.goals.goals.filter(t=>t.linkedAccountIds?.includes(e.accountId||""));for(const r of n){let e=new Rn(0);for(const a of r.linkedAccountIds||[]){const n=t.accounts.accounts.find(e=>e.id===a);n&&(e=e.plus(n.balance))}a(Cs({id:r.id,currentAmount:e.toNumber()}))}}function z(){return pt.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:pt.jsxs("div",{className:"text-center",children:[pt.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),pt.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading..."})]})})}function $({children:e}){const t=jt(),{isAuthenticated:a,isLoading:n,user:r}=O(),[s,o]=gt.useState(!1),[i,c]=gt.useState(!1),[l,d]=gt.useState(null);return gt.useEffect(()=>{!a||!r||n||i||s||(async()=>{if(o(!0),d(null),!(await es.ensureUserExists(r.id,r.email||"user@example.com",r.firstName,r.lastName)))return console.error("Failed to initialize user in database"),d("Failed to initialize user account. Please try refreshing the page."),c(!0),void o(!1);"undefined"!=typeof window&&sessionStorage.setItem("current_user_id",r.id),t(jl()).unwrap().then(()=>{c(!0)}).catch(e=>{console.error("\u274c Failed to load data from Supabase:",e),d("Failed to load your data. Please try refreshing the page."),c(!0)}).finally(()=>{o(!1)})})()},[t,a,r,n,i,s]),n||a&&!i?pt.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:pt.jsxs("div",{className:"text-center",children:[pt.jsx(z,{}),pt.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:n?"Authenticating...":"Loading your financial data..."}),s&&pt.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-500",children:"Syncing with cloud storage"})]})}):l?pt.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:pt.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[pt.jsx("div",{className:"mb-4 text-red-500",children:pt.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:pt.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.232 8.5c-.77.833.192 2.5 1.732 2.5z"})})}),pt.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Data Loading Error"}),pt.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:l}),pt.jsx("button",{onClick:()=>{d(null),c(!1)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Retry"})]})}):pt.jsx(pt.Fragment,{children:e})}function G({children:e}){const{user:t,isSignedIn:a}=Fn(),[n,r]=gt.useState(null),[s,o]=gt.useState(null),[i,c]=gt.useState(!0),[l,d]=gt.useState(null),u=n?.tier||"free",m=Cl.getFeatureLimits(u);gt.useEffect(()=>{a&&t?(async()=>{await es.ensureUserExists(t.id,t.primaryEmailAddress?.emailAddress||"",t.firstName||void 0,t.lastName||void 0)&&Dl.initializeUserProfile(t.id,t.primaryEmailAddress?.emailAddress||"",t.fullName||void 0).then(()=>{g()}).catch(()=>{g()})})():(r(null),o(null),c(!1),d(null))},[a,t]);const g=async()=>{c(!0),d(null);try{const e=await Dl.getCurrentSubscription(t.id);r(e);const a=localStorage.getItem(`usage_${t?.id}`);o(a?JSON.parse(a):{accounts:0,transactions:0,budgets:0,goals:0,lastCalculated:new Date})}catch(e){console.error("Error loading subscription data:",e),d("Failed to load subscription information"),r(null),o({accounts:0,transactions:0,budgets:0,goals:0,lastCalculated:new Date})}finally{c(!1)}},p={subscription:n,tier:u,limits:m,usage:s,isLoading:i,error:l,hasFeature:e=>Cl.hasFeatureAccess(u,e),canUseFeature:(e,t)=>{const a=`max${e.charAt(0).toUpperCase()+e.slice(1)}`;return Cl.isWithinLimits(u,t,a)},getRemainingUsage:e=>{if(!s)return 0;const t=`max${e.charAt(0).toUpperCase()+e.slice(1)}`,a=m[t],n=s[e];return-1===a?1/0:Math.max(0,a-n)},refreshSubscription:async()=>{await g()},updateUsage:e=>{const a={...s,...e,lastCalculated:new Date};o(a),t?.id&&localStorage.setItem(`usage_${t.id}`,JSON.stringify(a))}};return pt.jsx(El.Provider,{value:p,children:e})}function q(){const e=gt.useContext(El);if(!e)throw new Error("useSubscription must be used within a SubscriptionProvider");return e}function H({toast:e,onDismiss:t}){const[a,n]=gt.useState(!1),[r,s]=gt.useState(!1);gt.useEffect(()=>{if(setTimeout(()=>n(!0),10),0!==e.duration){const t=setTimeout(()=>{o()},e.duration||5e3);return()=>clearTimeout(t)}},[e.duration]);const o=()=>{s(!0),setTimeout(()=>{t(e.id)},300)},i={success:pt.jsx(io,{size:20,className:"text-green-500"}),error:pt.jsx(vo,{size:20,className:"text-red-500"}),warning:pt.jsx(vo,{size:20,className:"text-yellow-500"}),info:pt.jsx(Tl,{size:20,className:"text-blue-500"})},c={success:"text-green-800 dark:text-green-200",error:"text-red-800 dark:text-red-200",warning:"text-yellow-800 dark:text-yellow-200",info:"text-blue-800 dark:text-blue-200"};return pt.jsxs("div",{className:`\n        flex items-start gap-3 p-4 rounded-lg border shadow-lg\n        ${{success:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",error:"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800",warning:"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800",info:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800"}[e.type]}\n        transform transition-all duration-300 ease-out\n        ${a&&!r?"translate-x-0 opacity-100":"translate-x-full opacity-0"}\n        min-w-[300px] max-w-[500px]\n      `,role:"alert","aria-live":"polite",children:[pt.jsx("div",{className:"flex-shrink-0 mt-0.5",children:i[e.type]}),pt.jsxs("div",{className:"flex-1 min-w-0",children:[e.title&&pt.jsx("p",{className:`font-semibold ${c[e.type]}`,children:e.title}),pt.jsx("p",{className:`text-sm ${c[e.type]} ${e.title?"mt-1":""}`,children:e.message}),e.action&&pt.jsx("button",{onClick:e.action.onClick,className:`\n              mt-2 text-sm font-medium underline\n              ${c[e.type]} hover:no-underline\n              focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary\n            `,children:e.action.label})]}),pt.jsx("button",{onClick:o,className:`\n          flex-shrink-0 p-1 rounded-md\n          ${c[e.type]} hover:bg-black/5 dark:hover:bg-white/5\n          focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary\n          min-w-[44px] min-h-[44px] flex items-center justify-center\n        `,"aria-label":"Dismiss notification",children:pt.jsx(ro,{size:16})})]})}function W({toasts:e,onDismiss:t}){return pt.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-3",role:"region","aria-label":"Notifications","aria-live":"polite","aria-atomic":"false",children:e.map(e=>pt.jsx(H,{toast:e,onDismiss:t},e.id))})}function Y(){const e=gt.useContext(Ll);if(!e)throw new Error("useToast must be used within a ToastProvider");return e}function V({children:e}){const[t,a]=gt.useState([]),n=gt.useCallback(e=>{const t={id:`toast-${Date.now()}-${Math.random()}`,...e};a(e=>[...e,t])},[]),r=gt.useCallback((e,t)=>{n({type:"success",title:t||"Success",message:e,duration:3e3})},[n]),s=gt.useCallback(e=>{const t=function(e){const t=function(e){if("string"==typeof e){for(const[t,a]of Object.entries(_l))if(e.toLowerCase().includes(t.toLowerCase()))return a;return e}if(e instanceof Error){const t=e.message;if("NetworkError"===e.name||t.includes("fetch"))return _l.NetworkError;for(const[e,a]of Object.entries(_l))if(t.toLowerCase().includes(e.toLowerCase()))return a;return t.length>100?"An error occurred. Please try again or contact support if the problem persists.":t}if("object"==typeof e&&null!==e&&"field"in e){const t=e;return _l[t.message]||t.message}return"An unexpected error occurred. Please try again."}(e),a=function(e){const t={"session has expired":"Sign in again","connection problem":"Check connection","try again":"Retry","contact support":"Get help"},a=e.toLowerCase();for(const[n,r]of Object.entries(t))if(a.includes(n))return r;return null}(t);let n="error";t.includes("connection")||t.includes("offline")?n="warning":(t.includes("session")||t.includes("sign in"))&&(n="info");let r="Error";return"warning"===n&&(r="Connection Issue"),"info"===n&&(r="Action Required"),{title:r,message:t,action:a||void 0,type:n}}(e);n({type:t.type,title:t.title,message:t.message,duration:6e3,action:t.action?{label:t.action,onClick:()=>{"Sign in again"===t.action?window.location.href="/login":"Retry"===t.action&&window.location.reload()}}:void 0})},[n]),o=gt.useCallback((e,t)=>{n({type:"warning",title:t||"Warning",message:e,duration:5e3})},[n]),i=gt.useCallback((e,t)=>{n({type:"info",title:t||"Info",message:e,duration:4e3})},[n]),c=gt.useCallback(e=>{a(t=>t.filter(t=>t.id!==e))},[]);return pt.jsxs(Ll.Provider,{value:{showToast:n,showSuccess:r,showError:s,showWarning:o,showInfo:i,dismissToast:c},children:[e,pt.jsx(W,{toasts:t,onDismiss:c})]})}function Q(){const[e,t]=gt.useState([]),[a,n]=gt.useState({total:0,unread:0,transactions:0,accounts:0,budgets:0,goals:0,system:0}),[r,s]=gt.useState(new Date);gt.useEffect(()=>{const e=localStorage.getItem("recentActivities");if(e){const a=JSON.parse(e).map(e=>({...e,timestamp:new Date(e.timestamp)}));t(a),i(a)}const a=localStorage.getItem("lastActivityCheck");a&&s(new Date(a));const n=e=>{o(e.detail)};window.addEventListener("activity-logged",n);const r=setInterval(u,6e4);return()=>{window.removeEventListener("activity-logged",n),clearInterval(r)}},[]);const o=gt.useCallback(e=>{const a={...e,id:`activity_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:new Date,read:!1};t(e=>{const t=[a,...e].slice(0,100);return localStorage.setItem("recentActivities",JSON.stringify(t)),i(t),t}),window.dispatchEvent(new CustomEvent("activity-added",{detail:a}))},[]),i=e=>{const t=e.filter(e=>"sync"!==e.type&&"system"!==e.type),a={total:t.length,unread:t.filter(e=>!e.read).length,transactions:t.filter(e=>"transaction"===e.type).length,accounts:t.filter(e=>"account"===e.type).length,budgets:t.filter(e=>"budget"===e.type).length,goals:t.filter(e=>"goal"===e.type).length,system:0};n(a)},c=gt.useCallback(e=>{t(t=>{const a=t.map(t=>t.id===e?{...t,read:!0}:t);return localStorage.setItem("recentActivities",JSON.stringify(a)),i(a),a})},[]),l=gt.useCallback(()=>{t(e=>{const t=e.map(e=>({...e,read:!0}));return localStorage.setItem("recentActivities",JSON.stringify(t)),i(t),t});const e=new Date;s(e),localStorage.setItem("lastActivityCheck",e.toISOString())},[]),d=gt.useCallback(()=>{t([]),localStorage.removeItem("recentActivities"),i([])},[]),u=gt.useCallback(()=>{const e=localStorage.getItem("recentActivities");if(e){const a=JSON.parse(e).map(e=>({...e,timestamp:new Date(e.timestamp)}));t(a),i(a)}},[]),m=gt.useCallback((t,a=5)=>e.filter(e=>e.type===t).slice(0,a),[e]),g=gt.useCallback(t=>{const a=e.filter(e=>"sync"!==e.type&&"system"!==e.type);return t?a.filter(e=>e.type===t&&!e.read).length:a.filter(e=>!e.read).length},[e]),p=gt.useCallback(()=>e.filter(e=>e.timestamp>r),[e,r]);return{activities:e,counts:a,lastChecked:r,addActivity:o,markAsRead:c,markAllAsRead:l,clearActivities:d,getRecentByType:m,getUnreadCount:g,getNewSinceLastCheck:p}}function J(e){window.dispatchEvent(new CustomEvent("activity-logged",{detail:e}))}function K({children:e}){return function(){const{transactions:e,accounts:t,budgets:a,goals:n}=E();gt.useEffect(()=>{if(0===e.length)return;const t=[...e].sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())[0];Date.now()-new Date(t.date).getTime()<6e4&&J({type:"transaction",title:"New Transaction",description:t.description,category:t.category,amount:parseFloat(t.amount),actionUrl:"/transactions"})},[e.length]),gt.useEffect(()=>{t.forEach(e=>{const t=localStorage.getItem(`account_balance_${e.id}`),a=e.balance.toString();if(t&&t!==a){const n=parseFloat(a)-parseFloat(t);Math.abs(n)>.01&&J({type:"account",title:`${e.name} Balance Updated`,description:`Balance changed by \xa3${Math.abs(n).toFixed(2)}`,amount:n,actionUrl:"/accounts"})}localStorage.setItem(`account_balance_${e.id}`,a)})},[t]),gt.useEffect(()=>{0!==a.length&&a.forEach(t=>{const a=Math.abs(e.filter(e=>e.category===t.category&&parseFloat(e.amount)<0).reduce((e,t)=>e+parseFloat(t.amount),0))/parseFloat(t.amount)*100,n=`budget_alert_${t.id}_${(new Date).getMonth()}`,r=localStorage.getItem(n);a>=90&&!r?(J({type:"budget",title:"Budget Alert",description:`${t.category} budget is ${a.toFixed(0)}% spent`,actionUrl:"/budget"}),localStorage.setItem(n,"true")):a>=75&&a<90&&"75"!==r&&(J({type:"budget",title:"Budget Warning",description:`${t.category} budget is ${a.toFixed(0)}% spent`,actionUrl:"/budget"}),localStorage.setItem(n,"75"))})},[a,e]),gt.useEffect(()=>{n.forEach(e=>{const t=parseFloat(e.currentAmount)/parseFloat(e.targetAmount)*100,a=`goal_milestone_${e.id}`,n=parseInt(localStorage.getItem(a)||"0"),r=[25,50,75,100];for(const s of r)if(t>=s&&n<s){J({type:"goal",title:100===s?"Goal Achieved!":"Goal Milestone",description:`${e.name} is ${s}% complete`,actionUrl:"/goals"}),localStorage.setItem(a,s.toString());break}})},[n]),gt.useEffect(()=>{const e=e=>{J({type:"sync",title:"Data Synchronized",description:"Your data has been synced with the cloud"})},t=e=>{J({type:"system",title:"Sync Error",description:"Failed to sync data. Will retry automatically."})};return window.addEventListener("sync-complete",e),window.addEventListener("sync-error",t),()=>{window.removeEventListener("sync-complete",e),window.removeEventListener("sync-error",t)}},[]),gt.useEffect(()=>{const e=()=>{J({type:"system",title:"Connection Restored",description:"You are back online"})},t=()=>{J({type:"system",title:"Working Offline",description:"Changes will sync when reconnected"})};return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[]),gt.useEffect(()=>{const e=localStorage.getItem("activity_logged_today"),t=(new Date).toDateString();e!==t&&(J({type:"system",title:"Welcome Back",description:"Your data is up to date"}),localStorage.setItem("activity_logged_today",t))},[])}(),gt.useEffect(()=>{},[]),pt.jsx(pt.Fragment,{children:e})}function Z({children:e}){const t=qn(),[a,n]=gt.useState(e),[r,s]=gt.useState("fadeIn");return gt.useEffect(()=>{s("fadeOut");const t=setTimeout(()=>{n(e),s("fadeIn")},200);return()=>clearTimeout(t)},[t.pathname]),pt.jsx("div",{className:`page-transition ${r}`,style:{opacity:"fadeIn"===r?1:0,transform:"fadeIn"===r?"translateX(0)":"translateX(10px)",transition:"opacity 200ms ease-out, transform 200ms ease-out"},children:a})}function X(){const[e,t]=gt.useState(!1),[a,n]=gt.useState(0),r=qn();return gt.useEffect(()=>{t(!0),n(0);const e=setInterval(()=>{n(t=>t>=90?(clearInterval(e),90):t+30)},100),a=setTimeout(()=>{n(100),setTimeout(()=>{t(!1)},200)},300);return()=>{clearInterval(e),clearTimeout(a)}},[r]),e?pt.jsx("div",{className:"fixed top-0 left-0 right-0 h-1 bg-gray-200 dark:bg-gray-700 z-50",children:pt.jsx("div",{className:"h-full bg-primary transition-all duration-300 ease-out",style:{width:`${a}%`}})}):null}function ee(e,t=""){if("true"!==new URLSearchParams(t).get("demo"))return e;const a=e.includes("?")?"&":"?";return e.includes("demo=true")?e:`${e}${a}demo=true`}function te(){const e=qn(),t=e.pathname.split("/").filter(Boolean);if(0===t.length)return null;const a=[{label:"Home",path:ee("/",e.search)}];let n="";return t.forEach((t,r)=>{n+=`/${t}`;const s=Pl[t]||t.charAt(0).toUpperCase()+t.slice(1);a.push({label:s,path:ee(n,e.search)})}),pt.jsx("nav",{"aria-label":"Breadcrumb",className:"hidden sm:block mb-4",children:pt.jsx("ol",{className:"flex items-center space-x-2 text-sm",children:a.map((e,t)=>{const n=t===a.length-1;return pt.jsxs("li",{className:"flex items-center",children:[t>0&&pt.jsx(lo,{size:16,className:"mx-2 text-gray-400 dark:text-gray-600"}),n?pt.jsxs("span",{className:"text-gray-700 dark:text-gray-300 font-medium",children:[0===t&&pt.jsx(qs,{size:16,className:"inline mr-1"}),e.label]}):pt.jsxs(Hn,{to:e.path,className:"text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-primary-light transition-colors",children:[0===t&&pt.jsx(qs,{size:16,className:"inline mr-1"}),e.label]})]},e.path)})})})}function ae(){const e=qn(),t=e.pathname.split("/").filter(Boolean);if(0===t.length)return null;const a=t[t.length-1],n=Pl[a]||a.charAt(0).toUpperCase()+a.slice(1),r=t.length>1?`/${t.slice(0,-1).join("/")}`:"/";return pt.jsx("div",{className:"sm:hidden bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-3",children:pt.jsxs(Hn,{to:ee(r,e.search),className:"flex items-center gap-2 text-primary dark:text-primary-light",children:[pt.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:pt.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),pt.jsx("span",{className:"text-sm font-medium",children:n})]})})}function ne(){return pt.jsxs(pt.Fragment,{children:[pt.jsx(Ol,{}),pt.jsx("style",{jsx:!0,children:"\n        :global(.skip-link) {\n          position: absolute;\n          left: -10000px;\n          top: auto;\n          width: 1px;\n          height: 1px;\n          overflow: hidden;\n          background-color: #1a73e8;\n          color: white;\n          padding: 0.75rem 1.5rem;\n          text-decoration: none;\n          font-weight: 500;\n          border-radius: 0.375rem;\n          z-index: 9999;\n          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n        }\n\n        :global(.skip-link:focus) {\n          position: fixed;\n          left: 1rem;\n          top: 1rem;\n          width: auto;\n          height: auto;\n          overflow: visible;\n          outline: 3px solid #4285f4;\n          outline-offset: 2px;\n          animation: slideIn 0.2s ease-out;\n        }\n\n        @keyframes slideIn {\n          from {\n            transform: translateX(-20px);\n            opacity: 0;\n          }\n          to {\n            transform: translateX(0);\n            opacity: 1;\n          }\n        }\n      "})]})}function re(){return Gn.useEffect(()=>{const e=e=>{"Tab"===e.key&&document.body.classList.add("user-is-tabbing")},t=()=>{document.body.classList.remove("user-is-tabbing")};return window.addEventListener("keydown",e),window.addEventListener("mousedown",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("mousedown",t)}},[]),pt.jsx("style",{jsx:!0,global:!0,children:'\n      /* Enhanced focus styles for keyboard navigation */\n      .user-is-tabbing *:focus {\n        outline: 3px solid #4285f4 !important;\n        outline-offset: 2px !important;\n      }\n\n      /* Remove default focus for mouse users */\n      *:focus:not(.focus-visible) {\n        outline: none;\n      }\n\n      /* Ensure interactive elements have minimum size */\n      button, a, input, select, textarea, [role="button"] {\n        min-height: 44px;\n        min-width: 44px;\n      }\n\n      /* Exception for inline links */\n      p a, li a, span a {\n        min-height: auto;\n        min-width: auto;\n      }\n    '})}function se(){const[e,t]=Gn.useState("");return Gn.useEffect(()=>{const e=()=>{const e=document.title;t(`Navigated to ${e}`)};return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)},[]),pt.jsx("div",{role:"status","aria-live":"polite","aria-atomic":"true",className:"sr-only",children:e})}function oe(){const[e,t]=Gn.useState(!1);return Gn.useEffect(()=>{const e=window.matchMedia("(prefers-contrast: high)"),a=e=>{t(e.matches)};return t(e.matches),e.addEventListener("change",a),()=>e.removeEventListener("change",a)},[]),e}function ie(){const[e,t]=Gn.useState(!1);return Gn.useEffect(()=>{const e=window.matchMedia("(prefers-reduced-motion: reduce)"),a=e=>{t(e.matches)};return t(e.matches),e.addEventListener("change",a),()=>e.removeEventListener("change",a)},[]),e}function ce(){const[e,t]=gt.useState(!navigator.onLine),[a,n]=gt.useState(!1);return gt.useEffect(()=>{const e=()=>{t(!1),n(!0),setTimeout(()=>n(!1),3e3)},a=()=>{t(!0),n(!0)};return window.addEventListener("online",e),window.addEventListener("offline",a),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",a)}},[]),a?pt.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-auto z-50 transition-all duration-300 "+(e||a?"translate-y-0":"translate-y-full"),children:pt.jsx("div",{className:"flex items-center gap-3 px-4 py-3 rounded-lg shadow-lg "+(e?"bg-orange-500 text-white":"bg-green-500 text-white"),children:e?pt.jsxs(pt.Fragment,{children:[pt.jsx(Mi,{size:20}),pt.jsxs("div",{children:[pt.jsx("p",{className:"font-medium",children:"You're offline"}),pt.jsx("p",{className:"text-sm opacity-90",children:"Changes will sync when you're back online"})]})]}):pt.jsxs(pt.Fragment,{children:[pt.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:pt.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"})}),pt.jsx("p",{className:"font-medium",children:"Back online"})]})})}):null}function le(){const{isOffline:e,isSyncing:t,pendingChanges:a,syncNow:n}=function(){const[e,t]=gt.useState(!navigator.onLine),[a,n]=gt.useState(!1),[r,s]=gt.useState(0);gt.useEffect(()=>{Bl.init().catch(console.error)},[]);const o=gt.useCallback(async()=>{try{const e=await Bl.getOfflineQueueCount();s(e)}catch(e){console.error("Failed to get offline queue count:",e)}},[]);return gt.useEffect(()=>{const e=()=>{t(!1)},a=()=>{t(!0)},r=()=>{n(!0)},s=()=>{n(!1),o()},i=e=>{};window.addEventListener("online",e),window.addEventListener("offline",a),window.addEventListener("offline-sync-start",r),window.addEventListener("offline-sync-complete",s),window.addEventListener("offline-sync-conflict",i),o();const c=setInterval(o,3e4);return()=>{window.removeEventListener("online",e),window.removeEventListener("offline",a),window.removeEventListener("offline-sync-start",r),window.removeEventListener("offline-sync-complete",s),window.removeEventListener("offline-sync-conflict",i),clearInterval(c)}},[o]),{isOffline:e,isSyncing:a,pendingChanges:r,syncNow:gt.useCallback(async()=>{if(navigator.onLine){n(!0),window.dispatchEvent(new Event("offline-sync-start"));try{await Bl.syncOfflineData()}finally{n(!1)}}},[]),clearOfflineData:gt.useCallback(async()=>{confirm("Are you sure you want to clear all offline data? This cannot be undone.")&&(await Bl.clearOfflineData(),s(0))},[])}}();return e||0!==a||t?pt.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:pt.jsx("div",{className:`\n        flex items-center gap-3 px-4 py-3 rounded-lg shadow-lg backdrop-blur-sm\n        ${e?"bg-orange-500/90":t?"bg-blue-500/90":"bg-green-500/90"}\n        text-white transition-all duration-300\n      `,children:e?pt.jsxs(pt.Fragment,{children:[pt.jsx(Mi,{className:"h-5 w-5"}),pt.jsxs("div",{className:"flex-1",children:[pt.jsx("p",{className:"font-medium",children:"Offline Mode"}),a>0&&pt.jsxs("p",{className:"text-sm opacity-90",children:[a," change",1!==a?"s":""," pending"]})]})]}):t?pt.jsxs(pt.Fragment,{children:[pt.jsx(Po,{className:"h-5 w-5 animate-spin"}),pt.jsxs("div",{className:"flex-1",children:[pt.jsx("p",{className:"font-medium",children:"Syncing..."}),pt.jsx("p",{className:"text-sm opacity-90",children:"Uploading your changes"})]})]}):a>0?pt.jsxs(pt.Fragment,{children:[pt.jsx(vo,{className:"h-5 w-5"}),pt.jsxs("div",{className:"flex-1",children:[pt.jsx("p",{className:"font-medium",children:"Changes Pending"}),pt.jsxs("p",{className:"text-sm opacity-90",children:[a," change",1!==a?"s":""," to sync"]})]}),pt.jsx("button",{onClick:n,className:"px-3 py-1 bg-white/20 hover:bg-white/30 rounded-md text-sm font-medium transition-colors",disabled:t,children:"Sync Now"})]}):pt.jsxs(pt.Fragment,{children:[pt.jsx(io,{className:"h-5 w-5"}),pt.jsxs("div",{className:"flex-1",children:[pt.jsx("p",{className:"font-medium",children:"All Synced"}),pt.jsx("p",{className:"text-sm opacity-90",children:"Your data is up to date"})]})]})})}):null}function de(e,t="GBP"){return`${"GBP"===t?"\xa3":"USD"===t?"$":"\u20ac"}${Math.abs(e).toLocaleString("en-GB",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function ue({variant:e="primary",size:t="md",isLoading:a=!1,leftIcon:n,rightIcon:r,fullWidth:s=!1,className:o="",children:i,disabled:c,...l}){const d=s?"w-full":"",u={sm:14,md:16,lg:20}[t];return pt.jsx("button",{className:`\n        \n    inline-flex items-center justify-center font-medium\n    transition-all duration-[var(--duration-fast)] ease-[var(--easing-inOut)]\n    focus:outline-none focus:ring-2 focus:ring-offset-2\n    disabled:opacity-50 disabled:cursor-not-allowed\n  \n        ${{primary:"\n      bg-[var(--color-interactive-primary)] text-white\n      hover:bg-[var(--color-interactive-primaryHover)]\n      active:bg-[var(--color-interactive-primaryActive)]\n      focus:ring-[var(--color-interactive-primary)]\n    ",secondary:"\n      bg-[var(--color-surface-secondary)] text-[var(--color-text-primary)]\n      border border-[var(--color-border-primary)]\n      hover:bg-[var(--color-surface-tertiary)]\n      focus:ring-[var(--color-border-focus)]\n    ",danger:"\n      bg-[var(--color-status-error)] text-white\n      hover:opacity-90\n      focus:ring-[var(--color-status-error)]\n    ",success:"\n      bg-[var(--color-status-success)] text-white\n      hover:opacity-90\n      focus:ring-[var(--color-status-success)]\n    ",ghost:"\n      bg-transparent text-[var(--color-text-primary)]\n      hover:bg-[var(--color-surface-secondary)]\n      focus:ring-[var(--color-border-focus)]\n    "}[e]}\n        ${{sm:"px-[var(--spacing-3)] py-[var(--spacing-1-5)] text-[var(--font-size-sm)] rounded-[var(--radius-md)]",md:"px-[var(--spacing-4)] py-[var(--spacing-2)] text-[var(--font-size-base)] rounded-[var(--radius-md)]",lg:"px-[var(--spacing-6)] py-[var(--spacing-3)] text-[var(--font-size-lg)] rounded-[var(--radius-lg)]"}[t]}\n        ${d}\n        ${o}\n      `,disabled:c||a,...l,children:a?pt.jsxs(pt.Fragment,{children:[pt.jsx(Oi,{className:"animate-spin mr-2",size:u}),pt.jsx("span",{children:"Loading..."})]}):pt.jsxs(pt.Fragment,{children:[n&&pt.jsx(n,{className:"mr-2",size:u}),i,r&&pt.jsx(r,{className:"ml-2",size:u})]})})}function me(){const[e,t]=gt.useState([]),[a,n]=gt.useState(null),[r,s]=gt.useState(!1);gt.useEffect(()=>{o();const e=()=>{o(),s(!0)};return window.addEventListener("offline-sync-conflict",e),()=>{window.removeEventListener("offline-sync-conflict",e)}},[]);const o=async()=>{const e=await Bl.getConflicts();t(e.filter(e=>!e.resolved))};return 0===e.length?null:r?pt.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:pt.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[pt.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:pt.jsxs("div",{className:"flex items-center justify-between",children:[pt.jsxs("div",{children:[pt.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Sync Conflicts"}),pt.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:[e.length," conflict",1!==e.length?"s":""," need",1===e.length?"s":""," resolution"]})]}),pt.jsx("button",{onClick:()=>s(!1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:pt.jsx(ro,{className:"h-5 w-5 text-gray-500"})})]})}),pt.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(80vh-200px)]",children:a?pt.jsx(ge,{conflict:a,onResolve:async(t,a)=>{await Bl.resolveConflict(t,a),await o(),n(null),1===e.length&&s(!1)},onBack:()=>n(null)}):pt.jsx("div",{className:"space-y-3",children:e.map(e=>pt.jsx("button",{onClick:()=>n(e),className:"w-full text-left p-4 rounded-lg border border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 transition-colors",children:pt.jsxs("div",{className:"flex items-center justify-between",children:[pt.jsxs("div",{children:[pt.jsxs("p",{className:"font-medium text-gray-900 dark:text-white capitalize",children:[e.entity," Conflict"]}),pt.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:new Date(e.timestamp).toLocaleString()})]}),pt.jsx(vo,{className:"h-5 w-5 text-red-500"})]})},e.id))})})]})}):pt.jsxs("button",{onClick:()=>s(!0),className:"fixed bottom-20 right-4 bg-red-500 text-white p-3 rounded-full shadow-lg hover:bg-red-600 transition-colors","aria-label":"Resolve sync conflicts",children:[pt.jsx(vo,{className:"h-6 w-6"}),e.length>1&&pt.jsx("span",{className:"absolute -top-1 -right-1 bg-white text-red-500 text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold",children:e.length})]})}function ge({conflict:e,onResolve:t,onBack:a}){return pt.jsx("div",{children:"transaction"===e.entity&&(()=>{const n=e.localData,r=e.serverData||{};return pt.jsxs("div",{className:"space-y-6",children:[pt.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[pt.jsxs("div",{className:"space-y-4",children:[pt.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white flex items-center gap-2",children:[pt.jsx("span",{className:"text-blue-500",children:"Local Version"}),pt.jsx("span",{className:"text-xs bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200 px-2 py-1 rounded",children:"Your Changes"})]}),pt.jsx(pe,{transaction:n})]}),pt.jsxs("div",{className:"space-y-4",children:[pt.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white flex items-center gap-2",children:[pt.jsx("span",{className:"text-green-500",children:"Server Version"}),pt.jsx("span",{className:"text-xs bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-200 px-2 py-1 rounded",children:"Latest from Server"})]}),pt.jsx(pe,{transaction:r})]})]}),pt.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-700",children:[pt.jsx(ue,{variant:"ghost",onClick:a,children:"Back to List"}),pt.jsxs("div",{className:"flex gap-3",children:[pt.jsx(ue,{variant:"secondary",onClick:()=>t(e.id,"server"),leftIcon:so,children:"Use Server Version"}),pt.jsx(ue,{variant:"primary",onClick:()=>t(e.id,"local"),leftIcon:so,children:"Keep My Version"})]})]})]})})()})}function pe({transaction:e}){return e&&0!==Object.keys(e).length?pt.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-900 rounded-lg space-y-2",children:[pt.jsxs("div",{children:[pt.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Description:"}),pt.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:e.description})]}),pt.jsxs("div",{children:[pt.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Amount:"}),pt.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:de(e.amount)})]}),pt.jsxs("div",{children:[pt.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Date:"}),pt.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:new Date(e.date).toLocaleDateString()})]}),e.category&&pt.jsxs("div",{children:[pt.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Category:"}),pt.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:e.category})]})]}):pt.jsx("div",{className:"p-4 bg-gray-100 dark:bg-gray-700 rounded-lg",children:pt.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center italic",children:"No data available"})})}function he(){const{isInstallable:e,isInstalled:t,installApp:a}=function(){const[e,t]=gt.useState(null),[a,n]=gt.useState(!1),[r,s]=gt.useState(!1);return gt.useEffect(()=>{(()=>{const e=window.matchMedia("(display-mode: standalone)").matches,t=!0===window.navigator.standalone;s(e||t)})();const e=e=>{e.preventDefault(),t(e),n(!0)},a=()=>{s(!0),n(!1),t(null)};return window.addEventListener("beforeinstallprompt",e),window.addEventListener("appinstalled",a),()=>{window.removeEventListener("beforeinstallprompt",e),window.removeEventListener("appinstalled",a)}},[]),{isInstallable:a,isInstalled:r,installApp:async()=>{if(!e)return!1;try{await e.prompt();const{outcome:a}=await e.userChoice;return t(null),n(!1),"accepted"===a}catch(a){return console.error("Error installing app:",a),!1}}}}(),[n,r]=gt.useState(!1),[s,o]=gt.useState(!1);return gt.useEffect(()=>{localStorage.getItem("pwa-install-dismissed")&&o(!0)},[]),gt.useEffect(()=>{if(e&&!s&&!t){const e=setTimeout(()=>{r(!0)},3e4);return()=>clearTimeout(e)}},[e,s,t]),!n||t?null:pt.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:max-w-sm z-50 animate-fadeIn",children:pt.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-2xl border border-gray-200 dark:border-gray-600 p-4",children:[pt.jsxs("div",{className:"flex items-start justify-between mb-3",children:[pt.jsxs("div",{className:"flex items-center",children:[pt.jsx("div",{className:"w-10 h-10 bg-[#8EA9DB] rounded-lg flex items-center justify-center mr-3",children:pt.jsx("span",{className:"text-white font-bold text-lg",children:"W"})}),pt.jsxs("div",{children:[pt.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Install WealthTracker"}),pt.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Get the full app experience"})]})]}),pt.jsx("button",{onClick:()=>{r(!1),o(!0),localStorage.setItem("pwa-install-dismissed","true")},className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 p-1",children:pt.jsx(ro,{size:16})})]}),pt.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4",children:"Install WealthTracker for quick access, offline support, and a native app experience."}),pt.jsxs("div",{className:"flex space-x-2",children:[pt.jsx("button",{onClick:async()=>{await a()&&r(!1)},className:"flex-1 bg-[#8EA9DB] hover:bg-[#7A97C9] text-white font-medium py-2 px-4 rounded-lg transition-colors",children:"Install"}),pt.jsx("button",{onClick:()=>{r(!1)},className:"flex-1 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-medium py-2 px-4 rounded-lg transition-colors",children:"Later"})]})]})})}function ye(e,t){navigator.serviceWorker.register(e).then(e=>{Ul=e,setInterval(()=>{e.update()},36e5),e.onupdatefound=()=>{const a=e.installing;null!=a&&(a.onstatechange=()=>{"installed"===a.state&&(navigator.serviceWorker.controller?t&&t.onUpdate&&t.onUpdate(e):t&&t.onSuccess&&t.onSuccess(e))})},navigator.serviceWorker.addEventListener("message",e=>{})}).catch(e=>{console.error("Error during service worker registration:",e)})}function fe(){return new Promise((e,t)=>{if(!navigator.serviceWorker.controller)return void t(new Error("No active service worker"));const a=new MessageChannel;a.port1.onmessage=t=>{e(t.data)},navigator.serviceWorker.controller.postMessage({type:"GET_SYNC_STATUS"},[a.port2])})}function be(){navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"FORCE_SYNC"})}function xe({registration:e}){const[t,a]=gt.useState(!1),[n,r]=gt.useState(!1);gt.useEffect(()=>{if(!e)return;if("localhost"===window.location.hostname&&"5173"===window.location.port)return;const t=()=>{const t=e.installing;t&&t.addEventListener("statechange",()=>{"installed"===t.state&&navigator.serviceWorker.controller&&a(!0)})};return e.waiting&&a(!0),e.addEventListener("updatefound",t),()=>{e.removeEventListener("updatefound",t)}},[e]);const s=()=>{a(!1),setTimeout(()=>{e?.waiting&&a(!0)},144e5)};return t?pt.jsx("div",{className:"fixed bottom-20 md:bottom-4 left-4 right-4 md:left-auto md:right-4 md:max-w-md z-50 animate-slide-up",children:pt.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 p-4",children:pt.jsxs("div",{className:"flex items-start gap-3",children:[pt.jsx("div",{className:"flex-shrink-0",children:pt.jsx(Po,{size:24,className:"text-blue-600 dark:text-blue-400 "+(n?"animate-spin":"")})}),pt.jsxs("div",{className:"flex-1",children:[pt.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-1",children:"Update Available"}),pt.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-3",children:"A new version of WealthTracker is available with bug fixes and improvements."}),pt.jsxs("div",{className:"flex flex-wrap gap-2",children:[pt.jsx("button",{onClick:()=>{r(!0);const e=setTimeout(()=>{window.location.reload()},3e3);navigator.serviceWorker.addEventListener("controllerchange",()=>{clearTimeout(e),window.location.reload()},{once:!0}),Ul?.waiting&&(Ul.waiting.postMessage({type:"SKIP_WAITING"}),navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()}))},disabled:n,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800",children:n?"Updating...":"Update Now"}),pt.jsx("button",{onClick:s,disabled:n,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800",children:"Later"})]})]}),pt.jsx("button",{onClick:s,disabled:n,className:"flex-shrink-0 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 transition-colors","aria-label":"Dismiss update notification",children:pt.jsx(ro,{size:20})})]})})}):null}function we({onRefresh:e,children:t,threshold:a=80,maxPullDistance:n=120,refreshingText:r="Refreshing...",pullText:s="Pull to refresh",releaseText:o="Release to refresh",disabled:i=!1,className:c=""}){const[l,d]=gt.useState(0),[u,m]=gt.useState(!1),[g,p]=gt.useState(!1),[h,y]=gt.useState(!1),f=gt.useRef(null),b=gt.useRef(0),x=gt.useRef(0),w=gt.useRef(0),v=gt.useCallback(()=>!(!f.current||i)&&0===f.current.scrollTop,[i]),S=gt.useCallback(e=>{v()&&!u&&(b.current=e.touches[0].clientY,x.current=b.current,w.current=Date.now(),p(!0))},[v,u]),k=gt.useCallback(e=>{if(!g||u)return;x.current=e.touches[0].clientY;const t=x.current-b.current;if(t>0){y(!0);const a=Math.max(.3,1-t/n*.7),r=Math.min(t*a,n);d(r),r>10&&e.preventDefault()}},[g,u,n]),I=gt.useCallback(async()=>{if(g&&!u)if(y(!1),p(!1),l>=a){m(!0);try{await e()}catch(t){console.error("Refresh failed:",t)}finally{m(!1),d(0)}}else d(0)},[g,u,l,a,e]),j=gt.useCallback(t=>{if(!v()||u)return;b.current=t.clientY,x.current=b.current,p(!0);const r=e=>{x.current=e.clientY;const t=x.current-b.current;if(t>0){y(!0);const e=Math.max(.3,1-t/n*.7),a=Math.min(t*e,n);d(a)}},s=async()=>{if(document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",s),y(!1),p(!1),l>=a){m(!0);try{await e()}catch(t){console.error("Refresh failed:",t)}finally{m(!1),d(0)}}else d(0)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",s)},[v,u,l,a,n,e]),C=Math.min(l/a,1),N=l>0||u,D=l>=a&&!u;return gt.useEffect(()=>()=>{d(0),m(!1),p(!1),y(!1)},[]),pt.jsxs("div",{ref:f,className:`relative overflow-y-auto overflow-x-hidden ${c}`,style:{transform:`translateY(${h?.5*l:0}px)`,transition:h?"none":"transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)"},onTouchStart:S,onTouchMove:k,onTouchEnd:I,onMouseDown:j,children:[pt.jsx("div",{className:"absolute top-0 left-0 right-0 flex flex-col items-center justify-center z-10",style:{height:Math.max(l,u?60:0),transform:`translateY(${u?0:-60+l}px)`,transition:u?"transform 0.3s ease":h?"none":"all 0.3s ease"},children:N&&pt.jsxs(pt.Fragment,{children:[pt.jsx("div",{className:"flex items-center justify-center mb-2",children:u?pt.jsx(Po,{size:24,className:"text-blue-500 animate-spin"}):pt.jsx(uo,{size:24,className:"text-gray-600 dark:text-gray-400 transition-transform duration-200 "+(D?"rotate-180":""),style:{transform:`rotate(${D?180:180*C}deg)`}})}),pt.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 font-medium",children:u?r:D?o:s}),pt.jsx("div",{className:"mt-2 relative",children:pt.jsxs("svg",{width:"20",height:"20",className:"transform -rotate-90",children:[pt.jsx("circle",{cx:"10",cy:"10",r:"8",stroke:"currentColor",strokeWidth:"2",fill:"none",className:"text-gray-300 dark:text-gray-600"}),pt.jsx("circle",{cx:"10",cy:"10",r:"8",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeDasharray:""+2*Math.PI*8,strokeDashoffset:""+2*Math.PI*8*(1-C),className:"transition-all duration-200 "+(D?"text-green-500":"text-blue-500")})]})})]})}),pt.jsx("div",{style:{paddingTop:u?60:0,transition:"padding-top 0.3s ease"},children:t})]})}function ve({children:e,onRefresh:t,enabled:a=!0}){Yn();const n=window.innerWidth<768,r=gt.useCallback(async()=>{await new Promise(e=>setTimeout(e,1e3)),window.location.reload()},[]),s=t||r;return n&&a?pt.jsx(we,{onRefresh:s,children:e}):pt.jsx(pt.Fragment,{children:e})}function Se({isOpen:e,onClose:t,title:a,children:n,size:r="md",showCloseButton:s=!0,ariaDescribedBy:o}){const i=gt.useRef(null),c=gt.useRef(null),[l,d]=gt.useState({top:0,maxHeight:"90vh"});return gt.useEffect(()=>{if(e){c.current=document.activeElement;const e=()=>{const e=window.innerHeight,t=window.scrollY;d({top:t+40,maxHeight:e-80+"px"})};e();const a=()=>e();window.addEventListener("scroll",a),window.addEventListener("resize",a),setTimeout(()=>{i.current?.focus()},50);const n=e=>{if("Tab"!==e.key)return;const t=i.current?.querySelectorAll('a[href], button, textarea, input[type="text"], input[type="number"], input[type="radio"], input[type="checkbox"], select, [tabindex]:not([tabindex="-1"])');if(!t||0===t.length)return;const a=t[0],n=t[t.length-1];e.shiftKey&&document.activeElement===a?(n.focus(),e.preventDefault()):e.shiftKey||document.activeElement!==n||(a.focus(),e.preventDefault())},r=e=>{"Escape"===e.key&&t()};document.addEventListener("keydown",n),document.addEventListener("keydown",r);const s=document.body.style.overflow,o=document.body.style.position,l=document.body.style.top,u=document.body.style.width,m=window.scrollY;return document.body.style.position="fixed",document.body.style.top=`-${m}px`,document.body.style.width="100%",document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",n),document.removeEventListener("keydown",r),window.removeEventListener("scroll",a),window.removeEventListener("resize",a),document.body.style.position=o,document.body.style.top=l,document.body.style.width=u,document.body.style.overflow=s,window.scrollTo(0,m),c.current?.focus()}}},[e,t]),e?pt.jsxs(pt.Fragment,{children:[pt.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 animate-in fade-in duration-200",onClick:t,"aria-hidden":"true"}),pt.jsx("div",{className:"fixed inset-x-0 z-50 flex justify-center px-4",style:{top:`${l.top}px`},children:pt.jsxs("div",{ref:i,className:`\n            bg-white dark:bg-gray-900 \n            rounded-2xl \n            shadow-2xl \n            w-full \n            ${{sm:"max-w-sm",md:"max-w-md",lg:"max-w-2xl",xl:"max-w-4xl",full:"max-w-full mx-4"}[r]} \n            overflow-hidden \n            flex \n            flex-col\n            animate-in zoom-in-95 slide-in-from-bottom-4 duration-200\n            border border-gray-200/50 dark:border-gray-700/50\n          `,style:{maxHeight:l.maxHeight},role:"dialog","aria-modal":"true","aria-labelledby":"modal-title","aria-describedby":o,tabIndex:-1,children:[pt.jsxs("div",{className:"flex items-center justify-between px-6 py-5 border-b border-gray-200 dark:border-gray-800 bg-gradient-to-r from-gray-50 to-white dark:from-gray-900 dark:to-gray-800 flex-shrink-0",children:[pt.jsx("h2",{id:"modal-title",className:"text-xl font-bold text-gray-900 dark:text-white",children:a}),s&&pt.jsx("button",{onClick:t,className:"\n                  p-2 \n                  rounded-lg \n                  text-gray-400 \n                  hover:text-gray-600 \n                  dark:text-gray-500 \n                  dark:hover:text-gray-300 \n                  hover:bg-gray-100 \n                  dark:hover:bg-gray-800 \n                  transition-all \n                  duration-200\n                  focus:outline-none \n                  focus:ring-2 \n                  focus:ring-primary/50\n                ","aria-label":"Close modal",children:pt.jsx(Vn,{size:20})})]}),pt.jsx("div",{className:"flex-1 overflow-y-auto overscroll-contain",children:n})]})})]}):null}function ke({children:e,className:t=""}){return pt.jsx("div",{className:`px-6 py-5 ${t}`,children:e})}function Ie({children:e,className:t=""}){return pt.jsx("div",{className:`px-6 py-5 border-t border-gray-200 dark:border-gray-800 bg-gray-50/50 dark:bg-gray-900/50 flex-shrink-0 ${t}`,children:e})}function je(e,t){const[a,n]=gt.useState(e);return gt.useEffect(()=>{const a=setTimeout(()=>{n(e)},t);return()=>{clearTimeout(a)}},[e,t]),a}function Ce({isOpen:e,onClose:t}){const[a,n]=gt.useState(""),r=je(a,300),[s,o]=gt.useState(0),{results:i,hasResults:c,resultCount:l}=function(e){const{accounts:t,transactions:a,budgets:n,goals:r,categories:s}=E(),o=gt.useMemo(()=>{if(!e||e.length<2)return[];const o=[],i=e.toLowerCase().split(" ").filter(e=>e.length>0);try{const e=(e,t)=>{const a=e.toLowerCase();let n=0;const r=[];return t.forEach(e=>{a.includes(e)&&(a===e?n+=100:a.startsWith(e)?n+=50:n+=20,r.push(e))}),{score:n,matches:r}},c=e=>{if(!e)return"";const t=s.find(t=>t.id===e);return t?.name||""};return t.forEach(t=>{try{const a=e(t.name,i),n=e(t.institution||"",i),r=e(t.type,i),s=a.score+n.score+r.score,c=[...a.matches,...n.matches,...r.matches];if(s>0){const e="number"==typeof t.balance?t.balance.toFixed(2):"0.00";o.push({id:t.id,type:"account",title:t.name,description:`${t.type} at ${t.institution||"Unknown"} - ${t.currency||"GBP"} ${e}`,data:t,score:s,matches:[...new Set(c)]})}}catch(a){console.error("Error searching account:",t.id,a)}}),a.forEach(a=>{try{const n=e(a.description,i),r=e(c(a.category),i),s=e(a.amount?.toString()||"",i),l=e(a.type,i),d=n.score+r.score+s.score+l.score,u=[...n.matches,...r.matches,...s.matches,...l.matches];if(d>0){const e=t.find(e=>e.id===a.accountId),n="number"==typeof a.amount?a.amount.toFixed(2):"0.00";o.push({id:a.id,type:"transaction",title:a.description,description:`${a.type} - ${n} ${e?.currency||"GBP"} (${c(a.category)})`,data:a,score:d,matches:[...new Set(u)]})}}catch(n){console.error("Error searching transaction:",a.id,n)}}),n.forEach(t=>{try{const a=e(c(t.category),i),n=e(t.amount?.toString()||"",i),r=e(t.period,i),s=a.score+n.score+r.score,l=[...a.matches,...n.matches,...r.matches];if(s>0){const e="number"==typeof t.amount?t.amount.toFixed(2):"0.00";o.push({id:t.id,type:"budget",title:`${c(t.category)} Budget`,description:`${t.period} budget - ${e} GBP`,data:t,score:s,matches:[...new Set(l)]})}}catch(a){console.error("Error searching budget:",t.id,a)}}),r.forEach(t=>{try{const a=e(t.name,i),n=e(t.type,i),r=e(t.targetAmount?.toString()||"",i),s=e(t.currentAmount?.toString()||"",i),c=a.score+n.score+r.score+s.score,l=[...a.matches,...n.matches,...r.matches,...s.matches];if(c>0){const e="number"==typeof t.currentAmount?t.currentAmount:0,a="number"==typeof t.targetAmount?t.targetAmount:1,n=a>0?(e/a*100).toFixed(1):"0.0";o.push({id:t.id,type:"goal",title:t.name,description:`${t.type} goal - ${e.toFixed(2)} / ${a.toFixed(2)} GBP (${n}%)`,data:t,score:c,matches:[...new Set(l)]})}}catch(a){console.error("Error searching goal:",t.id,a)}}),o.sort((e,t)=>t.score-e.score)}catch(c){return console.error("Error in global search:",c),[]}},[e,t,a,n,r,s]);return{results:o,hasResults:o.length>0,resultCount:o.length}}(r),d=Yn(),u=gt.useRef(null);gt.useEffect(()=>{e&&u.current&&u.current.focus()},[e]),gt.useEffect(()=>{e||(n(""),o(0))},[e]),gt.useEffect(()=>{const a=a=>{if(e)switch(a.key){case"ArrowDown":a.preventDefault(),o(e=>Math.min(e+1,i.length-1));break;case"ArrowUp":a.preventDefault(),o(e=>Math.max(e-1,0));break;case"Enter":a.preventDefault(),i[s]&&m(i[s]);break;case"Escape":a.preventDefault(),t()}};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[e,i,s,t]),gt.useEffect(()=>{o(0)},[i]);const m=e=>{const a="true"===new URLSearchParams(window.location.search).get("demo");let n=(e=>{switch(e.type){case"account":return"/accounts";case"transaction":return`/transactions?search=${e.id}`;case"budget":return"/budget";case"goal":return"/goals";default:return"/"}})(e);a&&(n=n.includes("?")?`${n}&demo=true`:`${n}?demo=true`),d(n),t()},g=(e,t)=>{if(!e)return pt.jsx(pt.Fragment,{});if(!t||!t.length)return pt.jsx(pt.Fragment,{children:e});let a=e;t.forEach(e=>{if(e){const t=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),n=new RegExp(`(${t})`,"gi");a=a.replace(n,'<mark class="bg-yellow-200 dark:bg-yellow-800 px-1 rounded">$1</mark>')}});const n=Jn.sanitize(a,{ALLOWED_TAGS:["mark"],ALLOWED_ATTR:["class"]});return pt.jsx("span",{dangerouslySetInnerHTML:{__html:n}})};return e?pt.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-start justify-center pt-20",children:pt.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-2xl w-full max-w-2xl mx-4 max-h-[70vh] overflow-hidden",children:[pt.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-600",children:pt.jsxs("div",{className:"relative",children:[pt.jsx(Do,{size:20,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),pt.jsx("input",{ref:u,type:"text",value:a,onChange:e=>n(e.target.value),placeholder:"Search accounts, transactions, budgets, goals...",className:"w-full pl-10 pr-10 py-3 bg-transparent border-0 focus:ring-0 text-gray-900 dark:text-white placeholder-gray-500 text-lg",autoComplete:"off","data-search-input":!0}),pt.jsx("button",{onClick:t,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:pt.jsx(ro,{size:20})})]})}),pt.jsxs("div",{className:"max-h-96 overflow-y-auto",children:[a.length<2&&pt.jsxs("div",{className:"p-8 text-center text-gray-500 dark:text-gray-400",children:[pt.jsx(Do,{size:48,className:"mx-auto mb-4 opacity-50"}),pt.jsx("p",{className:"text-lg",children:"Start typing to search..."}),pt.jsx("p",{className:"text-sm mt-2",children:"Search across accounts, transactions, budgets, and goals"})]}),a.length>=2&&!c&&pt.jsxs("div",{className:"p-8 text-center text-gray-500 dark:text-gray-400",children:[pt.jsx(Do,{size:48,className:"mx-auto mb-4 opacity-50"}),pt.jsx("p",{className:"text-lg",children:"No results found"}),pt.jsx("p",{className:"text-sm mt-2",children:"Try different keywords or check your spelling"})]}),c&&pt.jsxs("div",{className:"p-2",children:[pt.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 px-3 py-2",children:[l," result",1!==l?"s":""]}),i.map((e,t)=>{const a=(e=>{switch(e){case"account":return Ys;case"transaction":return Vs;case"budget":return qo;case"goal":return Ho;default:return Do}})(e.type);return pt.jsxs("button",{onClick:()=>m(e),className:"w-full flex items-center p-3 rounded-lg transition-colors text-left "+(t===s?"bg-[var(--color-primary)]/10 border-l-2 border-[var(--color-primary)]":"hover:bg-gray-50 dark:hover:bg-gray-700"),children:[pt.jsx("div",{className:"p-2 rounded-lg mr-3 "+(t===s?"bg-[var(--color-primary)] text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"),children:pt.jsx(a,{size:20})}),pt.jsxs("div",{className:"flex-1 min-w-0",children:[pt.jsxs("div",{className:"flex items-center justify-between",children:[pt.jsx("div",{className:"font-medium text-gray-900 dark:text-white truncate",children:g(e.title,e.matches)}),pt.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2 capitalize",children:e.type})]}),pt.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:g(e.description,e.matches)})]})]},`${e.type}-${e.id}`)})]})]}),a.length>=2&&pt.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-700",children:pt.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 space-y-1",children:[pt.jsxs("div",{children:["\ud83d\udca1 ",pt.jsx("strong",{children:"Tips:"})," Use \u2191\u2193 to navigate, Enter to select, Escape to close"]}),pt.jsx("div",{children:"\ud83d\udd0d Search works across all your financial data"})]})})]})}):null}function Ne({isOpen:e,onClose:t}){const a=e=>{if(e.key.includes(" "))return e.key.split(" ").map(e=>e.toUpperCase()).join(" \u2192 ");const t=[];e.ctrlKey&&t.push("Ctrl"),e.altKey&&t.push("Alt"),e.shiftKey&&t.push("Shift"),e.metaKey&&t.push("Cmd");let a=e.key;return"comma"===a&&(a=",")," "===a&&(a="Space"),t.push(a.toUpperCase()),t.join("+")},n=[{key:"g h",description:"Go to Home",category:"Navigation",action:()=>{}},{key:"g d",description:"Go to Dashboard",category:"Navigation",action:()=>{}},{key:"g a",description:"Go to Accounts",category:"Navigation",action:()=>{}},{key:"g t",description:"Go to Transactions",category:"Navigation",action:()=>{}},{key:"g i",description:"Go to Investments",category:"Navigation",action:()=>{}},{key:"g b",description:"Go to Budget",category:"Navigation",action:()=>{}},{key:"g g",description:"Go to Goals",category:"Navigation",action:()=>{}},{key:"g r",description:"Go to Analytics",category:"Navigation",action:()=>{}},{key:"g s",description:"Go to Settings",category:"Navigation",action:()=>{}},{key:"n t",description:"New Transaction",category:"Quick Actions",action:()=>{}},{key:"n a",description:"New Account",category:"Quick Actions",action:()=>{}},{key:"n g",description:"New Goal",category:"Quick Actions",action:()=>{}},{key:"n b",description:"New Budget",category:"Quick Actions",action:()=>{}},{key:"Ctrl+K",description:"Open global search",category:"Global",action:()=>{},ctrlKey:!0},{key:"/",description:"Focus search input",category:"Global",action:()=>{}},{key:"?",description:"Show keyboard shortcuts",category:"Global",action:()=>{}},{key:"Escape",description:"Close modal/dialog",category:"Global",action:()=>{}},{key:"Ctrl+R",description:"Refresh data",category:"Utility",action:()=>{},ctrlKey:!0},{key:"Ctrl+P",description:"Print",category:"Utility",action:()=>{},ctrlKey:!0}].reduce((e,t)=>(e[t.category]||(e[t.category]=[]),e[t.category].push(t),e),{});return e?pt.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center p-4",children:pt.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[pt.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-600",children:[pt.jsxs("div",{className:"flex items-center space-x-3",children:[pt.jsx(ei,{size:24,className:"text-[var(--color-primary)]"}),pt.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Keyboard Shortcuts"})]}),pt.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":"Close keyboard shortcuts help",children:pt.jsx(ro,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),pt.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:Object.entries(n).map(([e,t])=>pt.jsxs("div",{className:"mb-6 last:mb-0",children:[pt.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:e}),pt.jsx("div",{className:"space-y-2",children:t.map((e,t)=>pt.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[pt.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:e.description}),pt.jsx("div",{className:"flex items-center space-x-1",children:a(e).includes("\u2192")?a(e).split(" \u2192 ").map((e,t)=>pt.jsxs(Gn.Fragment,{children:[t>0&&pt.jsx("span",{className:"text-gray-400 text-sm mx-1",children:"\u2192"}),pt.jsx("kbd",{className:"px-2 py-1 text-xs font-semibold text-gray-800 dark:text-gray-200 bg-gray-100 dark:bg-gray-600 border border-gray-200 dark:border-gray-500 rounded",children:e})]},t)):a(e).split("+").map((e,t)=>pt.jsxs(Gn.Fragment,{children:[t>0&&pt.jsx("span",{className:"text-gray-400 text-sm",children:"+"}),pt.jsx("kbd",{className:"px-2 py-1 text-xs font-semibold text-gray-800 dark:text-gray-200 bg-gray-100 dark:bg-gray-600 border border-gray-200 dark:border-gray-500 rounded",children:e})]},t))})]},t))})]},e))}),pt.jsx("div",{className:"p-6 border-t border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-700",children:pt.jsxs("div",{className:"flex items-center justify-between",children:[pt.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[pt.jsxs("p",{className:"mb-1",children:[pt.jsx("strong",{children:"Tip:"})," Shortcuts work from anywhere in the app"]}),pt.jsxs("p",{children:["Press ",pt.jsx("kbd",{className:"px-1 py-0.5 text-xs bg-gray-200 dark:bg-gray-600 rounded",children:"?"})," to open this help"]})]}),pt.jsx("button",{onClick:t,className:"px-4 py-2 bg-[var(--color-primary)] text-white rounded-lg hover:bg-[var(--color-secondary)] transition-colors",children:"Got it!"})]})})]})}):null}function De(){const e=Yn(),{activities:t,counts:a,markAsRead:n,markAllAsRead:r,clearActivities:s,getNewSinceLastCheck:o}=Q(),[i,c]=gt.useState(!1),[l,d]=gt.useState("all"),[u,m]=gt.useState(!1);gt.useEffect(()=>{o().length>0&&(m(!0),setTimeout(()=>m(!1),3e3))},[t]);const g=()=>{const e=t.filter(e=>"sync"!==e.type&&"system"!==e.type);return"all"===l?e:e.filter(e=>e.type===l)},p=e=>{switch(e.type){case"transaction":return pt.jsx(nr,{size:16,className:"text-blue-500"});case"account":return pt.jsx(ar,{size:16,className:"text-green-500"});case"budget":return pt.jsx(tr,{size:16,className:"text-purple-500"});case"goal":return pt.jsx(er,{size:16,className:"text-orange-500"});case"sync":return pt.jsx(Xn,{size:16,className:"text-teal-500"});case"system":return pt.jsx(Zn,{size:16,className:"text-gray-500"});default:return pt.jsx(Kn,{size:16,className:"text-gray-500"})}},h=e=>e.read?"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700":"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800";return pt.jsxs(pt.Fragment,{children:[pt.jsxs("button",{onClick:()=>c(!i),className:"relative p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":"Notifications"+(a.unread>0?` (${a.unread} unread)`:""),children:[pt.jsx(Kn,{size:20,className:"text-gray-700 dark:text-gray-200"}),a.unread>0&&pt.jsx("span",{className:"absolute -top-1 -right-1 min-w-[20px] h-5 px-1 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center",children:a.unread>99?"99+":a.unread}),u&&pt.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full animate-ping"})]}),i&&pt.jsxs(pt.Fragment,{children:[pt.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>c(!1)}),pt.jsxs("div",{className:"absolute right-0 top-12 z-50 w-96 max-h-[600px] bg-white dark:bg-gray-800 rounded-lg shadow-2xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[pt.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[pt.jsxs("div",{className:"flex items-center justify-between",children:[pt.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Notifications"}),pt.jsxs("div",{className:"flex items-center gap-2",children:[a.unread>0&&pt.jsx("button",{onClick:r,className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:"Mark all as read"}),pt.jsx("button",{onClick:()=>c(!1),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:pt.jsx(Vn,{size:16})})]})]}),pt.jsx("div",{className:"flex gap-1 mt-3 overflow-x-auto",children:[{value:"all",label:"All",count:a.total},{value:"transaction",label:"Transactions",count:a.transactions},{value:"account",label:"Accounts",count:a.accounts},{value:"budget",label:"Budgets",count:a.budgets},{value:"system",label:"System",count:a.system}].map(e=>pt.jsxs("button",{onClick:()=>d(e.value),className:"px-3 py-1 text-xs rounded-full transition-colors whitespace-nowrap "+(l===e.value?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[e.label,e.count>0&&pt.jsxs("span",{className:"ml-1 text-xs opacity-70",children:["(",e.count,")"]})]},e.value))})]}),pt.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"450px"},children:0===g().length?pt.jsxs("div",{className:"p-8 text-center",children:[pt.jsx(Kn,{size:48,className:"mx-auto mb-3 text-gray-300 dark:text-gray-600"}),pt.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No notifications"}),pt.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:"Your recent activity will appear here"})]}):pt.jsx("div",{className:"p-2",children:(()=>{const e=g(),t=new Map;return e.forEach(e=>{const a=(e=>{const t=new Date,a=new Date(t);return a.setDate(a.getDate()-1),e.toDateString()===t.toDateString()?"Today":e.toDateString()===a.toDateString()?"Yesterday":e>new Date(t.getTime()-6048e5)?"This Week":"Earlier"})(e.timestamp);t.has(a)||t.set(a,[]),t.get(a).push(e)}),Array.from(t.entries()).map(([e,t])=>({date:e,items:t}))})().map(t=>pt.jsxs("div",{className:"mb-4",children:[pt.jsx("h4",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase px-2 mb-2",children:t.date}),pt.jsx("div",{className:"space-y-1",children:t.items.map(t=>pt.jsx("button",{onClick:()=>(t=>{n(t.id),t.actionUrl&&(e(t.actionUrl),c(!1))})(t),className:`w-full p-3 rounded-lg border transition-all hover:shadow-sm text-left ${h(t)}`,children:pt.jsxs("div",{className:"flex items-start gap-3",children:[pt.jsx("div",{className:"mt-0.5",children:p(t)}),pt.jsxs("div",{className:"flex-1 min-w-0",children:[pt.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white "+(t.read?"":"font-semibold"),children:t.title}),pt.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-0.5 truncate",children:t.description}),t.amount&&pt.jsxs("p",{className:"text-sm font-medium mt-1 "+(t.amount>0?"text-green-600":"text-red-600"),children:["\xa3",Math.abs(t.amount).toFixed(2)]}),pt.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:Nr(t.timestamp,{addSuffix:!0})})]}),!t.read&&pt.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2"})]})},t.id))})]},t.date))})}),g().length>0&&pt.jsx("div",{className:"px-4 py-3 border-t border-gray-200 dark:border-gray-700",children:pt.jsx("button",{onClick:()=>{confirm("Are you sure you want to clear all notifications?")&&s()},className:"w-full text-center text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300",children:"Clear all notifications"})})]})]})]})}function Ee({type:e,className:t=""}){const{getUnreadCount:a}=Q(),n=a(e);return 0===n?null:pt.jsx("span",{className:`ml-auto inline-flex items-center justify-center min-w-[20px] h-5 px-1.5 text-xs font-medium text-white bg-blue-500 rounded-full ${t}`,children:n>9?"9+":n})}function Ae({activeSequence:e}){const[t,a]=gt.useState(!1);return gt.useEffect(()=>{if(!e){const e=setTimeout(()=>a(!1),200);return()=>clearTimeout(e)}a(!0)},[e]),t&&e?pt.jsx("div",{className:"fixed bottom-24 left-1/2 transform -translate-x-1/2 z-50 animate-fadeIn",children:pt.jsxs("div",{className:"bg-gray-900 dark:bg-gray-800 text-white px-6 py-3 rounded-lg shadow-xl flex items-center space-x-3",children:[pt.jsx(ei,{size:20,className:"text-primary"}),pt.jsxs("div",{className:"flex items-center space-x-2",children:[pt.jsx("kbd",{className:"px-2 py-1 text-sm font-semibold bg-gray-800 dark:bg-gray-700 border border-gray-600 rounded",children:e.toUpperCase()}),pt.jsx("span",{className:"text-sm",children:(()=>{switch(e){case"g":return"Go to... (press H/D/A/T/I/B/G/R/S)";case"n":return"New... (press T/A/G/B)";default:return"Waiting for next key..."}})()})]})]})}):null}function Te(){const e=function(){const e=gt.useRef(Zl.getConnectionState());return gt.useEffect(()=>Zl.onConnectionChange(t=>{e.current=t}),[]),e.current}(),[t,a]=gt.useState(!1);return pt.jsxs("div",{className:"relative",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[pt.jsx("div",{className:"w-2 h-2 rounded-full "+(e.isConnected?"bg-green-500":e.isReconnecting?"bg-yellow-500 animate-pulse":"bg-red-500")}),t&&pt.jsxs("div",{className:"absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white text-xs rounded px-2 py-1 whitespace-nowrap",children:[e.isConnected?"Real-time sync active":e.isReconnecting?"Reconnecting to real-time sync...":"Real-time sync disconnected",pt.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-2 border-r-2 border-t-2 border-transparent border-t-gray-900"})]})]})}function _e(){const e=qn(),[t,a]=gt.useState(!1);return pt.jsxs(pt.Fragment,{children:[t&&pt.jsx("div",{className:"md:hidden fixed inset-0 bg-black/50 z-40",onClick:()=>a(!1),children:pt.jsxs("div",{className:"absolute bottom-20 right-4 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-2 min-w-[200px]",children:[pt.jsxs(Hn,{to:"/transactions?action=add",className:"flex items-center gap-3 px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",onClick:()=>a(!1),children:[pt.jsx(Js,{size:20}),pt.jsx("span",{children:"Add Transaction"})]}),pt.jsxs(Hn,{to:"/accounts?action=add",className:"flex items-center gap-3 px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",onClick:()=>a(!1),children:[pt.jsx(Ys,{size:20}),pt.jsx("span",{children:"Add Account"})]}),pt.jsxs(Hn,{to:"/budget?action=add",className:"flex items-center gap-3 px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",onClick:()=>a(!1),children:[pt.jsx(Xs,{size:20}),pt.jsx("span",{children:"Add Budget"})]}),pt.jsxs(Hn,{to:"/goals?action=add",className:"flex items-center gap-3 px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",onClick:()=>a(!1),children:[pt.jsx(Hs,{size:20}),pt.jsx("span",{children:"Set Goal"})]})]})}),pt.jsx("button",{onClick:()=>a(!t),className:"md:hidden fixed bottom-20 right-4 w-14 h-14 bg-primary dark:bg-blue-600 text-white rounded-full shadow-lg z-50 flex items-center justify-center transition-transform "+(t?"rotate-45":""),"aria-label":"Quick actions",children:t?pt.jsx(ro,{size:24}):pt.jsx(to,{size:24})}),pt.jsx("nav",{className:"md:hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 z-50",role:"navigation","aria-label":"Mobile navigation",children:pt.jsx("div",{className:"flex justify-around items-center py-2 px-2 max-w-sm mx-auto",children:Xl.map(t=>{const a="/"===(n=t.to)?"/"===e.pathname:e.pathname.startsWith(n);var n;const r=t.icon;return pt.jsxs(Hn,{to:t.to,className:"flex flex-col items-center justify-center min-w-[48px] min-h-[48px] flex-1 py-2 px-1 rounded-lg transition-colors "+(a?"text-primary bg-primary/10":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),"aria-label":t.label,"aria-current":a?"page":void 0,children:[pt.jsxs("div",{className:"relative",children:[pt.jsx(r,{size:22}),t.badge&&pt.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:t.badge>99?"99+":t.badge})]}),pt.jsx("span",{className:"text-xs mt-1 truncate max-w-full "+(a?"font-medium":"font-normal"),children:t.label})]},t.to)})})})]})}function Le(e,t={}){const{threshold:a=50,velocity:n=.3,preventDefaultTouchmove:r=!1,trackMouse:s=!1,delta:o=10,preventScrollOnSwipe:i=!0,longPressDelay:c=500,doubleTapDelay:l=300}=t,[d,u]=gt.useState(!1),[m,g]=gt.useState(null),[p,h]=gt.useState(0),y=gt.useRef(null),f=gt.useRef(null),b=gt.useRef(0),x=gt.useRef(),w=gt.useRef(0),v=gt.useRef(0),S=gt.useRef(null),k=gt.useCallback((e,t)=>{const a=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.sqrt(a*a+n*n)},[]),I=gt.useCallback((e,t)=>{const a=e.clientX-t.clientX,n=e.clientY-t.clientY;return 180*Math.atan2(n,a)/Math.PI},[]),j=gt.useCallback(t=>{if(1===t.touches.length){const a=t.touches[0];y.current={x:a.clientX,y:a.clientY,time:Date.now()},x.current=setTimeout(()=>{e.onLongPress&&y.current&&(e.onLongPress(),y.current=null)},c)}else 2===t.touches.length&&(w.current=k(t.touches[0],t.touches[1]),v.current=I(t.touches[0],t.touches[1]));u(!1),g(null)},[e,c,k,I]),C=gt.useCallback(t=>{if(r&&t.preventDefault(),x.current&&clearTimeout(x.current),1===t.touches.length&&y.current){const e=t.touches[0],a=e.clientX-y.current.x,n=e.clientY-y.current.y,r=Math.sqrt(a*a+n*n);h(r),r>o&&(u(!0),Math.abs(a)>Math.abs(n)?g(a>0?"right":"left"):g(n>0?"down":"up"),i&&t.preventDefault())}else if(2===t.touches.length){const a=k(t.touches[0],t.touches[1]),n=I(t.touches[0],t.touches[1]);if(e.onPinch&&w.current){const t=a/w.current;e.onPinch(t)}if(e.onRotate&&v.current){const t=n-v.current;e.onRotate(t)}t.preventDefault()}},[r,i,o,e,k,I]),N=gt.useCallback(t=>{if(x.current&&clearTimeout(x.current),!y.current)return;const r=Date.now(),s=r-y.current.time;if(1===t.changedTouches.length){const i=t.changedTouches[0];f.current={x:i.clientX,y:i.clientY,time:r};const c=f.current.x-y.current.x,d=f.current.y-y.current.y,u=Math.sqrt(c*c+d*d),m=Math.abs(c/s),g=Math.abs(d/s);u<o&&s<200?r-b.current<l?(e.onDoubleTap&&e.onDoubleTap(),b.current=0):(e.onTap&&e.onTap(),b.current=r):(u>a||m>n||g>n)&&(Math.abs(c)>Math.abs(d)?c>0&&e.onSwipeRight?e.onSwipeRight():c<0&&e.onSwipeLeft&&e.onSwipeLeft():d>0&&e.onSwipeDown?e.onSwipeDown():d<0&&e.onSwipeUp&&e.onSwipeUp())}y.current=null,f.current=null,w.current=0,v.current=0,u(!1),g(null),h(0)},[a,n,o,l,e]),D=gt.useCallback(t=>{s&&(y.current={x:t.clientX,y:t.clientY,time:Date.now()},x.current=setTimeout(()=>{e.onLongPress&&y.current&&(e.onLongPress(),y.current=null)},c))},[s,e,c]),E=gt.useCallback(e=>{if(!s||!y.current)return;x.current&&clearTimeout(x.current);const t=e.clientX-y.current.x,a=e.clientY-y.current.y,n=Math.sqrt(t*t+a*a);n>o&&(u(!0),h(n),Math.abs(t)>Math.abs(a)?g(t>0?"right":"left"):g(a>0?"down":"up"))},[s,o]),A=gt.useCallback(t=>{if(!s||!y.current)return;x.current&&clearTimeout(x.current);const n=t.clientX-y.current.x,r=t.clientY-y.current.y,i=Math.sqrt(n*n+r*r),c=Date.now()-y.current.time;i<o&&c<200?e.onTap&&e.onTap():i>a&&(Math.abs(n)>Math.abs(r)?n>0&&e.onSwipeRight?e.onSwipeRight():n<0&&e.onSwipeLeft&&e.onSwipeLeft():r>0&&e.onSwipeDown?e.onSwipeDown():r<0&&e.onSwipeUp&&e.onSwipeUp()),y.current=null,u(!1),g(null),h(0)},[s,a,o,e]);return gt.useEffect(()=>{const e=S.current;if(e)return e.addEventListener("touchstart",j,{passive:!r}),e.addEventListener("touchmove",C,{passive:!r}),e.addEventListener("touchend",N),s&&(e.addEventListener("mousedown",D),e.addEventListener("mousemove",E),e.addEventListener("mouseup",A),e.addEventListener("mouseleave",A)),()=>{e.removeEventListener("touchstart",j),e.removeEventListener("touchmove",C),e.removeEventListener("touchend",N),s&&(e.removeEventListener("mousedown",D),e.removeEventListener("mousemove",E),e.removeEventListener("mouseup",A),e.removeEventListener("mouseleave",A)),x.current&&clearTimeout(x.current)}},[j,C,N,D,E,A,r,s]),{ref:S,isSwipe:d,swipeDirection:m,swipeDistance:p,bind:{ref:S}}}function Pe(e,{onSubmit:t,onClose:a,resetOnClose:n=!0}){const[r]=gt.useState(()=>"function"==typeof e?e():e),[s,o]=gt.useState(r),[i,c]=gt.useState(!1),[l,d]=gt.useState({}),u=gt.useCallback((e,t)=>{o(a=>({...a,[e]:t})),d(t=>{if(t[e]){const a={...t};return delete a[e],a}return t})},[]),m=gt.useCallback((e,t)=>{d(a=>({...a,[e]:t}))},[]),g=gt.useCallback(()=>{d({})},[]),p=gt.useCallback(()=>{o(r),d({}),c(!1)},[r]),h=gt.useCallback(async e=>{e&&e.preventDefault(),c(!0),g();try{await t(s),n&&p(),a()}catch(r){console.error("Form submission error:",r),d({submit:r instanceof Error?r.message:"An error occurred"})}finally{c(!1)}},[s,t,a,n,g,p]);return{formData:s,setFormData:o,updateField:u,errors:l,setFieldError:m,clearErrors:g,isSubmitting:i,handleSubmit:h,reset:p}}function Me({isOpen:e,onClose:t,onCategoryCreated:a,initialType:n="expense"}){const{categories:r,addCategory:s,getSubCategories:o,getDetailCategories:i}=E(),[c,l]=gt.useState(!1),[d,u]=gt.useState(!1),{formData:m,updateField:g,reset:p}=Pe({type:n,selectedCategory:"",newCategoryName:"",selectedSpecific:"",newSpecificName:""},{onSubmit:()=>{},onClose:t}),h=o(`type-${m.type}`),y=h.map(e=>e.name),f={expense:["Bills","Food","Household","Personal","Transportation","Entertainment","Healthcare","Shopping"],income:["Employment","Investments","Business","Other Income"]}[m.type].filter(e=>!y.includes(e));return pt.jsxs(Se,{isOpen:e,onClose:t,title:"Create New Category",size:"md",children:[pt.jsxs(ke,{className:"space-y-4",children:[pt.jsxs("div",{children:[pt.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Type"}),pt.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[pt.jsx("button",{onClick:()=>{g("type","income"),g("selectedCategory",""),l(!1),g("newCategoryName",""),g("selectedSpecific",""),u(!1),g("newSpecificName","")},className:"px-4 py-2 rounded-lg font-medium transition-colors "+("income"===m.type?"bg-green-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:"Income"}),pt.jsx("button",{onClick:()=>{g("type","expense"),g("selectedCategory",""),l(!1),g("newCategoryName",""),g("selectedSpecific",""),u(!1),g("newSpecificName","")},className:"px-4 py-2 rounded-lg font-medium transition-colors "+("expense"===m.type?"bg-red-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:"Expense"})]})]}),pt.jsxs("div",{children:[pt.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Category"}),pt.jsxs("select",{value:c?"new":m.selectedCategory,onChange:e=>(e=>{if("new"===e)l(!0),g("selectedCategory","");else if(e.startsWith("suggest-")){const t=e.replace("suggest-","");l(!0),g("newCategoryName",t),g("selectedCategory","")}else l(!1),g("selectedCategory",e),g("newCategoryName","");g("selectedSpecific",""),u(!1),g("newSpecificName","")})(e.target.value),className:"w-full px-3 py-2 bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-300/50 dark:border-gray-600/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white",children:[pt.jsx("option",{value:"",children:"Select a category"}),h.map(e=>pt.jsx("option",{value:e.id,children:e.name},e.id)),f.length>0&&pt.jsx("optgroup",{label:"Suggestions",children:f.map(e=>pt.jsxs("option",{value:`suggest-${e}`,children:[e," (create new)"]},e))}),pt.jsx("option",{value:"new",children:"+ New Category"})]}),c&&pt.jsx("input",{type:"text",value:m.newCategoryName,onChange:e=>g("newCategoryName",e.target.value),placeholder:"Enter new category name",className:"mt-2 w-full px-3 py-2 bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-300/50 dark:border-gray-600/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white",autoFocus:!0})]}),(m.selectedCategory||c&&m.newCategoryName)&&pt.jsxs("div",{children:[pt.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Specific Category"}),m.selectedCategory&&!c?pt.jsxs("select",{value:d?"new":m.selectedSpecific,onChange:e=>{var t;"new"===(t=e.target.value)?(u(!0),g("selectedSpecific","")):(u(!1),g("selectedSpecific",t),g("newSpecificName",""))},className:"w-full px-3 py-2 bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-300/50 dark:border-gray-600/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white",children:[pt.jsx("option",{value:"",children:"Select specific category (optional)"}),i(m.selectedCategory).map(e=>pt.jsx("option",{value:e.id,children:e.name},e.id)),pt.jsx("option",{value:"new",children:"+ New Specific Category"})]}):pt.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:"Save the category first to add specific categories"}),d&&m.selectedCategory&&pt.jsx("input",{type:"text",value:m.newSpecificName,onChange:e=>g("newSpecificName",e.target.value),placeholder:"Enter new specific category name",className:"mt-2 w-full px-3 py-2 bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-300/50 dark:border-gray-600/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white",autoFocus:!0})]})]}),pt.jsx(Ie,{children:pt.jsxs("div",{className:"flex gap-2 w-full",children:[pt.jsx("button",{onClick:t,className:"flex-1 px-4 py-2 text-sm sm:text-base border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"}),pt.jsxs("button",{onClick:()=>{let e=m.selectedCategory||m.selectedSpecific;if(c&&m.newCategoryName.trim()){const t={name:m.newCategoryName.trim(),type:m.type,level:"sub",parentId:`type-${m.type}`,isSystem:!1};s(t),e=`new-sub-${m.newCategoryName.trim()}`}if((m.selectedCategory||e)&&d&&m.newSpecificName.trim()){const t=m.selectedCategory||e,a={name:m.newSpecificName.trim(),type:m.type,level:"detail",parentId:t.startsWith("new-sub-")?`type-${m.type}`:t,isSystem:!1};s(a),e=`new-detail-${m.newSpecificName.trim()}`}a&&e&&setTimeout(()=>{if(e.startsWith("new-")){const t=e.includes("detail")?m.newSpecificName.trim():m.newCategoryName.trim(),n=e.includes("detail")?"detail":"sub",s=r.find(e=>e.name===t&&e.level===n);s&&a&&a(s.id)}else a&&a(e)},150),p(),l(!1),u(!1),t()},disabled:!(m.selectedCategory||c&&m.newCategoryName.trim()||m.selectedSpecific||d&&m.newSpecificName.trim()),className:"flex-1 px-4 py-2 text-sm sm:text-base bg-primary text-white rounded-lg hover:bg-secondary disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[pt.jsx(ed,{size:16}),"Create Category"]})]})})]})}function Oe(e){return ad[e]||e}function Be(e,t="GBP"){const a=Oe(t),n=e<0,r=Math.abs(e),s=new Intl.NumberFormat("en-GB",{minimumFractionDigits:2,maximumFractionDigits:2}).format(r);return"CHF"===t?n?`-${s} ${a}`:`${s} ${a}`:n?`-${a}${s}`:`${a}${s}`}function Re(e,t,a){if(t===a)return e;const n=function(e,t){if(e===t)return 1;const a=nd[e]||1,n=nd[t]||1;return"GBP"===e?n:"GBP"===t?1/a:n/a}(t,a);return e*n}async function Fe(){const e=Date.now();if(td&&e-td.timestamp<36e5)return td.rates;const t=await async function(){try{const e=await fetch("https://api.exchangerate-api.com/v4/latest/GBP");if(!e.ok)throw new Error("Failed to fetch exchange rates");return(await e.json()).rates}catch(e){return console.error("Error fetching exchange rates:",e),{GBP:1,USD:1.27,EUR:1.17,CAD:1.71,AUD:1.92,JPY:189.5,CHF:1.12,CNY:9.19,INR:105.85,NZD:2.09}}}();return td={rates:t,timestamp:e},t}async function Ue(e,t){try{const a=await Fe();return e.reduce((e,{amount:n,currency:r})=>{if(r===t)return e+n;if(!a[r]||!a[t])return console.warn(`Missing exchange rate for ${r} or ${t}`),e+n;const s="GBP"===r?n:n/a[r];return e+("GBP"===t?s:s*a[t])},0)}catch(a){return console.error("Currency conversion error:",a),e.reduce((e,{amount:t})=>e+t,0)}}function ze({isOpen:e,onClose:t,title:a,children:n,snapPoints:r=[.9],initialSnapPoint:s=0,showHandle:o=!0,closeOnOutsideClick:i=!0}){const[c,l]=gt.useState(0),[d,u]=gt.useState(!1),[m,g]=gt.useState(0),[p,h]=gt.useState(0),y=gt.useRef(null),f=gt.useRef(null);return gt.useEffect(()=>{if(e){const e=window.innerHeight*r[s];l(e),document.body.style.overflow="hidden";const a=e=>{"Escape"===e.key&&t()};return document.addEventListener("keydown",a),()=>{document.body.style.overflow="",document.removeEventListener("keydown",a)}}},[e,r,s,t]),e?pt.jsxs(pt.Fragment,{children:[pt.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 transition-opacity",onClick:()=>{i&&t()},"aria-hidden":"true"}),pt.jsxs("div",{ref:y,className:"fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 rounded-t-2xl shadow-2xl z-50 transition-transform",style:{height:`${c}px`,transform:e?"translateY(0)":"translateY(100%)",transition:d?"none":"transform 0.3s ease-out, height 0.3s ease-out"},role:"dialog","aria-modal":"true","aria-labelledby":a?"bottom-sheet-title":void 0,children:[o&&pt.jsx("div",{className:"absolute top-0 left-0 right-0 h-12 cursor-grab active:cursor-grabbing",onTouchStart:e=>{const t=e.touches[0];g(t.clientY),h(c),u(!0)},onTouchMove:e=>{if(!d)return;const t=e.touches[0],a=m-t.clientY,n=Math.max(0,Math.min(window.innerHeight,p+a));l(n)},onTouchEnd:()=>{if(!d)return;u(!1);const e=window.innerHeight,a=c/e;let n=r[0],s=Math.abs(a-r[0]);for(const t of r){const e=Math.abs(a-t);e<s&&(s=e,n=t)}a<.2*r[0]?t():l(e*n)},children:pt.jsx("div",{className:"flex justify-center pt-3",children:pt.jsx("div",{className:"w-12 h-1 bg-gray-300 dark:bg-gray-600 rounded-full"})})}),a&&pt.jsxs("div",{className:"flex items-center justify-between px-4 py-4 border-b border-gray-200 dark:border-gray-700",children:[pt.jsx("h2",{id:"bottom-sheet-title",className:"text-lg font-semibold text-gray-900 dark:text-white",children:a}),pt.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700","aria-label":"Close bottom sheet",children:pt.jsx(ro,{size:20})})]}),pt.jsx("div",{ref:f,className:"flex-1 overflow-y-auto overscroll-contain",style:{maxHeight:a?`calc(${c}px - ${o?"3rem":"0px"} - 4rem)`:`calc(${c}px - ${o?"3rem":"0px"})`},children:n})]})]}):null}function $e({isOpen:e,onClose:t,title:a,children:n,size:r="md",className:s,mobileSnapPoints:o=[.9],mobileInitialSnapPoint:i=0,showMobileHandle:c=!0}){return"undefined"!=typeof window&&window.innerWidth<768?pt.jsx(ze,{isOpen:e,onClose:t,title:a,snapPoints:o,initialSnapPoint:i,showHandle:c,children:n}):pt.jsx(Se,{isOpen:e,onClose:t,title:a,size:r,className:s,children:n})}function Ge({value:e,onChange:t,placeholder:a="Enter your notes...",maxHeight:n="200px",showPreview:r=!0,className:s=""}){const[o,i]=gt.useState(!1),c=gt.useRef(null),l=(a,n="",r="")=>{const s=c.current;if(!s)return;const o=s.selectionStart,i=s.selectionEnd,l=e.substring(o,i)||r,d=e.substring(0,o)+a+l+n+e.substring(i);t(d),setTimeout(()=>{s.focus();const e=o+a.length,t=e+l.length;s.setSelectionRange(e,t)},0)},d=[{icon:pt.jsx(Fi,{size:14}),title:"Bold",action:()=>l("**","**","bold text")},{icon:pt.jsx(Ui,{size:14}),title:"Italic",action:()=>l("*","*","italic text")},{icon:pt.jsx(qi,{size:14}),title:"Code",action:()=>l("`","`","code")},{icon:pt.jsx(Oo,{size:14}),title:"Link",action:()=>l("[","](url)","link text")},{icon:pt.jsx(zi,{size:14}),title:"List",action:()=>l("- ","","list item")},{icon:pt.jsx($i,{size:14}),title:"Quote",action:()=>l("> ","","quote")}];return pt.jsxs("div",{className:`markdown-editor border border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden ${s}`,children:[pt.jsxs("div",{className:"flex items-center justify-between bg-gray-50 dark:bg-gray-800 px-3 py-2 border-b border-gray-300 dark:border-gray-600",children:[pt.jsx("div",{className:"flex items-center gap-1",children:d.map((e,t)=>pt.jsx("button",{onClick:e.action,title:e.title,className:"p-1.5 hover:bg-gray-200 dark:hover:bg-gray-700 rounded text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200",children:e.icon},t))}),r&&pt.jsxs("div",{className:"flex items-center gap-1",children:[pt.jsx("button",{onClick:()=>i(!1),className:"p-1.5 rounded text-sm "+(o?"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200":"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300"),children:pt.jsx(ao,{size:14})}),pt.jsx("button",{onClick:()=>i(!0),className:"p-1.5 rounded text-sm "+(o?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"),children:pt.jsx(Ao,{size:14})})]})]}),pt.jsx("div",{className:"relative",children:o&&r?pt.jsx("div",{className:"p-3 min-h-[100px] prose prose-sm max-w-none dark:prose-invert",style:{maxHeight:n},children:e?pt.jsx("div",{dangerouslySetInnerHTML:{__html:(e=>{const t=e.replace(/^### (.*$)/gim,'<h3 class="text-lg font-semibold mb-2">$1</h3>').replace(/^## (.*$)/gim,'<h2 class="text-xl font-semibold mb-2">$1</h2>').replace(/^# (.*$)/gim,'<h1 class="text-2xl font-bold mb-3">$1</h1>').replace(/\*\*\*(.*)\*\*\*/gim,"<strong><em>$1</em></strong>").replace(/\*\*(.*)\*\*/gim,"<strong>$1</strong>").replace(/\*(.*)\*/gim,"<em>$1</em>").replace(/`([^`]+)`/gim,'<code class="bg-gray-100 dark:bg-gray-800 px-1 py-0.5 rounded text-sm">$1</code>').replace(/\[([^\]]+)\]\(([^)]+)\)/gim,'<a href="$2" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline">$1</a>').replace(/^\* (.+)$/gim,'<li class="ml-4">\u2022 $1</li>').replace(/^- (.+)$/gim,'<li class="ml-4">\u2022 $1</li>').replace(/^> (.+)$/gim,'<blockquote class="border-l-4 border-gray-300 dark:border-gray-600 pl-4 italic text-gray-600 dark:text-gray-400">$1</blockquote>').replace(/\n/gim,"<br>");return Jn.sanitize(t,{ALLOWED_TAGS:["h1","h2","h3","p","br","strong","em","code","a","li","blockquote"],ALLOWED_ATTR:["href","target","rel","class"],ALLOW_DATA_ATTR:!1})})(e)}}):pt.jsx("p",{className:"text-gray-500 dark:text-gray-400 italic",children:"Nothing to preview..."})}):pt.jsx("textarea",{ref:c,value:e,onChange:e=>t(e.target.value),placeholder:a,className:"w-full p-3 border-none resize-none focus:outline-none bg-transparent text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400",style:{maxHeight:n,minHeight:"100px"}})}),pt.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 px-3 py-2 text-xs text-gray-500 dark:text-gray-400 border-t border-gray-300 dark:border-gray-600",children:pt.jsxs("div",{className:"flex flex-wrap gap-4",children:[pt.jsx("span",{children:"**bold**"}),pt.jsx("span",{children:"*italic*"}),pt.jsx("span",{children:"`code`"}),pt.jsx("span",{children:"[link](url)"}),pt.jsx("span",{children:"- list"}),pt.jsx("span",{children:"> quote"})]})})]})}function qe({message:e="Loading...",size:t="medium",className:a=""}){return pt.jsxs("div",{className:`flex flex-col items-center justify-center ${{small:"h-32",medium:"h-48",large:"h-64"}[t]} ${a}`,children:[pt.jsx(Po,{size:{small:24,medium:32,large:48}[t],className:"text-primary animate-spin mb-4"}),pt.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:e})]})}function He({isLoading:e,children:t,loadingText:a="Loading...",className:n="",disabled:r=!1,onClick:s}){return pt.jsxs("button",{onClick:s,disabled:e||r,className:`relative ${n} ${e?"cursor-not-allowed":""}`,children:[pt.jsx("span",{className:e?"invisible":"",children:t}),e&&pt.jsxs("span",{className:"absolute inset-0 flex items-center justify-center",children:[pt.jsx(Po,{size:16,className:"animate-spin mr-2"}),a]})]})}function We({isOpen:e,onClose:t}){const{accounts:a,addTransaction:n,categories:r,getSubCategories:s,getDetailCategories:o}=E(),[i,c]=gt.useState(!1),[l,d]=gt.useState({}),{showSuccess:u,showError:m}=Y(),{formData:g,updateField:p,handleSubmit:h,isSubmitting:y}=Pe({description:"",amount:"",type:"expense",category:"",subCategory:"",accountId:"",date:(new Date).toISOString().split("T")[0],notes:""},{onSubmit:e=>{try{d({});const a=bd.validateTransaction({description:e.description,amount:e.amount,type:"transfer"===e.type?"expense":e.type,category:e.category,accountId:e.accountId,date:e.date,notes:e.notes||void 0}),r=parseFloat(a.amount),s="expense"===e.type?-Math.abs(r):Math.abs(r);n({description:a.description,amount:s,type:e.type,category:a.category,accountId:a.accountId,date:new Date(a.date),notes:a.notes}),u("Transaction added successfully"),t()}catch(a){if(a instanceof dr){d(bd.formatErrors(a));const e=a.issues[0];m(e.message)}else m(a),console.error("Failed to add transaction:",a),d({general:"Unable to save transaction. Please try again."})}},onClose:()=>{d({}),t()}});return pt.jsxs(pt.Fragment,{children:[pt.jsx($e,{isOpen:e,onClose:t,title:"Add Transaction",size:"md",mobileSnapPoints:[.5,.9],mobileInitialSnapPoint:1,children:pt.jsxs("form",{onSubmit:h,children:[pt.jsx("div",{className:"p-4 md:p-6",children:pt.jsxs("div",{className:"space-y-4",children:[pt.jsxs("div",{children:[pt.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Type"}),pt.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[pt.jsx("button",{type:"button",onClick:()=>p("type","income"),className:"px-4 py-2 min-h-[44px] rounded-lg font-medium transition-colors "+("income"===g.type?"bg-green-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),"aria-label":"Select income transaction type","aria-pressed":"income"===g.type,children:"Income"}),pt.jsx("button",{type:"button",onClick:()=>p("type","expense"),className:"px-4 py-2 min-h-[44px] rounded-lg font-medium transition-colors "+("expense"===g.type?"bg-red-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),"aria-label":"Select expense transaction type","aria-pressed":"expense"===g.type,children:"Expense"}),pt.jsx("button",{type:"button",onClick:()=>p("type","transfer"),className:"px-4 py-2 min-h-[44px] rounded-lg font-medium transition-colors "+("transfer"===g.type?"bg-blue-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),"aria-label":"Select transfer transaction type","aria-pressed":"transfer"===g.type,children:"Transfer"})]})]}),pt.jsxs("div",{children:[pt.jsx("label",{htmlFor:"account-select",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Account"}),pt.jsxs("select",{id:"account-select",value:g.accountId,onChange:e=>p("accountId",e.target.value),className:"w-full px-3 py-3 sm:py-2 text-base sm:text-sm bg-white dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-blue-400 focus:border-transparent dark:text-white min-h-[48px] sm:min-h-[auto]",required:!0,"aria-label":"Select account for transaction",children:[pt.jsx("option",{value:"",children:"Select account"}),a.map(e=>pt.jsxs("option",{value:e.id,children:[e.name," (",e.type,")"]},e.id))]})]}),pt.jsxs("div",{children:[pt.jsx("label",{htmlFor:"description-input",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),pt.jsx("input",{id:"description-input",type:"text",value:g.description,onChange:e=>{p("description",e.target.value),l.description&&d(e=>({...e,description:""}))},className:`w-full px-3 py-3 sm:py-2 text-base sm:text-sm bg-white dark:bg-gray-700 border-2 ${l.description?"border-red-500":"border-gray-300 dark:border-gray-500"} rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-blue-400 focus:border-transparent dark:text-white min-h-[48px] sm:min-h-[auto]`,placeholder:"e.g., Grocery shopping",maxLength:500,required:!0,"aria-label":"Transaction description","aria-describedby":l.description?"description-error":void 0}),l.description&&pt.jsx("p",{id:"description-error",className:"mt-1 text-sm text-red-500",role:"alert",children:l.description})]}),pt.jsxs("div",{children:[pt.jsxs("label",{htmlFor:"amount-input",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Amount ",g.accountId&&(()=>{const e=a.find(e=>e.id===g.accountId);return e?`(${Oe(e.currency)})`:"(\xa3)"})()]}),pt.jsx("input",{id:"amount-input",type:"number",step:"0.01",value:g.amount,onChange:e=>{p("amount",e.target.value),l.amount&&d(e=>({...e,amount:""}))},className:`w-full px-3 py-3 sm:py-2 text-base sm:text-sm bg-white dark:bg-gray-700 border-2 ${l.amount?"border-red-500":"border-gray-300 dark:border-gray-500"} rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-blue-400 focus:border-transparent dark:text-white min-h-[48px] sm:min-h-[auto]`,placeholder:"0.00",min:"0.01",required:!0,"aria-label":"Transaction amount","aria-describedby":l.amount?"amount-error":void 0}),l.amount&&pt.jsx("p",{id:"amount-error",className:"mt-1 text-sm text-red-500",role:"alert",children:l.amount})]}),pt.jsxs("div",{className:"space-y-3",children:[pt.jsxs("div",{children:[pt.jsxs("div",{className:"flex justify-between items-center mb-1",children:[pt.jsx("label",{htmlFor:"category-select",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Category"}),pt.jsxs("button",{type:"button",onClick:()=>c(!0),className:"text-sm text-primary hover:text-secondary flex items-center gap-1 p-2 min-h-[44px]",children:[pt.jsx(to,{size:14}),"Create new category"]})]}),pt.jsxs("select",{id:"category-select",value:g.subCategory,onChange:e=>{p("subCategory",e.target.value),p("category","")},className:"w-full px-3 py-3 sm:py-2 text-base sm:text-sm bg-white dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-blue-400 focus:border-transparent dark:text-white min-h-[48px] sm:min-h-[auto]",required:!0,"aria-label":"Select transaction category",children:[pt.jsx("option",{value:"",children:"Select category"}),s(`type-${g.type}`).map(e=>pt.jsx("option",{value:e.id,children:e.name},e.id))]})]}),g.subCategory&&pt.jsxs("div",{children:[pt.jsx("label",{htmlFor:"subcategory-select",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Sub-category"}),pt.jsxs("select",{id:"subcategory-select",value:g.category,onChange:e=>p("category",e.target.value),className:"w-full px-3 py-3 sm:py-2 text-base sm:text-sm bg-white dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-blue-400 focus:border-transparent dark:text-white min-h-[48px] sm:min-h-[auto]",required:!0,"aria-label":"Select transaction sub-category",children:[pt.jsx("option",{value:"",children:"Select sub-category"}),o(g.subCategory).map(e=>pt.jsx("option",{value:e.id,children:e.name},e.id))]})]})]}),pt.jsxs("div",{children:[pt.jsx("label",{htmlFor:"date-input",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Date"}),pt.jsx("input",{id:"date-input",type:"date",value:g.date,onChange:e=>p("date",e.target.value),className:"w-full px-3 py-3 sm:py-2 text-base sm:text-sm bg-white dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-blue-400 focus:border-transparent dark:text-white min-h-[48px] sm:min-h-[auto]",required:!0,"aria-label":"Transaction date"})]}),pt.jsxs("div",{children:[pt.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Notes (Optional)"}),pt.jsx(Ge,{value:g.notes,onChange:e=>{e.length<=1e3&&p("notes",e)},placeholder:"Add any additional notes or details...",maxHeight:"150px",className:"w-full"}),g.notes.length>900&&pt.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:[1e3-g.notes.length," characters remaining"]})]}),l.general&&pt.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-300 px-4 py-3 rounded-lg",children:l.general})]})}),pt.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 p-4 md:p-6",children:pt.jsxs("div",{className:"flex gap-3 w-full",children:[pt.jsx("button",{type:"button",onClick:t,disabled:y,className:"flex-1 px-4 py-2 min-h-[44px] text-sm sm:text-base border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),pt.jsx(He,{isLoading:y,loadingText:"Adding...",className:"flex-1 px-4 py-2 min-h-[44px] text-sm sm:text-base bg-primary text-white rounded-lg hover:bg-secondary disabled:opacity-50",children:"Add Transaction"})]})})]})}),pt.jsx(Me,{isOpen:i,onClose:()=>c(!1),initialType:"transfer"===g.type?"expense":g.type,onCategoryCreated:e=>{const t=r.find(t=>t.id===e);t&&("detail"===t.level?(p("subCategory",t.parentId||""),p("category",e)):(p("subCategory",e),p("category",""))),c(!1)}})]})}function Ye({isOpen:e,onClose:t,initialType:a="expense"}){const{accounts:n,addTransaction:r,categories:s}=E(),{showSuccess:o,showError:i}=Y(),[c,l]=gt.useState(a),[d,u]=gt.useState(""),[m,g]=gt.useState(""),[p,h]=gt.useState(n[0]?.id||""),[y,f]=gt.useState(n[1]?.id||""),[b,x]=gt.useState(""),w=gt.useRef(null);gt.useEffect(()=>{e&&w.current&&setTimeout(()=>w.current?.focus(),100)},[e]),gt.useEffect(()=>{l(a)},[a]);const v=s.filter(e=>e.type===("transfer"===c?"expense":c)&&!e.parentId);gt.useEffect(()=>{v.length>0&&!b&&x(v[0].id)},[v,b]);const S=e=>{if(e.preventDefault(),d&&m)if(p)if("transfer"!==c||y)try{const e={amount:parseFloat(d),description:m,type:c,accountId:p,category:b,date:new Date};"transfer"===c&&y&&(e.toAccountId=y),r(e),o(("expense"===c?"Expense":"income"===c?"Income":"Transfer")+" added quickly!"),u(""),g(""),t()}catch(a){i(a instanceof Error?a.message:"Failed to add transaction")}else i("Please select a destination account");else i("Please select an account");else i("Please enter amount and description")};return e?pt.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center",children:[pt.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:t}),pt.jsxs("div",{className:"relative bg-white dark:bg-gray-800 w-full sm:max-w-md rounded-t-2xl sm:rounded-2xl shadow-2xl transform transition-transform duration-300",onKeyDown:e=>{"Escape"===e.key?t():"Enter"===e.key&&e.metaKey&&S(e)},children:[pt.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[pt.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Quick ","expense"===c?"Expense":"income"===c?"Income":"Transfer"]}),pt.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":"Close",children:pt.jsx(ro,{size:20})})]}),pt.jsxs("form",{onSubmit:S,className:"p-4 space-y-4",children:[pt.jsxs("div",{children:[pt.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Amount"}),pt.jsxs("div",{className:"relative",children:[pt.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400",children:Oe("USD")}),pt.jsx("input",{ref:w,type:"number",step:"0.01",value:d,onChange:e=>u(e.target.value),className:"w-full pl-8 pr-3 py-3 text-lg font-medium bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"0.00",required:!0})]})]}),pt.jsxs("div",{children:[pt.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),pt.jsx("input",{type:"text",value:m,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"What's this for?",required:!0})]}),pt.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[pt.jsxs("div",{children:[pt.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"transfer"===c?"From Account":"Account"}),pt.jsx("select",{value:p,onChange:e=>h(e.target.value),className:"w-full px-2 py-2 text-sm bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",required:!0,children:n.map(e=>pt.jsx("option",{value:e.id,children:e.name},e.id))})]}),pt.jsx("div",{children:"transfer"===c?pt.jsxs(pt.Fragment,{children:[pt.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"To Account"}),pt.jsx("select",{value:y,onChange:e=>f(e.target.value),className:"w-full px-2 py-2 text-sm bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",required:!0,children:n.filter(e=>e.id!==p).map(e=>pt.jsx("option",{value:e.id,children:e.name},e.id))})]}):pt.jsxs(pt.Fragment,{children:[pt.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Category"}),pt.jsx("select",{value:b,onChange:e=>x(e.target.value),className:"w-full px-2 py-2 text-sm bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",required:"transfer"!==c,children:v.map(e=>pt.jsx("option",{value:e.id,children:e.name},e.id))})]})})]}),pt.jsxs("div",{className:"flex gap-2",children:[pt.jsx("button",{type:"button",onClick:()=>l("expense"),className:"flex-1 py-2 px-3 rounded-lg font-medium transition-colors "+("expense"===c?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"),children:"Expense"}),pt.jsx("button",{type:"button",onClick:()=>l("income"),className:"flex-1 py-2 px-3 rounded-lg font-medium transition-colors "+("income"===c?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"),children:"Income"}),pt.jsx("button",{type:"button",onClick:()=>l("transfer"),className:"flex-1 py-2 px-3 rounded-lg font-medium transition-colors "+("transfer"===c?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"),children:"Transfer"})]}),pt.jsxs("button",{type:"submit",className:"w-full py-3 bg-primary hover:bg-secondary text-white font-medium rounded-lg transition-colors",children:["Add ","expense"===c?"Expense":"income"===c?"Income":"Transfer"," (\u2318\u21b5)"]})]}),pt.jsxs("div",{className:"px-4 pb-3 text-xs text-gray-500 dark:text-gray-400",children:["Tip: Press ",pt.jsx("kbd",{className:"px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:"Esc"})," to cancel or ",pt.jsx("kbd",{className:"px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:"\u2318\u21b5"})," to save"]})]})]}):null}function Ve({className:e=""}){const[t,a]=gt.useState(!1),[n,r]=gt.useState(!1),[s,o]=gt.useState(!0),[i,c]=gt.useState(!0),[l,d]=gt.useState(0),u=qn(),{showInfo:m}=Y(),g=["/login","/welcome","/settings"].some(e=>u.pathname.startsWith(e));return gt.useEffect(()=>{if(g)return;const e=()=>{const e=window.scrollY;c(!(e>l&&e>100)),d(e)};return window.addEventListener("scroll",e,{passive:!0}),()=>{window.removeEventListener("scroll",e)}},[l,g]),gt.useEffect(()=>{const e=e=>{(e.metaKey||e.ctrlKey)&&"n"===e.key&&(e.preventDefault(),s?r(!0):a(!0))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[s]),g?pt.jsx(pt.Fragment,{}):pt.jsxs(pt.Fragment,{children:[pt.jsxs("button",{onClick:()=>s?r(!0):a(!0),onContextMenu:e=>{e.preventDefault();const t=!s;o(t),m(t?"Quick entry mode activated":"Full form mode activated")},className:`\n          fixed bottom-6 right-6 z-40\n          w-14 h-14 sm:w-16 sm:h-16\n          bg-primary hover:bg-secondary\n          text-white\n          rounded-full\n          shadow-lg hover:shadow-xl\n          flex items-center justify-center\n          transition-all duration-300 ease-out\n          transform hover:scale-110\n          ${i?"translate-y-0 opacity-100":"translate-y-20 opacity-0 pointer-events-none"}\n          ${e}\n        `,"aria-label":"Add new transaction (Ctrl+N)",title:"Add new transaction (Ctrl+N)",children:[pt.jsx(to,{size:24,className:"sm:hidden"}),pt.jsx(to,{size:28,className:"hidden sm:block"})]}),pt.jsx("div",{className:`\n          hidden lg:block\n          fixed bottom-7 right-24 z-40\n          bg-gray-900 text-white\n          px-3 py-2 rounded-lg\n          text-sm font-medium\n          transition-all duration-300\n          ${i?"opacity-0 group-hover:opacity-100":"opacity-0 pointer-events-none"}\n        `,children:"Quick add (\u2318N)"}),pt.jsx(Ye,{isOpen:n,onClose:()=>r(!1)}),pt.jsx(We,{isOpen:t,onClose:()=>a(!1)})]})}function Qe(){const[e,t]=gt.useState(navigator.onLine);return gt.useEffect(()=>{const e=()=>{t(!0)},a=()=>{t(!1)};return window.addEventListener("online",e),window.addEventListener("offline",a),window.addEventListener("app-online",e),window.addEventListener("app-offline",a),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",a),window.removeEventListener("app-online",e),window.removeEventListener("app-offline",a)}},[]),e}function Je({variant:e="compact",showLastSync:t=!1,className:a=""}){const n=Qe(),{status:r,lastSyncTime:s,pendingChanges:o,error:i,triggerSync:c}=function(){const e=Qe(),[t,a]=gt.useState(e?"synced":"offline"),[n,r]=gt.useState(()=>{const e=localStorage.getItem("lastSyncTime");return e?new Date(e):new Date}),[s,o]=gt.useState(0),[i,c]=gt.useState(null);gt.useEffect(()=>{const t=t=>{e?(o(e=>e+1),a("pending"),setTimeout(()=>{e&&l()},2e3)):o(e=>e+1)};return window.addEventListener("data-changed",t),()=>{window.removeEventListener("data-changed",t)}},[e]),gt.useEffect(()=>{e?s>0?(a("pending"),l()):a("synced"):a("offline")},[e,s]);const l=gt.useCallback(async()=>{if(e&&"syncing"!==t){a("syncing"),c(null);try{await new Promise(e=>setTimeout(e,1500));const e=new Date;r(e),localStorage.setItem("lastSyncTime",e.toISOString()),o(0),a("synced"),window.dispatchEvent(new CustomEvent("sync-complete",{detail:{timestamp:e}}))}catch(n){a("error"),c(n instanceof Error?n.message:"Sync failed"),window.dispatchEvent(new CustomEvent("sync-error",{detail:{error:n}}))}}},[e,t]);return{status:t,lastSyncTime:n,pendingChanges:s,error:i,triggerSync:l}}(),[l,d]=gt.useState(!1),u=async()=>{if(!l&&"syncing"!==r){d(!0);try{await c()}finally{setTimeout(()=>d(!1),1e3)}}},m=()=>{if(!n)return pt.jsx(ur,{size:16,className:"text-gray-500"});switch(r){case"synced":return pt.jsx(gr,{size:16,className:"text-green-600"});case"syncing":return pt.jsx(ft,{size:16,className:"text-blue-600 animate-spin"});case"pending":return pt.jsx(mr,{size:16,className:"text-yellow-600"});case"error":return pt.jsx(On,{size:16,className:"text-red-600"});default:return pt.jsx(mr,{size:16,className:"text-gray-500"})}},g=()=>{if(!n)return"Offline";switch(r){case"synced":return"All changes saved";case"syncing":return"Syncing...";case"pending":return`${o} pending ${1===o?"change":"changes"}`;case"error":return"Sync error";default:return"Ready"}},p=()=>{if(!n)return"text-gray-500";switch(r){case"synced":return"text-green-600";case"syncing":return"text-blue-600";case"pending":return"text-yellow-600";case"error":return"text-red-600";default:return"text-gray-500"}};return"compact"===e?pt.jsxs("button",{onClick:u,disabled:!n||"syncing"===r||l,className:`flex items-center gap-2 px-3 py-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed ${a}`,title:g(),"aria-label":`Sync status: ${g()}`,children:[m(),pt.jsx("span",{className:`text-sm hidden sm:inline ${p()}`,children:"syncing"===r||l?"Syncing...":"Sync"})]}):pt.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4 ${a}`,children:[pt.jsxs("div",{className:"flex items-center justify-between mb-3",children:[pt.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"Sync Status"}),pt.jsx("button",{onClick:u,disabled:!n||"syncing"===r||l,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Sync now","aria-label":"Trigger manual sync",children:pt.jsx(ft,{size:16,className:"syncing"===r||l?"animate-spin":""})})]}),pt.jsxs("div",{className:"space-y-2",children:[pt.jsxs("div",{className:"flex items-center gap-2",children:[m(),pt.jsx("span",{className:`text-sm font-medium ${p()}`,children:g()})]}),t&&s&&pt.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Last synced ",Nr(s,{addSuffix:!0})]}),i&&pt.jsx("div",{className:"mt-2 p-2 bg-red-50 dark:bg-red-900/20 rounded text-xs text-red-600 dark:text-red-400",children:i}),!n&&pt.jsx("div",{className:"mt-2 p-2 bg-yellow-50 dark:bg-yellow-900/20 rounded text-xs text-yellow-600 dark:text-yellow-400",children:"You're offline. Changes will sync when you reconnect."})]})]})}function Ke({to:e,icon:t,label:a,isCollapsed:n,hasSubItems:r,isSubItem:s,onNavigate:o}){const i=qn(),{isWideView:c}=m(),l=!c&&(i.pathname===e||r&&i.pathname.startsWith(e)||"/accounts"===e&&(i.pathname.startsWith("/transactions")||i.pathname.startsWith("/reconciliation"))||"/forecasting"===e&&(i.pathname.startsWith("/budget")||i.pathname.startsWith("/goals"))),d="true"===new URLSearchParams(i.search).get("demo")?`${e}?demo=true`:e,u=pt.jsxs(pt.Fragment,{children:[pt.jsx(t,{size:18}),!n&&pt.jsxs(pt.Fragment,{children:[pt.jsx("span",{className:"flex-1 text-sm",children:a}),r&&pt.jsx(lo,{size:14,className:"text-gray-400"})]})]}),g=`flex items-center gap-2 px-3 py-2.5 md:py-2 rounded-lg transition-colors min-h-[40px] md:min-h-[auto] ${s?"ml-5 text-xs":""} ${n?"sidebar-link-collapsed":""} ${l?n?"text-black dark:text-white":"bg-sidebar-active dark:bg-gray-900 text-black dark:text-white shadow-lg border-2 border-sidebar dark:border-gray-600":"bg-secondary text-white dark:text-gray-300 hover:bg-secondary dark:hover:bg-gray-800/50"}`;return pt.jsxs(Hn,{to:d,className:g,title:n?a:void 0,onClick:()=>{o&&o()},"aria-label":a,"aria-current":l?"page":void 0,children:[u,!n&&r&&pt.jsx(Ee,{type:"Accounts"===a?"account":"Budget"===a?"budget":void 0})]})}function Ze(){const[e,t]=gt.useState(!1),[a,n]=gt.useState(!1),[r,s]=gt.useState(!1),[o,i]=gt.useState(!1),[c,l]=gt.useState(!1),[u,g]=gt.useState(!1),[p,h]=gt.useState(!1),y=qn(),f=Yn(),b=new URLSearchParams(y.search),{registration:x}=function(){const[e,t]=gt.useState({registration:null,updateAvailable:!1,isOffline:!navigator.onLine,syncStatus:null});return gt.useEffect(()=>{const e=Ul||window.swRegistration;e&&(t(t=>({...t,registration:e})),e.waiting&&t(e=>({...e,updateAvailable:!0})));const a=e=>{t(t=>({...t,registration:e.detail.registration,updateAvailable:!0}))},n=()=>{t(e=>({...e,isOffline:!0}))},r=()=>{t(e=>({...e,isOffline:!1})),be()},s=e=>{"sync-status"===e.data.type&&t(t=>({...t,syncStatus:{pendingRequests:e.data.pendingRequests,lastSync:e.data.lastSync}}))};return window.addEventListener("sw-update-available",a),window.addEventListener("app-offline",n),window.addEventListener("app-online",r),window.addEventListener("offline",n),window.addEventListener("online",r),navigator.serviceWorker?.addEventListener("message",s),fe().then(e=>{t(t=>({...t,syncStatus:e}))}).catch(()=>{}),()=>{window.removeEventListener("sw-update-available",a),window.removeEventListener("app-offline",n),window.removeEventListener("app-online",r),window.removeEventListener("offline",n),window.removeEventListener("online",r),navigator.serviceWorker?.removeEventListener("message",s)}},[]),{...e,checkUpdates:gt.useCallback(async()=>{try{await(Ul?Ul.update():Promise.reject(new Error("No service worker registration found")))}catch(e){console.error("Failed to check for updates:",e)}},[]),refreshSyncStatus:gt.useCallback(async()=>{try{const e=await fe();t(t=>({...t,syncStatus:e}))}catch(e){console.error("Failed to get sync status:",e)}},[]),forceSync:gt.useCallback(()=>{be()},[]),enableOffline:gt.useCallback(()=>{navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"ENABLE_OFFLINE_MODE"})},[])}}(),{showGoals:w,showAnalytics:v,showInvestments:S,showEnhancedInvestments:k,showAIAnalytics:I,showTaxPlanning:j,showHousehold:C,showBusinessFeatures:N,showFinancialPlanning:D,showDataIntelligence:E,showSummaries:A}=d(),{isWideView:T}=m(),{isOpen:_,openSearch:L,closeSearch:P}=function(){const[e,t]=gt.useState(!1);return{isOpen:e,openSearch:()=>t(!0),closeSearch:()=>t(!1)}}(),{isOpen:M,openHelp:O,closeHelp:B}=function(){const[e,t]=gt.useState(!1);return{isOpen:e,openHelp:()=>t(!0),closeHelp:()=>t(!1)}}(),{currentConflict:R,currentAnalysis:F,isModalOpen:U,resolveConflict:z,dismissConflict:$,conflictState:G}=function(){const[e,t]=gt.useState({hasConflicts:!1,conflicts:[],autoResolvedCount:0,requiresUserIntervention:!1}),[a,n]=gt.useState(null),[r,s]=gt.useState(null),[o,i]=gt.useState(!1);gt.useEffect(()=>{let e=0;const r=({conflict:e,analysis:r})=>{Vl.requiresUserIntervention(r)&&(t(t=>({...t,hasConflicts:!0,conflicts:[...t.conflicts,e],requiresUserIntervention:!0})),a||(n(e),s(r),i(!0)))},o=({conflict:a,analysis:n,resolution:r})=>{e++,t(t=>({...t,autoResolvedCount:e}))},c=e=>{e.conflicts&&e.conflicts.length>0&&t(t=>({...t,hasConflicts:!0,conflicts:e.conflicts}))};return Kl.on("conflict-detected",r),Kl.on("conflict-auto-resolved",o),Kl.on("status-changed",c),()=>{Kl.off("conflict-detected",r),Kl.off("conflict-auto-resolved",o),Kl.off("status-changed",c)}},[a]);const c=gt.useCallback(async(r,o)=>{if(a)try{Kl.resolveConflict(a.id,r,o),t(e=>({...e,conflicts:e.conflicts.filter(e=>e.id!==a.id),hasConflicts:e.conflicts.length>1,requiresUserIntervention:e.conflicts.length>1})),i(!1);const c=e.conflicts.filter(e=>e.id!==a.id);if(c.length>0){const e=c[0],t=Vl.analyzeConflict(e.entity,e.clientData,e.serverData,e.clientTimestamp||Date.now(),e.serverTimestamp||Date.now());n(e),s(t),i(!0)}else n(null),s(null)}catch(c){console.error("Failed to resolve conflict:",c)}},[a,e.conflicts]),l=gt.useCallback(()=>{i(!1)},[]),d=gt.useCallback(()=>{if(a)i(!0);else if(e.conflicts.length>0){const t=e.conflicts[0],a=Vl.analyzeConflict(t.entity,t.clientData,t.serverData,t.clientTimestamp||Date.now(),t.serverTimestamp||Date.now());n(t),s(a),i(!0)}},[a,e.conflicts]),u=gt.useCallback((e,t,a,n,r)=>Vl.analyzeConflict(e,t,a,n||Date.now(),r||Date.now()),[]);return{conflictState:e,currentConflict:a,currentAnalysis:r,isModalOpen:o,resolveConflict:c,dismissConflict:l,showConflictModal:d,analyzeConflict:u,generateSummary:Vl.generateConflictSummary,requiresUserIntervention:Vl.requiresUserIntervention}}(),{activeSequence:q}=function(e){const t=Yn(),a=gt.useRef(null),n=gt.useRef(null),[r,s]=gt.useState(null),o=gt.useCallback((e,a)=>{if("g"===e)switch(a){case"h":t("/");break;case"d":t("/dashboard");break;case"a":t("/accounts");break;case"t":t("/transactions");break;case"i":t("/investments");break;case"b":t("/budget");break;case"g":t("/goals");break;case"r":t("/analytics");break;case"s":t("/settings")}else if("n"===e)switch(a){case"t":t("/transactions?action=add");break;case"a":t("/accounts?action=add");break;case"g":t("/goals?action=add");break;case"b":t("/budget?action=add")}},[t]),i=[{key:"g",description:"Go to... (press another key)",action:()=>{a.current="g",s("g"),n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{a.current=null,s(null)},2e3)},category:"Navigation",sequence:!0},{key:"n",description:"New... (press another key)",action:()=>{a.current="n",s("n"),n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{a.current=null,s(null)},2e3)},category:"Quick Actions",sequence:!0},{key:"h",altKey:!0,description:"Go to Home",action:()=>t("/"),category:"Navigation"},{key:"d",altKey:!0,description:"Go to Dashboard",action:()=>t("/dashboard"),category:"Navigation"},{key:"a",altKey:!0,description:"Go to Accounts",action:()=>t("/accounts"),category:"Navigation"},{key:"t",altKey:!0,description:"Go to Transactions",action:()=>t("/transactions"),category:"Navigation"},{key:"b",altKey:!0,description:"Go to Budget",action:()=>t("/budget"),category:"Navigation"},{key:"g",altKey:!0,description:"Go to Goals",action:()=>t("/goals"),category:"Navigation"},{key:"i",altKey:!0,description:"Go to Investments",action:()=>t("/investments"),category:"Navigation"},{key:"r",altKey:!0,description:"Go to Analytics",action:()=>t("/analytics"),category:"Navigation"},{key:"comma",altKey:!0,description:"Go to Settings",action:()=>t("/settings"),category:"Navigation"},{key:"n",ctrlKey:!0,shiftKey:!0,description:"New Transaction",action:()=>t("/transactions?action=add"),category:"Quick Actions"},{key:"n",ctrlKey:!0,altKey:!0,description:"New Account",action:()=>t("/accounts?action=add"),category:"Quick Actions"},{key:"r",ctrlKey:!0,description:"Refresh Data",action:()=>window.location.reload(),category:"Utility"},{key:"p",ctrlKey:!0,description:"Print Current Page",action:()=>window.print(),category:"Utility"}];return gt.useEffect(()=>{const t=t=>{if(!(t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement||t.target instanceof HTMLSelectElement)){if(a.current)return t.preventDefault(),o(a.current,t.key),a.current=null,s(null),void(n.current&&(clearTimeout(n.current),n.current=null));if("/"===t.key&&!t.ctrlKey&&!t.altKey&&!t.metaKey){t.preventDefault();const e=document.querySelector("[data-search-input]");e&&e.focus()}"?"!==t.key||t.ctrlKey||t.altKey||t.metaKey||(t.preventDefault(),e&&e())}};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t),n.current&&clearTimeout(n.current)}},[o,e]),function(e){gt.useEffect(()=>{const t=t=>{if(t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement||t.target instanceof HTMLSelectElement)return;if(document.querySelector('[role="dialog"]')||document.querySelector(".modal-open"))return;const a=e.find(e=>{const a=e.key.toLowerCase()===t.key.toLowerCase(),n=Boolean(e.ctrlKey)===t.ctrlKey,r=Boolean(e.altKey)===t.altKey,s=Boolean(e.shiftKey)===t.shiftKey,o=Boolean(e.metaKey)===t.metaKey;return a&&n&&r&&s&&o});a&&(t.preventDefault(),t.stopPropagation(),a.action())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e])}(i),{shortcuts:i,activeSequence:r}}(O),H=(e,t)=>{const a=["/dashboard","/accounts","/transactions","/investments","/analytics"],n=a.indexOf(t);return-1===n?null:"next"===e?n<a.length-1?a[n+1]:null:n>0?a[n-1]:null},W=Le({onSwipeLeft:()=>{if(window.innerWidth<=768){const e=H("next",y.pathname);e&&f(e)}},onSwipeRight:()=>{if(window.innerWidth<=768){const e=H("prev",y.pathname);e&&f(e)}},threshold:100}),Y=()=>{t(!e)};gt.useEffect(()=>{T&&t(!0)},[T]);const V=()=>{n(!a)};return gt.useEffect(()=>{const e=e=>{(e.ctrlKey||e.metaKey)&&"k"===e.key&&(e.preventDefault(),L()),"?"!==e.key||e.ctrlKey||e.metaKey||e.altKey||(e.preventDefault(),O()),e.altKey&&"m"===e.key&&(e.preventDefault(),V()),e.altKey&&"s"===e.key&&(e.preventDefault(),Y()),"Escape"===e.key&&a&&(e.preventDefault(),n(!1))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[a,L,O]),gt.useEffect(()=>{const e=e=>{const t=e.detail;setCurrentConflict(t),setConflictModalOpen(!0)};return window.addEventListener("open-conflict-resolver",e),()=>window.removeEventListener("open-conflict-resolver",e)},[]),pt.jsxs("div",{className:"flex min-h-screen bg-tertiary dark:bg-gray-900",children:[pt.jsx(Nd,{}),pt.jsx(ne,{}),pt.jsx(re,{}),pt.jsx(se,{}),pt.jsxs("div",{className:"sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 z-50",children:[pt.jsx("a",{href:"#main-content",className:"inline-block px-4 py-2 bg-blue-600 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"Skip to main content"}),pt.jsx("a",{href:"#main-navigation",className:"inline-block px-4 py-2 ml-2 bg-blue-600 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"Skip to navigation"})]}),pt.jsx("aside",{className:(e?"w-14":"w-52")+" bg-sidebar dark:bg-gray-800 shadow-2xl rounded-2xl transition-all duration-300 hidden md:block m-4 h-[calc(100vh-2rem)] fixed","aria-label":"Main navigation sidebar",children:pt.jsxs("div",{className:"p-3 h-full flex flex-col",children:[pt.jsxs("header",{className:"flex items-center justify-between mb-6",role:"banner",children:[!e&&pt.jsx("h1",{className:"text-lg font-bold text-white dark:text-white",children:"Wealth Tracker"}),pt.jsxs("div",{className:"flex items-center space-x-2",children:[!e&&pt.jsx("button",{onClick:L,className:"p-1 rounded hover:bg-white/20 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-white/50","aria-label":"Open global search",title:"Search (Ctrl+K)",children:pt.jsx(Do,{size:18,className:"text-white dark:text-gray-400"})}),pt.jsx("button",{onClick:Y,className:"p-1 rounded hover:bg-white/20 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-white/50","aria-label":e?"Expand sidebar":"Collapse sidebar",title:e?"Expand sidebar (Alt+S)":"Collapse sidebar (Alt+S)",children:pt.jsx(No,{size:18,className:"text-white dark:text-gray-400"})})]})]}),pt.jsxs("nav",{id:"main-navigation",className:"space-y-1.5 flex-1 overflow-y-auto pr-2",role:"navigation","aria-label":"Main navigation menu",children:[pt.jsx(Ke,{to:"/",icon:qs,label:"Home",isCollapsed:e}),pt.jsx(Ke,{to:"/dashboard",icon:Js,label:"Dashboard",isCollapsed:e}),pt.jsx("div",{children:e?pt.jsx(Ke,{to:"/accounts",icon:Ys,label:"Accounts",isCollapsed:!0}):pt.jsxs("div",{children:[pt.jsxs(Hn,{to:"true"===b.get("demo")?"/accounts?demo=true":"/accounts",onClick:()=>i(!o),className:"w-full flex items-center gap-2 px-3 py-2.5 md:py-2 rounded-lg transition-colors min-h-[40px] md:min-h-[auto] "+("/accounts"===y.pathname||y.pathname.startsWith("/transactions")||y.pathname.startsWith("/reconciliation")?"bg-sidebar-active dark:bg-gray-900 text-black dark:text-white shadow-lg border-2 border-sidebar dark:border-gray-600":"bg-secondary text-white dark:text-gray-300 hover:bg-secondary dark:hover:bg-gray-800/50"),"aria-expanded":o,"aria-label":"Accounts",children:[pt.jsx(Ys,{size:18}),pt.jsx("span",{className:"flex-1 text-sm text-left",children:"Accounts"}),pt.jsx(lo,{size:14,className:"text-gray-400 transition-transform duration-200 "+(o?"rotate-90":"")})]}),o&&pt.jsxs("div",{className:"mt-1 space-y-0.5",children:[pt.jsx(Ke,{to:"/transactions",icon:Vs,label:"Transactions",isCollapsed:!1,isSubItem:!0}),pt.jsx(Ke,{to:"/reconciliation",icon:wo,label:"Reconciliation",isCollapsed:!1,isSubItem:!0})]})]})}),(S||k)&&pt.jsx("div",{children:e?pt.jsx(Ke,{to:"/investments",icon:Xs,label:"Investments",isCollapsed:!0}):pt.jsxs("div",{children:[pt.jsxs(Hn,{to:"true"===b.get("demo")?"/investments?demo=true":"/investments",onClick:()=>h(!p),className:"w-full flex items-center gap-2 px-3 py-2.5 md:py-2 rounded-lg transition-colors min-h-[40px] md:min-h-[auto] "+("/investments"===y.pathname||y.pathname.startsWith("/enhanced-investments")?"bg-sidebar-active dark:bg-gray-900 text-black dark:text-white shadow-lg border-2 border-sidebar dark:border-gray-600":"bg-secondary text-white dark:text-gray-300 hover:bg-secondary dark:hover:bg-gray-800/50"),"aria-expanded":p,"aria-label":"Investments",children:[pt.jsx(Xs,{size:18}),pt.jsx("span",{className:"flex-1 text-sm text-left",children:"Investments"}),pt.jsx(lo,{size:14,className:"text-gray-400 transition-transform duration-200 "+(p?"rotate-90":"")})]}),p&&pt.jsx("div",{className:"mt-1 space-y-0.5",children:k&&pt.jsx(Ke,{to:"/enhanced-investments",icon:Js,label:"Investment Analytics",isCollapsed:!1,isSubItem:!0})})]})}),w&&pt.jsx("div",{children:e?pt.jsx(Ke,{to:"/forecasting",icon:Ks,label:"Forecasting",isCollapsed:!0}):pt.jsxs("div",{children:[pt.jsxs(Hn,{to:"true"===b.get("demo")?"/forecasting?demo=true":"/forecasting",onClick:()=>l(!c),className:"w-full flex items-center gap-2 px-3 py-2.5 md:py-2 rounded-lg transition-colors min-h-[40px] md:min-h-[auto] "+("/forecasting"===y.pathname||"/budget"===y.pathname||"/goals"===y.pathname?"bg-sidebar-active dark:bg-gray-900 text-black dark:text-white shadow-lg border-2 border-sidebar dark:border-gray-600":"bg-secondary text-white dark:text-gray-300 hover:bg-secondary dark:hover:bg-gray-800/50"),"aria-expanded":c,"aria-label":"Forecasting & Budget",children:[pt.jsx(Ks,{size:18}),pt.jsx("span",{className:"flex-1 text-sm text-left",children:"Forecasting"}),pt.jsx(lo,{size:14,className:"text-gray-400 transition-transform duration-200 "+(c?"rotate-90":"")})]}),c&&pt.jsx("div",{className:"mt-1 space-y-0.5",children:pt.jsx(Ke,{to:"/goals",icon:Ho,label:"Goals",isCollapsed:!1,isSubItem:!0})})]})}),v&&pt.jsx(Ke,{to:"/analytics",icon:Js,label:"Analytics",isCollapsed:e}),pt.jsxs("div",{children:[e?pt.jsx(Ke,{to:"/advanced",icon:ji,label:"Advanced",isCollapsed:!0}):pt.jsxs(Hn,{to:"true"===b.get("demo")?"/advanced?demo=true":"/advanced",onClick:()=>g(!u),className:"w-full flex items-center gap-2 px-3 py-2.5 md:py-2 rounded-lg transition-colors min-h-[40px] md:min-h-[auto] "+("/advanced"===y.pathname||y.pathname.startsWith("/ai-")||"/custom-reports"===y.pathname||"/tax-planning"===y.pathname||"/household"===y.pathname||"/business-features"===y.pathname||"/financial-planning"===y.pathname||"/data-intelligence"===y.pathname||"/summaries"===y.pathname?"bg-sidebar-active dark:bg-gray-900 text-black dark:text-white shadow-lg border-2 border-sidebar dark:border-gray-600":"bg-secondary text-white dark:text-gray-300 hover:bg-secondary dark:hover:bg-gray-800/50"),"aria-expanded":u,"aria-label":"Advanced",children:[pt.jsx(ji,{size:18}),pt.jsx("span",{className:"flex-1 text-sm text-left",children:"Advanced"}),pt.jsx(lo,{size:14,className:"text-gray-400 transition-transform duration-200 "+(u?"rotate-90":"")})]}),u&&!e&&pt.jsxs("div",{className:"mt-1 space-y-0.5",children:[I&&pt.jsx(Ke,{to:"/ai-analytics",icon:ji,label:"AI Analytics",isCollapsed:!1,isSubItem:!0}),pt.jsx(Ke,{to:"/ai-features",icon:Bi,label:"AI Features",isCollapsed:!1,isSubItem:!0}),pt.jsx(Ke,{to:"/custom-reports",icon:Go,label:"Custom Reports",isCollapsed:!1,isSubItem:!0}),j&&pt.jsx(Ke,{to:"/tax-planning",icon:vi,label:"Tax Planning",isCollapsed:!1,isSubItem:!0}),C&&pt.jsx(Ke,{to:"/household",icon:Qo,label:"Household",isCollapsed:!1,isSubItem:!0}),N&&pt.jsx(Ke,{to:"/business-features",icon:gi,label:"Business Features",isCollapsed:!1,isSubItem:!0}),D&&pt.jsx(Ke,{to:"/financial-planning",icon:vi,label:"Financial Planning",isCollapsed:!1,isSubItem:!0}),E&&pt.jsx(Ke,{to:"/data-intelligence",icon:Ro,label:"Data Intelligence",isCollapsed:!1,isSubItem:!0}),A&&pt.jsx(Ke,{to:"/summaries",icon:Zs,label:"Summaries",isCollapsed:!1,isSubItem:!0})]})]}),pt.jsxs("div",{children:[e?pt.jsx(Ke,{to:"/settings",icon:Hs,label:"Settings",isCollapsed:!0}):pt.jsxs(Hn,{to:"true"===b.get("demo")?"/settings?demo=true":"/settings",onClick:()=>s(!r),className:"w-full flex items-center gap-2 px-3 py-2.5 md:py-2 rounded-lg transition-colors min-h-[40px] md:min-h-[auto] "+(y.pathname.startsWith("/settings")||"/enhanced-import"===y.pathname||"/export-manager"===y.pathname||"/documents"===y.pathname||"/open-banking"===y.pathname?"bg-sidebar-active dark:bg-gray-900 text-black dark:text-white shadow-lg border-2 border-sidebar dark:border-gray-600":"bg-secondary text-white dark:text-gray-300 hover:bg-secondary dark:hover:bg-gray-800/50"),"aria-expanded":r,"aria-label":"Settings",children:[pt.jsx(Hs,{size:18}),pt.jsx("span",{className:"flex-1 text-sm text-left",children:"Settings"}),pt.jsx(lo,{size:14,className:"text-gray-400 transition-transform duration-200 "+(r?"rotate-90":"")})]}),r&&!e&&pt.jsxs("div",{className:"mt-1 space-y-0.5",children:[pt.jsx(Ke,{to:"/settings/app",icon:Ws,label:"App Settings",isCollapsed:!1,isSubItem:!0}),pt.jsx(Ke,{to:"/settings/data",icon:Ro,label:"Data Management",isCollapsed:!1,isSubItem:!0}),pt.jsx(Ke,{to:"/settings/categories",icon:Fo,label:"Categories",isCollapsed:!1,isSubItem:!0}),pt.jsx(Ke,{to:"/settings/tags",icon:Uo,label:"Tags",isCollapsed:!1,isSubItem:!0}),pt.jsx(Ke,{to:"/settings/deleted-accounts",icon:$o,label:"Deleted Accounts",isCollapsed:!1,isSubItem:!0}),pt.jsx(Ke,{to:"/settings/security",icon:Zo,label:"Security",isCollapsed:!1,isSubItem:!0}),pt.jsx(Ke,{to:"/enhanced-import",icon:Lo,label:"Enhanced Import",isCollapsed:!1,isSubItem:!0}),pt.jsx(Ke,{to:"/export-manager",icon:_o,label:"Export Manager",isCollapsed:!1,isSubItem:!0}),pt.jsx(Ke,{to:"/documents",icon:zo,label:"Documents",isCollapsed:!1,isSubItem:!0}),pt.jsx(Ke,{to:"/open-banking",icon:hi,label:"Open Banking",isCollapsed:!1,isSubItem:!0})]})]})]})]})}),pt.jsx("header",{className:"md:hidden fixed top-0 left-0 right-0 z-40 bg-white dark:bg-gray-800 shadow-md",role:"banner",children:pt.jsxs("div",{className:"flex items-center justify-between p-4",children:[pt.jsx("button",{onClick:V,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":a?"Close navigation menu":"Open navigation menu","aria-expanded":a,"aria-controls":"mobile-menu",title:a?"Close menu (Escape)":"Open menu (Alt+M)",children:a?pt.jsx(ro,{size:24,className:"text-gray-700 dark:text-gray-200"}):pt.jsx(No,{size:24,className:"text-gray-700 dark:text-gray-200"})}),pt.jsx("h1",{className:"text-lg font-bold text-gray-900 dark:text-white",id:"mobile-app-title",children:"Wealth Tracker"}),pt.jsxs("div",{className:"flex items-center gap-2",children:[pt.jsx(Je,{variant:"compact",className:"mr-1"}),pt.jsx(De,{}),pt.jsx("button",{onClick:L,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":"Search",children:pt.jsx(Do,{size:20,className:"text-gray-700 dark:text-gray-200"})}),pt.jsx(pr,{afterSignOutUrl:"/",appearance:{elements:{avatarBox:"w-8 h-8",userButtonPopoverCard:"shadow-xl",userButtonPopoverActions:"mt-2"}}})]})]})}),pt.jsxs("div",{className:"hidden md:flex items-center gap-3 fixed top-4 right-4 z-30",role:"toolbar","aria-label":"User tools",children:[pt.jsx(Je,{variant:"compact"}),pt.jsx(De,{}),pt.jsx(Te,{}),pt.jsx(pr,{afterSignOutUrl:"/",appearance:{elements:{avatarBox:"w-10 h-10",userButtonPopoverCard:"shadow-xl",userButtonPopoverActions:"mt-2"}}})]}),a&&pt.jsx("div",{className:"md:hidden fixed inset-0 z-40 bg-black bg-opacity-50",onClick:V,role:"dialog","aria-modal":"true","aria-labelledby":"mobile-menu-title",children:pt.jsx("nav",{id:"mobile-menu",className:"w-full max-w-sm h-full bg-sidebar dark:bg-gray-800 shadow-2xl overflow-y-auto rounded-r-2xl",onClick:e=>e.stopPropagation(),role:"navigation","aria-label":"Mobile navigation menu",children:pt.jsxs("div",{className:"p-4 pb-6",children:[pt.jsxs("header",{className:"flex justify-between items-center mb-8",role:"banner",children:[pt.jsx("h2",{id:"mobile-menu-title",className:"text-2xl font-bold text-white dark:text-white",children:"Wealth Tracker"}),pt.jsxs("div",{className:"flex items-center space-x-2",children:[pt.jsx("button",{onClick:()=>{L(),V()},className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-white/50","aria-label":"Open global search",children:pt.jsx(Do,{size:24,className:"text-white dark:text-gray-300"})}),pt.jsx("button",{onClick:V,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-white/50","aria-label":"Close navigation menu",children:pt.jsx(ro,{size:24,className:"text-white dark:text-gray-300"})})]})]}),pt.jsxs("div",{className:"space-y-2",role:"none",children:[pt.jsx(Ke,{to:"/",icon:qs,label:"Home",isCollapsed:!1,onNavigate:V}),pt.jsx(Ke,{to:"/dashboard",icon:Js,label:"Dashboard",isCollapsed:!1,onNavigate:V}),pt.jsxs("div",{children:[pt.jsxs(Hn,{to:"true"===b.get("demo")?"/accounts?demo=true":"/accounts",onClick:()=>{i(!o),V()},className:"w-full flex items-center gap-2 px-3 py-2.5 md:py-2 rounded-lg transition-colors min-h-[40px] md:min-h-[auto] bg-secondary text-white dark:text-gray-300 hover:bg-secondary dark:hover:bg-gray-800/50",children:[pt.jsx(Ys,{size:18}),pt.jsx("span",{className:"flex-1 text-sm text-left",children:"Accounts"}),pt.jsx(lo,{size:14,className:"text-gray-400 transition-transform duration-200 "+(o?"rotate-90":"")})]}),o&&pt.jsxs("div",{className:"mt-1 space-y-1",children:[pt.jsx(Ke,{to:"/transactions",icon:Vs,label:"Transactions",isCollapsed:!1,isSubItem:!0,onNavigate:V}),pt.jsx(Ke,{to:"/reconciliation",icon:wo,label:"Reconciliation",isCollapsed:!1,isSubItem:!0,onNavigate:V})]})]}),(S||k)&&pt.jsxs("div",{children:[pt.jsxs(Hn,{to:"true"===b.get("demo")?"/investments?demo=true":"/investments",onClick:()=>{h(!p),V()},className:"w-full flex items-center gap-2 px-3 py-2.5 md:py-2 rounded-lg transition-colors min-h-[40px] md:min-h-[auto] bg-secondary text-white dark:text-gray-300 hover:bg-secondary dark:hover:bg-gray-800/50",children:[pt.jsx(Xs,{size:18}),pt.jsx("span",{className:"flex-1 text-sm text-left",children:"Investments"}),pt.jsx(lo,{size:14,className:"text-gray-400 transition-transform duration-200 "+(p?"rotate-90":"")})]}),p&&pt.jsx("div",{className:"mt-1 space-y-1",children:k&&pt.jsx(Ke,{to:"/enhanced-investments",icon:Js,label:"Investment Analytics",isCollapsed:!1,isSubItem:!0,onNavigate:V})})]}),w&&pt.jsxs("div",{children:[pt.jsxs(Hn,{to:"true"===b.get("demo")?"/forecasting?demo=true":"/forecasting",onClick:()=>{l(!c),V()},className:"w-full flex items-center gap-2 px-3 py-2.5 md:py-2 rounded-lg transition-colors min-h-[40px] md:min-h-[auto] bg-secondary text-white dark:text-gray-300 hover:bg-secondary dark:hover:bg-gray-800/50",children:[pt.jsx(Ks,{size:18}),pt.jsx("span",{className:"flex-1 text-sm text-left",children:"Forecasting"}),pt.jsx(lo,{size:14,className:"text-gray-400 transition-transform duration-200 "+(c?"rotate-90":"")})]}),c&&pt.jsx("div",{className:"mt-1 space-y-1",children:pt.jsx(Ke,{to:"/goals",icon:Ho,label:"Goals",isCollapsed:!1,isSubItem:!0,onNavigate:V})})]}),v&&pt.jsx(Ke,{to:"/analytics",icon:Js,label:"Analytics",isCollapsed:!1,onNavigate:V}),I&&pt.jsx(Ke,{to:"/ai-analytics",icon:ji,label:"AI Analytics",isCollapsed:!1,onNavigate:V}),pt.jsx(Ke,{to:"/custom-reports",icon:Go,label:"Custom Reports",isCollapsed:!1,onNavigate:V}),j&&pt.jsx(Ke,{to:"/tax-planning",icon:vi,label:"Tax Planning",isCollapsed:!1,onNavigate:V}),C&&pt.jsx(Ke,{to:"/household",icon:Qo,label:"Household",isCollapsed:!1,onNavigate:V}),N&&pt.jsx(Ke,{to:"/business-features",icon:gi,label:"Business Features",isCollapsed:!1,onNavigate:V}),D&&pt.jsx(Ke,{to:"/financial-planning",icon:vi,label:"Financial Planning",isCollapsed:!1,onNavigate:V}),E&&pt.jsx(Ke,{to:"/data-intelligence",icon:Ro,label:"Data Intelligence",isCollapsed:!1,onNavigate:V}),A&&pt.jsx(Ke,{to:"/summaries",icon:Zs,label:"Summaries",isCollapsed:!1,onNavigate:V}),pt.jsxs("div",{children:[pt.jsx(Ke,{to:"/settings",icon:Hs,label:"Settings",isCollapsed:!1,hasSubItems:!0}),r&&pt.jsxs("div",{className:"mt-1 space-y-1",children:[pt.jsx(Ke,{to:"/settings/app",icon:Ws,label:"App Settings",isCollapsed:!1,isSubItem:!0,onNavigate:V}),pt.jsx(Ke,{to:"/settings/data",icon:Ro,label:"Data Management",isCollapsed:!1,isSubItem:!0,onNavigate:V}),pt.jsx(Ke,{to:"/settings/categories",icon:Fo,label:"Categories",isCollapsed:!1,isSubItem:!0,onNavigate:V}),pt.jsx(Ke,{to:"/settings/tags",icon:Uo,label:"Tags",isCollapsed:!1,isSubItem:!0,onNavigate:V}),pt.jsx(Ke,{to:"/settings/deleted-accounts",icon:$o,label:"Deleted Accounts",isCollapsed:!1,isSubItem:!0,onNavigate:V}),pt.jsx(Ke,{to:"/settings/security",icon:Zo,label:"Security",isCollapsed:!1,isSubItem:!0,onNavigate:V}),pt.jsx(Ke,{to:"/enhanced-import",icon:Lo,label:"Enhanced Import",isCollapsed:!1,isSubItem:!0,onNavigate:V}),pt.jsx(Ke,{to:"/export-manager",icon:_o,label:"Export Manager",isCollapsed:!1,isSubItem:!0,onNavigate:V}),pt.jsx(Ke,{to:"/documents",icon:zo,label:"Documents",isCollapsed:!1,isSubItem:!0,onNavigate:V}),pt.jsx(Ke,{to:"/open-banking",icon:hi,label:"Open Banking",isCollapsed:!1,isSubItem:!0,onNavigate:V})]})]})]})]})})}),pt.jsxs("main",{ref:W,id:"main-content",className:`flex-1 md:pl-0 mt-16 md:mt-0 ${e?"md:ml-[5.5rem]":"md:ml-[14.5rem]"} transition-all duration-300`,style:{WebkitOverflowScrolling:"touch"},role:"main","aria-label":"Main content",tabIndex:-1,children:[pt.jsx(X,{}),pt.jsx("div",{className:"hidden md:block sticky top-0 z-30 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-6 py-3",children:pt.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[pt.jsx("div",{className:"flex-1 max-w-2xl",children:pt.jsxs("button",{onClick:L,className:"w-full flex items-center gap-3 px-4 py-2 bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-lg text-left transition-colors group","aria-label":"Search transactions, accounts, and more",children:[pt.jsx(Do,{size:20,className:"text-gray-400 group-hover:text-gray-600 dark:group-hover:text-gray-300"}),pt.jsx("span",{className:"text-gray-500 dark:text-gray-400 group-hover:text-gray-700 dark:group-hover:text-gray-300",children:"Search transactions, accounts, budgets..."}),pt.jsx("span",{className:"ml-auto text-xs text-gray-400 dark:text-gray-500 font-mono",children:"Ctrl+K"})]})}),pt.jsxs("div",{className:"flex items-center gap-4 ml-6",children:[pt.jsx(De,{}),pt.jsx(Te,{}),pt.jsx(pr,{afterSignOutUrl:"/",appearance:{elements:{avatarBox:"w-8 h-8",userButtonPopoverCard:"shadow-xl",userButtonPopoverActions:"mt-2"}}})]})]})}),pt.jsx(ae,{}),pt.jsx(ve,{children:pt.jsxs("div",{className:"p-4 md:p-6 lg:p-8 max-w-7xl mx-auto pb-20 md:pb-8",children:[pt.jsx("div",{className:"hidden sm:block",children:pt.jsx(te,{})}),pt.jsx(Z,{children:pt.jsx(hr,{})})]})})]}),pt.jsx(ce,{}),pt.jsx(le,{}),pt.jsx(me,{}),pt.jsx(ql,{}),pt.jsx(Wl,{}),pt.jsx(Ql,{isOpen:U,onClose:$,conflict:R,analysis:F,onResolve:z}),pt.jsx(xe,{registration:x}),pt.jsx(he,{}),pt.jsx(gc,{children:pt.jsx(Ce,{isOpen:_,onClose:P})}),pt.jsx(Ne,{isOpen:M,onClose:B}),R&&pt.jsx(Ql,{isOpen:U,onClose:$,conflict:R,analysis:F,onResolve:z}),G.requiresUserIntervention&&pt.jsx("div",{className:"fixed bottom-20 right-4 z-50 bg-amber-100 dark:bg-amber-900/90 p-3 rounded-lg shadow-lg",children:pt.jsxs("div",{className:"flex items-center gap-2",children:[pt.jsx("div",{className:"w-2 h-2 bg-amber-500 rounded-full animate-pulse"}),pt.jsxs("span",{className:"text-sm text-amber-800 dark:text-amber-200",children:[G.conflicts.length," conflict",1!==G.conflicts.length?"s":""," need attention"]})]})}),G.autoResolvedCount>0&&pt.jsx("div",{className:"fixed top-20 right-4 z-50 bg-green-100 dark:bg-green-900/90 p-3 rounded-lg shadow-lg animate-fade-in-out",children:pt.jsxs("div",{className:"flex items-center gap-2",children:[pt.jsx("svg",{className:"w-4 h-4 text-green-600 dark:text-green-400",fill:"currentColor",viewBox:"0 0 20 20",children:pt.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),pt.jsxs("span",{className:"text-sm text-green-800 dark:text-green-200",children:[G.autoResolvedCount," conflict",1!==G.autoResolvedCount?"s":""," auto-resolved"]})]})}),pt.jsx(Ae,{activeSequence:q}),pt.jsx(_e,{}),pt.jsx(Ve,{})]})}function Xe(e){const t=gt.lazy(e);return t.preload=e,t}function et(e){"requestIdleCallback"in window?requestIdleCallback(()=>e.preload()):setTimeout(()=>e.preload(),1)}function tt(){const[e,t]=gt.useState({}),a=function(){const e=gt.useContext(Od);if(void 0===e)throw new Error("useApp must be used within an AppProvider");return e}();return gt.useEffect(()=>{const e=[];for(let t=0;t<localStorage.length;t++){const a=localStorage.key(t);a&&e.push(a)}const n=async()=>{try{return(await indexedDB.databases()).map(e=>e.name)}catch(e){return"IndexedDB check failed: "+e}},r=()=>{const e=[];for(let t=0;t<localStorage.length;t++){const a=localStorage.key(t);if(a&&(a.startsWith("enc_")||a.includes("encrypted")))try{const e=localStorage.getItem(a);e&&JSON.parse(e)}catch{e.push({key:a,error:"Parse error"})}}return e};(async()=>{const s={localStorage:{keys:e,totalKeys:e.length,encryptedKeys:e.filter(e=>e.startsWith("enc_")).length,corruptedKeys:r()},indexedDB:await n(),appContext:{accounts:a?.accounts?.length||0,transactions:a?.transactions?.length||0,categories:a?.categories?.length||0,isLoading:a?.isLoading||!1,hasTestData:a?.hasTestData||!1},errors:[]};t(s)})()},[a]),pt.jsxs("div",{className:"p-4 bg-white rounded-lg shadow",children:[pt.jsx("h2",{className:"text-xl font-bold mb-4",children:"Diagnostic Report"}),pt.jsx("pre",{className:"text-xs overflow-auto bg-gray-100 p-4 rounded",children:JSON.stringify(e,null,2)}),pt.jsxs("div",{className:"mt-4 space-x-2",children:[pt.jsx("button",{onClick:()=>{const e=[];for(let t=0;t<localStorage.length;t++){const a=localStorage.key(t);a&&(a.startsWith("enc_")||a.startsWith("wealthtracker_"))&&e.push(a)}e.forEach(e=>localStorage.removeItem(e)),alert(`Cleared ${e.length} keys. Please refresh the page.`)},className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Clear Encrypted Storage"}),pt.jsx("button",{onClick:()=>{localStorage.clear(),sessionStorage.clear(),alert("All storage cleared. Please refresh the page.")},className:"px-4 py-2 bg-red-800 text-white rounded hover:bg-red-900",children:"Clear ALL Storage"})]})]})}function at({className:e="",width:t,height:a,variant:n="text",animation:r="pulse"}){const s={width:t||"100%",height:a||("text"===n?"1em":"100%")};return pt.jsx("div",{className:`bg-gray-200 dark:bg-gray-700 ${{text:"rounded",circular:"rounded-full",rectangular:"",rounded:"rounded-lg"}[n]} ${{pulse:"animate-pulse",wave:"animate-shimmer",none:""}[r]} ${e}`,style:s,"aria-label":"Loading...",role:"status"})}function nt({lines:e=1,spacing:t="normal",className:a=""}){return pt.jsx("div",{className:`${{tight:"space-y-1",normal:"space-y-2",loose:"space-y-3"}[t]} ${a}`,children:Array.from({length:e}).map((t,a)=>pt.jsx(at,{variant:"text",width:a===e-1&&e>1?"80%":"100%"},a))})}function rt({className:e=""}){return pt.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow p-6 ${e}`,children:[pt.jsxs("div",{className:"flex items-start justify-between mb-4",children:[pt.jsxs("div",{className:"flex-1",children:[pt.jsx(at,{variant:"text",width:"60%",height:"24px",className:"mb-2"}),pt.jsx(at,{variant:"text",width:"40%"})]}),pt.jsx(at,{variant:"circular",width:"40px",height:"40px"})]}),pt.jsx(nt,{lines:3})]})}function st({columns:e=5}){return pt.jsx("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:Array.from({length:e}).map((e,t)=>pt.jsx("td",{className:"py-4 px-4",children:pt.jsx(at,{variant:"text"})},t))})}function ot({items:e=5,className:t=""}){return pt.jsx("div",{className:`space-y-4 ${t}`,children:Array.from({length:e}).map((e,t)=>pt.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-white dark:bg-gray-800 rounded-lg",children:[pt.jsx(at,{variant:"circular",width:"48px",height:"48px"}),pt.jsxs("div",{className:"flex-1",children:[pt.jsx(at,{variant:"text",width:"40%",className:"mb-2"}),pt.jsx(at,{variant:"text",width:"60%"})]}),pt.jsx(at,{variant:"rectangular",width:"80px",height:"32px"})]},t))})}function it({children:e,requirePremium:t=!1,requiredRole:a,fallbackPath:n="/"}){const{isLoaded:r,isSignedIn:s}=Un(),o=qn(),i="undefined"!=typeof window&&("true"===window.localStorage.getItem("isTestMode")||"true"===new URLSearchParams(window.location.search).get("testMode")),c="undefined"!=typeof window&&"true"===new URLSearchParams(window.location.search).get("demo");return r||i||c?s||i||c?pt.jsx(pt.Fragment,{children:e}):(sessionStorage.setItem("redirectAfterLogin",o.pathname),pt.jsx(yr,{to:n,replace:!0})):pt.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:pt.jsxs("div",{className:"text-center",children:[pt.jsx(at,{className:"w-32 h-32 rounded-full mx-auto mb-4"}),pt.jsx(at,{className:"w-48 h-6 mx-auto mb-2"}),pt.jsx(at,{className:"w-64 h-4 mx-auto"})]})})}function ct({children:e,requirePremium:t,requiredRole:a,fallbackPath:n}){return pt.jsx(it,{requirePremium:t,requiredRole:a,fallbackPath:n,children:pt.jsx(gt.Suspense,{fallback:pt.jsx(z,{}),children:e})})}function lt(){const{user:e,isLoaded:t}=Fn(),[a,n]=gt.useState(null),[r,s]=gt.useState(!0),[o,i]=gt.useState(null),c=async t=>{s(!0),i(null);try{let a=es.getCurrentDatabaseUserId();a&&es.getCurrentClerkId()===t||(console.log("[useUserId] Fetching database ID for Clerk ID:",t),a=e?.emailAddresses?.[0]?.emailAddress?await es.ensureUserExists(t,e.emailAddresses[0].emailAddress,e.firstName||void 0,e.lastName||void 0):await es.getDatabaseUserId(t),a&&await es.setCurrentUser(t,a)),n(a),a?console.log("[useUserId] Database ID resolved:",a):console.warn("[useUserId] No database ID found for Clerk ID:",t)}catch(a){console.error("[useUserId] Error fetching database ID:",a),i(a instanceof Error?a.message:"Failed to fetch database ID")}finally{s(!1)}};return gt.useEffect(()=>{t?e?.id?c(e.id):(n(null),s(!1),es.clearCache()):s(!0)},[e?.id,t]),{clerkId:e?.id||null,databaseId:a,isLoading:!t||r,error:o,refresh:async()=>{e?.id&&await c(e.id)}}}function dt(){const{clerkId:e,databaseId:t,isLoading:a}=lt(),[n,r]=gt.useState([]),[s,o]=gt.useState(null),i=e=>{r(t=>[...t,`${(new Date).toLocaleTimeString()}: ${e}`])};return gt.useEffect(()=>{a?i("Loading user information..."):t?(async()=>{i(`Starting test for Clerk user: ${e}`),i(`Using database ID: ${t}`),o(t);const a=Fr.getChannels();i(`Active channels: ${a.length}`),a.forEach(e=>{i(`  - ${e.topic}: ${e.state}`)}),i("Setting up realtime subscription...");Fr.channel(`test-accounts-${t}`).on("postgres_changes",{event:"*",schema:"public",table:"accounts",filter:`user_id=eq.${t}`},e=>{i(`\ud83c\udfaf REALTIME EVENT RECEIVED: ${e.eventType}`)}).subscribe((e,t)=>{i(`Subscription status: ${e}`),t&&i(`Subscription error: ${t.message}`)});setTimeout(async()=>{i("Creating test account...");const e={user_id:dbUser.id,name:`Test Account ${Date.now()}`,type:"savings",currency:"GBP",balance:100,initial_balance:100,is_active:!0},{data:t,error:a}=await Fr.from("accounts").insert(e).select().single();a?i(`Error creating test account: ${a.message}`):(i(`\u2705 Test account created: ${t.name}`),i("You should see a realtime event above if sync is working!"),setTimeout(async()=>{i("Deleting test account...");const{error:e}=await Fr.from("accounts").delete().eq("id",t.id);i(e?`Error deleting: ${e.message}`:"\u2705 Test account deleted")},5e3))},2e3)})():i("No user logged in or database user not found")},[e,t,a]),pt.jsxs("div",{className:"fixed top-20 right-4 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-lg max-w-md max-h-96 overflow-y-auto z-50 border-2 border-blue-500",children:[pt.jsx("h3",{className:"font-bold text-sm mb-2 text-blue-600",children:"\ud83e\uddea Realtime Sync Test"}),pt.jsxs("div",{className:"text-xs space-y-1 font-mono",children:[pt.jsxs("div",{children:["Clerk ID: ",user?.id?.slice(0,10),"..."]}),pt.jsxs("div",{children:["DB ID: ",s?.slice(0,10),"..."]}),pt.jsx("div",{className:"mt-2 border-t pt-2",children:n.map((e,t)=>pt.jsx("div",{className:e.includes("ERROR")||e.includes("Error")?"text-red-600":e.includes("\u2705")||e.includes("\ud83c\udfaf")?"text-green-600":"text-gray-600",children:e},t))})]})]})}function ut(){const[e,t]=gt.useState(!1),[a,n]=gt.useState(null),[r,s]=gt.useState(!0);gt.useEffect(()=>{(async()=>{if((()=>{if(!Dr())return!1;try{if("true"===localStorage.getItem("safari_warning_dismissed"))return!1}catch{}return!0})()){const e=await _r();n(e),e.warnings&&e.warnings.length>0&&t(!0)}s(!1)})()},[]);const o=()=>{Mr(),t(!1)};if(r||!e||!a)return null;const i=!a.localStorage||!a.sessionStorage,c=!a.thirdPartyCookies;return pt.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",children:pt.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-lg w-full overflow-hidden",children:[pt.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 px-6 py-4",children:pt.jsxs("div",{className:"flex items-center justify-between text-white",children:[pt.jsxs("div",{className:"flex items-center gap-3",children:[pt.jsx(ht,{size:24}),pt.jsx("h2",{className:"text-xl font-bold",children:"Safari Compatibility Issue"})]}),pt.jsx("button",{onClick:o,className:"p-1 hover:bg-white/20 rounded-lg transition-colors",children:pt.jsx(Vn,{size:20})})]})}),pt.jsxs("div",{className:"p-6 space-y-4",children:[pt.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:"We've detected that you're using Safari, which has some compatibility issues with our secure authentication system."}),pt.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg p-4 space-y-2",children:[pt.jsx("h3",{className:"font-semibold text-orange-900 dark:text-orange-300 mb-2",children:"Issues Detected:"}),i&&pt.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[pt.jsx(ht,{size:16,className:"text-orange-600 mt-0.5"}),pt.jsxs("div",{children:[pt.jsx("span",{className:"font-medium text-orange-900 dark:text-orange-300",children:"Private Browsing Mode"}),pt.jsx("p",{className:"text-orange-700 dark:text-orange-400",children:"Safari's private mode blocks storage needed for authentication."})]})]}),c&&pt.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[pt.jsx(ht,{size:16,className:"text-orange-600 mt-0.5"}),pt.jsxs("div",{children:[pt.jsx("span",{className:"font-medium text-orange-900 dark:text-orange-300",children:"Cross-Site Tracking Prevention"}),pt.jsx("p",{className:"text-orange-700 dark:text-orange-400",children:"Safari's privacy settings may block authentication cookies."})]})]})]}),pt.jsxs("div",{className:"space-y-3",children:[pt.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Recommended Solutions:"}),pt.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[pt.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Option 1: Adjust Safari Settings"}),pt.jsxs("ol",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 list-decimal list-inside",children:[i&&pt.jsx("li",{children:"Exit Private Browsing mode (File \u2192 New Window)"}),pt.jsx("li",{children:"Open Safari \u2192 Preferences \u2192 Privacy"}),pt.jsx("li",{children:'Uncheck "Prevent cross-site tracking"'}),pt.jsx("li",{children:'Ensure "Block all cookies" is unchecked'}),pt.jsx("li",{children:"Reload this page and try again"})]})]}),pt.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[pt.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Option 2: Use a Different Browser (Recommended)"}),pt.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"For the best experience, we recommend using:"}),pt.jsxs("div",{className:"flex gap-3",children:[pt.jsxs("a",{href:"https://www.google.com/chrome/",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-2 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/40 transition-colors",children:[pt.jsx(yt,{size:18}),"Chrome",pt.jsx(fr,{size:14})]}),pt.jsxs("a",{href:"https://www.microsoft.com/edge",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-2 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded-lg hover:bg-green-200 dark:hover:bg-green-900/40 transition-colors",children:[pt.jsx(br,{size:18}),"Edge",pt.jsx(fr,{size:14})]}),pt.jsxs("a",{href:"https://www.mozilla.org/firefox/",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-2 bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 rounded-lg hover:bg-orange-200 dark:hover:bg-orange-900/40 transition-colors",children:[pt.jsx(br,{size:18}),"Firefox",pt.jsx(fr,{size:14})]})]})]})]}),pt.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[pt.jsx("button",{onClick:()=>{Mr(),t(!1),window.location.href="/login"},className:"flex-1 px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:"Try Anyway"}),pt.jsx("button",{onClick:o,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"I'll Use Another Browser"})]})]})]})})}function mt(){return gt.useEffect(()=>{(async()=>{(await(async()=>{if(!Dr())return{safari:!1,indexedDB:!0};crypto.randomUUID||(crypto.randomUUID=function(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))});const e=await(async()=>{if(!("indexedDB"in window))return!1;try{return(await new Promise((e,t)=>{const a=indexedDB.open("_test_db_",1);a.onsuccess=()=>e(a.result),a.onerror=()=>t(a.error)})).close(),await new Promise((e,t)=>{const a=indexedDB.deleteDatabase("_test_db_");a.onsuccess=()=>e(),a.onerror=()=>t(a.error)}),!0}catch(e){return!1}})();return{safari:!0,indexedDB:e,privateMode:!e&&0===localStorage.length}})()).safari&&await _r()})(),xd()&&(()=>{if(!xd())return;const e={accounts:wd,transactions:Sd(100),budgets:kd,goals:Id,categories:jd,recurringTransactions:Cd};localStorage.setItem("demoMode","true"),localStorage.setItem("accounts",JSON.stringify(e.accounts)),localStorage.setItem("transactions",JSON.stringify(e.transactions)),localStorage.setItem("budgets",JSON.stringify(e.budgets)),localStorage.setItem("goals",JSON.stringify(e.goals)),localStorage.setItem("categories",JSON.stringify(e.categories)),localStorage.setItem("recurringTransactions",JSON.stringify(e.recurringTransactions))})(),Ad.preloadCommonLogos(),Td.init(),Md.initializeBackups(),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",e=>{"perform-backup"===e.data.type&&Md.performBackup()}),et(Ud),et($d),et(zd),et(Wd)},[]),pt.jsx(Bd,{children:pt.jsx(gc,{children:pt.jsx(mc,{fallback:e=>pt.jsx(a,{error:e.error,resetError:e.resetError}),showDialog:!0,children:pt.jsx(x,{children:pt.jsx(P,{children:pt.jsx(D,{children:pt.jsx(M,{children:pt.jsx(G,{children:pt.jsx(V,{children:pt.jsx(A,{children:pt.jsx($,{children:pt.jsx(K,{children:pt.jsxs(xr,{children:[pt.jsx(ut,{}),pt.jsxs(wr,{children:[pt.jsx(vr,{path:"/login",element:pt.jsx(gt.Suspense,{fallback:pt.jsx(z,{}),children:pt.jsx(Rd,{})})}),pt.jsxs(vr,{path:"/",element:pt.jsx(Ze,{}),children:[pt.jsx(vr,{index:!0,element:pt.jsx(gt.Suspense,{fallback:pt.jsx(z,{}),children:pt.jsx(Fd,{})})}),pt.jsx(vr,{path:"dashboard",element:pt.jsx(ct,{children:pt.jsx(Ud,{})})}),pt.jsx(vr,{path:"accounts",element:pt.jsx(ct,{children:pt.jsx(zd,{})})}),pt.jsx(vr,{path:"accounts/:accountId",element:pt.jsx(ct,{children:pt.jsx(du,{})})}),pt.jsx(vr,{path:"transactions",element:pt.jsx(ct,{children:pt.jsx($d,{})})}),pt.jsx(vr,{path:"transactions-comparison",element:pt.jsx(ct,{children:pt.jsx(Gd,{})})}),pt.jsx(vr,{path:"reconciliation",element:pt.jsx(ct,{children:pt.jsx(qd,{})})}),pt.jsx(vr,{path:"investments",element:pt.jsx(ct,{children:pt.jsx(Hd,{})})}),pt.jsx(vr,{path:"enhanced-investments",element:pt.jsx(ct,{requirePremium:!0,children:pt.jsx(mu,{})})}),pt.jsx(vr,{path:"budget",element:pt.jsx(ct,{children:pt.jsx(Wd,{})})}),pt.jsx(vr,{path:"goals",element:pt.jsx(ct,{children:pt.jsx(Yd,{})})}),pt.jsx(vr,{path:"analytics",element:pt.jsx(ct,{children:pt.jsx(Vd,{})})}),pt.jsx(vr,{path:"ai-analytics",element:pt.jsx(ct,{requirePremium:!0,children:pt.jsx(Qd,{})})}),pt.jsx(vr,{path:"ai-features",element:pt.jsx(ct,{requirePremium:!0,children:pt.jsx(Jd,{})})}),pt.jsx(vr,{path:"custom-reports",element:pt.jsx(ct,{requirePremium:!0,children:pt.jsx(Kd,{})})}),pt.jsx(vr,{path:"tax-planning",element:pt.jsx(ct,{requirePremium:!0,children:pt.jsx(Zd,{})})}),pt.jsx(vr,{path:"summaries",element:pt.jsx(ct,{children:pt.jsx(uu,{})})}),pt.jsx(vr,{path:"household",element:pt.jsx(ct,{requirePremium:!0,children:pt.jsx(gu,{})})}),pt.jsx(vr,{path:"mobile-features",element:pt.jsx(ct,{children:pt.jsx(pu,{})})}),pt.jsx(vr,{path:"business-features",element:pt.jsx(ct,{requirePremium:!0,children:pt.jsx(hu,{})})}),pt.jsx(vr,{path:"financial-planning",element:pt.jsx(ct,{requirePremium:!0,children:pt.jsx(yu,{})})}),pt.jsx(vr,{path:"data-intelligence",element:pt.jsx(ct,{requirePremium:!0,children:pt.jsx(fu,{})})}),pt.jsx(vr,{path:"export-manager",element:pt.jsx(ct,{children:pt.jsx(bu,{})})}),pt.jsx(vr,{path:"enhanced-import",element:pt.jsx(ct,{children:pt.jsx(wu,{})})}),pt.jsx(vr,{path:"documents",element:pt.jsx(ct,{children:pt.jsx(vu,{})})}),pt.jsx(vr,{path:"ocr-test",element:pt.jsx(gt.Suspense,{fallback:pt.jsx(z,{}),children:pt.jsx(Su,{})})}),pt.jsx(vr,{path:"open-banking",element:pt.jsx(gt.Suspense,{fallback:pt.jsx(z,{}),children:pt.jsx(ku,{})})}),pt.jsx(vr,{path:"performance",element:pt.jsx(gt.Suspense,{fallback:pt.jsx(z,{}),children:pt.jsx(Iu,{})})}),pt.jsx(vr,{path:"subscription",element:pt.jsx(gt.Suspense,{fallback:pt.jsx(z,{}),children:pt.jsx(ju,{})})}),pt.jsx(vr,{path:"advanced",element:pt.jsx(gt.Suspense,{fallback:pt.jsx(z,{}),children:pt.jsx(xu,{})})}),pt.jsxs(vr,{path:"settings",children:[pt.jsx(vr,{index:!0,element:pt.jsx(gt.Suspense,{fallback:pt.jsx(z,{}),children:pt.jsx(Xd,{})})}),pt.jsx(vr,{path:"app",element:pt.jsx(gt.Suspense,{fallback:pt.jsx(z,{}),children:pt.jsx(eu,{})})}),pt.jsx(vr,{path:"data",element:pt.jsx(gt.Suspense,{fallback:pt.jsx(z,{}),children:pt.jsx(tu,{})})}),pt.jsx(vr,{path:"categories",element:pt.jsx(gt.Suspense,{fallback:pt.jsx(z,{}),children:pt.jsx(au,{})})}),pt.jsx(vr,{path:"tags",element:pt.jsx(gt.Suspense,{fallback:pt.jsx(z,{}),children:pt.jsx(nu,{})})}),pt.jsx(vr,{path:"notifications",element:pt.jsx(gt.Suspense,{fallback:pt.jsx(z,{}),children:pt.jsx(iu,{})})}),pt.jsx(vr,{path:"accessibility",element:pt.jsx(gt.Suspense,{fallback:pt.jsx(z,{}),children:pt.jsx(cu,{})})}),pt.jsx(vr,{path:"deleted-accounts",element:pt.jsx(gt.Suspense,{fallback:pt.jsx(z,{}),children:pt.jsx(ru,{})})}),pt.jsx(vr,{path:"security",element:pt.jsx(gt.Suspense,{fallback:pt.jsx(z,{}),children:pt.jsx(su,{})})}),pt.jsx(vr,{path:"subscription",element:pt.jsx(gt.Suspense,{fallback:pt.jsx(z,{}),children:pt.jsx(ju,{})})}),pt.jsx(vr,{path:"security/audit-logs",element:pt.jsx(gt.Suspense,{fallback:pt.jsx(z,{}),children:pt.jsx(ou,{})})}),pt.jsx(vr,{path:"accessibility",element:pt.jsx(gt.Suspense,{fallback:pt.jsx(z,{}),children:pt.jsx(lu,{})})})]}),pt.jsx(vr,{path:"diagnostics",element:pt.jsx(gt.Suspense,{fallback:pt.jsx(z,{}),children:pt.jsx(tt,{})})}),pt.jsx(vr,{path:"realtime-test",element:pt.jsx(gt.Suspense,{fallback:pt.jsx(z,{}),children:pt.jsx(dt,{})})}),pt.jsx(vr,{path:"forecasting",element:pt.jsx(yr,{to:"/budget",replace:!0})})]})]})]})})})})})})})})})})})})})}import{r as gt,H as pt,T as ht,M as yt,N as ft,O as bt,Q as xt,S as wt,U as vt,d as St,A as kt,V as It,W as jt,X as Ct,Y as Nt,Z as Dt,$ as Et,a0 as At,a1 as Tt,a2 as _t,a3 as Lt,a4 as Pt,a5 as Mt,a6 as Ot,a7 as Bt,a8 as Rt,a9 as Ft,aa as Ut,ab as zt,ac as $t,ad as Gt,ae as qt,af as Ht,ag as Wt,ah as Yt,ai as Vt,aj as Qt,ak as Jt,al as Kt,am as Zt,an as Xt,ao as ea,ap as ta,aq as aa,ar as na,as as ra,at as sa,au as oa,av as ia,aw as ca,ax as la,ay as da,az as ua,aA as ma,aB as ga,aC as pa,aD as ha,aE as ya,aF as fa,aG as ba,aH as xa,aI as wa,aJ as va,aK as Sa,aL as ka,aM as Ia,aN as ja,aO as Ca,aP as Na,aQ as Da,aR as Ea,aS as Aa,aT as Ta,aU as _a,aV as La,aW as Pa,aX as Ma,aY as Oa,aZ as Ba,a_ as Ra,a$ as Fa,b0 as Ua,b1 as za,b2 as $a,b3 as Ga,b4 as qa,b5 as Ha,b6 as Wa,b7 as Ya,b8 as Va,b9 as Qa,ba as Ja,bb as Ka,bc as Za,bd as Xa,be as en,bf as tn,bg as an,bh as nn,bi as rn,bj as sn,bk as on,bl as cn,bm as ln,bn as dn,bo as un,bp as mn,bq as gn,br as pn,bs as hn,bt as yn,bu as fn,bv as bn,bw as xn,bx as wn,by as vn,bz as Sn,bA as kn,bB as In,bC as jn,bD as Cn,bE as Nn,bF as Dn,bG as En,bH as An,bI as Tn,bJ as _n,bK as Ln,bL as Pn,bM as Mn,bN as On,bO as Bn,bP as Rn,bQ as Fn,bR as Un,bS as zn,bT as $n,bU as Gn,bV as qn,bW as Hn,bX as Wn,bY as Yn,bZ as Vn,b_ as Qn,b$ as Jn,c0 as Kn,c1 as Zn,c2 as Xn,c3 as er,c4 as tr,c5 as ar,c6 as nr,c7 as rr,c8 as sr,c9 as or,ca as ir,cb as cr,cc as lr,cd as dr,ce as ur,cf as mr,cg as gr,ch as pr,ci as hr,cj as yr,ck as fr,cl as br,cm as xr,cn as wr,co as vr,cp as Sr,cq as kr,P as Ir}from"./chunk-DowOIOga.js";import{_ as jr}from"./chunk-ddLY9KjI.js";import{f as Cr,a as Nr}from"./chunk-B5pcS96K.js";!function(){function e(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const a of t)if("childList"===a.type)for(const t of a.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)}).observe(document,{childList:!0,subtree:!0})}}();const Dr=()=>{const e=navigator.userAgent;return e.includes("Safari")&&!e.includes("Chrome")&&!e.includes("Chromium")},Er=async()=>{try{document.cookie="test_cookie=1; SameSite=None; Secure";const e=document.cookie.includes("test_cookie=1");return e&&(document.cookie="test_cookie=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"),e}catch(e){return!1}},Ar=()=>{try{const e="__localStorage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}},Tr=()=>{try{const e="__sessionStorage_test__";return sessionStorage.setItem(e,e),sessionStorage.removeItem(e),!0}catch(e){return!1}},_r=async()=>{if(!Dr())return{compatible:!0};const e={safari:!0,localStorage:Ar(),sessionStorage:Tr(),thirdPartyCookies:await Er(),compatible:!0,warnings:[]};return e.localStorage||(e.warnings.push("localStorage blocked - likely private browsing mode"),e.compatible=!1),e.sessionStorage||(e.warnings.push("sessionStorage blocked - authentication may fail"),e.compatible=!1),e.thirdPartyCookies||e.warnings.push("Third-party cookies blocked - Clerk may not work properly"),e.compatible&&Lr(),e},Lr=()=>{try{const e=window.fetch;window.fetch=function(...t){const[a,n={}]=t;return"string"==typeof a&&(a.includes("clerk.")||a.includes("accounts."))&&(n.credentials="include",n.mode="cors"),e.apply(this,[a,n])}}catch(e){console.error("Failed to patch fetch for Safari:",e)}window.addEventListener&&window.addEventListener("storage",e=>{(e.key?.includes("clerk")||e.key?.includes("__session"))&&window.location.reload()}),Pr()},Pr=()=>{Promise.allSettled||(Promise.allSettled=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))}),"undefined"==typeof queueMicrotask&&(window.queueMicrotask=function(e){Promise.resolve().then(e)}),document.hasStorageAccess&&document.requestStorageAccess&&document.hasStorageAccess().then(e=>{if(!e)return document.requestStorageAccess()}).catch(e=>{})},Mr=()=>{try{localStorage.setItem("safari_warning_dismissed","true")}catch{try{sessionStorage.setItem("safari_warning_dismissed","true")}catch{document.cookie="safari_warning_dismissed=true; max-age=2592000"}}};class Or extends gt.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null,isSafariIssue:!1,safariSolution:null}}static getDerivedStateFromError(e){const t=Dr()&&(e.message.includes("localStorage")||e.message.includes("sessionStorage")||e.message.includes("cookie")||e.message.includes("Clerk")||e.message.includes("authentication")),a=t?(e=>{const t=e?.message||e?.toString()||"";return t.includes("localStorage")||t.includes("sessionStorage")?{message:"Storage access blocked in Safari",solution:'Please disable "Prevent cross-site tracking" in Safari Settings > Privacy, or try using a different browser.'}:t.includes("cookie")||t.includes("Cookie")?{message:"Cookies are blocked in Safari",solution:'Please enable cookies in Safari Settings > Privacy > "Block all cookies" should be OFF.'}:t.includes("fetch")||t.includes("network")?{message:"Network request blocked by Safari",solution:"Please check Safari content blockers or try disabling extensions."}:t.includes("crypto")||t.includes("subtle")?{message:"Cryptography API not available",solution:"Please ensure you are using HTTPS or update Safari to the latest version."}:{message:"Authentication error in Safari",solution:'Please try: 1) Clear Safari cache and cookies, 2) Disable "Prevent cross-site tracking", 3) Use a different browser like Chrome or Firefox.'}})(e):null;return{hasError:!0,error:e,errorInfo:null,isSafariIssue:t,safariSolution:a}}componentDidCatch(e,t){console.error("Clerk authentication error:",e,t),window.Sentry&&window.Sentry.captureException(e,{contexts:{react:{componentStack:t.componentStack},browser:{safari:Dr(),userAgent:navigator.userAgent}}}),this.setState({errorInfo:t})}handleReload=()=>{window.location.reload()};handleGoHome=()=>{window.location.href="/"};handleClearStorage=()=>{try{const e=[];for(let t=0;t<localStorage.length;t++){const a=localStorage.key(t);a&&(a.includes("clerk")||a.includes("__session"))&&e.push(a)}e.forEach(e=>localStorage.removeItem(e)),sessionStorage.clear(),document.cookie.split(";").forEach(e=>{document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()+";path=/")}),window.location.reload()}catch(e){console.error("Failed to clear storage:",e),alert("Failed to clear storage. Please try manually clearing your browser data.")}};render(){return this.state.hasError?pt.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center p-4",children:pt.jsxs("div",{className:"max-w-md w-full bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden",children:[pt.jsx("div",{className:"px-6 py-4 "+(this.state.isSafariIssue?"bg-gradient-to-r from-orange-500 to-red-500":"bg-gradient-to-r from-red-500 to-pink-500"),children:pt.jsxs("div",{className:"flex items-center gap-3 text-white",children:[pt.jsx(ht,{size:24}),pt.jsx("h1",{className:"text-xl font-bold",children:this.state.isSafariIssue?"Safari Authentication Issue":"Authentication Error"})]})}),pt.jsxs("div",{className:"p-6 space-y-4",children:[this.state.isSafariIssue&&this.state.safariSolution?pt.jsxs(pt.Fragment,{children:[pt.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg p-4",children:[pt.jsx("p",{className:"text-sm font-medium text-orange-900 dark:text-orange-300 mb-2",children:this.state.safariSolution.message}),pt.jsx("p",{className:"text-sm text-orange-700 dark:text-orange-400",children:this.state.safariSolution.solution})]}),pt.jsxs("div",{className:"space-y-2",children:[pt.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"For the best experience, try using:"}),pt.jsxs("div",{className:"flex gap-2",children:[pt.jsxs("a",{href:"https://www.google.com/chrome/",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-2 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/40 transition-colors text-sm",children:[pt.jsx(yt,{size:16}),"Chrome"]}),pt.jsx("a",{href:"https://www.microsoft.com/edge",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-2 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded-lg hover:bg-green-200 dark:hover:bg-green-900/40 transition-colors text-sm",children:"Edge"})]})]})]}):pt.jsxs(pt.Fragment,{children:[pt.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:"We encountered an error with the authentication system. This might be temporary."}),this.state.error&&pt.jsxs("details",{className:"text-sm",children:[pt.jsx("summary",{className:"cursor-pointer text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300",children:"Technical details"}),pt.jsx("pre",{className:"mt-2 p-2 bg-gray-100 dark:bg-gray-700 rounded text-xs overflow-auto",children:this.state.error.message})]})]}),pt.jsxs("div",{className:"flex flex-col gap-2 pt-4 border-t border-gray-200 dark:border-gray-700",children:[pt.jsxs("button",{onClick:this.handleReload,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[pt.jsx(ft,{size:18}),"Try Again"]}),pt.jsx("button",{onClick:this.handleClearStorage,className:"w-full px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm",children:"Clear Storage & Retry"}),pt.jsxs("button",{onClick:this.handleGoHome,className:"w-full px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors flex items-center justify-center gap-2 text-sm",children:[pt.jsx(bt,{size:16}),"Go to Homepage"]})]})]})]})}):this.props.children}}const Br=e=>{if(e)return"string"==typeof e?e:e instanceof Date?e.toISOString():void 0},Rr=()=>(new Date).toISOString(),Fr=xt("https://nqbacrjjgdjabygqtcah.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xYmFjcmpqZ2RqYWJ5Z3F0Y2FoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIzNDgxNjgsImV4cCI6MjA2NzkyNDE2OH0.teKfoCvodwO719cNddtlC7k-gWoHu_Ntd64mo6XkDq4",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!1},global:{headers:{"x-client-info":"wealthtracker-web"}},realtime:{params:{eventsPerSecond:10}}});class Ur{static async getUserProfile(e){if(!Fr)return null;const{data:t,error:a}=await Fr.from("user_profiles").select("*").eq("clerk_user_id",e).single();return a?(console.error("Error fetching user profile:",a),null):t}static async getAccounts(e){if(!Fr)return[];const{data:t,error:a}=await Fr.from("accounts").select("*").eq("user_id",e).order("created_at",{ascending:!0});return a?(console.error("Error fetching accounts:",a),[]):t||[]}static async createAccount(e,t){if(!Fr)return null;const{data:a,error:n}=await Fr.from("accounts").insert({user_id:e,name:t.name,type:t.type,balance:t.balance||0,currency:t.currency||"USD",institution:t.institution,is_active:!0}).select().single();return n?(console.error("Error creating account:",n),null):a}static async updateAccount(e,t){if(!Fr)return null;const{data:a,error:n}=await Fr.from("accounts").update(t).eq("id",e).select().single();return n?(console.error("Error updating account:",n),null):a}static async deleteAccount(e){if(!Fr)return!1;const{error:t}=await Fr.from("accounts").delete().eq("id",e);return!t||(console.error("Error deleting account:",t),!1)}static async getTransactions(e,t=100){if(!Fr)return[];const{data:a,error:n}=await Fr.from("transactions").select("*").eq("user_id",e).order("date",{ascending:!1}).limit(t);return n?(console.error("Error fetching transactions:",n),[]):a||[]}static async createTransaction(e,t){if(!Fr)return null;const{data:a,error:n}=await Fr.from("transactions").insert({user_id:e,account_id:t.accountId,date:t.date,description:t.description,amount:t.amount,type:t.type,category:t.category,notes:t.notes,tags:t.tags}).select().single();return n?(console.error("Error creating transaction:",n),null):a}static async updateTransaction(e,t){if(!Fr)return null;const{data:a,error:n}=await Fr.from("transactions").update(t).eq("id",e).select().single();return n?(console.error("Error updating transaction:",n),null):a}static async deleteTransaction(e){if(!Fr)return!1;const{error:t}=await Fr.from("transactions").delete().eq("id",e);return!t||(console.error("Error deleting transaction:",t),!1)}static async getBudgets(e){if(!Fr)return[];const{data:t,error:a}=await Fr.from("budgets").select("*").eq("user_id",e).eq("is_active",!0).order("category",{ascending:!0});return a?(console.error("Error fetching budgets:",a),[]):t||[]}static async createBudget(e,t){if(!Fr)return null;const{data:a,error:n}=await Fr.from("budgets").insert({user_id:e,name:t.name,category:t.category,amount:t.amount,period:t.period||"monthly",start_date:t.startDate,is_active:!0}).select().single();return n?(console.error("Error creating budget:",n),null):a}static async getGoals(e){if(!Fr)return[];const{data:t,error:a}=await Fr.from("goals").select("*").eq("user_id",e).order("target_date",{ascending:!0});return a?(console.error("Error fetching goals:",a),[]):t||[]}static async createGoal(e,t){if(!Fr)return null;const{data:a,error:n}=await Fr.from("goals").insert({user_id:e,name:t.name,description:t.description,target_amount:t.targetAmount,current_amount:t.currentAmount||0,target_date:t.targetDate,category:t.category}).select().single();return n?(console.error("Error creating goal:",n),null):a}static subscribeToAccounts(e,t){return Fr?Fr.channel("accounts_changes").on("postgres_changes",{event:"*",schema:"public",table:"accounts",filter:`user_id=eq.${e}`},t).subscribe():null}static subscribeToTransactions(e,t){return Fr?Fr.channel("transactions_changes").on("postgres_changes",{event:"*",schema:"public",table:"transactions",filter:`user_id=eq.${e}`},t).subscribe():null}static async importTransactions(e,t){if(!Fr)return{success:0,failed:0};const a=await Promise.allSettled(t.map(t=>this.createTransaction(e,t)));return{success:a.filter(e=>"fulfilled"===e.status).length,failed:a.filter(e=>"rejected"===e.status).length}}}const zr=new class{dbName;dbVersion;db=null;dbConfig;safariMode=!1;initPromise=null;constructor(){this.dbName="WealthTrackerDB",this.dbVersion=2,this.checkSafari(),this.dbConfig={name:this.dbName,version:this.dbVersion,stores:[{name:"documents",keyPath:"id",indexes:[{name:"transactionId",keyPath:"transactionId",unique:!1},{name:"accountId",keyPath:"accountId",unique:!1},{name:"type",keyPath:"type",unique:!1},{name:"uploadDate",keyPath:"uploadDate",unique:!1}]},{name:"documentBlobs",keyPath:"documentId"},{name:"cache",keyPath:"key",indexes:[{name:"expiry",keyPath:"expiry",unique:!1}]},{name:"largeData",keyPath:"key"},{name:"secureData",keyPath:"key"},{name:"offline-queue",keyPath:"id"},{name:"offline-data",keyPath:"id"},{name:"conflicts",keyPath:"id"},{name:"sync-meta",keyPath:"key"}]}}checkSafari(){const e=navigator.userAgent;this.safariMode=e.includes("Safari")&&!e.includes("Chrome")&&!e.includes("Chromium")}async init(){return this.initPromise||(this.initPromise=this._doInit()),this.initPromise}async _doInit(){return new Promise((e,t)=>{if(this.db)return void e();let a;try{a=indexedDB.open(this.dbName,this.dbVersion)}catch(n){return console.error("Failed to open IndexedDB:",n),void t(new Error("IndexedDB not available (possibly private browsing mode)"))}a.onerror=e=>{const a=e.target.error;console.error("IndexedDB error:",a),this.safariMode?t(new Error("IndexedDB failed in Safari. This might be due to private browsing mode or storage restrictions.")):t(new Error("Failed to open IndexedDB: "+(a?.message||"Unknown error")))},a.onsuccess=t=>{this.db=t.target.result,e()},a.onupgradeneeded=e=>{const t=e.target.result;this.dbConfig.stores.forEach(e=>{if(!t.objectStoreNames.contains(e.name)){const a=t.createObjectStore(e.name,{keyPath:e.keyPath});e.indexes?.forEach(e=>{a.createIndex(e.name,e.keyPath,{unique:e.unique||!1})})}})}})}async ensureDB(){if(!this.db)try{await this.init()}catch(e){if(console.error("Failed to initialize IndexedDB:",e),this.safariMode)throw new Error("IndexedDB not available in Safari. Please check browser settings or disable private browsing mode.");throw e}if(!this.db)throw new Error("Database initialization failed");return this.db}async add(e,t){const a=await this.ensureDB();return new Promise((n,r)=>{const s=a.transaction([e],"readwrite").objectStore(e).add(t);s.onsuccess=()=>n(),s.onerror=()=>r(new Error(`Failed to add data to ${e}`))})}async put(e,t){const a=await this.ensureDB();return new Promise((n,r)=>{const s=a.transaction([e],"readwrite").objectStore(e).put(t);s.onsuccess=()=>n(),s.onerror=()=>r(new Error(`Failed to put data to ${e}`))})}async get(e,t){const a=await this.ensureDB();return new Promise((n,r)=>{const s=a.transaction([e],"readonly").objectStore(e).get(t);s.onsuccess=()=>n(s.result),s.onerror=()=>r(new Error(`Failed to get data from ${e}`))})}async getAll(e){const t=await this.ensureDB();return new Promise((a,n)=>{const r=t.transaction([e],"readonly").objectStore(e).getAll();r.onsuccess=()=>a(r.result||[]),r.onerror=()=>n(new Error(`Failed to get all data from ${e}`))})}async getByIndex(e,t,a){const n=await this.ensureDB();return new Promise((r,s)=>{const o=n.transaction([e],"readonly").objectStore(e).index(t).getAll(a);o.onsuccess=()=>r(o.result||[]),o.onerror=()=>s(new Error(`Failed to get data by index from ${e}`))})}async delete(e,t){const a=await this.ensureDB();return new Promise((n,r)=>{const s=a.transaction([e],"readwrite").objectStore(e).delete(t);s.onsuccess=()=>n(),s.onerror=()=>r(new Error(`Failed to delete data from ${e}`))})}async clear(e){const t=await this.ensureDB();return new Promise((a,n)=>{const r=t.transaction([e],"readwrite").objectStore(e).clear();r.onsuccess=()=>a(),r.onerror=()=>n(new Error(`Failed to clear ${e}`))})}async count(e){const t=await this.ensureDB();return new Promise((a,n)=>{const r=t.transaction([e],"readonly").objectStore(e).count();r.onsuccess=()=>a(r.result),r.onerror=()=>n(new Error(`Failed to count items in ${e}`))})}async storeBlob(e,t){await this.put("documentBlobs",{documentId:e,blob:t,size:t.size,type:t.type,storedAt:new Date})}async getBlob(e){const t=await this.get("documentBlobs",e);return t?.blob}async setCache(e,t,a=60){const n=new Date;n.setMinutes(n.getMinutes()+a),await this.put("cache",{key:e,value:t,expiry:n.getTime(),createdAt:new Date})}async getCache(e){const t=await this.get("cache",e);if(t){if(!(t.expiry<Date.now()))return t.value;await this.delete("cache",e)}}async cleanCache(){const e=(await this.ensureDB()).transaction(["cache"],"readwrite").objectStore("cache").index("expiry"),t=Date.now();e.openCursor(IDBKeyRange.upperBound(t)).onsuccess=e=>{const t=e.target.result;t&&(t.delete(),t.continue())}}async getStorageInfo(){if("storage"in navigator&&"estimate"in navigator.storage){const e=await navigator.storage.estimate();return{usage:e.usage||0,quota:e.quota||0}}return{usage:0,quota:0}}async getAllKeys(e){const t=await this.ensureDB();return new Promise((a,n)=>{const r=t.transaction([e],"readonly").objectStore(e).getAllKeys();r.onsuccess=()=>a(r.result),r.onerror=()=>n(new Error(`Failed to get keys from ${e}`))})}async putBulk(e,t){const a=await this.ensureDB();return new Promise((n,r)=>{const s=a.transaction([e],"readwrite"),o=s.objectStore(e);let i=!1;t.forEach(({key:e,value:t})=>{o.put({...t,key:e}).onerror=()=>{i=!0,r(new Error(`Failed to put item with key ${e}`))}}),s.oncomplete=()=>{i||n()},s.onerror=()=>{r(new Error("Bulk put transaction failed"))}})}async clearStore(e){return this.clear(e)}close(){this.db&&(this.db.close(),this.db=null)}},$r=new class{encryptionKey;storeName="secureData";compressionThreshold=10240;constructor(){this.encryptionKey=this.getOrCreateEncryptionKey()}getOrCreateEncryptionKey(){let e=sessionStorage.getItem("wt_enc_key");return e||(e=wt.lib.WordArray.random(32).toString(),sessionStorage.setItem("wt_enc_key",e)),e}encrypt(e){const t=JSON.stringify(e);return wt.AES.encrypt(t,this.encryptionKey).toString()}decrypt(e){try{const t=wt.AES.decrypt(e,this.encryptionKey).toString(wt.enc.Utf8);return JSON.parse(t)}catch(t){throw console.error("Decryption failed:",t),new Error("Failed to decrypt data")}}compress(e){return btoa(e)}decompress(e){return atob(e)}async setItem(e,t,a={}){const{encrypted:n=!0,expiryDays:r,compress:s=!1}=a;let o=t,i=!1;const c=JSON.stringify(t).length;s&&c>this.compressionThreshold&&(i=!0),n?o=this.encrypt(t):i&&(o=this.compress(JSON.stringify(t)));const l={data:o,timestamp:Date.now(),encrypted:n,compressed:i&&!n};r&&(l.expiry=Date.now()+24*r*60*60*1e3),await zr.put(this.storeName,{key:e,...l})}async getItem(e){try{const t=await zr.get(this.storeName,e);if(!t)return null;if(t.expiry&&Date.now()>t.expiry)return await this.removeItem(e),null;let a=t.data;return t.encrypted&&"string"==typeof a?a=this.decrypt(a):t.compressed&&"string"==typeof a&&(a=JSON.parse(this.decompress(a))),a}catch(t){return console.error("Error retrieving data:",t),null}}async removeItem(e){await zr.delete(this.storeName,e)}async clear(){await zr.clearStore(this.storeName)}async getAllKeys(){return await zr.getAllKeys(this.storeName)}async setItems(e){const t=await Promise.all(e.map(async({key:e,value:t,options:a})=>{const{encrypted:n=!0,expiryDays:r,compress:s=!1}=a||{};let o=t,i=!1;const c=JSON.stringify(t).length;s&&c>this.compressionThreshold&&(i=!0),n?o=this.encrypt(t):i&&(o=this.compress(JSON.stringify(t)));const l={data:o,timestamp:Date.now(),encrypted:n,compressed:i&&!n};return r&&(l.expiry=Date.now()+24*r*60*60*1e3),{key:e,value:l}}));await zr.putBulk(this.storeName,t)}async migrateFromLocalStorage(e){const t=[];for(const n of e){const e=localStorage.getItem(n);if(e)try{const a=JSON.parse(e);t.push({key:n,value:a,options:{encrypted:!0}})}catch(a){t.push({key:n,value:e,options:{encrypted:!0}})}}if(t.length>0){await this.setItems(t);for(const t of e)localStorage.removeItem(t)}}async cleanupExpiredData(){const e=await this.getAllKeys();for(const t of e){const e=await zr.get(this.storeName,t);e?.expiry&&Date.now()>e.expiry&&await this.removeItem(t)}}async exportData(){const e=await this.getAllKeys(),t={};for(const a of e){const e=await this.getItem(a);null!==e&&(t[a]=e)}return t}async importData(e,t={}){const a=Object.entries(e).map(([e,a])=>({key:e,value:a,options:t}));await this.setItems(a)}async getStorageInfo(){if("storage"in navigator&&"estimate"in navigator.storage){const e=await navigator.storage.estimate(),t=e.usage||0,a=e.quota||0;return{usage:t,quota:a,percentUsed:a>0?t/a*100:0}}return{usage:0,quota:0,percentUsed:0}}},Gr="wealthtracker_accounts",qr="wealthtracker_transactions",Hr="wealthtracker_budgets",Wr="wealthtracker_goals",Yr="wealthtracker_categories",Vr=new class{_isReady=!1;migrationCompleted=!1;get isReady(){return this._isReady}async init(){try{await zr.init(),sessionStorage.getItem("wt_migration_completed")||(await this.migrateFromLocalStorage(),sessionStorage.setItem("wt_migration_completed","true")),this._isReady=!0,this.scheduleCleanup()}catch(e){console.error("Failed to initialize secure storage:",e),this._isReady=!0}}async migrateFromLocalStorage(){const e=[Gr,qr,Hr,Wr,"wealthtracker_tags","wealthtracker_recurring",Yr,"wealthtracker_preferences","money_management_theme","money_management_accent_color","money_management_notifications","money_management_budget_alerts_enabled","money_management_alert_threshold","money_management_large_transaction_alerts_enabled","money_management_large_transaction_threshold"];for(let a=0;a<localStorage.length;a++){const t=localStorage.key(a);t&&(t.startsWith("wealthtracker_")||t.startsWith("money_management_"))&&(e.includes(t)||e.push(t))}try{await $r.migrateFromLocalStorage(e),console.log("Migration completed successfully"),this.migrationCompleted=!0}catch(t){console.error("Migration failed:",t)}}async get(e){try{const t=await $r.getItem(e);if(null!==t)return t;if(!this.migrationCompleted){const t=localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch{return t}}return null}catch(t){console.error(`Error getting ${e}:`,t);const a=localStorage.getItem(e);if(a)try{return JSON.parse(a)}catch{return a}return null}}async set(e,t){try{const a=[Gr,qr,Hr,Wr].includes(e)||e.includes("transaction")||e.includes("account")||e.includes("budget")||e.includes("financial");await $r.setItem(e,t,{encrypted:a,expiryDays:a?void 0:30,compress:JSON.stringify(t).length>10240}),this.migrationCompleted&&localStorage.removeItem(e)}catch(a){console.error(`Error setting ${e}:`,a),localStorage.setItem(e,JSON.stringify(t))}}async remove(e){try{await $r.removeItem(e),localStorage.removeItem(e)}catch(t){console.error(`Error removing ${e}:`,t),localStorage.removeItem(e)}}async clear(){try{await $r.clear();const e=[];for(let t=0;t<localStorage.length;t++){const a=localStorage.key(t);a&&(a.startsWith("wealthtracker_")||a.startsWith("money_management_"))&&e.push(a)}e.forEach(e=>localStorage.removeItem(e))}catch(e){console.error("Error clearing storage:",e)}}scheduleCleanup(){setInterval(async()=>{try{await $r.cleanupExpiredData(),await zr.cleanCache()}catch(e){console.error("Cleanup error:",e)}},36e5),setTimeout(async()=>{try{await $r.cleanupExpiredData(),await zr.cleanCache()}catch(e){console.error("Initial cleanup error:",e)}},5e3)}async exportData(){return await $r.exportData()}async importData(e){await $r.importData(e,{encrypted:!0})}async getStorageInfo(){return await $r.getStorageInfo()}},Qr=xt("https://nqbacrjjgdjabygqtcah.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xYmFjcmpqZ2RqYWJ5Z3F0Y2FoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIzNDgxNjgsImV4cCI6MjA2NzkyNDE2OH0.teKfoCvodwO719cNddtlC7k-gWoHu_Ntd64mo6XkDq4",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0},realtime:{params:{eventsPerSecond:10}}}),Jr=()=>null!==Qr,Kr=e=>e?.message?e.message:e?.details?e.details:e?.hint?e.hint:"An unexpected error occurred";class Zr{static async getOrCreateUser(e,t,a,n){if(!Jr())return null;try{const{data:r,error:s}=await Qr.from("users").select("*").eq("clerk_id",e).single();if(r)return r;if("PGRST116"===s?.code){const{data:r,error:s}=await Qr.from("users").insert({clerk_id:e,email:t,first_name:a,last_name:n,subscription_tier:"free",subscription_status:"active",settings:{},preferences:{}}).select().single();if(s)throw console.error("Error creating user:",s),new Error(Kr(s));return r}if(s)throw console.error("Error fetching user:",s),new Error(Kr(s));return null}catch(r){throw console.error("UserService.getOrCreateUser error:",r),r}}static async updateUser(e,t){if(!Jr())return null;try{const{data:a,error:n}=await Qr.from("users").update(t).eq("clerk_id",e).select().single();if(n)throw console.error("Error updating user:",n),new Error(Kr(n));return a}catch(a){throw console.error("UserService.updateUser error:",a),a}}static async updatePreferences(e,t){if(Jr())try{const{error:a}=await Qr.from("users").update({preferences:t}).eq("clerk_id",e);if(a)throw console.error("Error updating preferences:",a),new Error(Kr(a))}catch(a){throw console.error("UserService.updatePreferences error:",a),a}else localStorage.setItem("wealthtracker_preferences",JSON.stringify(t))}static async updateSettings(e,t){if(Jr())try{const{error:a}=await Qr.from("users").update({settings:t}).eq("clerk_id",e);if(a)throw console.error("Error updating settings:",a),new Error(Kr(a))}catch(a){throw console.error("UserService.updateSettings error:",a),a}else localStorage.setItem("wealthtracker_settings",JSON.stringify(t))}static async getUserByClerkId(e){if(!Jr())return null;try{const{data:t,error:a}=await Qr.from("users").select("*").eq("clerk_id",e).single();if(a){if("PGRST116"===a.code)return null;throw console.error("Error fetching user:",a),new Error(Kr(a))}return t}catch(t){throw console.error("UserService.getUserByClerkId error:",t),t}}static async updateLastSync(e){if(Jr())try{const{error:t}=await Qr.from("users").update({last_sync_at:(new Date).toISOString()}).eq("clerk_id",e);if(t)throw console.error("Error updating last sync:",t),new Error(Kr(t))}catch(t){throw console.error("UserService.updateLastSync error:",t),t}}}class Xr{cache=new Map;CACHE_DURATION=3e5;currentClerkId=null;currentDatabaseId=null;async getDatabaseUserId(e){if(!e)return null;const t=this.cache.get(e);if(t&&Date.now()-t.timestamp<this.CACHE_DURATION)return t.databaseId;if(!Jr()||!Qr)return null;try{console.log("[UserIdService] Fetching database ID for Clerk ID:",e);const{data:t,error:a}=await Qr.from("users").select("id").eq("clerk_id",e).single();return a?"PGRST116"===a.code?(console.log("[UserIdService] User not found for Clerk ID:",e),null):(console.error("[UserIdService] Error fetching user:",a),null):t?(this.cache.set(e,{clerkId:e,databaseId:t.id,timestamp:Date.now()}),console.log("[UserIdService] Found database ID:",t.id,"for Clerk ID:",e),t.id):(console.log("[UserIdService] No user found for Clerk ID:",e),null)}catch(a){return console.error("[UserIdService] Failed to get database user ID:",a),null}}async setCurrentUser(e,t){if(this.currentClerkId=e,t)this.currentDatabaseId=t,this.cache.set(e,{clerkId:e,databaseId:t,timestamp:Date.now()});else{const t=await this.getDatabaseUserId(e);this.currentDatabaseId=t}}getCurrentDatabaseUserId(){return this.currentDatabaseId}getCurrentClerkId(){return this.currentClerkId}getCurrentUserIds(){return{clerkId:this.currentClerkId,databaseId:this.currentDatabaseId}}clearCache(){this.cache.clear(),this.currentClerkId=null,this.currentDatabaseId=null}async ensureUserExists(e,t,a,n){try{let r=await this.getDatabaseUserId(e);if(!r){console.log("[UserIdService] User not found, creating new user");const s=await Zr.getOrCreateUser(e,t,a,n);s&&(r=s.id,this.cache.set(e,{clerkId:e,databaseId:r,timestamp:Date.now()}))}return r&&(this.currentClerkId=e,this.currentDatabaseId=r,console.log("[UserIdService] Current user set - Clerk ID:",e,"Database ID:",r)),r}catch(r){return console.error("[UserIdService] Failed to ensure user exists:",r),null}}debug(){console.log("  Cache entries:",Array.from(this.cache.entries()).map(([e,t])=>({clerkId:e,databaseId:t.databaseId,age:Math.round((Date.now()-t.timestamp)/1e3)+"s"})))}}const es=new Xr,ts=Object.freeze(Object.defineProperty({__proto__:null,UserIdService:Xr,userIdService:es},Symbol.toStringTag,{value:"Module"})),as=vt("accounts/fetchFromSupabase",async(e,{rejectWithValue:a})=>{try{const e=await t();if(!e)throw new Error("User not authenticated");const a=await Ur.getAccounts(e);return await Vr.set("accounts",a),a}catch(n){console.error("Failed to fetch accounts from Supabase:",n);try{return await Vr.get("accounts")||[]}catch(r){return a("Failed to fetch accounts and no cached data available")}}}),ns=vt("accounts/createInSupabase",async(e,{rejectWithValue:a,dispatch:n})=>{try{const a=await t();if(!a)throw new Error("User not authenticated");const n=await Ur.createAccount(a,e);if(!n)throw new Error("Failed to create account in Supabase");const r=await Vr.get("accounts")||[];return await Vr.set("accounts",[...r,n]),n}catch(r){console.error("Failed to create account in Supabase:",r);const t={...e,id:`temp-${crypto.randomUUID()}`,lastUpdated:new Date,updatedAt:new Date},a=await Vr.get("accounts")||[],n=await Vr.get("offline_accounts")||[];return await Vr.set("accounts",[...a,t]),await Vr.set("offline_accounts",[...n,t]),t}}),rs=vt("accounts/updateInSupabase",async({id:e,updates:t},{rejectWithValue:a})=>{try{const a=await Ur.updateAccount(e,t);if(!a)throw new Error("Failed to update account in Supabase");const n=(await Vr.get("accounts")||[]).map(t=>t.id===e?a:t);return await Vr.set("accounts",n),a}catch(n){console.error("Failed to update account in Supabase:",n);const r=await Vr.get("accounts")||[],s=r.findIndex(t=>t.id===e);if(-1!==s){const a={...r[s],...t,updatedAt:new Date};r[s]=a,await Vr.set("accounts",r);const n=await Vr.get("offline_account_updates")||[];return await Vr.set("offline_account_updates",[...n,{id:e,updates:t}]),a}return a("Account not found")}}),ss=vt("accounts/deleteFromSupabase",async(e,{rejectWithValue:t})=>{try{if(!(await Ur.deleteAccount(e)))throw new Error("Failed to delete account from Supabase");const t=(await Vr.get("accounts")||[]).filter(t=>t.id!==e);return await Vr.set("accounts",t),e}catch(a){console.error("Failed to delete account from Supabase:",a);const t=(await Vr.get("accounts")||[]).filter(t=>t.id!==e);await Vr.set("accounts",t);const n=await Vr.get("offline_account_deletes")||[];return await Vr.set("offline_account_deletes",[...n,e]),e}}),os=vt("transactions/fetchFromSupabase",async(e=1e3,{rejectWithValue:a})=>{try{const a=await t();if(!a)throw new Error("User not authenticated");const n=await Ur.getTransactions(a,e);return await Vr.set("transactions",n),n}catch(n){console.error("Failed to fetch transactions from Supabase:",n);try{return await Vr.get("transactions")||[]}catch(r){return a("Failed to fetch transactions and no cached data available")}}}),is=vt("transactions/createInSupabase",async(e,{rejectWithValue:a})=>{try{const a=await t();if(!a)throw new Error("User not authenticated");const n=await Ur.createTransaction(a,e);if(!n)throw new Error("Failed to create transaction in Supabase");const r=await Vr.get("transactions")||[];return await Vr.set("transactions",[...r,n]),n}catch(n){console.error("Failed to create transaction in Supabase:",n);const t={...e,id:`temp-${crypto.randomUUID()}`},a=await Vr.get("transactions")||[],r=await Vr.get("offline_transactions")||[];return await Vr.set("transactions",[...a,t]),await Vr.set("offline_transactions",[...r,t]),t}}),cs=vt("transactions/updateInSupabase",async({id:e,updates:t},{rejectWithValue:a})=>{try{const a=await Ur.updateTransaction(e,t);if(!a)throw new Error("Failed to update transaction in Supabase");const n=(await Vr.get("transactions")||[]).map(t=>t.id===e?a:t);return await Vr.set("transactions",n),a}catch(n){console.error("Failed to update transaction in Supabase:",n);const r=await Vr.get("transactions")||[],s=r.findIndex(t=>t.id===e);if(-1!==s){const a={...r[s],...t};r[s]=a,await Vr.set("transactions",r);const n=await Vr.get("offline_transaction_updates")||[];return await Vr.set("offline_transaction_updates",[...n,{id:e,updates:t}]),a}return a("Transaction not found")}}),ls=vt("transactions/deleteFromSupabase",async(e,{rejectWithValue:t})=>{try{if(!(await Ur.deleteTransaction(e)))throw new Error("Failed to delete transaction from Supabase");const t=(await Vr.get("transactions")||[]).filter(t=>t.id!==e);return await Vr.set("transactions",t),e}catch(a){console.error("Failed to delete transaction from Supabase:",a);const t=(await Vr.get("transactions")||[]).filter(t=>t.id!==e);await Vr.set("transactions",t);const n=await Vr.get("offline_transaction_deletes")||[];return await Vr.set("offline_transaction_deletes",[...n,e]),e}}),ds=vt("budgets/fetchFromSupabase",async(e,{rejectWithValue:a})=>{try{const e=await t();if(!e)throw new Error("User not authenticated");const a=await Ur.getBudgets(e);return await Vr.set("budgets",a),a}catch(n){console.error("Failed to fetch budgets from Supabase:",n);try{return await Vr.get("budgets")||[]}catch(r){return a("Failed to fetch budgets and no cached data available")}}}),us=vt("budgets/createInSupabase",async(e,{rejectWithValue:a})=>{try{const a=await t();if(!a)throw new Error("User not authenticated");const n=await Ur.createBudget(a,e);if(!n)throw new Error("Failed to create budget in Supabase");const r=await Vr.get("budgets")||[];return await Vr.set("budgets",[...r,n]),n}catch(n){console.error("Failed to create budget in Supabase:",n);const t={...e,id:`temp-${crypto.randomUUID()}`,createdAt:new Date,spent:0},a=await Vr.get("budgets")||[],r=await Vr.get("offline_budgets")||[];return await Vr.set("budgets",[...a,t]),await Vr.set("offline_budgets",[...r,t]),t}}),ms=vt("goals/fetchFromSupabase",async(e,{rejectWithValue:a})=>{try{const e=await t();if(!e)throw new Error("User not authenticated");const a=await Ur.getGoals(e);return await Vr.set("goals",a),a}catch(n){console.error("Failed to fetch goals from Supabase:",n);try{return await Vr.get("goals")||[]}catch(r){return a("Failed to fetch goals and no cached data available")}}}),gs=vt("goals/createInSupabase",async(e,{rejectWithValue:a})=>{try{const a=await t();if(!a)throw new Error("User not authenticated");const n=await Ur.createGoal(a,e);if(!n)throw new Error("Failed to create goal in Supabase");const r=await Vr.get("goals")||[];return await Vr.set("goals",[...r,n]),n}catch(n){console.error("Failed to create goal in Supabase:",n);const t={...e,id:`temp-${crypto.randomUUID()}`,createdAt:new Date,currentAmount:0},a=await Vr.get("goals")||[],r=await Vr.get("offline_goals")||[];return await Vr.set("goals",[...a,t]),await Vr.set("offline_goals",[...r,t]),t}}),ps=vt("app/syncOfflineData",async(e,{dispatch:a,rejectWithValue:n})=>{try{if(!(await t()))throw new Error("User not authenticated");const e=await Vr.get("offline_accounts")||[];for(const t of e)t.id.startsWith("temp-")&&await a(ns(t));const n=await Vr.get("offline_transactions")||[];for(const t of n)t.id.startsWith("temp-")&&await a(is(t));return await Vr.remove("offline_accounts"),await Vr.remove("offline_transactions"),await Vr.remove("offline_budgets"),await Vr.remove("offline_goals"),!0}catch(r){return console.error("Failed to sync offline data:",r),n("Failed to sync offline data")}}),hs=St({name:"accounts",initialState:{accounts:[],loading:!1,error:null},reducers:{setAccounts:(e,t)=>{e.accounts=t.payload,e.error=null},addAccount:(e,t)=>{const a={...t.payload,id:crypto.randomUUID(),lastUpdated:Rr(),updatedAt:Rr()};e.accounts.push(a)},updateAccount:(e,t)=>{const a=e.accounts.findIndex(e=>e.id===t.payload.id);-1!==a&&(e.accounts[a]={...e.accounts[a],...t.payload.updates,updatedAt:Rr()})},deleteAccount:(e,t)=>{e.accounts=e.accounts.filter(e=>e.id!==t.payload)},updateAccountBalance:(e,t)=>{const a=e.accounts.find(e=>e.id===t.payload.id);a&&(a.balance=t.payload.balance,a.updatedAt=Rr())},recalculateAllBalances:(e,t)=>{}},extraReducers:e=>{e.addCase(as.pending,e=>{e.loading=!0,e.error=null}).addCase(as.fulfilled,(e,t)=>{e.loading=!1,e.accounts=t.payload}).addCase(as.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to load accounts"}).addCase(ns.pending,e=>{e.loading=!0,e.error=null}).addCase(ns.fulfilled,(e,t)=>{e.loading=!1,e.accounts=e.accounts.filter(e=>!(e.id.startsWith("temp-")&&e.name===t.payload.name)),e.accounts.push(t.payload)}).addCase(ns.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to create account"}).addCase(rs.pending,e=>{e.loading=!0,e.error=null}).addCase(rs.fulfilled,(e,t)=>{e.loading=!1;const a=e.accounts.findIndex(e=>e.id===t.payload.id);-1!==a&&(e.accounts[a]=t.payload)}).addCase(rs.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to update account"}).addCase(ss.pending,e=>{e.loading=!0,e.error=null}).addCase(ss.fulfilled,(e,t)=>{e.loading=!1,e.accounts=e.accounts.filter(e=>e.id!==t.payload)}).addCase(ss.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to delete account"})}}).reducer,ys=St({name:"transactions",initialState:{transactions:[],loading:!1,error:null},reducers:{setTransactions:(e,t)=>{e.transactions=t.payload,e.error=null},addTransaction:(e,t)=>{const a={...t.payload,id:crypto.randomUUID(),date:Br(t.payload.date)||Rr()};e.transactions.push(a)},updateTransaction:(e,t)=>{const a=e.transactions.findIndex(e=>e.id===t.payload.id);-1!==a&&(e.transactions[a]={...e.transactions[a],...t.payload.updates})},deleteTransaction:(e,t)=>{e.transactions=e.transactions.filter(e=>e.id!==t.payload)},bulkDeleteTransactions:(e,t)=>{const a=new Set(t.payload);e.transactions=e.transactions.filter(e=>!a.has(e.id))},bulkUpdateTransactions:(e,t)=>{const a=new Set(t.payload.ids);e.transactions=e.transactions.map(e=>a.has(e.id)?{...e,...t.payload.updates,updatedAt:Rr()}:e)}},extraReducers:e=>{e.addCase(os.pending,e=>{e.loading=!0,e.error=null}).addCase(os.fulfilled,(e,t)=>{e.loading=!1,e.transactions=t.payload}).addCase(os.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to load transactions"}).addCase(is.pending,e=>{e.loading=!0,e.error=null}).addCase(is.fulfilled,(e,t)=>{e.loading=!1,e.transactions=e.transactions.filter(e=>!(e.id.startsWith("temp-")&&e.description===t.payload.description&&e.amount===t.payload.amount&&e.accountId===t.payload.accountId)),e.transactions.push(t.payload)}).addCase(is.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to create transaction"}).addCase(cs.pending,e=>{e.loading=!0,e.error=null}).addCase(cs.fulfilled,(e,t)=>{e.loading=!1;const a=e.transactions.findIndex(e=>e.id===t.payload.id);-1!==a&&(e.transactions[a]=t.payload)}).addCase(cs.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to update transaction"}).addCase(ls.pending,e=>{e.loading=!0,e.error=null}).addCase(ls.fulfilled,(e,t)=>{e.loading=!1,e.transactions=e.transactions.filter(e=>e.id!==t.payload)}).addCase(ls.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to delete transaction"})}}),{deleteTransaction:fs}=ys.actions,bs=ys.reducer,xs=St({name:"budgets",initialState:{budgets:[],loading:!1,error:null},reducers:{setBudgets:(e,t)=>{e.budgets=t.payload,e.error=null},addBudget:(e,t)=>{const a={...t.payload,id:crypto.randomUUID(),createdAt:Rr(),updatedAt:Rr()};e.budgets.push(a)},updateBudget:(e,t)=>{const a=e.budgets.findIndex(e=>e.id===t.payload.id);-1!==a&&(e.budgets[a]={...e.budgets[a],...t.payload.updates,updatedAt:Rr()})},deleteBudget:(e,t)=>{e.budgets=e.budgets.filter(e=>e.id!==t.payload)},updateBudgetSpent:(e,t)=>{const a=e.budgets.find(e=>e.id===t.payload.id);a&&(a.spent=t.payload.spent,a.updatedAt=Rr())}},extraReducers:e=>{e.addCase(ds.pending,e=>{e.loading=!0,e.error=null}).addCase(ds.fulfilled,(e,t)=>{e.loading=!1,e.budgets=t.payload}).addCase(ds.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to load budgets"}).addCase(us.pending,e=>{e.loading=!0,e.error=null}).addCase(us.fulfilled,(e,t)=>{e.loading=!1,e.budgets=e.budgets.filter(e=>!(e.id.startsWith("temp-")&&e.category===t.payload.category)),e.budgets.push(t.payload)}).addCase(us.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to create budget"})}}),{updateBudgetSpent:ws}=xs.actions,vs=xs.reducer,Ss=vt("categories/load",async()=>await Vr.get("categories")||[]),ks=vt("categories/save",async e=>(await Vr.set("categories",e),e)),Is=St({name:"categories",initialState:{categories:[],loading:!1,error:null},reducers:{setCategories:(e,t)=>{e.categories=t.payload,e.error=null},addCategory:(e,t)=>{const a={...t.payload,id:crypto.randomUUID()};e.categories.push(a)},updateCategory:(e,t)=>{const a=e.categories.findIndex(e=>e.id===t.payload.id);-1!==a&&(e.categories[a]={...e.categories[a],...t.payload.updates})},deleteCategory:(e,t)=>{e.categories=e.categories.filter(e=>e.id!==t.payload).map(e=>e.parentId===t.payload?{...e,parentId:void 0}:e)}},extraReducers:e=>{e.addCase(Ss.pending,e=>{e.loading=!0,e.error=null}).addCase(Ss.fulfilled,(e,t)=>{e.loading=!1,e.categories=t.payload}).addCase(Ss.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to load categories"}).addCase(ks.fulfilled,(e,t)=>{e.categories=t.payload})}}).reducer,js=St({name:"goals",initialState:{goals:[],loading:!1,error:null},reducers:{setGoals:(e,t)=>{e.goals=t.payload,e.error=null},addGoal:(e,t)=>{const a={...t.payload,id:crypto.randomUUID(),createdAt:Rr(),updatedAt:Rr()};e.goals.push(a)},updateGoal:(e,t)=>{const a=e.goals.findIndex(e=>e.id===t.payload.id);-1!==a&&(e.goals[a]={...e.goals[a],...t.payload.updates,updatedAt:Rr()})},deleteGoal:(e,t)=>{e.goals=e.goals.filter(e=>e.id!==t.payload)},updateGoalProgress:(e,t)=>{const a=e.goals.find(e=>e.id===t.payload.id);a&&(a.currentAmount=t.payload.currentAmount,a.updatedAt=Rr())}},extraReducers:e=>{e.addCase(ms.pending,e=>{e.loading=!0,e.error=null}).addCase(ms.fulfilled,(e,t)=>{e.loading=!1,e.goals=t.payload}).addCase(ms.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to load goals"}).addCase(gs.pending,e=>{e.loading=!0,e.error=null}).addCase(gs.fulfilled,(e,t)=>{e.loading=!1,e.goals=e.goals.filter(e=>!(e.id.startsWith("temp-")&&e.name===t.payload.name)),e.goals.push(t.payload)}).addCase(gs.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to create goal"})}}),{updateGoalProgress:Cs}=js.actions,Ns=js.reducer,Ds=vt("tags/load",async()=>await Vr.get("tags")||[]),Es=vt("tags/save",async e=>(await Vr.set("tags",e),e)),As=St({name:"tags",initialState:{tags:[],loading:!1,error:null},reducers:{setTags:(e,t)=>{e.tags=t.payload,e.error=null},addTag:(e,t)=>{e.tags.includes(t.payload)||e.tags.push(t.payload)},removeTag:(e,t)=>{e.tags=e.tags.filter(e=>e!==t.payload)},addMultipleTags:(e,t)=>{const a=t.payload.filter(t=>!e.tags.includes(t));e.tags.push(...a)}},extraReducers:e=>{e.addCase(Ds.pending,e=>{e.loading=!0,e.error=null}).addCase(Ds.fulfilled,(e,t)=>{e.loading=!1,e.tags=t.payload}).addCase(Ds.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to load tags"}).addCase(Es.fulfilled,(e,t)=>{e.tags=t.payload})}}),{addMultipleTags:Ts}=As.actions,_s=As.reducer,Ls=vt("recurringTransactions/load",async()=>await Vr.get("recurringTransactions")||[]),Ps=vt("recurringTransactions/save",async e=>(await Vr.set("recurringTransactions",e),e)),Ms=St({name:"recurringTransactions",initialState:{recurringTransactions:[],loading:!1,error:null},reducers:{setRecurringTransactions:(e,t)=>{e.recurringTransactions=t.payload,e.error=null},addRecurringTransaction:(e,t)=>{const a={...t.payload,id:crypto.randomUUID(),createdAt:Rr(),updatedAt:Rr()};e.recurringTransactions.push(a)},updateRecurringTransaction:(e,t)=>{const a=e.recurringTransactions.findIndex(e=>e.id===t.payload.id);-1!==a&&(e.recurringTransactions[a]={...e.recurringTransactions[a],...t.payload.updates,updatedAt:Rr()})},deleteRecurringTransaction:(e,t)=>{e.recurringTransactions=e.recurringTransactions.filter(e=>e.id!==t.payload)},updateLastProcessed:(e,t)=>{const a=e.recurringTransactions.find(e=>e.id===t.payload.id);a&&(a.lastProcessed=Br(t.payload.lastProcessed),a.updatedAt=Rr())}},extraReducers:e=>{e.addCase(Ls.pending,e=>{e.loading=!0,e.error=null}).addCase(Ls.fulfilled,(e,t)=>{e.loading=!1,e.recurringTransactions=t.payload}).addCase(Ls.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to load recurring transactions"}).addCase(Ps.fulfilled,(e,t)=>{e.recurringTransactions=t.payload})}}).reducer,Os=e=>{try{localStorage.setItem("preferences",JSON.stringify(e))}catch(t){console.error("Failed to save preferences:",t)}},Bs=St({name:"preferences",initialState:{theme:"auto",colorTheme:"green",currency:"GBP",compactView:!0,pageVisibility:{showBudget:!0,showGoals:!0,showAnalytics:!0},goalCelebration:!0,firstName:"",...(()=>{try{const e=localStorage.getItem("preferences");return e?JSON.parse(e):{}}catch{return{}}})()},reducers:{setTheme:(e,t)=>{e.theme=t.payload,Os(e)},setColorTheme:(e,t)=>{e.colorTheme=t.payload,Os(e)},setCurrency:(e,t)=>{e.currency=t.payload,Os(e)},setCompactView:(e,t)=>{e.compactView=t.payload,Os(e)},setPageVisibility:(e,t)=>{e.pageVisibility={...e.pageVisibility,...t.payload},Os(e)},setGoalCelebration:(e,t)=>{e.goalCelebration=t.payload,Os(e)},setFirstName:(e,t)=>{e.firstName=t.payload,Os(e)},setThemeSchedule:(e,t)=>{e.themeSchedule=t.payload,Os(e)},updatePreferences:(e,t)=>{Object.assign(e,t.payload),Os(e)}}}).reducer,Rs=e=>{try{const t=e.map(({action:e,...t})=>t);localStorage.setItem("notifications",JSON.stringify(t))}catch(t){console.error("Failed to save notifications:",t)}},Fs=(()=>{try{const e=localStorage.getItem("notifications");return e?JSON.parse(e):[]}catch{return[]}})(),Us=kt({reducer:{accounts:hs,transactions:bs,budgets:vs,categories:Is,goals:Ns,tags:_s,recurringTransactions:Ms,preferences:Bs,notifications:St({name:"notifications",initialState:{notifications:Fs,unreadCount:Fs.filter(e=>!e.read).length},reducers:{addNotification:(e,t)=>{const a={...t.payload,id:crypto.randomUUID(),timestamp:Rr(),read:!1};e.notifications.unshift(a),e.unreadCount+=1,Rs(e.notifications)},markAsRead:(e,t)=>{const a=e.notifications.find(e=>e.id===t.payload);a&&!a.read&&(a.read=!0,e.unreadCount-=1,Rs(e.notifications))},markAllAsRead:e=>{e.notifications.forEach(e=>{e.read=!0}),e.unreadCount=0,Rs(e.notifications)},removeNotification:(e,t)=>{const a=e.notifications.findIndex(e=>e.id===t.payload);-1!==a&&(e.notifications[a].read||(e.unreadCount-=1),e.notifications.splice(a,1),Rs(e.notifications))},clearAllNotifications:e=>{e.notifications=[],e.unreadCount=0,Rs(e.notifications)}}}).reducer,layout:St({name:"layout",initialState:{isWideMode:!1},reducers:{setWideMode:(e,t)=>{e.isWideMode=t.payload},toggleWideMode:e=>{e.isWideMode=!e.isWideMode}}}).reducer},middleware:e=>e({serializableCheck:{ignoredActions:["persist/PERSIST","persist/REHYDRATE"],ignoredActionPaths:["meta.arg","payload.timestamp"],ignoredPaths:["items.dates"]}}),devTools:!1}),zs=jt,$s=It,Gs=(e,t)=>{const a=({size:t=20,color:a="currentColor",className:n="",onClick:r,title:s,style:o,strokeWidth:i=2,"data-testid":c})=>pt.jsx(e,{size:t,color:a,stroke:i,className:`transition-colors duration-200 ${r?"cursor-pointer hover:opacity-80":""} ${n}`,onClick:r,style:o,"aria-label":s,"data-testid":c});return a.displayName=t,a},qs=Gs(Nt,"HomeIcon"),Hs=Gs(qt,"SettingsIcon"),Ws=Gs(Ht,"Settings2Icon"),Ys=Gs(Et,"WalletIcon"),Vs=Gs(Tt,"CreditCardIcon"),Qs=Gs(Ia,"Building2Icon");Gs(Xt,"LandmarkIcon");const Js=Gs(Dt,"BarChart3Icon"),Ks=Gs(Pt,"LineChartIcon"),Zs=Gs(Gt,"PieChartIcon"),Xs=Gs(Lt,"TrendingUpIcon"),eo=Gs(la,"TrendingDownIcon"),to=Gs(ra,"PlusIcon"),ao=Gs(ua,"EditIcon"),no=Gs(ma,"DeleteIcon"),ro=Gs(ea,"XIcon"),so=Gs(xa,"CheckIcon"),oo=Gs(xa,"CheckIcon2"),io=Gs(da,"CheckCircleIcon"),co=Gs(Ya,"XCircleIcon"),lo=Gs(At,"ChevronRightIcon"),uo=Gs(xn,"ChevronDownIcon"),mo=Gs(Ca,"ChevronLeftIcon"),go=Gs(bn,"ChevronUpIcon"),po=Gs(ha,"ArrowLeftIcon"),ho=Gs(Ta,"ArrowRightIcon"),yo=Gs(za,"ArrowUpIcon"),fo=Gs($a,"ArrowDownIcon"),bo=Gs(Fa,"ArrowUpRightIcon"),xo=Gs(Ua,"ArrowDownRightIcon"),wo=Gs(_t,"ArrowRightLeftIcon"),vo=Gs(Na,"AlertCircleIcon"),So=Gs(sa,"AlertTriangleIcon"),ko=Gs(ka,"InfoIcon"),Io=Gs(pa,"BanknoteIcon"),jo=Gs(ca,"PiggyBankIcon"),Co=Gs(Aa,"DollarSignIcon"),No=Gs(Ct,"MenuIcon"),Do=Gs(Cn,"SearchIcon"),Eo=Gs(Oa,"FilterIcon"),Ao=Gs(ya,"EyeIcon"),To=Gs(Za,"EyeOffIcon"),_o=Gs(Kt,"DownloadIcon"),Lo=Gs(Jt,"UploadIcon"),Po=Gs(aa,"RefreshCwIcon"),Mo=Gs(Ma,"CopyIcon"),Oo=Gs(wa,"LinkIcon"),Bo=Gs(jn,"GripVerticalIcon"),Ro=Gs($t,"DatabaseIcon"),Fo=Gs(Wt,"TagIcon"),Uo=Gs(Yt,"HashIcon"),zo=Gs(Zt,"FolderIcon"),$o=Gs(Vt,"ArchiveIcon"),Go=Gs(Rt,"FileTextIcon"),qo=Gs(Mt,"TargetIcon"),Ho=Gs(Mt,"GoalIcon"),Wo=Gs(ga,"CalendarIcon"),Yo=Gs(Ea,"ClockIcon"),Vo=Gs(Ha,"UserIcon"),Qo=Gs(Ut,"UsersIcon"),Jo=Gs(ln,"LockIcon"),Ko=Gs(wn,"UnlockIcon"),Zo=Gs(Qt,"ShieldIcon"),Xo=Gs(sn,"KeyIcon"),ei=Gs(na,"KeyboardIcon"),ti=Gs(cn,"FingerprintIcon"),ai=Gs(rn,"MonitorIcon"),ni=Gs(rn,"ComputerIcon"),ri=Gs(ia,"PhoneIcon"),si=Gs(ba,"CameraIcon"),oi=Gs(nn,"MoonIcon"),ii=Gs(an,"SunIcon"),ci=Gs(tn,"PaletteIcon"),li=Gs(_a,"BellIcon"),di=Gs(Ba,"BellOffIcon"),ui=Gs(qa,"MailIcon"),mi=Gs(Sn,"SendIcon"),gi=Gs(zt,"BriefcaseIcon"),pi=Gs(Ia,"BuildingIcon"),hi=Gs(Xt,"BankIcon"),yi=Gs(Qa,"GraduationCapIcon"),fi=Gs(Va,"CarIcon"),bi=Gs(Wa,"MapPinIcon"),xi=Gs(Xa,"GlobeIcon"),wi=Gs(Ja,"StarIcon"),vi=Gs(Ft,"CalculatorIcon");Gs(Nn,"MinusIcon");const Si=Gs(Ga,"SaveIcon"),ki=Gs(vn,"LayersIcon"),Ii=Gs(Ra,"GridIcon"),ji=Gs(Ot,"MagicWandIcon"),Ci=Gs(on,"VolumeIcon"),Ni=Gs(La,"PlayIcon"),Di=Gs(Pa,"StopIcon"),Ei=Gs(un,"MergeIcon");Gs(Dn,"SelectAllIcon"),Gs(En,"DeselectAllIcon");const Ai=Gs(kn,"UnlinkIcon"),Ti=Gs(en,"WrenchIcon"),_i=Gs(In,"UndoIcon"),Li=Gs(Da,"ActivityIcon"),Pi=Gs(oa,"WifiIcon"),Mi=Gs(ta,"WifiOffIcon"),Oi=Gs(aa,"LoadingIcon"),Bi=Gs(Bt,"LightbulbIcon");Gs(An,"PdfIcon");const Ri=Gs(fa,"PaperclipIcon"),Fi=Gs(mn,"BoldIcon"),Ui=Gs(gn,"ItalicIcon"),zi=Gs(hn,"ListIcon"),$i=Gs(yn,"QuoteIcon"),Gi=Gs(fn,"ImageIcon"),qi=Gs(pn,"CodeIcon"),Hi=Gs(va,"ToggleLeftIcon"),Wi=Gs(Sa,"ToggleRightIcon");Gs(Tn,"MaximizeIcon"),Gs(_n,"MinimizeIcon"),Gs(Ln,"ExpandIcon"),Gs(Pn,"ShrinkIcon");const Yi=Gs(ja,"CircleDotIcon"),Vi=Gs(dn,"PlusCircleIcon"),Qi=Gs(aa,"RepeatIcon"),Ji=Gs(Ka,"SortIcon"),Ki=Gs(Bt,"LeafIcon"),Zi=no,Xi=Yo,ec=ko,tc=ai,ac=Po,nc=co,rc=So,sc=ro,oc=po,ic=Xs,cc=eo,lc=vo,dc=io,uc=ni,mc=Mn;class gc extends gt.Component{constructor(e){super(e),this.state={hasError:!1},this.handlePopState=this.handlePopState.bind(this)}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Error caught by boundary:",e,t),this.setState({errorInfo:t}),function(e,t){console.error("Error captured:",e,t)}(e,{componentStack:t.componentStack,props:this.props}),this.props.onError&&this.props.onError(e,t)}componentDidMount(){window.addEventListener("popstate",this.handlePopState),window.addEventListener("hashchange",this.handlePopState),this.interceptHistoryMethods()}componentWillUnmount(){window.removeEventListener("popstate",this.handlePopState),window.removeEventListener("hashchange",this.handlePopState),this.restoreHistoryMethods()}originalPushState;originalReplaceState;interceptHistoryMethods=()=>{this.originalPushState=window.history.pushState,this.originalReplaceState=window.history.replaceState,window.history.pushState=(...e)=>{this.originalPushState?.apply(window.history,e),this.handlePopState()},window.history.replaceState=(...e)=>{this.originalReplaceState?.apply(window.history,e),this.handlePopState()}};restoreHistoryMethods=()=>{this.originalPushState&&(window.history.pushState=this.originalPushState),this.originalReplaceState&&(window.history.replaceState=this.originalReplaceState)};handlePopState=()=>{this.state.hasError&&setTimeout(()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})},0)};componentDidUpdate(e){this.props.resetKey!==e.resetKey&&this.state.hasError&&this.setState({hasError:!1,error:void 0,errorInfo:void 0})}render(){return this.state.hasError?this.props.fallback||pt.jsx("div",{className:"min-h-[400px] flex items-center justify-center p-4",children:pt.jsxs("div",{className:"max-w-md w-full bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 text-center",children:[pt.jsx("div",{className:"flex justify-center mb-6",children:pt.jsx("div",{className:"w-20 h-20 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center",children:pt.jsx(So,{size:40,className:"text-red-600 dark:text-red-400"})})}),pt.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Oops! Something went wrong"}),pt.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:this.state.error?.message||"An unexpected error occurred. Please try again."}),!1,pt.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[pt.jsxs("button",{onClick:()=>this.setState({hasError:!1,error:void 0,errorInfo:void 0}),className:"flex items-center justify-center gap-2 px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors",children:[pt.jsx(Po,{size:18}),"Try Again"]}),pt.jsxs("button",{onClick:()=>window.location.href="/",className:"flex items-center justify-center gap-2 px-6 py-3 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:[pt.jsx(qs,{size:18}),"Go Home"]})]})]})}):this.props.children}}const pc=gt.createContext(void 0),hc=gt.createContext(void 0),yc=gt.createContext(void 0),fc=gt.createContext(void 0),bc=gt.createContext(void 0),xc=gt.createContext(void 0),wc=gt.createContext(void 0),vc={groceries:{min:20,max:80,frequency:3,cards:["5","6"]},restaurants:{min:25,max:120,frequency:2,cards:["5","6"]},transport:{min:15,max:50,frequency:2,cards:["5","6"]},shopping:{min:30,max:200,frequency:1,cards:["5","6"]},entertainment:{min:20,max:100,frequency:1,cards:["5","6"]},online:{min:15,max:150,frequency:2,cards:["5","6"]},coffee:{min:3,max:8,frequency:5,cards:["5","6"]},subscriptions:{min:9.99,max:19.99,frequency:.25,cards:["6"]},fuel:{min:50,max:80,frequency:.5,cards:["5"]}},Sc={groceries:"Groceries",restaurants:"Dining Out",transport:"Transport",shopping:"Shopping",entertainment:"Entertainment",online:"Online Shopping",coffee:"Coffee Shops",subscriptions:"Subscriptions",fuel:"Fuel"},kc={groceries:["Tesco","Sainsbury's","Waitrose","ASDA","Morrisons","Lidl","Aldi"],restaurants:["Pizza Express","Nando's","Wagamama","The Ivy","Dishoom","Franco Manca"],transport:["Uber","TfL","National Rail","Addison Lee","Citymapper"],shopping:["John Lewis","M&S","Zara","H&M","Next","Selfridges","ASOS"],entertainment:["Odeon","Vue Cinema","National Theatre","O2 Arena","Ticketmaster"],online:["Amazon","eBay","Argos","Currys","Apple Store"],coffee:["Pret","Starbucks","Costa","Nero","Gail's"],subscriptions:["Netflix","Spotify","Amazon Prime","Disney+","Apple Music"],fuel:["Shell","BP","Esso","Texaco"]},Ic=[{description:"Council Tax",amount:180,category:"Bills"},{description:"Gas & Electric",amount:150,category:"Utilities"},{description:"Water Bill",amount:45,category:"Utilities"},{description:"Internet & Phone",amount:55,category:"Utilities"},{description:"Mobile Phone",amount:35,category:"Bills"},{description:"Home Insurance",amount:65,category:"Insurance"},{description:"Life Insurance",amount:45,category:"Insurance"},{description:"Car Insurance",amount:85,category:"Insurance"},{description:"Gym Membership",amount:55,category:"Health & Fitness"}],jc=new Date("2024-07-01"),Cc=e=>e.map(e=>({ticker:e.symbol,name:e.name,shares:e.quantity,value:e.quantity*e.purchasePrice,averageCost:e.averageCost||e.purchasePrice,currentPrice:e.currentPrice,marketValue:e.currentValue,gain:e.currentValue-e.quantity*e.purchasePrice,gainPercent:(e.currentValue-e.quantity*e.purchasePrice)/(e.quantity*e.purchasePrice)*100,currency:"GBP",lastUpdated:e.lastUpdated})),Nc=()=>[{id:"inv1",accountId:"9",symbol:"LLOY.L",name:"Lloyds Banking Group",quantity:2e4,purchasePrice:.54,purchaseDate:jc,currentPrice:.56,lastUpdated:new Date,currentValue:2e4*.56,averageCost:.54,createdAt:jc},{id:"inv2",accountId:"9",symbol:"BARC.L",name:"Barclays",quantity:3e3,purchasePrice:2.1,purchaseDate:jc,currentPrice:2.15,lastUpdated:new Date,currentValue:6450,averageCost:2.1,createdAt:jc},{id:"inv3",accountId:"9",symbol:"BP.L",name:"BP",quantity:2e3,purchasePrice:4.85,purchaseDate:jc,currentPrice:4.9,lastUpdated:new Date,currentValue:9800,averageCost:4.85,createdAt:jc},{id:"inv4",accountId:"9",symbol:"GSK.L",name:"GlaxoSmithKline",quantity:800,purchasePrice:16.5,purchaseDate:jc,currentPrice:16.75,lastUpdated:new Date,currentValue:13400,averageCost:16.5,createdAt:jc},{id:"inv5",accountId:"9",symbol:"AAPL",name:"Apple Inc",quantity:100,purchasePrice:154.72,purchaseDate:jc,currentPrice:158.5,lastUpdated:new Date,currentValue:15850,averageCost:154.72,createdAt:jc},{id:"inv6",accountId:"9",symbol:"MSFT",name:"Microsoft Corp",quantity:50,purchasePrice:355.9,purchaseDate:jc,currentPrice:365,lastUpdated:new Date,currentValue:18250,averageCost:355.9,createdAt:jc},{id:"inv7",accountId:"9",symbol:"GOOGL",name:"Alphabet Inc",quantity:100,purchasePrice:142.52,purchaseDate:jc,currentPrice:145,lastUpdated:new Date,currentValue:14500,averageCost:142.52,createdAt:jc},{id:"inv8",accountId:"9",symbol:"NVDA",name:"NVIDIA Corp",quantity:100,purchasePrice:96.06,purchaseDate:jc,currentPrice:98.5,lastUpdated:new Date,currentValue:9850,averageCost:96.06,createdAt:jc},{id:"inv9",accountId:"9",symbol:"VWRL",name:"Vanguard FTSE All-World ETF",quantity:250,purchasePrice:108.5,purchaseDate:jc,currentPrice:110,lastUpdated:new Date,currentValue:27500,averageCost:108.5,createdAt:jc},{id:"inv10",accountId:"9",symbol:"SMT",name:"Scottish Mortgage Trust",quantity:2e3,purchasePrice:8.45,purchaseDate:jc,currentPrice:8.6,lastUpdated:new Date,currentValue:17200,averageCost:8.45,createdAt:jc},{id:"inv11",accountId:"9",symbol:"CTY",name:"City of London Investment Trust",quantity:1500,purchasePrice:4.25,purchaseDate:jc,currentPrice:4.3,lastUpdated:new Date,currentValue:6450,averageCost:4.25,createdAt:jc}];class Dc{static async getAccounts(e){if(!Jr())return await Vr.get(Gr)||[];try{const{data:t,error:a}=await Qr.from("accounts").select("*").eq("user_id",e).eq("is_active",!0).order("created_at",{ascending:!0});if(a)throw console.error("Error fetching accounts:",a),new Error(Kr(a));return t||[]}catch(t){return console.error("AccountService.getAccounts error:",t),await Vr.get(Gr)||[]}}static async createAccount(e,t){if(!Jr()){const e={...t,id:crypto.randomUUID(),created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},a=await Vr.get(Gr)||[];return a.push(e),await Vr.set(Gr,a),e}try{const a="current"===t.type?"checking":t.type,n="current"===a?"checking":a,r={user_id:e,name:t.name,type:n||"checking",currency:t.currency||"GBP",balance:t.balance||0,initial_balance:t.initialBalance||t.balance||0,is_active:void 0===t.isActive||t.isActive,institution:t.institution||null,icon:t.icon||null,color:t.color||null};console.log("Creating account with data:",r);const{data:s,error:o}=await Qr.from("accounts").insert(r).select().single();if(o)throw console.error("Error creating account:",o),new Error(Kr(o));return console.log("Account created successfully:",s),s}catch(a){throw console.error("AccountService.createAccount error:",a),a}}static async updateAccount(e,t){if(!Jr()){const a=await Vr.get(Gr)||[],n=a.findIndex(t=>t.id===e);if(-1===n)throw new Error("Account not found");return a[n]={...a[n],...t,updated_at:(new Date).toISOString()},await Vr.set(Gr,a),a[n]}try{const{data:a,error:n}=await Qr.from("accounts").update(t).eq("id",e).select().single();if(n)throw console.error("Error updating account:",n),new Error(Kr(n));return a}catch(a){throw console.error("AccountService.updateAccount error:",a),a}}static async deleteAccount(e){if(!Jr()){const t=(await Vr.get(Gr)||[]).filter(t=>t.id!==e);return void(await Vr.set(Gr,t))}try{const{error:t}=await Qr.from("accounts").update({is_active:!1}).eq("id",e);if(t)throw console.error("Error deleting account:",t),new Error(Kr(t))}catch(t){throw console.error("AccountService.deleteAccount error:",t),t}}static async getAccountById(e){if(!Jr())return(await Vr.get(Gr)||[]).find(t=>t.id===e)||null;try{const{data:t,error:a}=await Qr.from("accounts").select("*").eq("id",e).single();if(a){if("PGRST116"===a.code)return null;throw console.error("Error fetching account:",a),new Error(Kr(a))}return t}catch(t){throw console.error("AccountService.getAccountById error:",t),t}}static async updateBalance(e,t){if(!Jr()){const a=await Vr.get(Gr)||[],n=a.findIndex(t=>t.id===e);return void(-1!==n&&(a[n].balance=t,a[n].updated_at=(new Date).toISOString(),await Vr.set(Gr,a)))}try{const{error:a}=await Qr.from("accounts").update({balance:t}).eq("id",e);if(a)throw console.error("Error updating balance:",a),new Error(Kr(a))}catch(a){throw console.error("AccountService.updateBalance error:",a),a}}static async recalculateBalance(e){if(!Jr()){const t=(await Vr.get(qr)||[]).filter(t=>t.account_id===e).reduce((e,t)=>e+t.amount,0);return await this.updateBalance(e,t),t}try{const{data:t}=await Qr.from("accounts").select("initial_balance").eq("id",e).single(),{data:a}=await Qr.from("transactions").select("amount").eq("account_id",e),n=a?.reduce((e,t)=>e+t.amount,0)||0,r=(t?.initial_balance||0)+n;return await this.updateBalance(e,r),r}catch(t){throw console.error("AccountService.recalculateBalance error:",t),t}}static async getTotalBalance(e){if(!Jr())return(await Vr.get(Gr)||[]).reduce((e,t)=>e+(t.balance||0),0);try{const{data:t,error:a}=await Qr.from("accounts").select("balance").eq("user_id",e).eq("is_active",!0);if(a)throw console.error("Error fetching total balance:",a),new Error(Kr(a));return t?.reduce((e,t)=>e+(t.balance||0),0)||0}catch(t){throw console.error("AccountService.getTotalBalance error:",t),t}}static subscribeToAccounts(e,t){if(!Jr())return()=>{};const a=Qr.channel(`accounts:${e}`).on("postgres_changes",{event:"*",schema:"public",table:"accounts",filter:`user_id=eq.${e}`},t).subscribe();return()=>{a.unsubscribe()}}}class Ec{static async getTransactions(e){if(!Jr())return await Vr.get(qr)||[];try{const{data:t,error:a}=await Qr.from("transactions").select("*").eq("user_id",e).order("date",{ascending:!1});if(a)throw console.error("Error fetching transactions:",a),new Error(Kr(a));return t||[]}catch(t){return console.error("TransactionService.getTransactions error:",t),await Vr.get(qr)||[]}}static async createTransaction(e,t){if(!Jr()){const e={...t,id:crypto.randomUUID(),created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},a=await Vr.get(qr)||[];return a.push(e),await Vr.set(qr,a),e}try{const{data:a,error:n}=await Qr.from("transactions").insert({...t,user_id:e}).select().single();if(n)throw console.error("Error creating transaction:",n),new Error(Kr(n));return await this.updateAccountBalance(t.account_id,t.amount),a}catch(a){throw console.error("TransactionService.createTransaction error:",a),a}}static async updateTransaction(e,t){if(!Jr()){const a=await Vr.get(qr)||[],n=a.findIndex(t=>t.id===e);if(-1===n)throw new Error("Transaction not found");return a[n]={...a[n],...t,updated_at:(new Date).toISOString()},await Vr.set(qr,a),a[n]}try{const{data:a}=await Qr.from("transactions").select("amount, account_id").eq("id",e).single(),{data:n,error:r}=await Qr.from("transactions").update(t).eq("id",e).select().single();if(r)throw console.error("Error updating transaction:",r),new Error(Kr(r));if(a&&void 0!==t.amount&&t.amount!==a.amount){const e=t.amount-a.amount;await this.updateAccountBalance(a.account_id,e)}return n}catch(a){throw console.error("TransactionService.updateTransaction error:",a),a}}static async deleteTransaction(e){if(!Jr()){const t=(await Vr.get(qr)||[]).filter(t=>t.id!==e);return void(await Vr.set(qr,t))}try{const{data:t}=await Qr.from("transactions").select("amount, account_id").eq("id",e).single(),{error:a}=await Qr.from("transactions").delete().eq("id",e);if(a)throw console.error("Error deleting transaction:",a),new Error(Kr(a));t&&await this.updateAccountBalance(t.account_id,-t.amount)}catch(t){throw console.error("TransactionService.deleteTransaction error:",t),t}}static async getTransactionsByDateRange(e,t,a){if(!Jr())return(await Vr.get(qr)||[]).filter(e=>{const n=new Date(e.date);return n>=t&&n<=a});try{const{data:n,error:r}=await Qr.from("transactions").select("*").eq("user_id",e).gte("date",t.toISOString()).lte("date",a.toISOString()).order("date",{ascending:!1});if(r)throw console.error("Error fetching transactions by date range:",r),new Error(Kr(r));return n||[]}catch(n){throw console.error("TransactionService.getTransactionsByDateRange error:",n),n}}static async getTransactionsByAccount(e){if(!Jr())return(await Vr.get(qr)||[]).filter(t=>t.account_id===e);try{const{data:t,error:a}=await Qr.from("transactions").select("*").eq("account_id",e).order("date",{ascending:!1});if(a)throw console.error("Error fetching transactions by account:",a),new Error(Kr(a));return t||[]}catch(t){throw console.error("TransactionService.getTransactionsByAccount error:",t),t}}static async getTransactionsByCategory(e){if(!Jr())return(await Vr.get(qr)||[]).filter(t=>t.category===e);try{const{data:t,error:a}=await Qr.from("transactions").select("*").eq("category_id",e).order("date",{ascending:!1});if(a)throw console.error("Error fetching transactions by category:",a),new Error(Kr(a));return t||[]}catch(t){throw console.error("TransactionService.getTransactionsByCategory error:",t),t}}static async bulkCreateTransactions(e,t){if(!Jr()){const e=t.map(e=>({...e,id:crypto.randomUUID(),created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()})),a=await Vr.get(qr)||[];return a.push(...e),await Vr.set(qr,a),e}try{const a=t.map(t=>({...t,user_id:e})),{data:n,error:r}=await Qr.from("transactions").insert(a).select();if(r)throw console.error("Error bulk creating transactions:",r),new Error(Kr(r));for(const e of n||[])await this.updateAccountBalance(e.account_id,e.amount);return n||[]}catch(a){throw console.error("TransactionService.bulkCreateTransactions error:",a),a}}static async updateAccountBalance(e,t){if(Jr())try{const{data:a}=await Qr.from("accounts").select("balance").eq("id",e).single();if(a){const n=(a.balance||0)+t;await Qr.from("accounts").update({balance:n}).eq("id",e)}}catch(a){console.error("Error updating account balance:",a)}}static subscribeToTransactions(e,t){if(!Jr())return()=>{};const a=Qr.channel(`transactions:${e}`).on("postgres_changes",{event:"*",schema:"public",table:"transactions",filter:`user_id=eq.${e}`},t).subscribe();return()=>{a.unsubscribe()}}}class Ac{static async initialize(e,t,a,n){if(Jr())try{console.log("[DataService] Initializing for Clerk ID:",e);const r=await es.ensureUserExists(e,t,a,n);r?console.log("[DataService] User initialized with database ID:",r):console.warn("[DataService] No database ID returned from userIdService")}catch(r){console.error("[DataService] Failed to initialize user:",r)}}static async loadAppData(){es.getCurrentDatabaseUserId();try{const[e,t,a,n,r]=await Promise.all([this.getAccounts(),this.getTransactions(),this.getBudgets(),this.getGoals(),this.getCategories()]);return{accounts:e,transactions:t,budgets:a,goals:n,categories:r}}catch(e){return console.error("Error loading app data:",e),{accounts:[],transactions:[],budgets:[],goals:[],categories:[]}}}static async getAccounts(){const e=es.getCurrentDatabaseUserId();return e&&Jr()?Dc.getAccounts(e):await Vr.get(Gr)||[]}static async createAccount(e){const t=es.getCurrentDatabaseUserId();if(t&&Jr())return Dc.createAccount(t,e);const a={...e,id:crypto.randomUUID()},n=await this.getAccounts();return n.push(a),await Vr.set(Gr,n),a}static async updateAccount(e,t){if(es.getCurrentDatabaseUserId()&&Jr())return Dc.updateAccount(e,t);const a=await this.getAccounts(),n=a.findIndex(t=>t.id===e);if(-1===n)throw new Error("Account not found");return a[n]={...a[n],...t},await Vr.set(Gr,a),a[n]}static async deleteAccount(e){if(es.getCurrentDatabaseUserId()&&Jr())return Dc.deleteAccount(e);const t=(await this.getAccounts()).filter(t=>t.id!==e);await Vr.set(Gr,t)}static async getTransactions(){const e=es.getCurrentDatabaseUserId();return e&&Jr()?Ec.getTransactions(e):await Vr.get(qr)||[]}static async createTransaction(e){const t=es.getCurrentDatabaseUserId();if(t&&Jr())return Ec.createTransaction(t,e);const a={...e,id:crypto.randomUUID()},n=await this.getTransactions();return n.push(a),await Vr.set(qr,n),await this.updateAccountBalance(e.accountId,e.amount),a}static async updateTransaction(e,t){if(es.getCurrentDatabaseUserId()&&Jr())return Ec.updateTransaction(e,t);const a=await this.getTransactions(),n=a.findIndex(t=>t.id===e);if(-1===n)throw new Error("Transaction not found");const r=a[n].amount,s=a[n].accountId;return a[n]={...a[n],...t},await Vr.set(qr,a),void 0!==t.amount&&t.amount!==r&&await this.updateAccountBalance(s,-r+t.amount),a[n]}static async deleteTransaction(e){if(es.getCurrentDatabaseUserId()&&Jr())return Ec.deleteTransaction(e);const t=await this.getTransactions(),a=t.find(t=>t.id===e);a&&await this.updateAccountBalance(a.accountId,-a.amount);const n=t.filter(t=>t.id!==e);await Vr.set(qr,n)}static async getBudgets(){return await Vr.get(Hr)||[]}static async getGoals(){return await Vr.get(Wr)||[]}static async getCategories(){return await Vr.get(Yr)||[]}static async updateAccountBalance(e,t){if(es.getCurrentDatabaseUserId()&&Jr())return;const a=await this.getAccounts(),n=a.find(t=>t.id===e);n&&(n.balance=(n.balance||0)+t,await Vr.set(Gr,a))}static subscribeToUpdates(e){const t=es.getCurrentDatabaseUserId();if(!t||!Jr())return()=>{};const a=[];return e.onAccountUpdate&&a.push(Dc.subscribeToAccounts(t,e.onAccountUpdate)),e.onTransactionUpdate&&a.push(Ec.subscribeToTransactions(t,e.onTransactionUpdate)),()=>{a.forEach(e=>e())}}static isUsingSupabase(){return null!==es.getCurrentDatabaseUserId()&&Jr()}static getUserIds(){return es.getCurrentUserIds()}static async refreshData(){return this.loadAppData()}}class Tc{static instance;syncQueue=[];syncStatus={isOnline:!0,isSyncing:!1,lastSyncTime:null,pendingChanges:0,syncErrors:[]};syncInterval=null;userId=null;isInitialized=!1;constructor(){"undefined"!=typeof window&&(window.addEventListener("online",()=>this.handleOnline()),window.addEventListener("offline",()=>this.handleOffline()))}static getInstance(){return Tc.instance||(Tc.instance=new Tc),Tc.instance}async initialize(e){if(!this.isInitialized||this.userId!==e){this.userId=e;try{const t=await this.loadLocalData();console.log("[AutoSync] Local data loaded:",{accounts:t.accounts.length,transactions:t.transactions.length});const a=await this.checkCloudData(e);console.log("[AutoSync] Cloud data exists:",a),!a&&this.hasLocalData(t)?(console.log("[AutoSync] Performing silent migration..."),await this.migrateToCloud(e,t)):a&&this.hasLocalData(t)&&(console.log("[AutoSync] Merging local and cloud data..."),await this.mergeData(e,t)),await this.convertLocalToCache(),this.startContinuousSync(),this.isInitialized=!0,console.log("[AutoSync] Initialization complete")}catch(t){console.error("[AutoSync] Initialization failed:",t)}}}async checkCloudData(e){if(!Fr)return!1;try{const t=await es.getDatabaseUserId(e);if(!t)return!1;const{data:a}=await Fr.from("accounts").select("id").eq("user_id",t).limit(1);return a&&a.length>0}catch(t){return console.error("[AutoSync] Error checking cloud data:",t),!1}}async loadLocalData(){const[e,t,a,n,r]=await Promise.all([Vr.get(Gr)||[],Vr.get(qr)||[],Vr.get(Hr)||[],Vr.get(Wr)||[],Vr.get(Yr)||[]]);return{accounts:e,transactions:t,budgets:a,goals:n,categories:r}}hasLocalData(e){return e.accounts.length>0||e.transactions.length>0||e.budgets.length>0||e.goals.length>0}async migrateToCloud(e,t){if(Fr)try{const a=await this.ensureUserExists(e);if(!a)throw new Error("Failed to create user in database");if(t.accounts.length>0){const e=t.accounts.map(e=>({user_id:a,name:e.name,type:"current"===e.type?"checking":e.type,balance:e.balance||0,currency:e.currency||"GBP",institution:e.institution||null,is_active:!1!==e.isActive,initial_balance:e.initialBalance||e.balance||0,created_at:e.createdAt||(new Date).toISOString(),updated_at:e.updatedAt||(new Date).toISOString()})),{error:n}=await Fr.from("accounts").insert(e);n?console.error("[AutoSync] Failed to migrate accounts:",n):console.log("[AutoSync] Migrated",e.length,"accounts")}if(t.transactions.length>0){const{data:e}=await Fr.from("accounts").select("id, name").eq("user_id",a);if(e){const n=new Map(e.map(e=>[t.accounts.find(t=>t.name===e.name)?.id,e.id])),r=t.transactions.filter(e=>n.has(e.accountId)).map(e=>({user_id:a,account_id:n.get(e.accountId),amount:e.amount,description:e.description,date:e.date,category:e.category,subcategory:e.subcategory||null,type:e.type,is_recurring:e.isRecurring||!1,notes:e.notes||null,tags:e.tags||[],created_at:e.createdAt||(new Date).toISOString()}));if(r.length>0){const e=100;for(let t=0;t<r.length;t+=e){const a=r.slice(t,t+e),{error:n}=await Fr.from("transactions").insert(a);n&&console.error("[AutoSync] Failed to migrate transaction batch:",n)}console.log("[AutoSync] Migrated",r.length,"transactions")}}}localStorage.setItem("autoSyncMigrationComplete","true"),localStorage.setItem("autoSyncMigrationDate",(new Date).toISOString()),console.log("[AutoSync] Silent migration complete")}catch(a){console.error("[AutoSync] Migration failed:",a)}}async ensureUserExists(e){if(!Fr)return null;try{let t=await es.getDatabaseUserId(e);return t||(t=await es.ensureUserExists(e,"user@example.com",void 0,void 0),t||(console.error("[AutoSync] Failed to create user"),null))}catch(t){return console.error("[AutoSync] Error ensuring user exists:",t),null}}async mergeData(e,t){}async convertLocalToCache(){localStorage.setItem("primaryStorage","cloud")}startContinuousSync(){this.syncInterval=setInterval(()=>{this.processSyncQueue()},5e3)}stopSync(){this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null)}queueOperation(e,t,a){const n={id:crypto.randomUUID(),type:e,entity:t,data:a,timestamp:Date.now(),retries:0,status:"pending"};this.syncQueue.push(n),this.syncStatus.pendingChanges=this.syncQueue.filter(e=>"pending"===e.status).length,this.syncStatus.isOnline&&this.processSyncQueue()}async processSyncQueue(){if(this.syncStatus.isSyncing||!this.syncStatus.isOnline)return;const e=this.syncQueue.filter(e=>"pending"===e.status);if(0!==e.length){this.syncStatus.isSyncing=!0;for(const a of e)try{a.status="syncing",await this.syncItem(a),a.status="completed",this.syncQueue=this.syncQueue.filter(e=>e.id!==a.id)}catch(t){console.error("[AutoSync] Sync failed for item:",a,t),a.status="pending",a.retries++,a.retries>3&&(this.syncStatus.syncErrors.push(`Failed to sync ${a.entity}: ${t}`),this.syncQueue=this.syncQueue.filter(e=>e.id!==a.id))}this.syncStatus.isSyncing=!1,this.syncStatus.lastSyncTime=new Date,this.syncStatus.pendingChanges=this.syncQueue.filter(e=>"pending"===e.status).length}}async syncItem(e){if(!Fr||!this.userId)throw new Error("Not initialized");const t=await es.getDatabaseUserId(this.userId);if(!t)throw new Error("User not found");const a=`${e.entity}s`;switch(e.type){case"CREATE":if(e.data.id&&36===e.data.id.length)return;await Fr.from(a).insert({...e.data,user_id:t});break;case"UPDATE":await Fr.from(a).update(e.data).eq("id",e.data.id).eq("user_id",user.id);break;case"DELETE":await Fr.from(a).delete().eq("id",e.data.id).eq("user_id",user.id)}}handleOnline(){this.syncStatus.isOnline=!0,this.processSyncQueue()}handleOffline(){this.syncStatus.isOnline=!1}getSyncStatus(){return{...this.syncStatus}}}const _c=Tc.getInstance();Rn.config({precision:20,rounding:Rn.ROUND_HALF_UP,toExpPos:9,toExpNeg:-9});const Lc=gt.createContext(void 0),Pc=new class{rules=[];budgetAlertConfig={warningThreshold:80,dangerThreshold:100,enableMonthlyReset:!0,enableProjectedOverspend:!0,enableCategoryComparison:!0};transactionAlertConfig={largeTransactionThreshold:500,unusualSpendingEnabled:!0,duplicateDetectionEnabled:!0,recurringDetectionEnabled:!0,merchantChangeAlerts:!0};goalCelebrationConfig={enableMilestones:!0,milestonePercentages:[25,50,75,100],enableStreaks:!0,enableBadges:!0,enableSoundEffects:!1,enableProgressReminders:!0};constructor(){this.loadConfig(),this.loadRules()}loadConfig(){this.budgetAlertConfig={warningThreshold:80,dangerThreshold:100,enableMonthlyReset:!0,enableProjectedOverspend:!0,enableCategoryComparison:!0,...this.loadFromStorage("notificationService_budgetConfig")},this.transactionAlertConfig={largeTransactionThreshold:500,unusualSpendingEnabled:!0,duplicateDetectionEnabled:!0,merchantAlertEnabled:!1,foreignTransactionEnabled:!0,...this.loadFromStorage("notificationService_transactionConfig")},this.goalCelebrationConfig={milestonePercentages:[25,50,75,100],enableCompletionCelebration:!0,enableMilestoneNotifications:!0,enableProgressReminders:!0,...this.loadFromStorage("notificationService_goalConfig")}}loadRules(){const e=this.loadFromStorage("notificationService_rules");this.rules=Array.isArray(e)?e:this.getDefaultRules()}loadFromStorage(e){try{const t=localStorage.getItem(e);if(!t)return{};const a=JSON.parse(t);return"object"!=typeof a||null===a||Array.isArray(a)?{}:a}catch{return{}}}saveToStorage(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(a){}}getDefaultRules(){return[{id:"budget-warning",name:"Budget Warning Alert",type:"budget",enabled:!0,conditions:[{field:"percentage_spent",operator:"greater_than",value:this.budgetAlertConfig.warningThreshold,description:`Spent more than ${this.budgetAlertConfig.warningThreshold}% of budget`}],actions:[{type:"show_notification",config:{title:"Budget Warning",message:"You're approaching your budget limit",actionButton:{label:"View Budget",action:"/budget"}}}],priority:"medium",cooldown:60,created:new Date},{id:"budget-exceeded",name:"Budget Exceeded Alert",type:"budget",enabled:!0,conditions:[{field:"percentage_spent",operator:"greater_than",value:this.budgetAlertConfig.dangerThreshold,description:"Exceeded budget limit"}],actions:[{type:"show_notification",config:{title:"Budget Exceeded!",message:"You've exceeded your budget for this category",actionButton:{label:"Review Spending",action:"/budget"}}}],priority:"high",cooldown:30,created:new Date},{id:"large-transaction",name:"Large Transaction Alert",type:"transaction",enabled:!0,conditions:[{field:"amount",operator:"greater_than",value:this.transactionAlertConfig.largeTransactionThreshold,description:`Transaction amount exceeds \xa3${this.transactionAlertConfig.largeTransactionThreshold}`}],actions:[{type:"show_notification",config:{title:"Large Transaction Detected",message:"A large transaction was recorded",actionButton:{label:"Review Transaction",action:"/transactions"}}}],priority:"medium",cooldown:5,created:new Date},{id:"goal-milestone",name:"Goal Milestone Celebration",type:"goal",enabled:!0,conditions:[{field:"percentage_complete",operator:"percentage_of",value:this.goalCelebrationConfig.milestonePercentages,description:"Goal milestone reached"}],actions:[{type:"show_notification",config:{title:"\ud83c\udf89 Goal Milestone Reached!",message:"Congratulations on your progress!",actionButton:{label:"View Goals",action:"/goals"}}}],priority:"medium",cooldown:60,created:new Date},{id:"goal-completed",name:"Goal Completion Celebration",type:"goal",enabled:!0,conditions:[{field:"percentage_complete",operator:"greater_than",value:100,description:"Goal completed"}],actions:[{type:"show_notification",config:{title:"\ud83c\udfc6 Goal Completed!",message:"Amazing! You've reached your goal!",actionButton:{label:"Celebrate",action:"/goals"}}}],priority:"high",cooldown:0,created:new Date}]}checkBudgetAlerts(e,t,a){const n=[],r=new Date;return e.forEach(e=>{const s=this.calculateBudgetSpent(e,t),o=e.amount>0?s/e.amount*100:0;this.rules.filter(e=>"budget"===e.type&&e.enabled&&this.shouldTriggerRule(e,r)).forEach(t=>{if(this.evaluateConditions(t.conditions,{percentage_spent:o,amount_spent:s,budget_amount:e.amount,category:e.category,period:e.period})){const i=a.find(t=>t.name===e.category),c=this.createNotificationFromRule(t,{categoryName:e.category,categoryColor:i?.color||"#6B7280",percentage:Math.round(o),spent:s,budget:e.amount,period:e.period});c&&(n.push(c),this.updateRuleLastTriggered(t.id,r))}})}),n}checkTransactionAlerts(e,t){const a=[],n=new Date;if(this.rules.filter(e=>"transaction"===e.type&&e.enabled&&this.shouldTriggerRule(e,n)).forEach(t=>{if(this.evaluateConditions(t.conditions,{amount:e.amount,description:e.description,category:e.category,type:e.type,date:e.date})){const r=this.createNotificationFromRule(t,{amount:e.amount,description:e.description,category:e.category});r&&(a.push(r),this.updateRuleLastTriggered(t.id,n))}}),this.transactionAlertConfig.duplicateDetectionEnabled){const n=this.checkDuplicateTransaction(e,t);n&&a.push(n)}return a}checkGoalProgress(e,t){const a=[];return e.forEach(e=>{const n=this.calculateGoalProgress(e),r=t?.find(t=>t.id===e.id),s=r?this.calculateGoalProgress(r):0;if(this.goalCelebrationConfig.enableMilestoneNotifications){const t=this.checkGoalMilestone(e,n,s);t&&a.push(t)}if(this.goalCelebrationConfig.enableCompletionCelebration&&n>=100&&s<100){const t=this.createGoalCompletionNotification(e);t&&a.push(t)}}),a}checkGoalMilestone(e,t,a){const n=this.goalCelebrationConfig.milestonePercentages;for(const r of n)if(t>=r&&a<r&&r<100)return{id:`goal-milestone-${e.id}-${r}`,type:"success",title:`\ud83c\udfaf ${r}% Goal Progress!`,message:`You're ${r}% of the way to "${e.name}"! Keep it up!`,timestamp:new Date,read:!1,action:{label:"View Goal",onClick:()=>{window.location.href="/goals"}}};return null}createGoalCompletionNotification(e){return{id:`goal-completed-${e.id}`,type:"success",title:"\ud83c\udfc6 Goal Achieved!",message:`Congratulations! You've completed "${e.name}"! Time to celebrate! \ud83c\udf89`,timestamp:new Date,read:!1,action:{label:"View Achievement",onClick:()=>{window.location.href="/goals"}}}}checkDuplicateTransaction(e,t){return t.filter(t=>t.id!==e.id&&Math.abs(t.amount-e.amount)<.01&&t.description===e.description&&Math.abs(new Date(t.date).getTime()-new Date(e.date).getTime())<864e5).length>0?{id:`duplicate-transaction-${e.id}`,type:"warning",title:"Possible Duplicate Transaction",message:`Similar transaction detected: ${e.description} (\xa3${e.amount})`,timestamp:new Date,read:!1,action:{label:"Review Transactions",onClick:()=>{window.location.href="/transactions"}}}:null}calculateBudgetSpent(e,t){const a=new Date;let n,r;return"monthly"===e.period?(n=new Date(a.getFullYear(),a.getMonth(),1),r=new Date(a.getFullYear(),a.getMonth()+1,0)):(n=new Date(a.getFullYear(),0,1),r=new Date(a.getFullYear(),11,31)),t.filter(t=>{const a=new Date(t.date);return t.category===e.category&&"expense"===t.type&&a>=n&&a<=r}).reduce((e,t)=>e+t.amount,0)}calculateGoalProgress(e){return e.targetAmount<=0?0:Math.min(e.currentAmount/e.targetAmount*100,100)}shouldTriggerRule(e,t){return!e.cooldown||!e.lastTriggered||t.getTime()-e.lastTriggered.getTime()>=60*e.cooldown*1e3}evaluateConditions(e,t){return e.every(e=>{const a=t[e.field];switch(e.operator){case"equals":return a===e.value;case"greater_than":return"number"==typeof a&&"number"==typeof e.value&&a>e.value;case"less_than":return"number"==typeof a&&"number"==typeof e.value&&a<e.value;case"contains":return String(a).toLowerCase().includes(String(e.value).toLowerCase());case"percentage_of":return Array.isArray(e.value)&&"number"==typeof a?e.value.some(e=>"number"==typeof e&&Math.abs(a-e)<1):"number"==typeof a&&"number"==typeof e.value&&Math.abs(a-e.value)<1;default:return!1}})}createNotificationFromRule(e,t){const a=e.actions.find(e=>"show_notification"===e.type);if(!a)return null;const n=this.interpolateString(a.config.title,t),r=this.interpolateString(a.config.message,t);return{id:`rule-${e.id}-${Date.now()}`,type:this.mapPriorityToType(e.priority),title:n,message:r,timestamp:new Date,read:!1,action:a.config.actionButton?{label:a.config.actionButton.label,onClick:()=>{a.config.actionButton&&(window.location.href=a.config.actionButton.action)}}:void 0}}interpolateString(e,t){return e.replace(/\{(\w+)\}/g,(e,a)=>{const n=t[a];return"number"==typeof n&&a.includes("amount")?new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(n):String(n||e)})}mapPriorityToType(e){switch(e){case"urgent":case"high":return"error";case"medium":return"warning";default:return"info"}}updateRuleLastTriggered(e,t){const a=this.rules.find(t=>t.id===e);a&&(a.lastTriggered=t,this.saveRules())}saveRules(){this.saveToStorage("notificationService_rules",JSON.parse(JSON.stringify(this.rules)))}updateBudgetConfig(e){this.budgetAlertConfig={...this.budgetAlertConfig,...e},this.saveToStorage("notificationService_budgetConfig",JSON.parse(JSON.stringify(this.budgetAlertConfig)))}updateTransactionConfig(e){this.transactionAlertConfig={...this.transactionAlertConfig,...e},this.saveToStorage("notificationService_transactionConfig",JSON.parse(JSON.stringify(this.transactionAlertConfig)))}updateGoalConfig(e){this.goalCelebrationConfig={...this.goalCelebrationConfig,...e},this.saveToStorage("notificationService_goalConfig",JSON.parse(JSON.stringify(this.goalCelebrationConfig)))}getRules(){return[...this.rules]}addRule(e){const t={...e,id:`rule-${Date.now()}`,created:new Date};return this.rules.push(t),this.saveRules(),t}updateRule(e,t){const a=this.rules.findIndex(t=>t.id===e);return-1!==a&&(this.rules[a]={...this.rules[a],...t},this.saveRules(),!0)}deleteRule(e){const t=this.rules.findIndex(t=>t.id===e);return-1!==t&&(this.rules.splice(t,1),this.saveRules(),!0)}getBudgetConfig(){return{...this.budgetAlertConfig}}getTransactionConfig(){return{...this.transactionAlertConfig}}getGoalConfig(){return{...this.goalCelebrationConfig}}},Mc=gt.createContext(void 0),Oc="#f9fafb",Bc="#f3f4f6",Rc="#e5e7eb",Fc="#d1d5db",Uc="#9ca3af",zc="#6b7280",$c="#4b5563",Gc="#374151",qc="#1f2937",Hc="#111827",Wc="#93c5fd",Yc="#60a5fa",Vc="#3b82f6",Qc="#2563eb",Jc="#1d4ed8",Kc="#86efac",Zc="#4ade80",Xc="#22c55e",el="#16a34a",tl="#15803d",al="#166534",nl="#f87171",rl="#dc2626",sl="#d8b4fe",ol="#c084fc",il="#a855f7",cl="#9333ea",ll="#7c3aed",dl="#6b21a8",ul={xs:"0.75rem",sm:"0.875rem",base:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem"},ml={thin:"100",light:"300",normal:"400",medium:"500",semibold:"600",bold:"700",extrabold:"800"},gl={none:"1",tight:"1.25",snug:"1.375",normal:"1.5",relaxed:"1.625",loose:"2"},pl={0:"0px",px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",11:"2.75rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem"},hl={none:"0px",sm:"0.125rem",DEFAULT:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},yl={none:"none",sm:"0 1px 2px 0 rgb(0 0 0 / 0.05)",DEFAULT:"0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1)",md:"0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)",lg:"0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)",xl:"0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1)","2xl":"0 25px 50px -12px rgb(0 0 0 / 0.25)",inner:"inset 0 2px 4px 0 rgb(0 0 0 / 0.05)"},fl={fast:"150ms",normal:"300ms",slow:"500ms"},bl={linear:"linear",in:"cubic-bezier(0.4, 0, 1, 1)",out:"cubic-bezier(0, 0, 0.2, 1)",inOut:"cubic-bezier(0.4, 0, 0.2, 1)"},xl={background:{primary:Oc,secondary:"#ffffff",tertiary:Bc,elevated:"#ffffff",overlay:"rgba(0, 0, 0, 0.5)"},surface:{primary:"#ffffff",secondary:Oc,tertiary:Bc,inverse:Hc},text:{primary:Hc,secondary:Gc,tertiary:zc,inverse:"#ffffff",link:Qc,disabled:Uc},border:{primary:Rc,secondary:Fc,tertiary:Bc,focus:Vc},interactive:{primary:Qc,primaryHover:Jc,primaryActive:"#1e40af",secondary:$c,secondaryHover:Gc,secondaryActive:qc},status:{success:el,successBackground:"#f0fdf4",warning:"#ca8a04",warningBackground:"#fefce8",error:rl,errorBackground:"#fef2f2",info:Qc,infoBackground:"#eff6ff"},financial:{income:el,expense:rl,transfer:Qc,investment:cl,savings:tl}},wl={background:{primary:Hc,secondary:qc,tertiary:"#030712",elevated:qc,overlay:"rgba(0, 0, 0, 0.7)"},surface:{primary:qc,secondary:Gc,tertiary:Hc,inverse:Oc},text:{primary:Oc,secondary:Fc,tertiary:Uc,inverse:Hc,link:Yc,disabled:zc},border:{primary:Gc,secondary:$c,tertiary:qc,focus:Yc},interactive:{primary:Vc,primaryHover:Yc,primaryActive:Qc,secondary:Uc,secondaryHover:Fc,secondaryActive:zc},status:{success:Zc,successBackground:`${"#14532d"}20`,warning:"#facc15",warningBackground:`${"#713f12"}20`,error:nl,errorBackground:`${"#7f1d1d"}20`,info:Yc,infoBackground:`${"#1e3a8a"}20`},financial:{income:Zc,expense:nl,transfer:Yc,investment:ol,savings:Xc}},vl={lightBlue:{id:"lightBlue",name:"Light Blue",description:"Clean and professional light theme",isDark:!1,colors:xl},darkBlue:{id:"darkBlue",name:"Dark Blue",description:"Modern dark theme with blue accents",isDark:!0,colors:wl},lightGreen:{id:"lightGreen",name:"Light Green",description:"Fresh and calming light theme",isDark:!1,colors:{...xl,interactive:{primary:el,primaryHover:tl,primaryActive:al,secondary:Xc,secondaryHover:el,secondaryActive:tl},border:{...xl.border,focus:Xc}}},darkGreen:{id:"darkGreen",name:"Dark Green",description:"Nature-inspired dark theme",isDark:!0,colors:{...wl,interactive:{primary:Xc,primaryHover:Zc,primaryActive:el,secondary:Zc,secondaryHover:Kc,secondaryActive:Xc},border:{...wl.border,focus:Zc}}},lightPurple:{id:"lightPurple",name:"Light Purple",description:"Creative and vibrant light theme",isDark:!1,colors:{...xl,interactive:{primary:cl,primaryHover:ll,primaryActive:dl,secondary:il,secondaryHover:cl,secondaryActive:ll},border:{...xl.border,focus:il}}},darkPurple:{id:"darkPurple",name:"Dark Purple",description:"Rich and elegant dark theme",isDark:!0,colors:{...wl,interactive:{primary:il,primaryHover:ol,primaryActive:cl,secondary:ol,secondaryHover:sl,secondaryActive:il},border:{...wl.border,focus:ol}}},highContrastLight:{id:"highContrastLight",name:"High Contrast Light",description:"Maximum readability light theme",isDark:!1,colors:{...xl,background:{primary:"#ffffff",secondary:"#ffffff",tertiary:"#f5f5f5",elevated:"#ffffff",overlay:"rgba(0, 0, 0, 0.7)"},text:{primary:"#000000",secondary:qc,tertiary:Gc,inverse:"#ffffff",link:Jc,disabled:zc},border:{primary:"#000000",secondary:qc,tertiary:$c,focus:Jc}}},highContrastDark:{id:"highContrastDark",name:"High Contrast Dark",description:"Maximum readability dark theme",isDark:!0,colors:{...wl,background:{primary:"#000000",secondary:"#0a0a0a",tertiary:"#000000",elevated:"#141414",overlay:"rgba(0, 0, 0, 0.9)"},text:{primary:"#ffffff",secondary:Rc,tertiary:Fc,inverse:"#000000",link:Wc,disabled:zc},border:{primary:"#ffffff",secondary:Fc,tertiary:Uc,focus:Wc}}}},Sl=gt.createContext(null);class kl{static mapClerkUser(e){return{id:e.id,email:e.primaryEmailAddress?.emailAddress||"",name:e.fullName||void 0,imageUrl:e.imageUrl,createdAt:new Date(e.createdAt),lastSignIn:new Date(e.lastSignInAt||e.createdAt),emailVerified:"verified"===e.primaryEmailAddress?.verification?.status,hasPasskey:e.passkeyUsernames?.length>0,hasMFA:e.totpEnabled||e.backupCodeEnabled||e.twoFactorEnabled}}static hasEnhancedSecurity(e){return e.hasPasskey||e.hasMFA}static getSecurityScore(e){let t=0;return e.emailVerified&&(t+=30),e.hasPasskey&&(t+=40),e.hasMFA&&(t+=30),t}static getSecurityRecommendations(e){const t=[];return e.emailVerified||t.push("Verify your email address for better account recovery"),e.hasPasskey||t.push("Enable passkey login for instant, secure access"),e.hasMFA||t.push("Add an authenticator app for extra security"),t}static formatLastSignIn(e){const t=(new Date).getTime()-e.getTime(),a=Math.floor(t/36e5);if(a<1)return"Just now";if(a<24)return`${a} hour${a>1?"s":""} ago`;const n=Math.floor(a/24);return n<7?`${n} day${n>1?"s":""} ago`:e.toLocaleDateString()}}const Il=gt.createContext(void 0),jl=vt("app/loadAllData",async(e,{dispatch:t})=>{try{await Promise.all([t(as()),t(os(1e3)),t(Ss()),t(ds()),t(ms()),t(Ds()),t(Ls())]),t(ps())}catch(a){console.error("Failed to load data from Supabase:",a)}});vt("app/addTransaction",async(e,{getState:t,dispatch:a})=>{const n=await a(is(e));if(is.fulfilled.match(n)){const r=n.payload,s=t();if(e.accountId){const t=s.accounts.accounts.find(t=>t.id===e.accountId);if(t){const n=B([...s.transactions.transactions,r],e.accountId,t.openingBalance||0);a(rs({id:e.accountId,updates:{balance:n}}))}}if("expense"===e.type&&e.category){const t=s.budgets.budgets.filter(t=>t.category===e.category&&F(e.date,t));for(const e of t){const t=R([...s.transactions.transactions,r],e);a(ws({id:e.id,spent:t}))}}U(r,s,a),e.tags&&e.tags.length>0&&a(Ts(e.tags))}}),vt("app/updateTransaction",async({id:e,updates:t},{getState:a,dispatch:n})=>{const r=a().transactions.transactions.find(t=>t.id===e);if(!r)return;const s=await n(cs({id:e,updates:t}));if(cs.fulfilled.match(s)){const e=s.payload,o=a(),i=new Set([r.accountId,t.accountId].filter(Boolean));for(const t of i){if(!t)continue;const e=o.accounts.accounts.find(e=>e.id===t);if(e){const a=B(o.transactions.transactions,t,e.openingBalance||0);n(rs({id:t,updates:{balance:a}}))}}!function(e,t,a,n){const r=new Set;"expense"===e.type&&e.category&&a.budgets.budgets.filter(t=>t.category===e.category&&F(e.date,t)).forEach(e=>r.add(e.id)),"expense"===t.type&&t.category&&a.budgets.budgets.filter(e=>e.category===t.category&&F(t.date,e)).forEach(e=>r.add(e.id));for(const s of r){const e=a.budgets.budgets.find(e=>e.id===s);if(e){const t=R(a.transactions.transactions,e);n(ws({id:s,spent:t}))}}}(r,e,o,n),U(e,o,n),t.tags&&n(Ts(t.tags))}}),vt("app/deleteTransaction",async(e,{getState:t,dispatch:a})=>{const n=t().transactions.transactions.find(t=>t.id===e);if(!n)return;const r=await a(ls(e));if(ls.fulfilled.match(r)){const e=t();if(n.accountId){const t=e.accounts.accounts.find(e=>e.id===n.accountId);if(t){const r=B(e.transactions.transactions,n.accountId,t.openingBalance||0);a(rs({id:n.accountId,updates:{balance:r}}))}}if("expense"===n.type&&n.category){const t=e.budgets.budgets.filter(e=>e.category===n.category&&F(n.date,e));for(const n of t){const t=R(e.transactions.transactions,n);a(ws({id:n.id,spent:t}))}}U(n,e,a)}});class Cl{static stripe=null;static getStripe(){if(!this.stripe)throw new Error("Stripe publishable key not found in environment variables");return this.stripe}static getSubscriptionPlans(){return[{id:"free",name:"Free",tier:"free",description:"Perfect for getting started with personal finance",price:0,currency:"gbp",interval:"month",stripePriceId:"",features:["5 accounts maximum","100 transactions per month","3 budgets","3 financial goals","Basic reporting","Mobile app access"],maxAccounts:5,maxTransactions:100,maxBudgets:3,maxGoals:3,advancedReports:!1,csvExport:!1,apiAccess:!1,prioritySupport:!1},{id:"premium",name:"Premium",tier:"premium",description:"Advanced features for serious financial management",price:7.99,currency:"gbp",interval:"month",stripePriceId:"",features:["Unlimited accounts","Unlimited transactions","Unlimited budgets","Unlimited goals","Advanced analytics","CSV export","Investment tracking","Bill reminders","Email support"],isPopular:!0,maxAccounts:-1,maxTransactions:-1,maxBudgets:-1,maxGoals:-1,advancedReports:!0,csvExport:!0,apiAccess:!1,prioritySupport:!1},{id:"pro",name:"Pro",tier:"pro",description:"Professional-grade tools for power users and businesses",price:15.99,currency:"gbp",interval:"month",stripePriceId:"",features:["Everything in Premium","API access","Custom reports","Advanced forecasting","Multi-currency support","Priority support","Custom categories","Bulk operations","White-label options"],maxAccounts:-1,maxTransactions:-1,maxBudgets:-1,maxGoals:-1,advancedReports:!0,csvExport:!0,apiAccess:!0,prioritySupport:!0}]}static getFeatureLimits(e){const t=this.getSubscriptionPlans().find(t=>t.tier===e);return t?{maxAccounts:t.maxAccounts||5,maxTransactions:t.maxTransactions||100,maxBudgets:t.maxBudgets||3,maxGoals:t.maxGoals||3,advancedReports:t.advancedReports||!1,csvExport:t.csvExport||!1,apiAccess:t.apiAccess||!1,prioritySupport:t.prioritySupport||!1}:{maxAccounts:5,maxTransactions:100,maxBudgets:3,maxGoals:3,advancedReports:!1,csvExport:!1,apiAccess:!1,prioritySupport:!1}}static hasFeatureAccess(e,t){const a=this.getFeatureLimits(e);return!0===a[t]||-1===a[t]}static isWithinLimits(e,t,a){const n=this.getFeatureLimits(e)[a];return-1===n||t<n}static async createCheckoutSession(e,t){try{const a=await fetch("http://localhost:3000/api/subscriptions/create-checkout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({planType:e,successUrl:`${window.location.origin}/subscription?success=true`,cancelUrl:`${window.location.origin}/subscription`})});if(!a.ok){const e=await a.json();throw new Error(e.error||`Failed to create checkout: ${a.statusText}`)}return(await a.json()).data}catch(a){throw console.error("Error creating checkout session:",a),a}}static async createSubscription(e){throw new Error("Use createCheckoutSession instead")}static async updateSubscription(e,t){try{const a=await fetch(`/api/subscriptions/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw new Error(`Failed to update subscription: ${a.statusText}`);return await a.json()}catch(a){throw console.error("Error updating subscription:",a),a}}static async cancelSubscription(e,t=!0){return this.updateSubscription(e,{cancelAtPeriodEnd:t})}static async getSubscriptionPreview(e,t){try{const a=await fetch(`/api/subscriptions/${e}/preview?priceId=${t}`);if(!a.ok)throw new Error(`Failed to get subscription preview: ${a.statusText}`);return await a.json()}catch(a){throw console.error("Error getting subscription preview:",a),a}}static async getCurrentSubscription(e){try{if(!e)return console.warn("No authentication token provided"),null;const t=await fetch("http://localhost:3000/api/subscriptions/status",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(404===t.status)return null;if(!t.ok)throw new Error(`Failed to get current subscription: ${t.statusText}`);const a=await t.json();return a.success&&a.data.hasSubscription?{id:a.data.subscriptionId,userId:"",tier:a.data.planType,status:a.data.status,stripeCustomerId:a.data.customerId,stripeSubscriptionId:a.data.subscriptionId,currentPeriodStart:a.data.currentPeriodStart,currentPeriodEnd:a.data.currentPeriodEnd,trialEnd:a.data.trialEnd,cancelAtPeriodEnd:a.data.cancelAtPeriodEnd}:null}catch(t){throw console.error("Error getting current subscription:",t),t}}static async getBillingHistory(){try{const e=await fetch("/api/billing/history");if(!e.ok)throw new Error(`Failed to get billing history: ${e.statusText}`);return await e.json()}catch(e){throw console.error("Error getting billing history:",e),e}}static async addPaymentMethod(e){try{const t=await fetch("/api/billing/payment-methods",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentMethodId:e})});if(!t.ok)throw new Error(`Failed to add payment method: ${t.statusText}`);return await t.json()}catch(t){throw console.error("Error adding payment method:",t),t}}static async setDefaultPaymentMethod(e){try{const t=await fetch(`/api/billing/payment-methods/${e}/default`,{method:"PUT"});if(!t.ok)throw new Error(`Failed to set default payment method: ${t.statusText}`)}catch(t){throw console.error("Error setting default payment method:",t),t}}static async removePaymentMethod(e){try{const t=await fetch(`/api/billing/payment-methods/${e}`,{method:"DELETE"});if(!t.ok)throw new Error(`Failed to remove payment method: ${t.statusText}`)}catch(t){throw console.error("Error removing payment method:",t),t}}static async createPortalSession(){try{const e=await fetch("/api/billing/portal",{method:"POST"});if(!e.ok)throw new Error(`Failed to create portal session: ${e.statusText}`);const{url:t}=await e.json();return t}catch(e){throw console.error("Error creating portal session:",e),e}}static formatPrice(e,t="usd"){return new Intl.NumberFormat("en-US",{style:"currency",currency:t.toUpperCase()}).format(e)}static getPlanByTier(e){return this.getSubscriptionPlans().find(t=>t.tier===e)}static isUpgrade(e,t){const a=["free","premium","pro"],n=a.indexOf(e);return a.indexOf(t)>n}static isDowngrade(e,t){const a=["free","premium","pro"],n=a.indexOf(e);return a.indexOf(t)<n}}class Nl{static async getCurrentSubscription(e){try{const{data:t,error:a}=await Fr.from("subscriptions").select("*").eq("user_id",e).order("created_at",{ascending:!1}).limit(1).single();if(a&&"PGRST116"!==a.code)throw a;return t?{id:t.id,userId:t.user_id,tier:t.tier,status:t.status,stripeCustomerId:t.stripe_customer_id,stripeSubscriptionId:t.stripe_subscription_id,stripePriceId:t.stripe_price_id,currentPeriodStart:t.current_period_start?new Date(t.current_period_start):void 0,currentPeriodEnd:t.current_period_end?new Date(t.current_period_end):void 0,trialStart:t.trial_start?new Date(t.trial_start):void 0,trialEnd:t.trial_end?new Date(t.trial_end):void 0,cancelledAt:t.cancelled_at?new Date(t.cancelled_at):void 0,cancelAtPeriodEnd:t.cancel_at_period_end,createdAt:new Date(t.created_at),updatedAt:new Date(t.updated_at)}:null}catch(t){throw console.error("Error getting current subscription:",t),t}}static async upsertSubscription(e){try{const t={user_id:e.userId,stripe_subscription_id:e.stripeSubscriptionId,stripe_customer_id:e.stripeCustomerId,stripe_price_id:e.stripePriceId,tier:e.tier,status:e.status,current_period_start:e.currentPeriodStart?.toISOString(),current_period_end:e.currentPeriodEnd?.toISOString(),trial_start:e.trialStart?.toISOString(),trial_end:e.trialEnd?.toISOString(),cancelled_at:e.cancelledAt?.toISOString(),cancel_at_period_end:e.cancelAtPeriodEnd},{data:a,error:n}=await Fr.from("subscriptions").upsert(t,{onConflict:"stripe_subscription_id"}).select().single();if(n)throw n;return{id:a.id,userId:a.user_id,tier:a.tier,status:a.status,stripeCustomerId:a.stripe_customer_id,stripeSubscriptionId:a.stripe_subscription_id,stripePriceId:a.stripe_price_id,currentPeriodStart:a.current_period_start?new Date(a.current_period_start):void 0,currentPeriodEnd:a.current_period_end?new Date(a.current_period_end):void 0,trialStart:a.trial_start?new Date(a.trial_start):void 0,trialEnd:a.trial_end?new Date(a.trial_end):void 0,cancelledAt:a.cancelled_at?new Date(a.cancelled_at):void 0,cancelAtPeriodEnd:a.cancel_at_period_end,createdAt:new Date(a.created_at),updatedAt:new Date(a.updated_at)}}catch(t){throw console.error("Error upserting subscription:",t),t}}static async getSubscriptionUsage(e){try{const{data:t,error:a}=await Fr.from("subscription_usage").select("*").eq("user_id",e).single();if(a&&"PGRST116"!==a.code)throw a;if(!t){const{data:t,error:a}=await Fr.from("subscription_usage").insert({user_id:e,accounts_count:0,transactions_count:0,budgets_count:0,goals_count:0}).select().single();if(a)throw a;return{accounts:t.accounts_count,transactions:t.transactions_count,budgets:t.budgets_count,goals:t.goals_count,lastCalculated:new Date(t.last_calculated)}}return{accounts:t.accounts_count,transactions:t.transactions_count,budgets:t.budgets_count,goals:t.goals_count,lastCalculated:new Date(t.last_calculated)}}catch(t){throw console.error("Error getting subscription usage:",t),t}}static async updateSubscriptionUsage(e,t){try{const a={last_calculated:(new Date).toISOString()};void 0!==t.accounts&&(a.accounts_count=t.accounts),void 0!==t.transactions&&(a.transactions_count=t.transactions),void 0!==t.budgets&&(a.budgets_count=t.budgets),void 0!==t.goals&&(a.goals_count=t.goals);const{error:n}=await Fr.from("subscription_usage").upsert({user_id:e,...a},{onConflict:"user_id"});if(n)throw n}catch(a){throw console.error("Error updating subscription usage:",a),a}}static async refreshUsageCounts(e){try{const{error:t}=await Fr.rpc("update_usage_counts",{p_user_id:e});if(t)throw t}catch(t){throw console.error("Error refreshing usage counts:",t),t}}static async hasFeatureAccess(e,t){try{const{data:a,error:n}=await Fr.rpc("has_feature_access",{p_user_id:e,p_feature:t});if(n)throw n;return a}catch(a){return console.error("Error checking feature access:",a),!1}}static async getPaymentMethods(e){try{const{data:t,error:a}=await Fr.from("payment_methods").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(a)throw a;return(t||[]).map(e=>({id:e.stripe_payment_method_id,last4:e.last4,brand:e.brand,expiryMonth:e.expiry_month,expiryYear:e.expiry_year,isDefault:e.is_default}))}catch(t){throw console.error("Error getting payment methods:",t),t}}static async addPaymentMethod(e,t){try{const{error:a}=await Fr.from("payment_methods").insert({user_id:e,stripe_payment_method_id:t.id,last4:t.last4,brand:t.brand,expiry_month:t.expiryMonth,expiry_year:t.expiryYear,is_default:!1});if(a)throw a}catch(a){throw console.error("Error adding payment method:",a),a}}static async setDefaultPaymentMethod(e,t){try{await Fr.from("payment_methods").update({is_default:!1}).eq("user_id",e);const{error:a}=await Fr.from("payment_methods").update({is_default:!0}).eq("user_id",e).eq("stripe_payment_method_id",t);if(a)throw a}catch(a){throw console.error("Error setting default payment method:",a),a}}static async removePaymentMethod(e,t){try{const{error:a}=await Fr.from("payment_methods").delete().eq("user_id",e).eq("stripe_payment_method_id",t);if(a)throw a}catch(a){throw console.error("Error removing payment method:",a),a}}static async getInvoices(e){try{const{data:t,error:a}=await Fr.from("invoices").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(a)throw a;return(t||[]).map(e=>({id:e.stripe_invoice_id,amount:parseFloat(e.amount),currency:e.currency,status:e.status,paidAt:e.paid_at?new Date(e.paid_at):void 0,dueDate:e.due_date?new Date(e.due_date):void 0,invoiceUrl:e.invoice_url,invoicePdf:e.invoice_pdf,description:e.description,createdAt:new Date(e.created_at)}))}catch(t){throw console.error("Error getting invoices:",t),t}}static async addInvoice(e,t){try{const{error:a}=await Fr.from("invoices").insert({user_id:e,stripe_invoice_id:t.id,amount:t.amount,currency:t.currency,status:t.status,paid_at:t.paidAt?.toISOString(),due_date:t.dueDate?.toISOString(),invoice_url:t.invoiceUrl,invoice_pdf:t.invoicePdf,description:t.description});if(a)throw a}catch(a){throw console.error("Error adding invoice:",a),a}}static async createUserProfile(e,t,a){try{const{error:n}=await Fr.from("user_profiles").insert({clerk_user_id:e,email:t,full_name:a,subscription_tier:"free",subscription_status:"active"});if(n&&"23505"!==n.code)throw n}catch(n){throw console.error("Error creating user profile:",n),n}}static async getUserProfile(e){try{const{data:t,error:a}=await Fr.from("user_profiles").select("*").eq("clerk_user_id",e).single();if(a)throw a;return t}catch(t){throw console.error("Error getting user profile:",t),t}}}class Dl{static stripe=$n("");static async createSubscription(e){try{throw new Error("Subscription creation requires a backend API. This demo shows the frontend components only. In production, implement the following backend endpoints:\n- POST /api/subscriptions (create subscription)\n- PATCH /api/subscriptions/:id (update subscription)\n- GET /api/subscriptions/current (get current subscription)\n- POST /api/billing/portal (create portal session)")}catch(t){throw console.error("Error creating subscription:",t),t}}static async updateSubscription(e,t){try{throw new Error("Subscription updates require a backend API. See createSubscription method for implementation guidance.")}catch(a){throw console.error("Error updating subscription:",a),a}}static async getCurrentSubscription(e){try{const t=await Nl.getUserProfile(e);return t?await Nl.getCurrentSubscription(t.id):null}catch(t){return console.error("Error getting current subscription:",t),null}}static async getBillingHistory(e){try{const t=await Nl.getUserProfile(e);if(!t)throw new Error("User profile not found");const[a,n]=await Promise.all([Nl.getPaymentMethods(t.id),Nl.getInvoices(t.id)]),r=await Nl.getCurrentSubscription(t.id);return{invoices:n,paymentMethods:a,nextBillingDate:r?.currentPeriodEnd,totalPaid:n.filter(e=>"paid"===e.status).reduce((e,t)=>e+t.amount,0)}}catch(t){throw console.error("Error getting billing history:",t),t}}static async createPortalSession(){try{throw new Error("Customer portal requires a backend API endpoint.\nImplement POST /api/billing/portal that:\n1. Gets user from session\n2. Creates Stripe portal session\n3. Returns portal URL")}catch(e){throw console.error("Error creating portal session:",e),e}}static async createDemoSubscription(e,t){try{const a=await Nl.getUserProfile(e);if(!a)throw new Error("User profile not found");const n={userId:a.id,tier:t,status:"trialing",stripeCustomerId:`cus_demo_${Date.now()}`,stripeSubscriptionId:`sub_demo_${Date.now()}`,stripePriceId:"premium"===t?"price_premium":"price_pro",trialStart:new Date,trialEnd:new Date(Date.now()+12096e5),currentPeriodStart:new Date,currentPeriodEnd:new Date(Date.now()+2592e6),cancelAtPeriodEnd:!1};return await Nl.upsertSubscription(n)}catch(a){throw console.error("Error creating demo subscription:",a),a}}static async cancelDemoSubscription(e){try{const t=await Nl.getUserProfile(e);if(!t)throw new Error("User profile not found");const a=await Nl.getCurrentSubscription(t.id);if(!a)throw new Error("No subscription found");const n={...a,status:"cancelled",cancelledAt:new Date,cancelAtPeriodEnd:!0};return await Nl.upsertSubscription(n)}catch(t){throw console.error("Error canceling demo subscription:",t),t}}static async initializeUserProfile(e,t,a){try{await Nl.createUserProfile(e,t,a);const n=await Nl.getUserProfile(e);n&&await Nl.refreshUsageCounts(n.id)}catch(n){console.error("Error initializing user profile:",n)}}static async checkFeatureAccess(e,t){try{const a=await Nl.getUserProfile(e);return!!a&&await Nl.hasFeatureAccess(a.id,t)}catch(a){return console.error("Error checking feature access:",a),!1}}static async getUsageInfo(e){try{const t=await Nl.getUserProfile(e);if(!t)throw new Error("User profile not found");const[a,n]=await Promise.all([Nl.getCurrentSubscription(t.id),Nl.getSubscriptionUsage(t.id)]);return{subscription:a,usage:n,tier:a?.tier||"free"}}catch(t){throw console.error("Error getting usage info:",t),t}}}const El=gt.createContext(void 0),Al=({size:e=20,color:t="currentColor",hoverColor:a,onClick:n,className:r="",title:s,children:o,viewBox:i="0 0 24 24",style:c,strokeWidth:l,"data-testid":d})=>{const[u,m]=Gn.useState(!1);return pt.jsxs("svg",{width:e,height:e,viewBox:i,fill:"none",xmlns:"http://www.w3.org/2000/svg",onClick:n,onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),className:`transition-all duration-200 ${n?"cursor-pointer":""} ${r}`,style:{color:u&&a?a:t,...c},strokeWidth:l,role:n?"button":s?"img":void 0,"aria-label":s,"data-testid":d,children:[s&&pt.jsx("title",{children:s}),o]})},Tl=e=>pt.jsxs(Al,{...e,children:[pt.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",fill:"none"}),pt.jsx("path",{d:"M12 16V12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),pt.jsx("path",{d:"M12 8H12.01",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),_l={required:"This field is required","Description is required":"Please enter a description for this transaction","Amount must be greater than 0":"Please enter a valid amount greater than zero","Category is required":"Please select a category for this transaction","Invalid account ID":"Please select a valid account","Date must be in YYYY-MM-DD format":"Please enter a valid date","Invalid decimal number":"Please enter a valid number (e.g., 10.50)","Notes must be less than 1000 characters":"Your notes are too long. Please keep them under 1000 characters","Description must be less than 500 characters":"Description is too long. Please keep it under 500 characters","Account not found":"The selected account no longer exists. Please refresh and try again","Insufficient balance":"This account doesn't have enough funds for this transaction","Account is locked":"This account is currently locked. Please unlock it in Account Settings",NetworkError:"Connection problem. Please check your internet and try again","Failed to fetch":"Unable to connect to the server. Please try again","Network request failed":"Connection lost. Your changes will be saved when you're back online",timeout:"This is taking longer than expected. Please try again",Unauthorized:"Your session has expired. Please sign in again",Forbidden:"You don't have permission to perform this action","Invalid credentials":"The email or password you entered is incorrect","Email already exists":"An account with this email already exists","unique constraint":"This item already exists. Please use a different name","foreign key constraint":"This item is being used elsewhere and cannot be deleted",SQLITE_BUSY:"The database is busy. Please wait a moment and try again","File too large":"This file is too large. Please choose a file under 5MB","Invalid file type":"This file type is not supported. Please use JPG, PNG, or PDF","Upload failed":"Unable to upload the file. Please try again","Something went wrong":"An unexpected error occurred. Please try again","Invalid input":"Please check your input and try again","Operation failed":"Unable to complete this action. Please try again"},Ll=gt.createContext(void 0),Pl={dashboard:"Dashboard",transactions:"Transactions",accounts:"Accounts",budget:"Budget",goals:"Goals",investments:"Investments","enhanced-investments":"Investment Analytics",analytics:"Analytics","ai-analytics":"AI Analytics","custom-reports":"Custom Reports","tax-planning":"Tax Planning",household:"Household","business-features":"Business Features","financial-planning":"Financial Planning","data-intelligence":"Data Intelligence",summaries:"Summaries",settings:"Settings",app:"App Settings",data:"Data Management",categories:"Categories",tags:"Tags",security:"Security","enhanced-import":"Enhanced Import","export-manager":"Export Manager",documents:"Documents","open-banking":"Open Banking",reconciliation:"Reconciliation","ai-features":"AI Features"},Ml=[{href:"#main-content",label:"Skip to main content"},{href:"#navigation",label:"Skip to navigation"},{href:"#search",label:"Skip to search"}],Ol=({links:e=Ml})=>pt.jsx("nav",{className:"skip-links","aria-label":"Skip links",children:e.map((e,t)=>pt.jsx("a",{href:e.href,className:"skip-link",style:{marginLeft:t>0?"8px":"0"},children:e.label},e.href))}),Bl=new class{db=null;syncInProgress=!1;DB_NAME="WealthTrackerOffline";DB_VERSION=1;async init(){this.db||(this.db=await Wn(this.DB_NAME,this.DB_VERSION,{upgrade(e){if(!e.objectStoreNames.contains("transactions")){const t=e.createObjectStore("transactions",{keyPath:"id"});t.createIndex("by-date","date"),t.createIndex("by-sync-status","syncStatus")}e.objectStoreNames.contains("accounts")||e.createObjectStore("accounts",{keyPath:"id"}),e.objectStoreNames.contains("budgets")||e.createObjectStore("budgets",{keyPath:"id"}),e.objectStoreNames.contains("goals")||e.createObjectStore("goals",{keyPath:"id"}),e.objectStoreNames.contains("offlineQueue")||e.createObjectStore("offlineQueue",{keyPath:"id"}),e.objectStoreNames.contains("conflicts")||e.createObjectStore("conflicts",{keyPath:"id"})}}),this.setupEventListeners())}setupEventListeners(){window.addEventListener("online",()=>{this.syncOfflineData()}),document.addEventListener("visibilitychange",()=>{!document.hidden&&navigator.onLine&&this.syncOfflineData()}),"serviceWorker"in navigator&&"SyncManager"in window&&navigator.serviceWorker.ready.then(e=>e.sync.register("sync-offline-data")).catch(e=>{console.error("Failed to register background sync:",e)})}async saveTransaction(e,t=!1){this.db||await this.init();const a=this.db.transaction(["transactions","offlineQueue"],"readwrite");await a.objectStore("transactions").put({...e,syncStatus:t?"pending":"synced"}),t&&await a.objectStore("offlineQueue").put({id:`transaction-${e.id}-${Date.now()}`,type:"create",entity:"transaction",data:e,timestamp:Date.now(),retries:0}),await a.done}async getTransactions(e){this.db||await this.init();const t=await this.db.getAll("transactions");return e?t.filter(t=>t.accountId===e):t}async updateTransaction(e,t,a=!1){this.db||await this.init();const n=this.db.transaction(["transactions","offlineQueue"],"readwrite"),r=await n.objectStore("transactions").get(e);if(r){const s={...r,...t,syncStatus:a?"pending":"synced"};await n.objectStore("transactions").put(s),a&&await n.objectStore("offlineQueue").put({id:`transaction-${e}-${Date.now()}`,type:"update",entity:"transaction",data:s,timestamp:Date.now(),retries:0})}await n.done}async deleteTransaction(e,t=!1){this.db||await this.init();const a=this.db.transaction(["transactions","offlineQueue"],"readwrite");await a.objectStore("transactions").delete(e),t&&await a.objectStore("offlineQueue").put({id:`transaction-${e}-${Date.now()}`,type:"delete",entity:"transaction",data:{id:e},timestamp:Date.now(),retries:0}),await a.done}async syncOfflineData(){if(!this.syncInProgress&&navigator.onLine){this.syncInProgress=!0;try{this.db||await this.init();const t=await this.db.getAll("offlineQueue");t.sort((e,t)=>e.timestamp-t.timestamp),console.log(`Syncing ${t.length} offline items`);for(const a of t)try{await this.syncQueueItem(a),await this.db.delete("offlineQueue",a.id)}catch(e){console.error(`Failed to sync item ${a.id}:`,e),a.retries+=1,a.lastError=e instanceof Error?e.message:"Unknown error",a.retries>3?(await this.handleSyncConflict(a),await this.db.delete("offlineQueue",a.id)):await this.db.put("offlineQueue",a)}window.dispatchEvent(new CustomEvent("offline-sync-complete",{detail:{itemsSynced:t.length}}))}finally{this.syncInProgress=!1}}}async syncQueueItem(e){const t=`/api/${e.entity}${"delete"===e.type?`/${e.data.id}`:""}`,a="create"===e.type?"POST":"update"===e.type?"PUT":"DELETE",n=await fetch(t,{method:a,headers:{"Content-Type":"application/json"},body:"delete"!==e.type?JSON.stringify(e.data):void 0});if(!n.ok)throw new Error(`Sync failed: ${n.statusText}`);"transaction"===e.entity&&"delete"!==e.type&&await this.db.put("transactions",{...e.data,syncStatus:"synced"})}async handleSyncConflict(e){this.db||await this.init(),await this.db.put("conflicts",{id:`conflict-${e.id}`,entity:e.entity,localData:e.data,serverData:null,timestamp:Date.now(),resolved:!1}),window.dispatchEvent(new CustomEvent("offline-sync-conflict",{detail:{entity:e.entity,data:e.data}}))}async getConflicts(){return this.db||await this.init(),this.db.getAll("conflicts")}async resolveConflict(e,t){this.db||await this.init();const a=await this.db.get("conflicts",e);a&&("local"===t&&await this.db.put("offlineQueue",{id:`resolved-${e}`,type:"update",entity:a.entity,data:a.localData,timestamp:Date.now(),retries:0}),a.resolved=!0,await this.db.put("conflicts",a))}async clearOldData(e=30){this.db||await this.init();const t=new Date;t.setDate(t.getDate()-e);const a=this.db.transaction(["transactions"],"readwrite"),n=await a.objectStore("transactions").getAll();for(const r of n)new Date(r.date)<t&&"synced"===r.syncStatus&&await a.objectStore("transactions").delete(r.id);await a.done}async getOfflineQueueCount(){return this.db||await this.init(),this.db.count("offlineQueue")}async clearOfflineData(){this.db||await this.init();const e=["transactions","accounts","budgets","goals","offlineQueue","conflicts"],t=this.db.transaction(e,"readwrite");for(const a of e)await t.objectStore(a).clear();await t.done}},Rl={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_CLERK_PUBLISHABLE_KEY:"pk_test_bWF0dXJlLXJhdHRsZXNuYWtlLTc1LmNsZXJrLmFjY291bnRzLmRldiQ",VITE_SENTRY_DSN:"",VITE_STRIPE_PUBLISHABLE_KEY:"",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xYmFjcmpqZ2RqYWJ5Z3F0Y2FoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIzNDgxNjgsImV4cCI6MjA2NzkyNDE2OH0.teKfoCvodwO719cNddtlC7k-gWoHu_Ntd64mo6XkDq4",VITE_SUPABASE_SERVICE_ROLE_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xYmFjcmpqZ2RqYWJ5Z3F0Y2FoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MjM0ODE2OCwiZXhwIjoyMDY3OTI0MTY4fQ.mEya-U5K8xmO_xa3Ts-3aiTVNha1CU3FGCpQrSZ_Oy4",VITE_SUPABASE_URL:"https://nqbacrjjgdjabygqtcah.supabase.co"},Fl=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));let Ul=null;const zl=new class{OFFLINE_QUEUE_STORE="offline-queue";OFFLINE_DATA_STORE="offline-data";CONFLICT_STORE="conflicts";SYNC_META_STORE="sync-metadata";syncInProgress=!1;offlineState={isOffline:!navigator.onLine,pendingChanges:0,lastSync:null,syncInProgress:!1};constructor(){this.initializeOfflineDetection(),this.initializeStores()}initializeOfflineDetection(){window.addEventListener("online",()=>this.handleOnline()),window.addEventListener("offline",()=>this.handleOffline()),setInterval(()=>this.checkConnectivity(),3e4)}async initializeStores(){try{await zr.put("offline-queue",{id:"init",initialized:!0}),await zr.put("offline-data",{id:"init",initialized:!0}),await zr.put("conflicts",{id:"init",initialized:!0}),await zr.put("sync-meta",{key:"lastSync",timestamp:null})}catch(e){console.error("[OfflineStorage] Failed to initialize stores:",e)}}async checkConnectivity(){try{return(await fetch("/api/health",{method:"HEAD",cache:"no-cache"})).ok}catch{return!1}}async handleOnline(){this.offlineState.isOffline=!1,this.notifyStateChange(),await this.syncOfflineData()}handleOffline(){this.offlineState.isOffline=!0,this.notifyStateChange(),this.cacheEssentialData()}async queueOfflineOperation(e){const t={...e,id:crypto.randomUUID(),timestamp:Date.now(),synced:!1,retries:0};return await zr.put(this.OFFLINE_QUEUE_STORE,t),this.offlineState.pendingChanges++,this.notifyStateChange(),this.offlineState.isOffline||this.syncOfflineData(),t.id}async getPendingOperations(){const e=await zr.getAllKeys(this.OFFLINE_QUEUE_STORE),t=[];for(const a of e)if("init"!==a){const e=await zr.get(this.OFFLINE_QUEUE_STORE,a);e&&!e.synced&&t.push(e)}return t.sort((e,t)=>e.timestamp-t.timestamp)}async syncOfflineData(){if(!this.syncInProgress&&!this.offlineState.isOffline){this.syncInProgress=!0,this.offlineState.syncInProgress=!0,this.notifyStateChange();try{const t=await this.getPendingOperations();console.log(`[OfflineStorage] Syncing ${t.length} operations`);for(const a of t)try{await this.syncOperation(a),a.synced=!0,await zr.put(this.OFFLINE_QUEUE_STORE,a.id,a),await zr.delete(this.OFFLINE_QUEUE_STORE,a.id),this.offlineState.pendingChanges--}catch(e){console.error(`[OfflineStorage] Failed to sync operation ${a.id}:`,e),409===e.status?await this.handleConflict(a,e.data):(a.retries++,a.error=e.message,a.retries>=3?console.error(`[OfflineStorage] Operation ${a.id} failed after 3 retries`):await zr.put(this.OFFLINE_QUEUE_STORE,a))}this.offlineState.lastSync=new Date,await zr.put(this.SYNC_META_STORE,{key:"lastSync",timestamp:this.offlineState.lastSync.toISOString()})}finally{this.syncInProgress=!1,this.offlineState.syncInProgress=!1,this.notifyStateChange()}}}async syncOperation(e){const t=this.getEndpoint(e),a=this.getMethod(e),n=await fetch(t,{method:a,headers:{"Content-Type":"application/json","X-Offline-Sync":"true","X-Client-Timestamp":e.timestamp.toString()},body:"DELETE"!==a?JSON.stringify(e.data):void 0});if(!n.ok){const e=await n.json();throw{status:n.status,data:e}}return n.json()}getEndpoint(e){const t="/api",a=e.data?.id;switch(e.entity){case"transaction":return"create"===e.type?`${t}/transactions`:`${t}/transactions/${a}`;case"account":return"create"===e.type?`${t}/accounts`:`${t}/accounts/${a}`;case"budget":return"create"===e.type?`${t}/budgets`:`${t}/budgets/${a}`;case"goal":return"create"===e.type?`${t}/goals`:`${t}/goals/${a}`;default:throw new Error(`Unknown entity type: ${e.entity}`)}}getMethod(e){switch(e.type){case"create":return"POST";case"update":return"PUT";case"delete":return"DELETE";default:throw new Error(`Unknown operation type: ${e.type}`)}}async handleConflict(e,t){const a={id:crypto.randomUUID(),operationId:e.id,clientData:e.data,serverData:t,entity:e.entity,timestamp:Date.now(),resolved:!1};await zr.put(this.CONFLICT_STORE,a),this.notifyConflict(a);const n=await this.autoResolveConflict(e,t);n.resolved&&(e.data=n.resolved,await this.syncOperation(e),a.resolved=!0,await zr.put(this.CONFLICT_STORE,a))}async autoResolveConflict(e,t){const a=e.data;switch(e.entity){case"transaction":return this.resolveTransactionConflict(a,t);case"account":return this.resolveAccountConflict(a,t);case"budget":return this.resolveBudgetConflict(a,t);default:return{client:a,server:t,resolved:null,strategy:"manual"}}}resolveTransactionConflict(e,t){return e.date!==t.date?{client:e,server:t,resolved:new Date(e.date).getTime()>new Date(t.date).getTime()?e:t,strategy:"client-wins"}:{client:e,server:t,resolved:null,strategy:"manual"}}resolveAccountConflict(e,t){const a=e.balance-e.originalBalance;return{client:e,server:t,resolved:{...t,balance:t.balance+a},strategy:"merge"}}resolveBudgetConflict(e,t){return{client:e,server:t,resolved:{...t,amount:Math.min(e.amount,t.amount),spent:Math.max(e.spent||0,t.spent||0)},strategy:"merge"}}async cacheEssentialData(){const e=[{key:"accounts",url:"/api/accounts"},{key:"transactions",url:"/api/transactions?limit=100"},{key:"categories",url:"/api/categories"},{key:"budgets",url:"/api/budgets"},{key:"tags",url:"/api/tags"}];for(const{key:a,url:n}of e)try{const e=await fetch(n);if(e.ok){const t=await e.json();await zr.put(this.OFFLINE_DATA_STORE,{id:a,...t})}}catch(t){console.error(`[OfflineStorage] Failed to cache ${a}:`,t)}}async getCachedData(e){return await zr.get(this.OFFLINE_DATA_STORE,e)}getOfflineState(){return{...this.offlineState}}async getConflicts(){const e=await zr.getAllKeys(this.CONFLICT_STORE),t=[];for(const a of e)if("init"!==a){const e=await zr.get(this.CONFLICT_STORE,a);e&&!e.resolved&&t.push(e)}return t}async resolveConflict(e,t){const a=await zr.get(this.CONFLICT_STORE,e);if(!a)throw new Error("Conflict not found");const n=await zr.get(this.OFFLINE_QUEUE_STORE,a.operationId);n&&(n.data=t,await this.syncOperation(n)),a.resolved=!0,a.resolutionData=t,await zr.put(this.CONFLICT_STORE,a)}async clearOfflineData(){await zr.clearStore(this.OFFLINE_QUEUE_STORE),await zr.clearStore(this.OFFLINE_DATA_STORE),await zr.clearStore(this.CONFLICT_STORE),this.offlineState.pendingChanges=0,this.offlineState.lastSync=null,this.notifyStateChange()}notifyStateChange(){window.dispatchEvent(new CustomEvent("offline-state-change",{detail:this.getOfflineState()}))}notifyConflict(e){window.dispatchEvent(new CustomEvent("sync-conflict",{detail:e}))}},$l=()=>{const[e,t]=Gn.useState(zl.getOfflineState());return Gn.useEffect(()=>{const e=e=>{t(e.detail)};return window.addEventListener("offline-state-change",e),()=>window.removeEventListener("offline-state-change",e)},[]),e},Gl=()=>({queue:Gn.useCallback(e=>zl.queueOfflineOperation(e),[]),sync:Gn.useCallback(()=>zl.syncOfflineData(),[]),getConflicts:Gn.useCallback(()=>zl.getConflicts(),[]),resolveConflict:Gn.useCallback((e,t)=>zl.resolveConflict(e,t),[])}),ql=()=>{const e=$l(),{sync:t,getConflicts:a}=Gl(),[n,r]=Gn.useState([]),[s,o]=Gn.useState(!1);return Gn.useEffect(()=>{const e=async()=>{const e=await a();r(e)};e();const t=()=>e();return window.addEventListener("sync-conflict",t),()=>window.removeEventListener("sync-conflict",t)},[a]),e.isOffline||0!==e.pendingChanges||0!==n.length?pt.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:pt.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-4 min-w-[280px]",children:[pt.jsxs("div",{className:"flex items-center justify-between mb-3",children:[pt.jsx("div",{className:"flex items-center gap-2",children:e.isOffline?pt.jsxs(pt.Fragment,{children:[pt.jsx(Mi,{className:"h-5 w-5 text-red-500"}),pt.jsx("span",{className:"font-medium text-red-700 dark:text-red-400",children:"Offline Mode"})]}):pt.jsxs(pt.Fragment,{children:[pt.jsx(Pi,{className:"h-5 w-5 text-green-500"}),pt.jsx("span",{className:"font-medium text-green-700 dark:text-green-400",children:"Online"})]})}),e.pendingChanges>0&&pt.jsx("button",{onClick:async()=>{try{await t()}catch(e){console.error("Sync failed:",e)}},disabled:e.isOffline||e.syncInProgress,className:"p-1.5 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",title:"Sync now",children:pt.jsx(Po,{className:"h-4 w-4 "+(e.syncInProgress?"animate-spin":"")})})]}),pt.jsxs("div",{className:"space-y-2 text-sm",children:[e.isOffline&&pt.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Your changes will be saved locally and synced when you're back online."}),e.pendingChanges>0&&pt.jsxs("div",{className:"flex items-center justify-between",children:[pt.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Pending changes:"}),pt.jsx("span",{className:"font-medium text-orange-600 dark:text-orange-400",children:e.pendingChanges})]}),n.length>0&&pt.jsxs("div",{className:"flex items-center gap-2 text-red-600 dark:text-red-400",children:[pt.jsx(vo,{className:"h-4 w-4"}),pt.jsxs("span",{children:[n.length," conflict",n.length>1?"s":""," need resolution"]})]}),e.lastSync&&pt.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-500",children:["Last synced: ",new Date(e.lastSync).toLocaleTimeString()]})]}),(e.pendingChanges>0||n.length>0)&&pt.jsxs(pt.Fragment,{children:[pt.jsxs("button",{onClick:()=>o(!s),className:"mt-3 text-xs text-blue-600 dark:text-blue-400 hover:underline",children:[s?"Hide":"Show"," details"]}),s&&pt.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[n.length>0&&pt.jsxs("div",{className:"mb-3",children:[pt.jsx("h4",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Conflicts:"}),pt.jsx("div",{className:"space-y-1",children:n.map(e=>pt.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 flex items-center justify-between",children:[pt.jsxs("span",{children:[e.entity," conflict"]}),pt.jsx("button",{className:"text-blue-600 dark:text-blue-400 hover:underline",onClick:()=>{window.dispatchEvent(new CustomEvent("open-conflict-resolver",{detail:e}))},children:"Resolve"})]},e.id))})]}),pt.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-500",children:e.isOffline?"Working offline. Changes saved locally.":e.syncInProgress?"Syncing...":"Ready to sync"})]})]})]})}):null},Hl=({isOpen:e,onClose:t,onSuccess:a})=>{const{queue:n}=Gl(),{categories:r}=function(){const e=gt.useContext(fc);if(!e)throw new Error("useCategories must be used within CategoryProvider");return e}(),{accounts:s}=function(){const e=gt.useContext(pc);if(!e)throw new Error("useAccounts must be used within AccountProvider");return e}(),[o,i]=Gn.useState({description:"",amount:"",type:"expense",category:"",accountId:"",date:(new Date).toISOString().split("T")[0],tags:[],notes:""}),[c,l]=Gn.useState(!1),[d,u]=Gn.useState(!1),[m,g]=Gn.useState(null);return e?pt.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:pt.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto",children:[pt.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b dark:border-gray-700 p-4",children:[pt.jsxs("div",{className:"flex items-center justify-between mb-2",children:[pt.jsx("h2",{className:"text-lg font-semibold",children:"Add Transaction (Offline)"}),pt.jsx("button",{onClick:t,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:"\u2715"})]}),pt.jsxs("div",{className:"flex items-center gap-2 text-sm text-orange-600 dark:text-orange-400",children:[pt.jsx(Mi,{className:"h-4 w-4"}),pt.jsx("span",{children:"Will sync when back online"})]})]}),d?pt.jsxs("div",{className:"p-8 text-center",children:[pt.jsx(io,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),pt.jsx("h3",{className:"text-lg font-medium mb-2",children:"Transaction Queued!"}),pt.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Your transaction will be synced when you're back online."})]}):pt.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),o.description&&o.amount&&o.category&&o.accountId){l(!0),g(null);try{const e={id:`offline-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,description:o.description,amount:parseFloat(o.amount)*("expense"===o.type?-1:1),category:o.category,accountId:o.accountId,date:o.date,tags:o.tags,notes:o.notes,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),isOffline:!0};await n({type:"create",entity:"transaction",data:e}),u(!0),setTimeout(()=>{i({description:"",amount:"",type:"expense",category:"",accountId:"",date:(new Date).toISOString().split("T")[0],tags:[],notes:""}),u(!1),a&&a(),t()},1500)}catch(r){g(r.message||"Failed to queue transaction")}finally{l(!1)}}else g("Please fill in all required fields")},className:"p-4 space-y-4",children:[m&&pt.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-sm text-red-700 dark:text-red-300",children:[pt.jsx(vo,{className:"h-4 w-4"}),m]}),pt.jsxs("div",{className:"flex gap-2",children:[pt.jsx("button",{type:"button",onClick:()=>i({...o,type:"expense"}),className:"flex-1 py-2 px-4 rounded-lg font-medium transition-colors "+("expense"===o.type?"bg-red-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:"Expense"}),pt.jsx("button",{type:"button",onClick:()=>i({...o,type:"income"}),className:"flex-1 py-2 px-4 rounded-lg font-medium transition-colors "+("income"===o.type?"bg-green-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:"Income"})]}),pt.jsxs("div",{children:[pt.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Description ",pt.jsx("span",{className:"text-red-500",children:"*"})]}),pt.jsxs("div",{className:"relative",children:[pt.jsx(Go,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),pt.jsx("input",{type:"text",value:o.description,onChange:e=>i({...o,description:e.target.value}),className:"w-full pl-10 pr-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",placeholder:"What did you spend on?",required:!0})]})]}),pt.jsxs("div",{children:[pt.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Amount ",pt.jsx("span",{className:"text-red-500",children:"*"})]}),pt.jsxs("div",{className:"relative",children:[pt.jsx(Co,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),pt.jsx("input",{type:"number",step:"0.01",value:o.amount,onChange:e=>i({...o,amount:e.target.value}),className:"w-full pl-10 pr-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",placeholder:"0.00",required:!0})]})]}),pt.jsxs("div",{children:[pt.jsx("label",{className:"block text-sm font-medium mb-1",children:"Date"}),pt.jsxs("div",{className:"relative",children:[pt.jsx(Wo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),pt.jsx("input",{type:"date",value:o.date,onChange:e=>i({...o,date:e.target.value}),className:"w-full pl-10 pr-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600"})]})]}),pt.jsxs("div",{children:[pt.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Category ",pt.jsx("span",{className:"text-red-500",children:"*"})]}),pt.jsxs("select",{value:o.category,onChange:e=>i({...o,category:e.target.value}),className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",required:!0,children:[pt.jsx("option",{value:"",children:"Select a category"}),r.map(e=>pt.jsxs("option",{value:e.id,children:[e.icon," ",e.name]},e.id))]})]}),pt.jsxs("div",{children:[pt.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Account ",pt.jsx("span",{className:"text-red-500",children:"*"})]}),pt.jsxs("select",{value:o.accountId,onChange:e=>i({...o,accountId:e.target.value}),className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",required:!0,children:[pt.jsx("option",{value:"",children:"Select an account"}),s.map(e=>pt.jsxs("option",{value:e.id,children:[e.name," (",de(e.balance),")"]},e.id))]})]}),pt.jsxs("div",{children:[pt.jsx("label",{className:"block text-sm font-medium mb-1",children:"Notes"}),pt.jsx("textarea",{value:o.notes,onChange:e=>i({...o,notes:e.target.value}),className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",rows:3,placeholder:"Add any additional notes..."})]}),pt.jsxs("div",{className:"flex gap-3 pt-4",children:[pt.jsx("button",{type:"button",onClick:t,className:"flex-1 py-2 px-4 border border-gray-300 dark:border-gray-600 rounded-lg font-medium hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"}),pt.jsx("button",{type:"submit",disabled:c,className:"flex-1 py-2 px-4 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Queuing...":"Add Transaction"})]})]})]})}):null},Wl=()=>{const e=$l(),[t,a]=Gn.useState(!1);return e.isOffline||0!==e.pendingChanges?pt.jsxs(pt.Fragment,{children:[pt.jsx("button",{onClick:()=>a(!0),className:"fixed bottom-20 right-4 z-40 bg-blue-600 hover:bg-blue-700 text-white rounded-full p-4 shadow-lg transition-all transform hover:scale-110",title:"Add transaction (offline)",children:pt.jsxs("div",{className:"relative",children:[pt.jsx(Vi,{className:"h-6 w-6"}),e.isOffline&&pt.jsx(Mi,{className:"absolute -top-2 -right-2 h-4 w-4 text-orange-400"})]})}),pt.jsx(Hl,{isOpen:t,onClose:()=>a(!1),onSuccess:()=>{}})]}):null},Yl={account:[{field:"balance",strategy:"serverWins"},{field:"name",strategy:"newer"},{field:"type",strategy:"newer"},{field:"currency",strategy:"newer"},{field:"is_active",strategy:"serverWins"}],transaction:[{field:"amount",strategy:"newer"},{field:"description",strategy:"newer"},{field:"category",strategy:"newer"},{field:"date",strategy:"newer"},{field:"cleared",strategy:"max"},{field:"tags",strategy:"union"},{field:"notes",strategy:"concat"},{field:"reconciled",strategy:"max"}],budget:[{field:"amount",strategy:"min"},{field:"spent",strategy:"sum"},{field:"category",strategy:"newer"},{field:"period",strategy:"newer"},{field:"rollover",strategy:"newer"}],goal:[{field:"targetAmount",strategy:"newer"},{field:"currentAmount",strategy:"sum"},{field:"deadline",strategy:"newer"},{field:"name",strategy:"newer"},{field:"achieved",strategy:"max"}]};class Vl{static analyzeConflict(e,t,a,n,r){if(Qn.isEqual(t,a))return{hasConflict:!1,conflictingFields:[],nonConflictingFields:[],canAutoResolve:!0,suggestedResolution:"merge",mergedData:t,confidence:100};const s=this.getChangedFields(t,a),o=this.categorizeChanges(e,t,a,s,n,r);return o.canAutoResolve&&(o.mergedData=this.performSmartMerge(e,t,a,o,n,r)),o}static getChangedFields(e,t){const a=new Set([...Object.keys(e),...Object.keys(t)]),n=[];for(const r of a)["id","user_id","created_at","sync_version"].includes(r)||Qn.isEqual(e[r],t[r])||n.push(r);return n}static categorizeChanges(e,t,a,n,r,s){const o=[],i=[];let c=!0,l=100;for(const u of n){const n=t[u],r=a[u];if(this.isNonConflictingChange(u,n,r,e))i.push(u);else{o.push(u);const t=this.getMergeRule(e,u);t&&"manual"!==t.strategy?l=Math.max(0,l-10):(c=!1,l=0)}}let d="manual";return 0===n.length?(d="merge",l=100):0===o.length?(d="merge",l=95):c?(d="merge",l=Math.max(l,70)):r>s?(d="client",l=50):(d="server",l=50),{hasConflict:o.length>0,conflictingFields:o,nonConflictingFields:i,canAutoResolve:c,suggestedResolution:d,confidence:l}}static isNonConflictingChange(e,t,a,n){return null==t&&null!=a||null!=t&&null==a||!(!Array.isArray(t)||!Array.isArray(a))||!!["notes","description","memo"].includes(e)||"boolean"==typeof t&&"boolean"==typeof a}static getMergeRule(e,t){const a=Yl[e];if(a)return a.find(e=>e.field===t)}static performSmartMerge(e,t,a,n,r,s){const o={...a};for(const i of n.nonConflictingFields){const n=t[i],c=a[i];o[i]=this.mergeFieldValue(i,n,c,e,r,s)}for(const i of n.conflictingFields){const n=this.getMergeRule(e,i);o[i]=n?this.applyMergeRule(n,t[i],a[i],r,s):r>s?t[i]:a[i]}return o.updated_at=Math.max(r,s),o}static mergeFieldValue(e,t,a,n,r,s){if(null==t)return a;if(null==a)return t;if(Array.isArray(t)&&Array.isArray(a))return[...new Set([...t,...a])];if(["notes","description","memo"].includes(e)){if(t===a)return t;const e=new Date(r).toLocaleString();return new Date(s).toLocaleString(),`${a}\n---\n[Added ${e}]: ${t}`}return"boolean"==typeof t&&"boolean"==typeof a?t||a:r>s?t:a}static applyMergeRule(e,t,a,n,r){if(e.condition&&!e.condition(t,a))return a;switch(e.strategy){case"newer":return n>r?t:a;case"older":return n<r?t:a;case"sum":return(Number(t)||0)+(Number(a)||0);case"min":return Math.min(Number(t)||0,Number(a)||0);case"max":return Math.max(Number(t)||0,Number(a)||0);case"concat":return t===a?t:`${a}\n${t}`;case"union":return Array.isArray(t)&&Array.isArray(a)?[...new Set([...t,...a])]:a;case"clientWins":return t;default:return a}}static generateConflictSummary(e){if(!e.hasConflict)return"No conflicts detected - changes can be merged automatically.";const t=[];return e.conflictingFields.length>0&&t.push(`Conflicting fields: ${e.conflictingFields.join(", ")}`),e.nonConflictingFields.length>0&&t.push(`Compatible changes: ${e.nonConflictingFields.join(", ")}`),e.canAutoResolve?t.push(`Automatic resolution available (${e.confidence}% confidence)`):t.push("Manual resolution required"),t.join("\n")}static requiresUserIntervention(e,t){const a=t?.autoResolveThreshold||70;if(e.confidence<a)return!0;const n=["amount","balance","targetAmount"];return!!(e.conflictingFields.some(e=>n.includes(e))&&e.confidence<90)||!e.canAutoResolve}}const Ql=({isOpen:e,onClose:t,conflict:a,analysis:n,onResolve:r})=>{const[s,o]=gt.useState("merge"),[i,c]=gt.useState({}),[l,d]=gt.useState(!1),[u,m]=gt.useState(null),[g,p]=gt.useState(!1);if(gt.useEffect(()=>{if(a&&!n){const e=Vl.analyzeConflict(a.entity,a.clientData,a.serverData,a.clientTimestamp||Date.now(),a.serverTimestamp||Date.now());m(e),e.canAutoResolve&&e.mergedData?o("merge"):o("client"===e.suggestedResolution?"client":"server")}else n&&(m(n),n.canAutoResolve&&n.mergedData&&o("merge"))},[a,n]),!a||!u)return null;const h=(e,t)=>null==t?"(empty)":e.includes("amount")||e.includes("balance")||"spent"===e?de(t):e.includes("date")||e.includes("_at")?Cr(new Date(t),"PP"):Array.isArray(t)?t.join(", ")||"(none)":"boolean"==typeof t?t?"Yes":"No":String(t);return pt.jsx(Se,{isOpen:e,onClose:t,title:"Resolve Data Sync Conflict",maxWidth:"max-w-3xl",children:pt.jsxs("div",{className:"space-y-6",children:[u.canAutoResolve&&pt.jsxs("div",{className:"flex items-start gap-3 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[pt.jsx(Jl,{className:"h-5 w-5 text-green-600 dark:text-green-400 flex-shrink-0 mt-0.5"}),pt.jsxs("div",{className:"flex-1",children:[pt.jsx("h3",{className:"font-medium text-green-900 dark:text-green-100",children:"Smart Resolution Available"}),pt.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300 mt-1",children:["We can automatically merge these changes with ",u.confidence,"% confidence.",u.conflictingFields.length>0&&` ${u.conflictingFields.length} field(s) have conflicts but can be resolved intelligently.`]})]})]}),!u.canAutoResolve&&pt.jsxs("div",{className:"flex items-start gap-3 p-4 bg-amber-50 dark:bg-amber-900/20 rounded-lg",children:[pt.jsx(So,{className:"h-5 w-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5"}),pt.jsxs("div",{className:"flex-1",children:[pt.jsx("h3",{className:"font-medium text-amber-900 dark:text-amber-100",children:"Manual Resolution Required"}),pt.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 mt-1",children:["This ",a.entity," was modified in incompatible ways. Please review the changes and choose how to resolve."]})]})]}),pt.jsxs("div",{className:"space-y-3",children:[pt.jsxs("div",{className:"flex items-center justify-between",children:[pt.jsx("h4",{className:"font-medium",children:"Resolution Strategy"}),pt.jsxs("button",{onClick:()=>p(!g),className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:[g?"Hide":"Show"," Advanced Options"]})]}),pt.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[u.canAutoResolve&&pt.jsxs("button",{onClick:()=>o("merge"),className:"p-3 rounded-lg border-2 transition-all "+("merge"===s?"border-purple-500 bg-purple-50 dark:bg-purple-900/30":"border-gray-200 dark:border-gray-700 hover:border-gray-300"),children:[pt.jsx(Ei,{className:"h-6 w-6 mx-auto mb-2 text-purple-600 dark:text-purple-400"}),pt.jsx("div",{className:"text-sm font-medium",children:"Smart Merge"}),pt.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Intelligently combine changes"})]}),pt.jsxs("button",{onClick:()=>o("client"),className:"p-3 rounded-lg border-2 transition-all "+("client"===s?"border-blue-500 bg-blue-50 dark:bg-blue-900/30":"border-gray-200 dark:border-gray-700 hover:border-gray-300"),children:[pt.jsx("div",{className:"text-2xl mb-2",children:"\ud83d\udcbb"}),pt.jsx("div",{className:"text-sm font-medium",children:"Keep Your Version"}),pt.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Use your local changes"})]}),pt.jsxs("button",{onClick:()=>o("server"),className:"p-3 rounded-lg border-2 transition-all "+("server"===s?"border-green-500 bg-green-50 dark:bg-green-900/30":"border-gray-200 dark:border-gray-700 hover:border-gray-300"),children:[pt.jsx("div",{className:"text-2xl mb-2",children:"\u2601\ufe0f"}),pt.jsx("div",{className:"text-sm font-medium",children:"Keep Server Version"}),pt.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Use server changes"})]})]})]}),pt.jsx("div",{className:"max-h-96 overflow-y-auto",children:(()=>{const e=new Set([...Object.keys(a.clientData||{}),...Object.keys(a.serverData||{})]),t=Array.from(e).filter(e=>!["id","user_id","created_at","updated_at","sync_version"].includes(e));return pt.jsx("div",{className:"space-y-2",children:t.map(e=>{const t=a.clientData?.[e],n=a.serverData?.[e],r=t!==n,o=u.conflictingFields.includes(e),l=i[e]||(u.mergedData?.[e]===t?"client":"server");return pt.jsxs("div",{className:"border rounded-lg p-3 "+(r?o?"border-amber-300 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/20":"border-blue-300 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700"),children:[pt.jsxs("div",{className:"flex items-center justify-between mb-2",children:[pt.jsx("span",{className:"font-medium text-sm capitalize",children:e.replace(/_/g," ")}),r&&pt.jsxs("div",{className:"flex items-center gap-2",children:[o?pt.jsx("span",{className:"text-xs px-2 py-1 bg-amber-200 text-amber-800 dark:bg-amber-800 dark:text-amber-200 rounded",children:"Conflict"}):pt.jsx("span",{className:"text-xs px-2 py-1 bg-green-200 text-green-800 dark:bg-green-800 dark:text-green-200 rounded",children:"Compatible"}),g&&pt.jsxs("button",{onClick:()=>(e=>{c(t=>({...t,[e]:"client"===t[e]?"server":"client"}))})(e),className:"text-xs px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600",children:["Use ","client"===l?"Server":"Your"," Version"]})]})]}),pt.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[pt.jsxs("div",{className:"p-2 rounded "+("client"===l&&r?"bg-blue-100 dark:bg-blue-900/30 ring-2 ring-blue-400":"bg-gray-50 dark:bg-gray-800"),children:[pt.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Your Version"}),pt.jsx("div",{className:"font-mono text-xs",children:h(e,t)})]}),pt.jsxs("div",{className:"p-2 rounded "+("server"===l&&r?"bg-green-100 dark:bg-green-900/30 ring-2 ring-green-400":"bg-gray-50 dark:bg-gray-800"),children:[pt.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Server Version"}),pt.jsx("div",{className:"font-mono text-xs",children:h(e,n)})]})]}),"merge"===s&&u.mergedData&&r&&pt.jsxs("div",{className:"mt-2 p-2 bg-purple-50 dark:bg-purple-900/20 rounded",children:[pt.jsxs("div",{className:"text-xs text-purple-700 dark:text-purple-300 mb-1 flex items-center gap-1",children:[pt.jsx(Jl,{className:"h-3 w-3"}),"Smart Merge Result:"]}),pt.jsx("div",{className:"font-mono text-xs",children:h(e,u.mergedData[e])})]})]},e)})})})()}),"merge"===s&&u.mergedData&&pt.jsx("div",{className:"p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg",children:pt.jsx("p",{className:"text-sm text-purple-700 dark:text-purple-300",children:Vl.generateConflictSummary(u)})}),pt.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[pt.jsx("button",{onClick:t,disabled:l,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:"Cancel"}),pt.jsx("button",{onClick:async()=>{d(!0);try{let e;if("merge"===s)if(g&&Object.keys(i).length>0){e={...a.serverData};for(const[t,n]of Object.entries(i))e[t]="client"===n?a.clientData[t]:a.serverData[t]}else e=u.mergedData;else e="client"===s?a.clientData:a.serverData;await r(s,e),t()}catch(e){console.error("Failed to resolve conflict:",e)}finally{d(!1)}},disabled:l,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:l?pt.jsx(pt.Fragment,{children:"Resolving..."}):pt.jsxs(pt.Fragment,{children:[pt.jsx(so,{className:"h-4 w-4"}),"Apply ","merge"===s?"Smart Merge":"Resolution"]})})]})]})})},Jl=({className:e})=>pt.jsx("svg",{className:e,fill:"currentColor",viewBox:"0 0 24 24",children:pt.jsx("path",{d:"M7 11L6 8l-3-1 3-1 1-3 1 3 3 1-3 1-1 3zm5 8l-1-2.5L8.5 15l2.5-1 1-2.5 1 2.5 2.5 1-2.5 1.5L12 19zm7-15l-1 3-3 1 3 1 1 3 1-3 3-1-3-1-1-3z"})}),Kl=new class{socket=null;clientId;syncQueue=[];conflicts=[];vectorClocks=new Map;listeners=new Map;syncStatus={isConnected:!1,isSyncing:!1,pendingOperations:0,conflicts:[]};syncInterval=null;reconnectAttempts=0;maxReconnectAttempts=5;baseReconnectDelay=1e3;constructor(){this.clientId=this.getOrCreateClientId(),this.loadQueueFromStorage(),this.initializeSync()}getOrCreateClientId(){let e=localStorage.getItem("syncClientId");return e||(e=Bn(),localStorage.setItem("syncClientId",e)),e}loadQueueFromStorage(){try{const e=localStorage.getItem("syncQueue");if(e){const t=JSON.parse(e);this.syncQueue=t.map(e=>({operation:e.operation,retryCount:0,maxRetries:3})),this.syncStatus.pendingOperations=this.syncQueue.length}}catch(e){console.error("Failed to load sync queue:",e)}}saveQueueToStorage(){try{localStorage.setItem("syncQueue",JSON.stringify(this.syncQueue))}catch(e){console.error("Failed to save sync queue:",e)}}initializeSync(){}connect(){}getAuthToken(){return localStorage.getItem("authToken")}setupSocketListeners(){this.socket&&(this.socket.on("connect",()=>{this.syncStatus.isConnected=!0,this.reconnectAttempts=0,this.emit("status-changed",this.syncStatus),this.processSyncQueue()}),this.socket.on("disconnect",()=>{this.syncStatus.isConnected=!1,this.emit("status-changed",this.syncStatus)}),this.socket.on("sync-update",e=>{this.handleRemoteUpdate(e)}),this.socket.on("sync-conflict",e=>{this.handleConflict(e)}),this.socket.on("sync-ack",e=>{this.handleSyncAck(e)}),this.socket.on("error",e=>{console.error("Sync socket error:",e),this.syncStatus.error=e.message,this.emit("status-changed",this.syncStatus)}))}handleConnectionError(){if(this.reconnectAttempts++,this.reconnectAttempts<this.maxReconnectAttempts){const e=this.baseReconnectDelay*Math.pow(2,this.reconnectAttempts);setTimeout(()=>this.connect(),e)}else console.error("Max reconnection attempts reached, running in offline mode"),this.syncStatus.error="Unable to connect to sync server",this.emit("status-changed",this.syncStatus)}startSyncInterval(){this.syncInterval=setInterval(()=>{this.syncQueue.length>0&&this.syncStatus.isConnected&&!this.syncStatus.isSyncing&&this.processSyncQueue()},5e3)}async queueOperation(e,t,a,n){const r={operation:{id:Bn(),type:e,entity:t,entityId:a,data:n,timestamp:Date.now(),clientId:this.clientId,version:this.getNextVersion(a)},retryCount:0,maxRetries:3};this.syncQueue.push(r),this.syncStatus.pendingOperations=this.syncQueue.length,this.saveQueueToStorage(),this.emit("status-changed",this.syncStatus),this.syncStatus.isConnected&&!this.syncStatus.isSyncing&&this.processSyncQueue()}async processSyncQueue(){if(0===this.syncQueue.length||!this.socket||!this.syncStatus.isConnected)return;this.syncStatus.isSyncing=!0,this.emit("status-changed",this.syncStatus);const e=this.syncQueue.slice(0,10);for(const a of e)try{await this.sendOperation(a.operation),this.syncQueue=this.syncQueue.filter(e=>e.operation.id!==a.operation.id)}catch(t){console.error("Failed to send operation:",t),a.retryCount++,a.retryCount>=a.maxRetries&&(console.error("Operation failed after max retries:",a.operation),this.syncQueue=this.syncQueue.filter(e=>e.operation.id!==a.operation.id),this.emit("sync-failed",a.operation))}this.syncStatus.isSyncing=!1,this.syncStatus.pendingOperations=this.syncQueue.length,this.syncStatus.lastSyncTime=new Date,this.saveQueueToStorage(),this.emit("status-changed",this.syncStatus)}sendOperation(e){return new Promise((t,a)=>{if(!this.socket)return void a(new Error("Socket not connected"));const n=setTimeout(()=>{a(new Error("Operation timeout"))},1e4);this.socket.emit("sync-operation",e,e=>{clearTimeout(n),e.success?t():a(new Error(e.error))})})}handleRemoteUpdate(e){const t=this.getVersion(e.entityId);if(t&&t>=e.version){const a={id:Bn(),localOperation:{...e,version:t},remoteOperation:e};this.handleConflict(a)}else this.applyRemoteOperation(e),this.updateVectorClock(e.entityId,e.clientId,e.version)}handleConflict(e){const t=Vl.analyzeConflict(e.localOperation.entity,e.localOperation.data,e.remoteOperation.data,e.localOperation.timestamp,e.remoteOperation.timestamp);if(!Vl.requiresUserIntervention(t)&&t.canAutoResolve)t.mergedData&&(this.applyMergedData(e.localOperation.entity,e.localOperation.entityId,t.mergedData),this.updateVectorClock(e.localOperation.entityId,e.remoteOperation.clientId,Math.max(e.localOperation.version,e.remoteOperation.version)+1)),this.emit("conflict-auto-resolved",{conflict:e,analysis:t,resolution:"merge"});else if(this.conflicts.push(e),this.syncStatus.conflicts=this.conflicts,this.emit("status-changed",this.syncStatus),this.emit("conflict-detected",{conflict:e,analysis:t}),t.confidence>=50&&"manual"!==t.suggestedResolution){const a=this.autoResolveConflict(e,t);a&&this.resolveConflict(e.id,a,t.mergedData)}}autoResolveConflict(e,t){if(t&&t.suggestedResolution)switch(t.suggestedResolution){case"client":return"local";case"server":return"remote";case"merge":return t.mergedData?"merge":null;default:return null}return e.localOperation.timestamp>e.remoteOperation.timestamp?"local":(e.remoteOperation.timestamp,e.localOperation.timestamp,"remote")}resolveConflict(e,t,a){const n=this.conflicts.find(t=>t.id===e);if(n){switch(n.resolution=t,t){case"local":this.queueOperation(n.localOperation.type,n.localOperation.entity,n.localOperation.entityId,n.localOperation.data);break;case"remote":this.applyRemoteOperation(n.remoteOperation);break;case"merge":a&&(n.mergedData=a,this.applyMergedData(n.remoteOperation.entity,n.remoteOperation.entityId,a))}this.conflicts=this.conflicts.filter(t=>t.id!==e),this.syncStatus.conflicts=this.conflicts,this.emit("status-changed",this.syncStatus)}}applyRemoteOperation(e){this.emit(`remote-${e.type.toLowerCase()}`,{entity:e.entity,entityId:e.entityId,data:e.data})}applyMergedData(e,t,a){this.emit("remote-merge",{entity:e,entityId:t,data:a})}handleSyncAck(e){this.syncQueue=this.syncQueue.filter(t=>t.operation.id!==e),this.syncStatus.pendingOperations=this.syncQueue.length,this.saveQueueToStorage(),this.emit("status-changed",this.syncStatus)}getVersion(e){const t=this.vectorClocks.get(e);if(!t)return null;let a=0;for(const n of Object.values(t))a=Math.max(a,n);return a}getNextVersion(e){return(this.getVersion(e)||0)+1}updateVectorClock(e,t,a){let n=this.vectorClocks.get(e);n||(n={},this.vectorClocks.set(e,n)),n[t]=a}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){const a=this.listeners.get(e);a&&a.delete(t)}emit(e,t){const a=this.listeners.get(e);a&&a.forEach(e=>e(t))}getStatus(){return{...this.syncStatus}}forceSync(){this.syncStatus.isConnected&&!this.syncStatus.isSyncing&&this.processSyncQueue()}clearQueue(){this.syncQueue=[],this.syncStatus.pendingOperations=0,this.saveQueueToStorage(),this.emit("status-changed",this.syncStatus)}getConflicts(){return[...this.conflicts]}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null),this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null),this.syncStatus.isConnected=!1,this.emit("status-changed",this.syncStatus)}},Zl=new class{subscriptions=new Map;connectionState={isConnected:!1,isReconnecting:!1,lastConnected:null,lastDisconnected:null,connectionCount:0};connectionCallbacks=new Set;reconnectTimeout=null;reconnectAttempts=0;maxReconnectAttempts=5;reconnectDelay=1e3;isInitialized=!1;initialize(){!this.isInitialized&&Fr&&(this.isInitialized=!0,this.setupConnectionMonitoring())}setupConnectionMonitoring(){Fr&&this.handleConnectionChange(!0)}handleConnectionChange(e){const t=new Date,a=this.connectionState.isConnected;this.connectionState={...this.connectionState,isConnected:e,isReconnecting:!1,lastConnected:e?t:this.connectionState.lastConnected,lastDisconnected:e?this.connectionState.lastDisconnected:t,connectionCount:e&&!a?this.connectionState.connectionCount+1:this.connectionState.connectionCount},e&&this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null,this.reconnectAttempts=0),e||this.reconnectTimeout||this.scheduleReconnect(),this.notifyConnectionCallbacks()}scheduleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts)return;this.connectionState.isReconnecting=!0,this.notifyConnectionCallbacks();const e=this.reconnectDelay*Math.pow(2,this.reconnectAttempts);this.reconnectTimeout=setTimeout(()=>{this.reconnectAttempts++,this.reconnectAllSubscriptions()},e)}reconnectAllSubscriptions(){Fr&&Array.from(this.subscriptions.keys()).forEach(e=>{const t=this.subscriptions.get(e);if(t){t.unsubscribe(),this.subscriptions.delete(e);const[a,n]=e.split(":");this.reestablishSubscription(a,n)}})}reestablishSubscription(e,t){}async subscribeToAccounts(e,t,a={}){if(!Fr||!e)return null;let n=e;if(e.startsWith("user_")){const t=await es.getDatabaseUserId(e);if(!t)return console.error("[RealtimeService] Could not resolve database ID for Clerk ID:",e),null;n=t}const r=`accounts:${n}`;this.unsubscribe(r);const s=Fr.channel(`accounts_${n}`).on("postgres_changes",{event:"*",schema:"public",table:"accounts",filter:`user_id=eq.${n}`},e=>{const a={eventType:e.eventType,new:e.new,old:e.old,table:e.table,schema:e.schema};t(a)}).subscribe((e,t)=>{"SUBSCRIBED"===e?this.handleConnectionChange(!0):"CHANNEL_ERROR"!==e&&"TIMED_OUT"!==e||(console.error(`Accounts subscription error: ${t?.message||e}`),this.handleConnectionChange(!1))});return this.subscriptions.set(r,s),r}async subscribeToTransactions(e,t,a={}){if(!Fr||!e)return null;let n=e;if(e.startsWith("user_")){const t=await es.getDatabaseUserId(e);if(!t)return console.error("[RealtimeService] Could not resolve database ID for Clerk ID:",e),null;n=t}const r=`transactions:${n}`;this.unsubscribe(r);const s=Fr.channel(`transactions_${n}`).on("postgres_changes",{event:"*",schema:"public",table:"transactions",filter:`user_id=eq.${n}`},e=>{const a={eventType:e.eventType,new:e.new,old:e.old,table:e.table,schema:e.schema};t(a)}).subscribe((e,t)=>{"SUBSCRIBED"===e?this.handleConnectionChange(!0):"CHANNEL_ERROR"!==e&&"TIMED_OUT"!==e||(console.error(`Transactions subscription error: ${t?.message||e}`),this.handleConnectionChange(!1))});return this.subscriptions.set(r,s),r}async subscribeToBudgets(e,t,a={}){if(!Fr||!e)return null;let n=e;if(e.startsWith("user_")){const t=await es.getDatabaseUserId(e);if(!t)return console.error("[RealtimeService] Could not resolve database ID for Clerk ID:",e),null;n=t}const r=`budgets:${n}`;this.unsubscribe(r);const s=Fr.channel(`budgets_${n}`).on("postgres_changes",{event:"*",schema:"public",table:"budgets",filter:`user_id=eq.${n}`},e=>{const a={eventType:e.eventType,new:e.new,old:e.old,table:e.table,schema:e.schema};t(a)}).subscribe((e,t)=>{"SUBSCRIBED"===e?this.handleConnectionChange(!0):"CHANNEL_ERROR"!==e&&"TIMED_OUT"!==e||(console.error(`Budgets subscription error: ${t?.message||e}`),this.handleConnectionChange(!1))});return this.subscriptions.set(r,s),r}async subscribeToGoals(e,t,a={}){if(!Fr||!e)return null;let n=e;if(e.startsWith("user_")){const t=await es.getDatabaseUserId(e);if(!t)return console.error("[RealtimeService] Could not resolve database ID for Clerk ID:",e),null;n=t}const r=`goals:${n}`;this.unsubscribe(r);const s=Fr.channel(`goals_${n}`).on("postgres_changes",{event:"*",schema:"public",table:"goals",filter:`user_id=eq.${userId}`},e=>{const a={eventType:e.eventType,new:e.new,old:e.old,table:e.table,schema:e.schema};t(a)}).subscribe((e,t)=>{"SUBSCRIBED"===e?this.handleConnectionChange(!0):"CHANNEL_ERROR"!==e&&"TIMED_OUT"!==e||(console.error(`Goals subscription error: ${t?.message||e}`),this.handleConnectionChange(!1))});return this.subscriptions.set(r,s),r}unsubscribe(e){const t=this.subscriptions.get(e);t&&(t.unsubscribe(),this.subscriptions.delete(e))}unsubscribeAll(){this.subscriptions.forEach((e,t)=>{e.unsubscribe()}),this.subscriptions.clear(),this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.connectionState.isConnected=!1,this.connectionState.isReconnecting=!1,this.notifyConnectionCallbacks()}onConnectionChange(e){return this.connectionCallbacks.add(e),e(this.connectionState),()=>{this.connectionCallbacks.delete(e)}}notifyConnectionCallbacks(){this.connectionCallbacks.forEach(e=>{try{e(this.connectionState)}catch(t){console.error("Error in connection callback:",t)}})}getConnectionState(){return{...this.connectionState}}getSubscriptionCount(){return this.subscriptions.size}forceReconnect(){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.reconnectAttempts=0,this.scheduleReconnect()}destroy(){this.unsubscribeAll(),this.connectionCallbacks.clear(),this.isInitialized=!1,this.reconnectAttempts=0,this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null)}},Xl=[{to:"/",icon:qs,label:"Home"},{to:"/accounts",icon:Ys,label:"Accounts"},{to:"/transactions",icon:Js,label:"Transactions"},{to:"/budget",icon:Xs,label:"Budget"},{to:"/goals",icon:Hs,label:"Goals"}],ed=e=>pt.jsxs(Al,{...e,children:[pt.jsx("path",{d:"M12 5V19",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),pt.jsx("path",{d:"M5 12H19",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]});let td=null;const ad={GBP:"\xa3",USD:"$",EUR:"\u20ac",CAD:"$",AUD:"$",JPY:"\xa5",CHF:"CHF",CNY:"\xa5",INR:"\u20b9",NZD:"$"},nd={GBP:1,USD:1.25,EUR:1.176470588},rd=[{code:"GBP",name:"British Pound",symbol:"\xa3"},{code:"USD",name:"US Dollar",symbol:"$"},{code:"EUR",name:"Euro",symbol:"\u20ac"},{code:"CAD",name:"Canadian Dollar",symbol:"$"},{code:"AUD",name:"Australian Dollar",symbol:"$"},{code:"JPY",name:"Japanese Yen",symbol:"\xa5"},{code:"CHF",name:"Swiss Franc",symbol:"CHF"},{code:"CNY",name:"Chinese Yuan",symbol:"\xa5"},{code:"INR",name:"Indian Rupee",symbol:"\u20b9"},{code:"NZD",name:"New Zealand Dollar",symbol:"$"}],sd={ALLOWED_TAGS:[],ALLOWED_ATTR:[],ALLOW_DATA_ATTR:!1,KEEP_CONTENT:!0},od=e=>e?Jn.sanitize(e,sd):"",id=e=>{if(!e)return"";let t=Jn.sanitize(e,sd);return t=t.replace(/\[([^\]]+)\]\(((?:[^)(]|\([^)]*\))*)\)/gi,(e,t,a)=>{const n=a.toLowerCase().trim();return n.startsWith("javascript:")||n.startsWith("data:")||n.startsWith("vbscript:")?`[${t}]()`:e}),t};"undefined"!=typeof window&&Jn.addHook("afterSanitizeAttributes",e=>{"target"in e&&"_blank"===e.getAttribute("target")&&e.setAttribute("rel","noopener noreferrer")});const cd=sr().refine(e=>{try{return new Rn(e),!0}catch{return!1}},{message:"Invalid decimal number"}),ld=rr({id:sr().uuid().optional(),date:sr().regex(/^\d{4}-\d{2}-\d{2}$/,"Date must be in YYYY-MM-DD format"),description:sr().min(1,"Description is required").max(500,"Description must be less than 500 characters").transform(e=>od(e.trim())),amount:cd.refine(e=>new Rn(e).abs().gt(0),{message:"Amount must be greater than 0"}),type:ir(["income","expense"]),category:sr().min(1,"Category is required"),subcategory:sr().optional(),accountId:sr().uuid("Invalid account ID"),tags:lr(sr().transform(e=>od(e))).optional(),notes:sr().max(1e3,"Notes must be less than 1000 characters").transform(e=>e?id(e):e).optional(),attachments:lr(sr()).optional(),isRecurring:or().optional(),recurringId:sr().uuid().optional(),location:rr({latitude:cr().min(-90).max(90).optional(),longitude:cr().min(-180).max(180).optional(),address:sr().optional()}).optional(),merchant:sr().max(200,"Merchant name must be less than 200 characters").optional(),paymentMethod:ir(["cash","credit","debit","transfer","check","other"]).optional(),status:ir(["pending","cleared","reconciled"]).optional(),taxDeductible:or().optional(),createdAt:sr().optional(),updatedAt:sr().optional()}),dd=rr({id:sr().uuid().optional(),name:sr().min(1,"Account name is required").max(100,"Account name must be less than 100 characters").transform(e=>od(e.trim())),type:ir(["checking","savings","credit_card","investment","loan","asset","other"]),balance:cd,currency:sr().length(3,"Currency must be a 3-letter code").toUpperCase().default("USD"),institution:sr().max(200,"Institution name must be less than 200 characters").transform(e=>e?od(e):e).optional(),accountNumber:sr().max(50,"Account number must be less than 50 characters").transform(e=>e?od(e):e).optional(),isActive:or().default(!0),color:sr().regex(/^#[0-9A-Fa-f]{6}$/,"Color must be a valid hex code").optional(),notes:sr().max(1e3,"Notes must be less than 1000 characters").transform(e=>e?id(e):e).optional(),createdAt:sr().optional(),updatedAt:sr().optional()}),ud=rr({id:sr().uuid().optional(),name:sr().min(1,"Budget name is required").max(100,"Budget name must be less than 100 characters").transform(e=>od(e.trim())),category:sr().min(1,"Category is required"),amount:cd.refine(e=>new Rn(e).gte(0),{message:"Budget amount must be non-negative"}),period:ir(["daily","weekly","monthly","quarterly","yearly"]),startDate:sr().regex(/^\d{4}-\d{2}-\d{2}$/,"Start date must be in YYYY-MM-DD format"),endDate:sr().regex(/^\d{4}-\d{2}-\d{2}$/,"End date must be in YYYY-MM-DD format").optional(),alertThreshold:cr().min(0,"Alert threshold must be between 0 and 100").max(100,"Alert threshold must be between 0 and 100").optional(),notes:sr().max(1e3,"Notes must be less than 1000 characters").optional(),isActive:or().default(!0),createdAt:sr().optional(),updatedAt:sr().optional()}),md=rr({id:sr().uuid().optional(),name:sr().min(1,"Goal name is required").max(100,"Goal name must be less than 100 characters").transform(e=>e.trim()),targetAmount:cd.refine(e=>new Rn(e).gt(0),{message:"Target amount must be greater than 0"}),currentAmount:cd.default("0"),targetDate:sr().regex(/^\d{4}-\d{2}-\d{2}$/,"Target date must be in YYYY-MM-DD format"),category:ir(["emergency_fund","vacation","home","car","education","retirement","other"]),priority:ir(["low","medium","high"]),description:sr().max(500,"Description must be less than 500 characters").optional(),isActive:or().default(!0),createdAt:sr().optional(),updatedAt:sr().optional()}),gd=rr({id:sr().uuid().optional(),name:sr().min(1,"Category name is required").max(50,"Category name must be less than 50 characters").transform(e=>e.trim()),type:ir(["income","expense","both"]),color:sr().regex(/^#[0-9A-Fa-f]{6}$/,"Color must be a valid hex code").optional(),icon:sr().max(50,"Icon name must be less than 50 characters").optional(),parentId:sr().uuid().optional(),isActive:or().default(!0),order:cr().int().min(0).optional()}),pd=rr({id:sr().uuid().optional(),name:sr().min(1,"Tag name is required").max(30,"Tag name must be less than 30 characters").transform(e=>e.trim().toLowerCase()),color:sr().regex(/^#[0-9A-Fa-f]{6}$/,"Color must be a valid hex code").optional()}),hd=rr({date:sr(),description:sr(),amount:sr(),category:sr().optional(),accountName:sr().optional(),notes:sr().optional(),tags:sr().optional()});rr({defaultCurrency:sr().length(3,"Currency must be a 3-letter code").toUpperCase(),numberFormat:ir(["1,234.56","1.234,56","1 234.56","1 234,56"]),showCurrencySymbol:or()}),rr({emailNotifications:or(),pushNotifications:or(),budgetAlerts:or(),goalReminders:or(),billReminders:or(),alertThreshold:cr().min(0).max(100)});const yd=sr().email("Invalid email address").max(255,"Email must be less than 255 characters"),fd=sr().min(8,"Password must be at least 8 characters").max(100,"Password must be less than 100 characters").regex(/[A-Z]/,"Password must contain at least one uppercase letter").regex(/[a-z]/,"Password must contain at least one lowercase letter").regex(/[0-9]/,"Password must contain at least one number").regex(/[^A-Za-z0-9]/,"Password must contain at least one special character");class bd{static validateTransaction(e){return ld.parse(e)}static validateAccount(e){return dd.parse(e)}static validateBudget(e){return ud.parse(e)}static validateGoal(e){return md.parse(e)}static validateCategory(e){return gd.parse(e)}static validateTag(e){return pd.parse(e)}static validateCsvImportRow(e){return hd.parse(e)}static validateEmail(e){return yd.parse(e)}static validatePassword(e){return fd.parse(e)}static safeValidate(e,t){const a=e.safeParse(t);return a.success?{success:!0,data:a.data}:{success:!1,errors:a.error}}static formatErrors(e){const t={};return e.issues.forEach(e=>{const a=e.path.join("."),n=this.getUserFriendlyValidationMessage(e.message,a);t[a]=n}),t}static getUserFriendlyValidationMessage(e,t){const a={Required:`Please enter a ${t}`,"String must contain at least 1 character(s)":`Please enter a ${t}`,"Invalid uuid":"Please select a valid option","Invalid decimal number":"Please enter a valid number (e.g., 10.50)","Amount must be greater than 0":"Amount must be greater than zero","Date must be in YYYY-MM-DD format":"Please select a valid date"};if(a[e])return a[e];for(const[n,r]of Object.entries(a))if(e.includes(n))return r;return e}static sanitizeString(e,t=1e3){return od(e).substring(0,t)}static validateFileName(e){const t=(e=>{if(!e)return"";let t=e.replace(/\.\./g,"");return t=t.replace(/[^a-zA-Z0-9._\- ]/g,""),t.length>255&&(t=t.substring(0,255)),t})(e);if(!t||"."===t||".."===t)throw new Error("Invalid file name");return t}static validateDateRange(e,t){const a=new Date(e),n=new Date(t);if(isNaN(a.getTime())||isNaN(n.getTime()))throw new Error("Invalid date format");if(a>n)throw new Error("Start date must be before end date");return!0}static validateAmount(e){try{const t=new Rn(e);if(t.isNaN()||!t.isFinite())throw new Error("Invalid amount");return t}catch{throw new Error("Invalid amount format")}}}const xd=()=>"undefined"!=typeof window&&"true"===new URLSearchParams(window.location.search).get("demo"),wd=[{id:Bn(),name:"Main Checking",type:"checking",balance:"5234.56",currency:"USD",institution:"Demo Bank",accountNumber:"****1234",isActive:!0,createdAt:new Date("2024-01-01").toISOString(),updatedAt:(new Date).toISOString()},{id:Bn(),name:"Savings Account",type:"savings",balance:"25000.00",currency:"USD",institution:"Demo Bank",accountNumber:"****5678",isActive:!0,createdAt:new Date("2024-01-01").toISOString(),updatedAt:(new Date).toISOString()},{id:Bn(),name:"Investment Portfolio",type:"investment",balance:"45678.90",currency:"USD",institution:"Demo Investments",accountNumber:"****9012",isActive:!0,createdAt:new Date("2024-01-01").toISOString(),updatedAt:(new Date).toISOString(),holdings:[{id:Bn(),symbol:"AAPL",name:"Apple Inc.",shares:50,costBasis:7500,currentPrice:185.5,marketValue:9275,value:9275,assetType:"stock",allocation:20.3},{id:Bn(),symbol:"GOOGL",name:"Alphabet Inc.",shares:25,costBasis:3250,currentPrice:140.25,marketValue:3506.25,value:3506.25,assetType:"stock",allocation:7.7},{id:Bn(),symbol:"MSFT",name:"Microsoft Corporation",shares:30,costBasis:10200,currentPrice:380.75,marketValue:11422.5,value:11422.5,assetType:"stock",allocation:25},{id:Bn(),symbol:"VTI",name:"Vanguard Total Stock Market ETF",shares:40,costBasis:8800,currentPrice:235.4,marketValue:9416,value:9416,assetType:"etf",allocation:20.6},{id:Bn(),symbol:"BND",name:"Vanguard Total Bond Market ETF",shares:100,costBasis:7800,currentPrice:74.95,marketValue:7495,value:7495,assetType:"etf",allocation:16.4},{id:Bn(),symbol:"CASH",name:"Cash & Money Market",shares:1,costBasis:4563.15,currentPrice:4563.15,marketValue:4563.15,value:4563.15,assetType:"cash",allocation:10}]},{id:Bn(),name:"Credit Card",type:"credit",balance:"-2345.67",currency:"USD",institution:"Demo Credit",accountNumber:"****3456",isActive:!0,createdAt:new Date("2024-01-01").toISOString(),updatedAt:(new Date).toISOString()}],vd=["Whole Foods Market","Starbucks Coffee","Uber Ride","Netflix Subscription","Amazon Purchase","Electric Bill","Doctor Visit","Online Course","Flight Booking","Car Insurance","Stock Purchase","Monthly Salary","Target Store","Gas Station","Spotify Premium","Gym Membership","Restaurant Dinner","Grocery Store","Phone Bill","Internet Service"],Sd=(e=50)=>{const t=[],a=new Date;for(let n=0;n<e;n++){const e=Math.floor(90*Math.random()),n=new Date(a);n.setDate(n.getDate()-e);const r=Math.random()>.2,s=r?-(500*Math.random()+10).toFixed(2):(3e3*Math.random()+1e3).toFixed(2),o=jd.filter(e=>"expense"===e.type),i=jd.find(e=>"income"===e.type),c=r?o[Math.floor(Math.random()*o.length)]:i,l=c?.id||"cat-other",d=c?.name||"Other";t.push({id:Bn(),date:n.toISOString().split("T")[0],description:vd[Math.floor(Math.random()*vd.length)],amount:s.toString(),category:l,categoryName:d,accountId:wd[Math.floor(Math.random()*wd.length)].id,type:parseFloat(s)<0?"expense":"income",isRecurring:Math.random()>.9,isPending:Math.random()>.95,tags:Math.random()>.7?["tagged"]:[],notes:Math.random()>.8?"Sample transaction note":"",createdAt:n.toISOString(),updatedAt:n.toISOString()})}return t.sort((e,t)=>t.date.localeCompare(e.date))},kd=[{id:Bn(),name:"Monthly Expenses",category:"Groceries",amount:"600.00",spent:"423.50",period:"monthly",startDate:(new Date).toISOString().split("T")[0],endDate:null,isActive:!0},{id:Bn(),name:"Dining Out",category:"Restaurants",amount:"400.00",spent:"312.75",period:"monthly",startDate:(new Date).toISOString().split("T")[0],endDate:null,isActive:!0},{id:Bn(),name:"Entertainment",category:"Entertainment",amount:"200.00",spent:"145.00",period:"monthly",startDate:(new Date).toISOString().split("T")[0],endDate:null,isActive:!0},{id:Bn(),name:"Transportation",category:"Transportation",amount:"300.00",spent:"389.00",period:"monthly",startDate:(new Date).toISOString().split("T")[0],endDate:null,isActive:!0}],Id=[{id:Bn(),name:"Emergency Fund",targetAmount:"10000.00",currentAmount:"6500.00",deadline:new Date(Date.now()+15552e6).toISOString().split("T")[0],category:"savings",priority:"high",isActive:!0},{id:Bn(),name:"Vacation Fund",targetAmount:"5000.00",currentAmount:"2100.00",deadline:new Date(Date.now()+10368e6).toISOString().split("T")[0],category:"travel",priority:"medium",isActive:!0},{id:Bn(),name:"New Car Down Payment",targetAmount:"8000.00",currentAmount:"3200.00",deadline:new Date(Date.now()+31536e6).toISOString().split("T")[0],category:"purchase",priority:"low",isActive:!0}],jd=[{id:"cat-groceries",name:"Groceries",color:"#10b981",icon:"\ud83d\uded2",type:"expense"},{id:"cat-restaurants",name:"Restaurants",color:"#f59e0b",icon:"\ud83c\udf7d\ufe0f",type:"expense"},{id:"cat-transportation",name:"Transportation",color:"#3b82f6",icon:"\ud83d\ude97",type:"expense"},{id:"cat-entertainment",name:"Entertainment",color:"#8b5cf6",icon:"\ud83c\udfac",type:"expense"},{id:"cat-shopping",name:"Shopping",color:"#ec4899",icon:"\ud83d\udecd\ufe0f",type:"expense"},{id:"cat-bills",name:"Bills & Utilities",color:"#ef4444",icon:"\ud83d\udcf1",type:"expense"},{id:"cat-healthcare",name:"Healthcare",color:"#06b6d4",icon:"\ud83c\udfe5",type:"expense"},{id:"cat-education",name:"Education",color:"#6366f1",icon:"\ud83d\udcda",type:"expense"},{id:"cat-travel",name:"Travel",color:"#0ea5e9",icon:"\u2708\ufe0f",type:"expense"},{id:"cat-insurance",name:"Insurance",color:"#84cc16",icon:"\ud83d\udee1\ufe0f",type:"expense"},{id:"cat-investments",name:"Investments",color:"#14b8a6",icon:"\ud83d\udcc8",type:"both"},{id:"cat-salary",name:"Salary",color:"#22c55e",icon:"\ud83d\udcb0",type:"income"}],Cd=[{id:Bn(),name:"Netflix Subscription",amount:"-15.99",category:"Entertainment",frequency:"monthly",nextDate:new Date(Date.now()+6048e5).toISOString().split("T")[0],accountId:wd[0].id,isActive:!0},{id:Bn(),name:"Spotify Premium",amount:"-9.99",category:"Entertainment",frequency:"monthly",nextDate:new Date(Date.now()+10368e5).toISOString().split("T")[0],accountId:wd[0].id,isActive:!0},{id:Bn(),name:"Gym Membership",amount:"-49.99",category:"Healthcare",frequency:"monthly",nextDate:new Date(Date.now()+2592e5).toISOString().split("T")[0],accountId:wd[0].id,isActive:!0},{id:Bn(),name:"Salary",amount:"3500.00",category:"Salary",frequency:"monthly",nextDate:new Date(Date.now()+1296e6).toISOString().split("T")[0],accountId:wd[0].id,isActive:!0}],Nd=()=>xd()?pt.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-yellow-500 text-black text-center py-2 px-4",children:pt.jsxs("div",{className:"flex items-center justify-center gap-2",children:[pt.jsx("span",{className:"text-xl",children:"\ud83c\udfad"}),pt.jsx("span",{className:"font-semibold",children:"Demo Mode Active"}),pt.jsx("span",{className:"text-sm",children:"- Using sample data for UI/UX testing"}),pt.jsx("a",{href:"/",className:"ml-4 text-sm underline hover:no-underline",onClick:()=>{const e=new URL(window.location.href);e.searchParams.delete("demo"),window.location.href=e.toString()},children:"Exit Demo"})]})}):null,Dd=[{name:"Tesco",logo:"\ud83d\uded2",color:"#005EB8",keywords:["tesco","tesco express","tesco metro","tesco extra"]},{name:"Sainsbury's",logo:"\ud83d\uded2",color:"#FF7200",keywords:["sainsbury","sainsburys","sainsbury's"]},{name:"ASDA",logo:"\ud83d\uded2",color:"#7DC242",keywords:["asda"]},{name:"Morrisons",logo:"\ud83d\uded2",color:"#FFD700",keywords:["morrison","morrisons"]},{name:"Waitrose",logo:"\ud83d\uded2",color:"#81B93F",keywords:["waitrose"]},{name:"Aldi",logo:"\ud83d\uded2",color:"#00559F",keywords:["aldi"]},{name:"Lidl",logo:"\ud83d\uded2",color:"#0050AA",keywords:["lidl"]},{name:"Co-op",logo:"\ud83d\uded2",color:"#00B1E7",keywords:["co-op","coop","cooperative"]},{name:"M&S",logo:"\ud83d\uded2",color:"#000000",keywords:["m&s","marks spencer","marks and spencer","marks & spencer"]},{name:"TfL",logo:"\ud83d\ude87",color:"#DC241F",keywords:["tfl","transport for london","london underground","oyster"]},{name:"National Rail",logo:"\ud83d\ude82",color:"#C00000",keywords:["national rail","trainline","rail","railway"]},{name:"Uber",logo:"\ud83d\ude97",color:"#000000",keywords:["uber"]},{name:"Addison Lee",logo:"\ud83d\ude95",color:"#E30613",keywords:["addison lee"]},{name:"British Airways",logo:"\u2708\ufe0f",color:"#2E5C99",keywords:["british airways","ba.com"]},{name:"EasyJet",logo:"\u2708\ufe0f",color:"#FF6600",keywords:["easyjet"]},{name:"Ryanair",logo:"\u2708\ufe0f",color:"#073590",keywords:["ryanair"]},{name:"Shell",logo:"\u26fd",color:"#DD1D21",keywords:["shell"]},{name:"BP",logo:"\u26fd",color:"#006F51",keywords:["bp","british petroleum"]},{name:"Esso",logo:"\u26fd",color:"#CE1126",keywords:["esso"]},{name:"Texaco",logo:"\u26fd",color:"#FF0000",keywords:["texaco"]},{name:"McDonald's",logo:"\ud83c\udf54",color:"#FFC72C",keywords:["mcdonald","mcdonalds","mcd"]},{name:"KFC",logo:"\ud83c\udf57",color:"#F40027",keywords:["kfc","kentucky fried chicken"]},{name:"Burger King",logo:"\ud83c\udf54",color:"#D62300",keywords:["burger king"]},{name:"Subway",logo:"\ud83e\udd6a",color:"#008C15",keywords:["subway"]},{name:"Greggs",logo:"\ud83e\udd50",color:"#00539F",keywords:["greggs"]},{name:"Pret",logo:"\u2615",color:"#862633",keywords:["pret","pret a manger"]},{name:"Costa",logo:"\u2615",color:"#6C1F45",keywords:["costa","costa coffee"]},{name:"Starbucks",logo:"\u2615",color:"#00704A",keywords:["starbucks"]},{name:"Nando's",logo:"\ud83c\udf57",color:"#DC241F",keywords:["nando","nandos"]},{name:"Pizza Hut",logo:"\ud83c\udf55",color:"#ED1C24",keywords:["pizza hut"]},{name:"Domino's",logo:"\ud83c\udf55",color:"#006491",keywords:["domino","dominos"]},{name:"Wagamama",logo:"\ud83c\udf5c",color:"#ED1C24",keywords:["wagamama"]},{name:"Amazon",logo:"\ud83d\udce6",color:"#FF9900",keywords:["amazon","amzn"]},{name:"Argos",logo:"\ud83d\udecd\ufe0f",color:"#ED1B24",keywords:["argos"]},{name:"John Lewis",logo:"\ud83c\udfec",color:"#000000",keywords:["john lewis","johnlewis"]},{name:"Next",logo:"\ud83d\udc55",color:"#000000",keywords:["next","next retail"]},{name:"Primark",logo:"\ud83d\udc57",color:"#0066B3",keywords:["primark"]},{name:"H&M",logo:"\ud83d\udc54",color:"#E50010",keywords:["h&m","h & m","hennes"]},{name:"Zara",logo:"\ud83d\udc57",color:"#000000",keywords:["zara"]},{name:"Boots",logo:"\ud83d\udc8a",color:"#005EB8",keywords:["boots"]},{name:"Superdrug",logo:"\ud83d\udc84",color:"#E6007E",keywords:["superdrug"]},{name:"Netflix",logo:"\ud83d\udcfa",color:"#E50914",keywords:["netflix"]},{name:"Spotify",logo:"\ud83c\udfb5",color:"#1DB954",keywords:["spotify"]},{name:"Disney+",logo:"\ud83c\udfac",color:"#113CCF",keywords:["disney","disney+","disney plus"]},{name:"Amazon Prime",logo:"\ud83d\udcfa",color:"#00A8E1",keywords:["amazon prime","prime video"]},{name:"Sky",logo:"\ud83d\udce1",color:"#0072C9",keywords:["sky"]},{name:"BT",logo:"\ud83d\udcde",color:"#5514B4",keywords:["bt","british telecom"]},{name:"Virgin Media",logo:"\ud83d\udcf6",color:"#ED1A3B",keywords:["virgin media","virgin"]},{name:"EE",logo:"\ud83d\udcf1",color:"#00B5B0",keywords:["ee","everything everywhere"]},{name:"O2",logo:"\ud83d\udcf1",color:"#0019A5",keywords:["o2"]},{name:"Three",logo:"\ud83d\udcf1",color:"#EE2E7B",keywords:["three","3 mobile"]},{name:"Vodafone",logo:"\ud83d\udcf1",color:"#E60000",keywords:["vodafone"]},{name:"British Gas",logo:"\ud83d\udd25",color:"#0396D6",keywords:["british gas"],domain:"britishgas.co.uk"},{name:"E.ON",logo:"\u26a1",color:"#E2001A",keywords:["eon","e.on"],domain:"eonenergy.com"},{name:"EDF",logo:"\u26a1",color:"#0066CC",keywords:["edf","edf energy"],domain:"edfenergy.com"},{name:"Thames Water",logo:"\ud83d\udca7",color:"#0082CA",keywords:["thames water"],domain:"thameswater.co.uk"},{name:"Council Tax",logo:"\ud83c\udfdb\ufe0f",color:"#2B3E50",keywords:["council tax","council"]},{name:"Barclays",logo:"\ud83c\udfe6",color:"#00AEEF",keywords:["barclays"]},{name:"HSBC",logo:"\ud83c\udfe6",color:"#DB0011",keywords:["hsbc"]},{name:"Lloyds",logo:"\ud83c\udfe6",color:"#024731",keywords:["lloyds"]},{name:"NatWest",logo:"\ud83c\udfe6",color:"#5A287F",keywords:["natwest"]},{name:"Santander",logo:"\ud83c\udfe6",color:"#EC0000",keywords:["santander"]},{name:"Halifax",logo:"\ud83c\udfe6",color:"#005EB8",keywords:["halifax"]},{name:"Nationwide",logo:"\ud83c\udfe6",color:"#1B3A6B",keywords:["nationwide"]},{name:"PayPal",logo:"\ud83d\udcb3",color:"#003087",keywords:["paypal"]},{name:"ATM",logo:"\ud83c\udfe7",color:"#4A90E2",keywords:["atm","cash machine","cashpoint"]},{name:"PureGym",logo:"\ud83d\udcaa",color:"#E4002B",keywords:["puregym","pure gym"],domain:"puregym.com"},{name:"David Lloyd",logo:"\ud83c\udfc3",color:"#003DA5",keywords:["david lloyd"],domain:"davidlloyd.co.uk"},{name:"Virgin Active",logo:"\ud83c\udfcb\ufe0f",color:"#ED1A3B",keywords:["virgin active"],domain:"virginactive.co.uk"},{name:"Google",logo:"\ud83d\udd0d",color:"#4285F4",keywords:["google"]},{name:"Apple",logo:"\ud83c\udf4e",color:"#000000",keywords:["apple","app store","itunes"]},{name:"Microsoft",logo:"\ud83d\udcbb",color:"#0078D4",keywords:["microsoft"]},{name:"Restaurant",logo:"\ud83c\udf7d\ufe0f",color:"#FF6B6B",keywords:["restaurant","dining","food"]},{name:"Groceries",logo:"\ud83d\uded2",color:"#4ECDC4",keywords:["grocery","supermarket"]},{name:"Transport",logo:"\ud83d\ude8c",color:"#45B7D1",keywords:["transport","travel","bus","train"]},{name:"Shopping",logo:"\ud83d\udecd\ufe0f",color:"#96CEB4",keywords:["shop","retail","store"]},{name:"Bills",logo:"\ud83d\udccb",color:"#DDA0DD",keywords:["bill","utility","payment"]},{name:"Entertainment",logo:"\ud83c\udfad",color:"#FF6B9D",keywords:["cinema","theatre","entertainment"]},{name:"Health",logo:"\ud83c\udfe5",color:"#66D9EF",keywords:["pharmacy","doctor","health","medical"]}],Ed={"amazon.com":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0OCA0OCI+PHBhdGggZmlsbD0iI0ZGOTgwMCIgZD0iTTM3LDM1LjVjLTYuNiw0LjItMTUuNCw2LjUtMjMuNCw2LjVDOC40LDQyLDMuOSw0MC4xLDAuOSwzNy4yYy0wLjItMC4yLDAtMC40LDAuMi0wLjNDNC4yLDM5LDguOCw0MCwxMy41LDQwYzMuMSwwLDYuNi0wLjUsOS45LTEuNkMzMS4yLDM1LjksMzcuNywzNC40LDM3LDM1LjV6IE00MS4zLDMxLjNjLTAuMy0wLjQtMi4xLTAuMi0yLjksMC4xYy0wLjIsMC4xLTAuMywwLjQtMC4xLDAuNWMwLjksMi43LDIuOCwyLDMuNCwxLjVDNDIuMywzMyw0Mi4yLDMxLjcsNDEuMywzMS4zeiBNMjAuNywxNy45YzAsMi41LDAsNC43LTEuMiw2LjljLTAuOCwxLjUtMi4xLDIuNC0zLjUsMi40Yy0xLjksMC0zLjEtMS41LTMuMS0zLjZjMC0xNi43LDguMy0xOS43LDguMy0xOS43VjE3Ljl6IE0yNy40LDMxLjNjLTAuNC0wLjQtMS0wLjQtMS41LTAuMWMtMi4xLDEuNy0yLjUsMi42LTMuNiwzLjNjLTEuNCwxLjQtMywxLjgtNC42LDEuOGMtMi4zLDAtNC4xLTEuNS00LjEtNC40YzAtMy43LDIuMy01LjIsNi00LjJ2LTFjMC0xLjUtMC4xLTMuMi0xLTQuNGMtMC42LTAuOS0xLjktMS40LTMuMS0xLjRjLTIuMSwwLTQsMS4xLTQuNCwzLjNjLTAuMSwwLjUtMC40LDEtMC45LDFsLTUuMS0wLjZDNS4xLDIwLjIsNS42LDE5LjksNiwxOS41YzEuOC0zLjMsNS00LjMsOC42LTQuM2MxLjksMCw0LjMsMC41LDUuOCwyYzEuOCwxLjgsMS42LDQuMiwxLjYsNi44djYuMmMwLDEuOSwwLjgsMi43LDEuNSwzLjdjMC4zLDAuMywwLjMsMC44LDAsMUMyMy4xLDI4LjMsMjQuNCwyOS45LDI3LjQsMzEuM3oiLz48L3N2Zz4=","netflix.com":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0OCA0OCI+PHBhdGggZmlsbD0iI0I3MUMxQyIgZD0iTTEzIDloOHYzMGgtOHoiLz48cGF0aCBmaWxsPSIjRTUzOTM1IiBkPSJNMjcgOWg4djMwaC04eiIvPjxwYXRoIGZpbGw9IiNGRjU3MjIiIGQ9Ik0xMyA5bDE0IDE0VjloLTd6Ii8+PHBhdGggZmlsbD0iI0U1MzkzNSIgZD0iTTI3IDM5TDEzIDI1djE0aDd6Ii8+PC9zdmc+","spotify.com":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0OCA0OCI+PGNpcmNsZSBjeD0iMjQiIGN5PSIyNCIgcj0iMjAiIGZpbGw9IiMxREI5NTQiLz48cGF0aCBmaWxsPSIjMTkxNDE0IiBkPSJNMzAuOCAxOS45Yy00LjUtMS45LTkuNS0yLTE0LjItMC41Yy0wLjYgMC4yLTEuMi0wLjEtMS40LTAuN2MtMC4yLTAuNiAwLjEtMS4yIDAuNy0xLjRjNS4zLTEuNiAxMC44LTEuNCAxNS44IDAuNmMwLjYgMC4yIDAuOSAwLjggMC43IDEuNEMzMiAxOS42IDMxLjQgMjAuMSAzMC44IDE5Ljl6TTI5LjIgMjUuNWMtMC41IDAuMy0xLjEgMC4xLTEuNC0wLjRjLTEuNi0yLjItNC4yLTMuMy02LjktMy40Yy0yLTAuMS0zLjkgMC4zLTUuNyAxLjFjLTAuNSAwLjItMS4xLTAuMS0xLjMtMC42Yy0wLjItMC41IDAuMS0xLjEgMC42LTEuM2MyLjEtMC45IDQuMy0xLjQgNi42LTEuMmMzLjIgMC4xIDYuMSAxLjMgOCwzLjlDMjkuNCAyNC40IDI5LjUgMjUuMSAyOS4yIDI1LjV6IE0yOCAzMC4zYy0wLjQgMC4yLTAuOSAwLjEtMS4xLTAuM2MtMS4yLTEuNy0zLjItMi42LTUuMi0yLjdjLTEuNS0wLjEtMi45IDAuMi00LjMgMC44Yy0wLjQgMC4yLTAuOSAwLTEtMC40Yy0wLjItMC40IDAtMC45IDAuNC0xYzEuNi0wLjcgMy4zLTEuMSA1LjEtMC45YzIuNCAwLjEgNC42IDEuMiA2LjEgMy4yQzI4LjIgMjkuNSAyOC4yIDMwLjEgMjggMzAuM3oiLz48L3N2Zz4=","apple.com":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0OCA0OCI+PHBhdGggZmlsbD0iIzQyQTVGNSIgZD0iTTM1LjMgMTAuN2MtMS44IDIuMy00LjcgMy42LTcuNSAzLjVjLTAuNC0yLjkgMS03LjYgMi44LTkuOWMxLjgtMi4zIDQuOS0zLjkgNy40LTRDMzguMSAzLjIgMzcuMSA4LjQgMzUuMyAxMC43eiIvPjxwYXRoIGZpbGw9IiM0MjQyNDIiIGQ9Ik0zOC4yIDE2LjRjLTEuNi0wLjktMy40LTEuNC01LjMtMS40Yy0yLjYgMC00LjUgMC45LTUuOCAxLjdjLTAuNyAwLjQtMS4zIDAuOC0xLjcgMC45Yy0wLjQtMC4yLTAuOS0wLjUtMS42LTAuOWMtMS41LTAuOS0zLjUtMS44LTYuNC0xLjhjLTMuNiAwLTYuNyAyLjItOC41IDUuN2MtMi41IDQuOS0yLjEgMTEuNCAxLjkgMTguMWMxLjkgMy4yIDQuNSA3LjEgNy45IDcuMmMwIDAsMCAwIDAuMSAwYzEuNSAwIDIuNS0wLjUgMy40LTAuOWMxLTAuNSAxLjktMC45IDMuNC0wLjljMS41IDAgMi40IDAuNCAzLjQgMC45YzAuOSAwLjQgMS45IDAuOSAzLjQgMC45YzAuMSAwIDAuMSAwIDAuMiAwYzMuNC0wLjEgNi00LjEgNy45LTcuM2MxLjItMiAyLTMuOCAyLjUtNS4xYyAyLjMtMiA0LjUtMi43IDUuMy0yLjd6Ii8+PC9zdmc+","tesco.com":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0OCA0OCI+PHJlY3Qgd2lkdGg9IjQ4IiBoZWlnaHQ9IjQ4IiByeD0iOCIgZmlsbD0iIzAwNUVCOCIvPjx0ZXh0IHg9IjI0IiB5PSIzMiIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE4IiBmb250LXdlaWdodD0iYm9sZCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPlRFU0NPPC90ZXh0Pjwvc3ZnPg==","sainsburys.co.uk":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0OCA0OCI+PHJlY3Qgd2lkdGg9IjQ4IiBoZWlnaHQ9IjQ4IiByeD0iOCIgZmlsbD0iI0ZGNzIwMCIvPjx0ZXh0IHg9IjI0IiB5PSIzMiIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjI0IiBmb250LXdlaWdodD0iYm9sZCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPlM8L3RleHQ+PC9zdmc+","mcdonalds.com":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0OCA0OCI+PHBhdGggZmlsbD0iI0ZGQzEwNyIgZD0iTTEyIDEwYzAtMi4yIDEuOC00IDQtNHM0IDEuOCA0IDR2MjhoLTh6bTE2IDBjMC0yLjIgMS44LTQgNC00czQgMS44IDQgNHYyOGgtOHoiLz48L3N2Zz4=","starbucks.com":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0OCA0OCI+PGNpcmNsZSBjeD0iMjQiIGN5PSIyNCIgcj0iMjAiIGZpbGw9IiMwMDcwNEEiLz48Y2lyY2xlIGN4PSIyNCIgY3k9IjI0IiByPSIxNiIgZmlsbD0id2hpdGUiLz48Y2lyY2xlIGN4PSIyNCIgY3k9IjI0IiByPSIxMiIgZmlsbD0iIzAwNzA0QSIvPjwvc3ZnPg==","uber.com":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0OCA0OCI+PHJlY3Qgd2lkdGg9IjQ4IiBoZWlnaHQ9IjQ4IiByeD0iOCIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IHg9IjI0IiB5PSIzMiIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE4IiBmb250LXdlaWdodD0iYm9sZCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPlViZXI8L3RleHQ+PC9zdmc+"},Ad=new class{merchantMap=new Map;logoCache=new Map;logoFetchPromises=new Map;constructor(){Dd.forEach(e=>{e.keywords.forEach(t=>{this.merchantMap.set(t.toLowerCase(),e)})}),this.loadCachedLogos()}loadCachedLogos(){try{const e=localStorage.getItem("merchantLogos");if(e){const t=JSON.parse(e);Object.entries(t).forEach(([e,t])=>{this.logoCache.set(e,t)})}}catch(e){console.error("Error loading cached logos:",e)}}saveCachedLogos(){try{const e=Object.fromEntries(this.logoCache);localStorage.setItem("merchantLogos",JSON.stringify(e))}catch(e){console.error("Error saving cached logos:",e)}}async fetchLogoUrl(e){if(Ed[e])return Ed[e];if(this.logoCache.has(e)){const t=this.logoCache.get(e);return""===t?null:t}if(this.logoFetchPromises.has(e))return this.logoFetchPromises.get(e);const t=(async()=>{try{const t=`https://logo.clearbit.com/${e}`,a=`https://www.google.com/s2/favicons?domain=${e}&sz=64`,n=`https://icons.duckduckgo.com/ip3/${e}.ico`;return new Promise(r=>{let s=0;const o=[t,a,n],i=()=>{if(s>=o.length)return this.logoCache.set(e,""),this.saveCachedLogos(),void r(null);const t=o[s],a=new Image;0===s&&(a.crossOrigin="anonymous");const n=setTimeout(()=>{a.src="",s++,i()},3e3);a.onload=()=>{clearTimeout(n),console.log(`Successfully loaded ${0===s?"logo":"favicon"} for ${e}`),this.logoCache.set(e,t),this.saveCachedLogos(),r(t)},a.onerror=()=>{clearTimeout(n),console.warn(`${["Clearbit logo","Google favicon","DuckDuckGo favicon"][s]} failed for ${e}${s<o.length-1?", trying next...":", will use emoji"}`),s++,i()},a.src=t};i()})}catch(t){console.error(`Error fetching logo for ${e}:`,t)}return null})();return this.logoFetchPromises.set(e,t),t.finally(()=>{this.logoFetchPromises.delete(e)}),t}getMerchantInfo(e){const t=e.toLowerCase().replace(/^(card purchase|direct debit|standing order|bank transfer|pos|contactless|online)[\s-]*/i,"").replace(/[*#\d]/g,"").trim();for(const[n,r]of Array.from(this.merchantMap.entries()))if(t.includes(n))return r;const a=t.split(/[\s-,]/);for(const n of a)if(n.length>2){const e=this.merchantMap.get(n);if(e)return e}return t.includes("fuel")||t.includes("petrol")?{name:"Fuel",logo:"\u26fd",color:"#FF6347",keywords:[]}:t.includes("taxi")||t.includes("cab")?{name:"Taxi",logo:"\ud83d\ude95",color:"#FFD700",keywords:[]}:t.includes("parking")?{name:"Parking",logo:"\ud83c\udd7f\ufe0f",color:"#4169E1",keywords:[]}:t.includes("coffee")?{name:"Coffee",logo:"\u2615",color:"#6F4E37",keywords:[]}:t.includes("pub")||t.includes("bar")?{name:"Pub",logo:"\ud83c\udf7a",color:"#8B4513",keywords:[]}:null}getAllMerchants(){const e=new Map;return Dd.forEach(t=>{e.has(t.name)||e.set(t.name,t)}),Array.from(e.values())}async preloadCommonLogos(){["amazon.com","netflix.com","spotify.com","apple.com","tesco.com","sainsburys.co.uk","asda.com","mcdonalds.com","starbucks.com","uber.com"].forEach(e=>{this.fetchLogoUrl(e).catch(()=>{})})}},Td=new class{metrics=[];observer=null;reportCallback=null;isInitialized=!1;thresholds={LCP:{good:2500,poor:4e3},FID:{good:100,poor:300},CLS:{good:.1,poor:.25},FCP:{good:1800,poor:3e3},TTFB:{good:800,poor:1800},INP:{good:200,poor:500}};init(e){this.isInitialized||(this.reportCallback=e||null,this.isInitialized=!0,"undefined"!=typeof window&&(this.observeWebVitals(),this.measureCustomMetrics(),this.setupResourceObserver(),this.trackBundleSize()))}observeWebVitals(){if("PerformanceObserver"in window){try{new PerformanceObserver(e=>{const t=e.getEntries(),a=t[t.length-1];this.recordMetric("LCP",a.startTime,"LCP")}).observe({entryTypes:["largest-contentful-paint"]})}catch(e){}try{new PerformanceObserver(e=>{e.getEntries().forEach(e=>{"first-input"===e.name&&this.recordMetric("FID",e.processingStart-e.startTime,"FID")})}).observe({entryTypes:["first-input"]})}catch(e){}try{let e=0;new PerformanceObserver(t=>{for(const a of t.getEntries())a.hadRecentInput||(e+=a.value);this.recordMetric("CLS",e,"CLS")}).observe({entryTypes:["layout-shift"]})}catch(e){}try{new PerformanceObserver(e=>{e.getEntries().forEach(e=>{"first-contentful-paint"===e.name&&this.recordMetric("FCP",e.startTime,"FCP")})}).observe({entryTypes:["paint"]})}catch(e){}}if(window.performance&&window.performance.timing){const e=window.performance.timing,t=e.responseStart-e.navigationStart;t>0&&this.recordMetric("TTFB",t,"TTFB")}if("PerformanceEventTiming"in window){let t=0;const a=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{e.duration>t&&(t=e.duration,this.recordMetric("INP",t,"INP"))})});try{a.observe({entryTypes:["event"]})}catch(e){}}}recordMetric(e,t,a){const n=this.getRating(t,a),r={name:e,value:Math.round(t),rating:n,timestamp:Date.now()};this.metrics.push(r),this.sendToAnalytics(r)}getRating(e,t){const a=this.thresholds[t];return a?e<=a.good?"good":e<=a.poor?"needs-improvement":"poor":"good"}measureCustomMetrics(){if("complete"===document.readyState){const e=performance.now();this.recordMetric("TTI",e,"FCP")}else window.addEventListener("load",()=>{const e=performance.now();this.recordMetric("TTI",e,"FCP")});performance.now();const e=()=>{performance.now(),this.isInitialized&&requestAnimationFrame(e)};requestAnimationFrame(e)}setupResourceObserver(){if(!("PerformanceObserver"in window))return;const e=new PerformanceObserver(e=>{const t=e.getEntries().filter(e=>e.duration>1e3);t.length>0&&console.warn("[Performance] Slow resources detected:",t.map(e=>({name:e.name,duration:Math.round(e.duration),type:e.initiatorType})))});try{e.observe({entryTypes:["resource"]})}catch(t){}}async trackBundleSize(){if(!("navigator"in window)||!("connection"in navigator))return;const e=Array.from(document.scripts);((await Promise.all(e.filter(e=>e.src).map(async e=>{try{const t=(await fetch(e.src,{method:"HEAD"})).headers.get("content-length");return{url:e.src,size:t?parseInt(t):0}}catch{return{url:e.src,size:0}}}))).reduce((e,t)=>e+t.size,0)/1048576).toFixed(2)}sendToAnalytics(e){if("undefined"!=typeof window&&"gtag"in window&&window.gtag("event","performance",{metric_name:e.name,metric_value:e.value,metric_rating:e.rating}),this.reportCallback){const t={metrics:[e],timestamp:Date.now(),url:window.location.href,userAgent:navigator.userAgent};this.reportCallback(t)}}getMetrics(){return[...this.metrics]}getSummary(){const e={};return this.metrics.forEach(t=>{(!e[t.name]||t.timestamp>e[t.name].timestamp)&&(e[t.name]=t)}),{metrics:Object.values(e),score:this.calculatePerformanceScore(e),recommendations:this.getRecommendations(e)}}calculatePerformanceScore(e){let t=0,a=0;return Object.entries({LCP:.25,FID:.25,CLS:.25,FCP:.15,TTFB:.1}).forEach(([n,r])=>{const s=e[n];if(s){const e="good"===s.rating?100:"needs-improvement"===s.rating?50:0;t+=e*r,a+=r}}),a>0?Math.round(t/a):0}getRecommendations(e){const t=[];return"good"!==e.LCP?.rating&&t.push("Optimize largest contentful paint: Consider lazy loading images, optimizing server response time, and using a CDN"),"good"!==e.FID?.rating&&t.push("Improve first input delay: Break up long tasks, use web workers, and optimize JavaScript execution"),"good"!==e.CLS?.rating&&t.push("Reduce layout shift: Set size attributes on images/videos, avoid inserting content above existing content"),"good"!==e.FCP?.rating&&t.push("Speed up first contentful paint: Minimize render-blocking resources, inline critical CSS"),"good"!==e.TTFB?.rating&&t.push("Reduce server response time: Use caching, optimize database queries, consider a CDN"),t}recordCustomMetric(e,t){this.metrics.push({name:e,value:t,rating:"good",timestamp:Date.now()})}mark(e){performance.mark(e)}measure(e,t,a){try{const n=performance.measure(e,t,a);this.recordCustomMetric(e,n.duration)}catch(n){console.error("Performance measurement failed:",n)}}clear(){this.metrics=[]}exportMetrics(){return{metrics:this.getMetrics(),summary:this.getSummary(),timestamp:Date.now(),url:window.location.href,userAgent:navigator.userAgent,connection:navigator.connection||{}}}destroy(){this.isInitialized=!1,this.observer?.disconnect(),this.clear()}};let _d=null;const Ld=new class{scheduledReports=[];templates=[];constructor(){this.loadData(),this.initializeDefaultTemplates()}loadData(){try{const e=localStorage.getItem("scheduled-reports");e&&(this.scheduledReports=JSON.parse(e).map(e=>({...e,nextRun:new Date(e.nextRun),createdAt:new Date(e.createdAt),lastRun:e.lastRun?new Date(e.lastRun):void 0,options:{...e.options,startDate:new Date(e.options.startDate),endDate:new Date(e.options.endDate)}})));const t=localStorage.getItem("export-templates");t&&(this.templates=JSON.parse(t).map(e=>({...e,createdAt:new Date(e.createdAt),options:{...e.options,startDate:new Date(e.options.startDate),endDate:new Date(e.options.endDate)}})))}catch(e){console.error("Error loading export data:",e)}}saveData(){try{localStorage.setItem("scheduled-reports",JSON.stringify(this.scheduledReports)),localStorage.setItem("export-templates",JSON.stringify(this.templates))}catch(e){console.error("Error saving export data:",e)}}initializeDefaultTemplates(){if(0===this.templates.length){const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),a=new Date(e.getFullYear(),e.getMonth()+1,0),n=[{id:"monthly-summary",name:"Monthly Summary",description:"Complete monthly financial summary with charts and transactions",options:{startDate:t,endDate:a,format:"pdf",includeCharts:!0,includeTransactions:!0,includeAccounts:!0,includeInvestments:!0,includeBudgets:!0,groupBy:"category"},isDefault:!0,createdAt:new Date},{id:"transaction-report",name:"Transaction Report",description:"Detailed transaction listing for specified period",options:{startDate:t,endDate:a,format:"csv",includeCharts:!1,includeTransactions:!0,includeAccounts:!1,includeInvestments:!1,includeBudgets:!1,groupBy:"none"},isDefault:!0,createdAt:new Date},{id:"investment-portfolio",name:"Investment Portfolio",description:"Investment portfolio overview with performance charts",options:{startDate:new Date(e.getFullYear(),0,1),endDate:e,format:"pdf",includeCharts:!0,includeTransactions:!1,includeAccounts:!1,includeInvestments:!0,includeBudgets:!1,groupBy:"none"},isDefault:!0,createdAt:new Date}];this.templates=n,this.saveData()}}getTemplates(){return this.templates.sort((e,t)=>e.isDefault&&!t.isDefault?-1:!e.isDefault&&t.isDefault?1:e.name.localeCompare(t.name))}createTemplate(e){const t={...e,id:Date.now().toString(),createdAt:new Date};return this.templates.push(t),this.saveData(),t}updateTemplate(e,t){const a=this.templates.findIndex(t=>t.id===e);return-1===a?null:(this.templates[a]={...this.templates[a],...t},this.saveData(),this.templates[a])}deleteTemplate(e){const t=this.templates.findIndex(t=>t.id===e);return-1!==t&&(this.templates.splice(t,1),this.saveData(),!0)}getScheduledReports(){return this.scheduledReports.sort((e,t)=>e.nextRun.getTime()-t.nextRun.getTime())}createScheduledReport(e){const t=this.calculateNextRun(e.frequency),a={...e,id:Date.now().toString(),nextRun:t,createdAt:new Date};return this.scheduledReports.push(a),this.saveData(),a}updateScheduledReport(e,t){const a=this.scheduledReports.findIndex(t=>t.id===e);if(-1===a)return null;const n={...this.scheduledReports[a],...t};return t.frequency&&(n.nextRun=this.calculateNextRun(t.frequency)),this.scheduledReports[a]=n,this.saveData(),n}deleteScheduledReport(e){const t=this.scheduledReports.findIndex(t=>t.id===e);return-1!==t&&(this.scheduledReports.splice(t,1),this.saveData(),!0)}calculateNextRun(e){const t=new Date,a=new Date(t);switch(e){case"daily":a.setDate(t.getDate()+1);break;case"weekly":a.setDate(t.getDate()+7);break;case"monthly":a.setMonth(t.getMonth()+1);break;case"quarterly":a.setMonth(t.getMonth()+3)}return a.setHours(9,0,0,0),a}async exportToCSV(e,t={}){const{startDate:a,endDate:n,groupBy:r="none"}=t;let s=e;a&&n&&(s=e.filter(e=>{const t="date"in e?e.date:"createdAt"in e?e.createdAt:new Date;return t>=a&&t<=n}));const o=this.groupData(s,r);if(Array.isArray(o))return this.arrayToCSV(o);{const e=Object.entries(o).map(([e,t])=>({Group:e,Count:Array.isArray(t)?t.length:1,Total:this.calculateGroupTotal(t)}));return this.arrayToCSV(e)}}async exportToPDF(e,t){if(!_d){const e=await jr(()=>import("./chunk-ddLY9KjI.js").then(e=>e.j),__vite__mapDeps([0,1,2]));_d=e.jsPDF}const a=new _d;let n=20;if(a.setFontSize(20),a.text(t.customTitle||"Financial Report",20,n),n+=10,a.setFontSize(12),a.text(`Period: ${this.formatDate(t.startDate)} - ${this.formatDate(t.endDate)}`,20,n),n+=20,t.logoUrl)try{a.addImage(t.logoUrl,"PNG",150,10,40,20)}catch(r){}return e.accounts&&t.includeAccounts&&(n=await this.addAccountsSummaryToPDF(a,e.accounts,n)),e.transactions&&t.includeTransactions&&(n=await this.addTransactionsSummaryToPDF(a,e.transactions,n,t)),e.investments&&t.includeInvestments&&(n=await this.addInvestmentsSummaryToPDF(a,e.investments,n)),e.budgets&&t.includeBudgets&&(n=await this.addBudgetsSummaryToPDF(a,e.budgets,n)),t.includeCharts&&await this.addChartsToPDF(a,e,n),a.output("arraybuffer")}async addAccountsSummaryToPDF(e,t,a){e.setFontSize(16),e.text("Accounts Summary",20,a),a+=10,e.setFontSize(10),t.forEach(t=>{e.text(`${t.name}: ${this.formatCurrency(t.balance)}`,20,a),a+=5});const n=t.reduce((e,t)=>e.plus(t.balance),new Rn(0));return e.setFontSize(12),e.text(`Total Balance: ${this.formatCurrency(n.toNumber())}`,20,a+5),a+20}async addTransactionsSummaryToPDF(e,t,a,n){e.setFontSize(16),e.text("Transactions Summary",20,a),a+=10;const r=t.filter(e=>e.date>=n.startDate&&e.date<=n.endDate).reduce((e,t)=>(e[t.category]||(e[t.category]=[]),e[t.category].push(t),e),{});return e.setFontSize(10),Object.entries(r).forEach(([t,n])=>{const r=n.reduce((e,t)=>e.plus(Math.abs(t.amount)),new Rn(0));e.text(`${t}: ${n.length} transactions, ${this.formatCurrency(r.toNumber())}`,20,a),a+=5}),a+15}async addInvestmentsSummaryToPDF(e,t,a){return e.setFontSize(16),e.text("Investments Summary",20,a),a+=10,e.setFontSize(10),t.forEach(t=>{const n=new Rn(t.currentValue||0),r=new Rn(t.costBasis||t.quantity*t.purchasePrice),s=n.minus(r),o=r.gt(0)?s.div(r).mul(100):new Rn(0);e.text(`${t.symbol}: ${this.formatCurrency(n.toNumber())} (${s.gte(0)?"+":""}${o.toFixed(2)}%)`,20,a),a+=5}),a+15}async addBudgetsSummaryToPDF(e,t,a){return e.setFontSize(16),e.text("Budget Summary",20,a),a+=10,e.setFontSize(10),t.forEach(t=>{const n=new Rn(t.spent||0),r=new Rn(t.budgeted);r.minus(n);const s=r.gt(0)?n.div(r).mul(100):new Rn(0);e.text(`${t.category}: ${this.formatCurrency(n.toNumber())} / ${this.formatCurrency(r.toNumber())} (${s.toFixed(1)}%)`,20,a),a+=5}),a+15}async addChartsToPDF(e,t,a){e.setFontSize(14),e.text("Charts would be rendered here from DOM elements",20,a)}groupData(e,t){return"none"===t?e:e.reduce((e,a)=>{let n;switch(t){case"category":n=("category"in a?a.category:void 0)||"Uncategorized";break;case"account":n=("accountId"in a?a.accountId:"account"in a?a.account:void 0)||"Unknown";break;case"month":{const e=("date"in a?a.date:"createdAt"in a?a.createdAt:void 0)||new Date,t=e instanceof Date?e:new Date(e);n=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`;break}default:n="All"}return e[n]||(e[n]=[]),e[n].push(a),e},{})}calculateGroupTotal(e){return e.reduce((e,t)=>{let a=0;return"amount"in t?a=t.amount:"balance"in t?a=t.balance:"currentValue"in t&&(a=t.currentValue||0),e+Math.abs(a)},0)}arrayToCSV(e){if(0===e.length)return"";const t=Object.keys(e[0]);return[t.join(","),...e.map(e=>t.map(t=>{const a=e[t];return"string"==typeof a&&(a.includes(",")||a.includes('"'))?`"${a.replace(/"/g,'""')}"`:a}).join(","))].join("\n")}formatCurrency(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e)}formatDate(e){return e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}async sendScheduledReport(e){const t=this.scheduledReports.find(t=>t.id===e);if(!t||!t.isActive)return!1;try{return console.log(`Sending scheduled report "${t.name}" to ${t.email}`),t.lastRun=new Date,t.nextRun=this.calculateNextRun(t.frequency),this.saveData(),!0}catch(a){return console.error("Error sending scheduled report:",a),!1}}getDueReports(){const e=new Date;return this.scheduledReports.filter(t=>t.isActive&&t.nextRun<=e)}exportToQIF(e){let t="";for(const a of e.accounts){t+="!Account\n",t+=`N${a.name}\n`,t+=`T${this.mapAccountType(a.type)}\n`,t+=`$${a.balance.toFixed(2)}\n`,t+="^\n";const n=e.transactions.filter(e=>e.accountId===a.id);if(n.length>0){t+=`!Type:${this.mapAccountType(a.type)}\n`;for(const e of n){const a=new Date(e.date);t+=`D${(a.getMonth()+1).toString().padStart(2,"0")}/${a.getDate().toString().padStart(2,"0")}/${a.getFullYear()}\n`,t+=`T${"expense"===e.type?"-":""}${e.amount.toFixed(2)}\n`,t+=`P${e.description||""}\n`,t+=`L${e.category||"Uncategorized"}\n`,e.note&&(t+=`M${e.note}\n`),t+="^\n"}}}return t}exportToOFX(e){const t=(new Date).toISOString().replace(/[-:]/g,"").split(".")[0];let a=`OFXHEADER:100\nDATA:OFXSGML\nVERSION:103\nSECURITY:NONE\nENCODING:USASCII\nCHARSET:1252\nCOMPRESSION:NONE\nOLDFILEUID:NONE\nNEWFILEUID:${t}\n\n<OFX>\n<SIGNONMSGSRSV1>\n<SONRS>\n<STATUS>\n<CODE>0\n<SEVERITY>INFO\n</STATUS>\n<DTSERVER>${t}\n<LANGUAGE>ENG\n</SONRS>\n</SIGNONMSGSRSV1>\n<BANKMSGSRSV1>\n<STMTTRNRS>\n<TRNUID>${t}\n<STATUS>\n<CODE>0\n<SEVERITY>INFO\n</STATUS>\n`;for(const n of e.accounts){const r=e.transactions.filter(e=>e.accountId===n.id);a+=`<STMTRS>\n<CURDEF>USD\n<BANKACCTFROM>\n<BANKID>123456789\n<ACCTID>${n.id}\n<ACCTTYPE>${this.mapOFXAccountType(n.type)}\n</BANKACCTFROM>\n<BANKTRANLIST>\n<DTSTART>${t}\n<DTEND>${t}\n`;for(const e of r){const t=new Date(e.date).toISOString().replace(/[-:]/g,"").split(".")[0],n="expense"===e.type?`-${e.amount}`:`${e.amount}`;a+=`<STMTTRN>\n<TRNTYPE>${"expense"===e.type?"DEBIT":"CREDIT"}\n<DTPOSTED>${t}\n<TRNAMT>${n}\n<FITID>${e.id}\n<NAME>${e.description||""}\n<MEMO>${e.note||""}\n</STMTTRN>\n`}a+=`</BANKTRANLIST>\n<LEDGERBAL>\n<BALAMT>${n.balance}\n<DTASOF>${t}\n</LEDGERBAL>\n</STMTRS>\n`}return a+="</STMTTRNRS>\n</BANKMSGSRSV1>\n</OFX>",a}mapAccountType(e){return{current:"Bank",checking:"Bank",savings:"Bank",credit:"CCard",loan:"Liability",investment:"Investment",other:"Bank"}[e]||"Bank"}mapOFXAccountType(e){return{current:"CHECKING",checking:"CHECKING",savings:"SAVINGS",credit:"CREDITLINE",loan:"LOAN",investment:"INVESTMENT",other:"CHECKING"}[e]||"CHECKING"}async exportData(e,t){const{format:a}=t;switch(a){case"csv":return this.exportToCSV(e,t);case"pdf":return await this.exportToPDF(e,t);case"xlsx":return await this.exportToExcel(e,t);case"json":return JSON.stringify(e,null,2);case"qif":if(!e.transactions||!e.accounts)throw new Error("QIF export requires transactions and accounts data");return this.exportToQIF({transactions:e.transactions,accounts:e.accounts});case"ofx":if(!e.transactions||!e.accounts)throw new Error("OFX export requires transactions and accounts data");return this.exportToOFX({transactions:e.transactions,accounts:e.accounts});default:throw new Error(`Unsupported export format: ${a}`)}}};var Pd={};const Md=new class{BACKUP_CONFIG_KEY="money_management_backup_config";BACKUP_HISTORY_KEY="money_management_backup_history";MAX_HISTORY_ENTRIES=30;async initializeBackups(){if(this.getBackupConfig().enabled)if("periodicSync"in self.registration)try{"granted"===(await navigator.permissions.query({name:"periodic-background-sync"})).state?await this.registerPeriodicSync():(console.log("[AutomaticBackup] Periodic sync permission not granted"),this.setupFallbackScheduler())}catch(e){console.error("[AutomaticBackup] Failed to setup periodic sync:",e),this.setupFallbackScheduler()}else this.setupFallbackScheduler()}async registerPeriodicSync(){const e=this.getBackupConfig(),t=await navigator.serviceWorker.ready,a=this.getMinInterval(e.frequency);try{await t.periodicSync.register("automatic-backup",{minInterval:a}),console.log("[AutomaticBackup] Periodic sync registered")}catch(n){throw console.error("[AutomaticBackup] Failed to register periodic sync:",n),n}}getMinInterval(e){switch(e){case"daily":default:return 864e5;case"weekly":return 6048e5;case"monthly":return 2592e6}}setupFallbackScheduler(){const e=this.getLastBackupTime(),t=this.getBackupConfig(),a=this.calculateNextBackupTime(e,t);Date.now()>=a&&this.performBackup(),setInterval(()=>{Date.now()>=this.calculateNextBackupTime(this.getLastBackupTime(),this.getBackupConfig())&&this.performBackup()},36e5)}async performBackup(){const e=this.getBackupConfig();if(e.enabled)try{console.log("[AutomaticBackup] Starting backup...");const t=await this.collectBackupData(),a=[];if("json"===e.format||"all"===e.format){const n=await this.createJSONBackup(t,e);a.push(n)}if("csv"===e.format||"all"===e.format){const e=await this.createCSVBackup(t);a.push(e)}await this.storeBackups(a,e),this.updateBackupHistory({timestamp:Date.now(),success:!0,format:e.format,filesCreated:a.length}),await this.cleanupOldBackups(e.retentionDays),this.sendBackupNotification(!0),console.log("[AutomaticBackup] Backup completed successfully")}catch(t){console.error("[AutomaticBackup] Backup failed:",t),this.updateBackupHistory({timestamp:Date.now(),success:!1,error:t instanceof Error?t.message:"Unknown error"}),this.sendBackupNotification(!1,t)}}async collectBackupData(){const e=["money_management_transactions","money_management_accounts","money_management_categories","money_management_tags","money_management_budgets","money_management_goals","money_management_investments","money_management_recurring_transactions","money_management_preferences","money_management_import_profiles","money_management_import_rules","money_management_scheduled_reports"],t={version:"2.0",timestamp:(new Date).toISOString(),app_version:Pd.REACT_APP_VERSION||"1.4.7"};for(const n of e){const e=localStorage.getItem(n);if(e)try{t[n.replace("money_management_","")]=JSON.parse(e)}catch(a){}}return t}async createJSONBackup(e,t){let a=JSON.stringify(e,null,2);return t.encryptionEnabled&&(a=await this.encryptData(a)),{format:"json",data:new Blob([a],{type:"application/json"}),filename:`wealthtracker-backup-${(new Date).toISOString().split("T")[0]}.json`}}async createCSVBackup(e){const t={startDate:new Date(0),endDate:new Date,includeTransactions:!0,includeAccounts:!0,includeInvestments:!0,includeBudgets:!0,format:"csv"},a=await Ld.exportData({transactions:e.transactions||[],accounts:e.accounts||[],investments:e.investments||[],budgets:e.budgets||[]},t);return{format:"csv",data:new Blob([a],{type:"text/csv"}),filename:`wealthtracker-backup-${(new Date).toISOString().split("T")[0]}.csv`}}async encryptData(e){const t=(new TextEncoder).encode(e),a=await crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),n=crypto.getRandomValues(new Uint8Array(12)),r=await crypto.subtle.encrypt({name:"AES-GCM",iv:n},a,t),s=new Uint8Array(n.length+r.byteLength);return s.set(n),s.set(new Uint8Array(r),n.length),btoa(String.fromCharCode(...s))}async storeBackups(e,t){const a=(await this.openBackupDB()).transaction(["backups"],"readwrite").objectStore("backups");for(const n of e)await a.add({filename:n.filename,format:n.format,data:n.data,timestamp:Date.now(),cloudSynced:!1});t.cloudProvider&&await this.syncToCloud(e,t.cloudProvider)}async openBackupDB(){return new Promise((e,t)=>{const a=indexedDB.open("WealthTrackerBackups",1);a.onerror=()=>t(a.error),a.onsuccess=()=>e(a.result),a.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains("backups")){const e=t.createObjectStore("backups",{keyPath:"id",autoIncrement:!0});e.createIndex("timestamp","timestamp",{unique:!1}),e.createIndex("format","format",{unique:!1})}}})}async syncToCloud(e,t){}async cleanupOldBackups(e){const t=(await this.openBackupDB()).transaction(["backups"],"readwrite").objectStore("backups").index("timestamp"),a=Date.now()-24*e*60*60*1e3,n=IDBKeyRange.upperBound(a),r=t.openCursor(n);return new Promise((e,t)=>{r.onsuccess=()=>{const t=r.result;t?(t.delete(),t.continue()):e()},r.onerror=()=>t(r.error)})}sendBackupNotification(e,t){if("Notification"in window&&"granted"===Notification.permission){const a=new Notification(e?"Backup Completed":"Backup Failed",{body:e?"Your financial data has been backed up successfully.":`Backup failed: ${t?.message||"Unknown error"}`,icon:"/icon-192.png",tag:"backup-notification"});a.onclick=()=>{window.focus(),a.close()}}}getBackupConfig(){const e=localStorage.getItem(this.BACKUP_CONFIG_KEY);if(e)try{return JSON.parse(e)}catch(t){console.error("Failed to parse backup config:",t)}return{enabled:!1,frequency:"daily",time:"02:00",format:"json",encryptionEnabled:!0,retentionDays:30,includeAttachments:!1}}updateBackupConfig(e){const t={...this.getBackupConfig(),...e};localStorage.setItem(this.BACKUP_CONFIG_KEY,JSON.stringify(t)),void 0!==e.enabled&&this.initializeBackups()}getLastBackupTime(){const e=this.getBackupHistory().filter(e=>e.success);return 0===e.length?0:Math.max(...e.map(e=>e.timestamp))}calculateNextBackupTime(e,t){const[a,n]=t.time.split(":").map(Number),r=new Date(e);if(r.setHours(a,n,0,0),r.getTime()<=e)switch(t.frequency){case"daily":r.setDate(r.getDate()+1);break;case"weekly":r.setDate(r.getDate()+7);break;case"monthly":r.setMonth(r.getMonth()+1)}return r.getTime()}getBackupHistory(){const e=localStorage.getItem(this.BACKUP_HISTORY_KEY);if(e)try{return JSON.parse(e)}catch(t){console.error("Failed to parse backup history:",t)}return[]}updateBackupHistory(e){const t=this.getBackupHistory();t.unshift(e),t.length>this.MAX_HISTORY_ENTRIES&&t.splice(this.MAX_HISTORY_ENTRIES),localStorage.setItem(this.BACKUP_HISTORY_KEY,JSON.stringify(t))}async getStoredBackups(){const e=(await this.openBackupDB()).transaction(["backups"],"readonly").objectStore("backups").getAll();return new Promise((t,a)=>{e.onsuccess=()=>{const a=e.result.map(e=>({id:e.id,filename:e.filename,format:e.format,timestamp:e.timestamp,size:e.data.size,cloudSynced:e.cloudSynced}));t(a)},e.onerror=()=>a(e.error)})}async downloadBackup(e){const t=(await this.openBackupDB()).transaction(["backups"],"readonly").objectStore("backups").get(e);return new Promise((e,a)=>{t.onsuccess=()=>{const n=t.result;if(n){const t=URL.createObjectURL(n.data),a=document.createElement("a");a.href=t,a.download=n.filename,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),e()}else a(new Error("Backup not found"))},t.onerror=()=>a(t.error)})}async deleteBackup(e){const t=(await this.openBackupDB()).transaction(["backups"],"readwrite").objectStore("backups");return new Promise((a,n)=>{const r=t.delete(e);r.onsuccess=()=>a(),r.onerror=()=>n(r.error)})}},Od=gt.createContext(void 0);class Bd extends gt.Component{state={hasError:!1,error:null,errorInfo:null};static getDerivedStateFromError(e){return{hasError:!0,error:e,errorInfo:null}}componentDidCatch(e,t){console.error("DebugErrorBoundary caught:",e,t),this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?pt.jsx("div",{className:"min-h-screen bg-red-50 p-8",children:pt.jsxs("div",{className:"max-w-4xl mx-auto",children:[pt.jsx("h1",{className:"text-3xl font-bold text-red-600 mb-4",children:"Application Error"}),pt.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg mb-4",children:[pt.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Error Message:"}),pt.jsx("pre",{className:"bg-gray-100 p-4 rounded overflow-auto text-sm",children:this.state.error?.toString()})]}),pt.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg mb-4",children:[pt.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Stack Trace:"}),pt.jsx("pre",{className:"bg-gray-100 p-4 rounded overflow-auto text-sm text-red-600",children:this.state.error?.stack})]}),this.state.errorInfo&&pt.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg mb-4",children:[pt.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Component Stack:"}),pt.jsx("pre",{className:"bg-gray-100 p-4 rounded overflow-auto text-sm",children:this.state.errorInfo.componentStack})]}),pt.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Reload Page"})]})}):this.props.children}}const Rd=Xe(()=>jr(()=>import("./Login-BQOM3qFs.js"),__vite__mapDeps([3,1,0,2]))),Fd=Xe(()=>jr(()=>import("./Welcome-CK97tJfu.js"),__vite__mapDeps([4,1,0,2,5]))),Ud=Xe(()=>jr(()=>import("./Dashboard-CKYEzZh9.js"),__vite__mapDeps([6,0,1,2,7,5]))),zd=Xe(()=>jr(()=>import("./Accounts-DWAHY6JV.js"),__vite__mapDeps([8,1,0,2,9,10,7,11,5]))),$d=Xe(()=>jr(()=>import("./chunk-Cl45ftLB.js").then(e=>e.T),__vite__mapDeps([12,0,1,2,10,7,9,13]))),Gd=Xe(()=>jr(()=>import("./TransactionsComparison-xFnX20kn.js"),__vite__mapDeps([14,1,0,2,7,15,13,5,10,16,17,18,19]))),qd=Xe(()=>jr(()=>import("./Reconciliation-BEG42rr4.js"),__vite__mapDeps([20,1,0,2,9,16,17,18,19,5,10]))),Hd=Xe(()=>jr(()=>import("./Investments-CKGQFPIi.js"),__vite__mapDeps([21,1,0,2,22,10,23,7,5]))),Wd=Xe(()=>jr(()=>import("./Budget-C5Sxc-SB.js"),__vite__mapDeps([24,1,0,2,10,9,23,11,25,7,5]))),Yd=Xe(()=>jr(()=>import("./Goals-CKPqtF9Z.js"),__vite__mapDeps([26,1,0,2,9,7,11,10,5]))),Vd=Xe(()=>jr(()=>import("./Analytics-DvOGMZoC.js"),__vite__mapDeps([27,0,1,2,5,10,7]))),Qd=Xe(()=>jr(()=>import("./AdvancedAnalytics-3zCkBTdG.js"),__vite__mapDeps([28,1,0,2,7,5,10]))),Jd=Xe(()=>jr(()=>import("./AIFeatures-BIZ9RYX-.js"),__vite__mapDeps([29,1,0,2,7,30,31,5,25]))),Kd=Xe(()=>jr(()=>import("./CustomReports-CveoPPjF.js"),__vite__mapDeps([32,1,0,2,5]))),Zd=Xe(()=>jr(()=>import("./TaxPlanning-fxiutPR7.js"),__vite__mapDeps([33,1,0,2,7,5,10]))),Xd=Xe(()=>jr(()=>import("./Settings-BVzvAdlF.js"),__vite__mapDeps([34,1,0,2,7,5]))),eu=Xe(()=>jr(()=>import("./AppSettings-DezeLrio.js"),__vite__mapDeps([35,1,0,2,7,10,5]))),tu=Xe(()=>jr(()=>import("./DataManagement-SI4p66IV.js"),__vite__mapDeps([36,0,1,2,5]))),au=Xe(()=>jr(()=>import("./Categories-DM42StY8.js"),__vite__mapDeps([37,1,0,2,17,10,9,7,5]))),nu=Xe(()=>jr(()=>import("./Tags-Bdon49t2.js"),__vite__mapDeps([38,1,0,2,9,7,5]))),ru=Xe(()=>jr(()=>import("./DeletedAccounts-Cn6cOMzp.js"),__vite__mapDeps([39,1,0,2,7,10,5]))),su=Xe(()=>jr(()=>import("./SecuritySettings-C85EcfZ4.js"),__vite__mapDeps([40,1,0,2,41,7,5]))),ou=Xe(()=>jr(()=>import("./AuditLogs-5XgCSMNl.js"),__vite__mapDeps([42,1,0,2,41,7,43,5]))),iu=Xe(()=>jr(()=>import("./Notifications-B6eA2A1f.js"),__vite__mapDeps([44,1,0,2,7,5]))),cu=Xe(()=>jr(()=>import("./AccessibilitySettings-Cg027gg4.js"),__vite__mapDeps([45,1,0,2,7,5]))),lu=Xe(()=>jr(()=>import("./AccessibilityDashboard-BCbH7IOI.js"),__vite__mapDeps([46,1,0,2,5]))),du=Xe(()=>jr(()=>import("./AccountTransactions-DxdtMyyl.js"),__vite__mapDeps([47,1,0,2,10,16,17,18,19,5,43]))),uu=Xe(()=>jr(()=>import("./FinancialSummaries-CKQcTEjI.js"),__vite__mapDeps([48,1,0,2,5,7,10]))),mu=Xe(()=>jr(()=>import("./EnhancedInvestments-lgSu_GaN.js"),__vite__mapDeps([49,1,0,2,10,22,25,50,7,5]))),gu=Xe(()=>jr(()=>import("./HouseholdManagement-C0MgbNrl.js"),__vite__mapDeps([51,1,0,2,7,25,5]))),pu=Xe(()=>jr(()=>import("./MobileFeatures-jfZlg_xK.js"),__vite__mapDeps([52,1,0,2,7,10,5]))),hu=Xe(()=>jr(()=>import("./BusinessFeatures-PcUgKcan.js"),__vite__mapDeps([53,1,0,2,7,5]))),yu=Xe(()=>jr(()=>import("./FinancialPlanning-IzJU2LJd.js"),__vite__mapDeps([54,1,0,2,7,5]))),fu=Xe(()=>jr(()=>import("./DataIntelligence-jO6BSNjB.js"),__vite__mapDeps([55,1,0,2,7,5]))),bu=Xe(()=>jr(()=>import("./ExportManager-DnB7ZSsv.js"),__vite__mapDeps([56,1,0,2,7,5]))),xu=Xe(()=>jr(()=>import("./Advanced-BGjf7M7I.js"),__vite__mapDeps([57,1,0,2,7,5]))),wu=Xe(()=>jr(()=>import("./EnhancedImport-CH1BCUTd.js"),__vite__mapDeps([58,1,0,2,59,7,60,31,61,62,63,5,64]))),vu=Xe(()=>jr(()=>import("./Documents-BcLEVGQa.js"),__vite__mapDeps([65,1,0,2,7,18,19,5]))),Su=Xe(()=>jr(()=>import("./OCRTest-BmxmDO80.js"),__vite__mapDeps([66,1,0,2,19,5]))),ku=Xe(()=>jr(()=>import("./OpenBanking-C5Uu6nDH.js"),__vite__mapDeps([67,1,0,2,7,5]))),Iu=Xe(()=>jr(()=>import("./Performance-DbpfWd86.js"),__vite__mapDeps([68,1,0,2,7]))),ju=Xe(()=>jr(()=>import("./Subscription-CC8vFUyZ.js"),__vite__mapDeps([69,1,0,2,7,5]))),Cu=new class{vapidPublicKey;registration=null;constructor(){this.vapidPublicKey="BKcvxvtwNpK2QFYwpwKyTjdGaNzHKdvLXYqfT2VzQd6X0gSJI_6R5gSjB2LqvJJcQ_8G9pYsvGLPCmWYYZrJe1Y"}async initialize(){try{if(!("serviceWorker"in navigator))return void console.warn("Service Worker not supported");if(!("PushManager"in window))return void console.warn("Push notifications not supported");const e=await navigator.serviceWorker.ready;this.registration=e;const t=await this.getPermissionState();console.log("Push notification permission:",t)}catch(e){console.error("Failed to initialize push notifications:",e)}}async requestPermission(){try{const e=await Notification.requestPermission();return"granted"===e&&await this.subscribe(),e}catch(e){return console.error("Failed to request notification permission:",e),"denied"}}async getPermissionState(){return Notification.permission}async isSubscribed(){return!!this.registration&&null!==await this.registration.pushManager.getSubscription()}async subscribe(){if(!this.registration)throw new Error("Service worker not registered");try{const e=this.urlBase64ToUint8Array(this.vapidPublicKey),t=await this.registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e});return await this.sendSubscriptionToServer(t),t}catch(e){return console.error("Failed to subscribe to push notifications:",e),null}}async unsubscribe(){if(!this.registration)return!1;try{const e=await this.registration.pushManager.getSubscription();return!!e&&(await e.unsubscribe(),await this.removeSubscriptionFromServer(e),!0)}catch(e){return console.error("Failed to unsubscribe from push notifications:",e),!1}}async sendSubscriptionToServer(e){try{await fetch("/api/notifications/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:e,preferences:this.getNotificationPreferences()})})}catch(t){console.error("Failed to send subscription to server:",t)}}async removeSubscriptionFromServer(e){try{await fetch("/api/notifications/unsubscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:e})})}catch(t){console.error("Failed to remove subscription from server:",t)}}async updatePreferences(e){if(localStorage.setItem("notificationPreferences",JSON.stringify(e)),await this.isSubscribed())try{await fetch("/api/notifications/preferences",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({preferences:e})})}catch(t){console.error("Failed to update notification preferences:",t)}}getNotificationPreferences(){const e=localStorage.getItem("notificationPreferences");return e?JSON.parse(e):{budgetAlerts:!0,billReminders:!0,goalAchievements:!0,investmentAlerts:!0,weeklyReports:!1,unusualSpending:!0}}async showNotification(e){if(!this.registration)throw new Error("Service worker not registered");if("granted"!==Notification.permission)throw new Error("Notification permission not granted");await this.registration.showNotification(e.title,{body:e.body,icon:e.icon||"/icon-192.png",badge:e.badge||"/badge-72.png",tag:e.tag,data:e.data,actions:e.actions,requireInteraction:e.requireInteraction})}async testNotification(){await this.showNotification({title:"WealthTracker Test",body:"Push notifications are working! \ud83c\udf89",tag:"test-notification",data:{type:"test",timestamp:Date.now()}})}urlBase64ToUint8Array(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),a=window.atob(t),n=new Uint8Array(a.length);for(let r=0;r<a.length;++r)n[r]=a.charCodeAt(r);return n}static getNotificationConfig(e,t){switch(e){case"budget-alert":return{title:"\ud83d\udcb0 Budget Alert",body:`You've used ${t.percentage}% of your ${t.category} budget`,tag:"budget-alert",data:{type:"budget-alert",...t},actions:[{action:"view",title:"View Budget"},{action:"dismiss",title:"Dismiss"}]};case"bill-reminder":return{title:"\ud83d\udcc5 Bill Due Soon",body:`${t.name} - $${t.amount} due in ${t.daysUntilDue} days`,tag:`bill-${t.id}`,data:{type:"bill-reminder",...t},requireInteraction:!0,actions:[{action:"pay",title:"Mark as Paid"},{action:"remind-later",title:"Remind Later"}]};case"goal-achieved":return{title:"\ud83c\udf89 Goal Achieved!",body:`Congratulations! You've reached your "${t.name}" goal`,tag:`goal-${t.id}`,data:{type:"goal-achieved",...t}};case"investment-alert":return{title:"\ud83d\udcc8 Investment Alert",body:t.message||"Check your portfolio for important updates",tag:"investment-alert",data:{type:"investment-alert",...t}};case"weekly-report":return{title:"\ud83d\udcca Weekly Summary",body:"Your weekly financial report is ready",tag:"weekly-report",data:{type:"weekly-report",...t}};case"unusual-spending":return{title:"\u26a0\ufe0f Unusual Spending Detected",body:`Spending in ${t.category} is ${t.percentage}% higher than usual`,tag:"unusual-spending",data:{type:"unusual-spending",...t},requireInteraction:!0};default:return{title:"WealthTracker",body:t.message||"You have a new notification",data:t}}}},Nu=()=>{const[e,t]=React.useState("default"),[a,n]=React.useState(!1),[r,s]=React.useState(Cu.getNotificationPreferences());return React.useEffect(()=>{(async()=>{const e=await Cu.getPermissionState();t(e);const a=await Cu.isSubscribed();n(a)})()},[]),{permission:e,isSubscribed:a,preferences:r,requestPermission:React.useCallback(async()=>{const e=await Cu.requestPermission();if(t(e),"granted"===e){const e=await Cu.isSubscribed();n(e)}return e},[]),subscribe:React.useCallback(async()=>{const e=await Cu.subscribe();return e&&n(!0),e},[]),unsubscribe:React.useCallback(async()=>{const e=await Cu.unsubscribe();return e&&n(!1),e},[]),updatePreferences:React.useCallback(async e=>{await Cu.updatePreferences(e),s(e)},[]),testNotification:React.useCallback(async()=>{await Cu.testNotification()},[])}};"undefined"!=typeof window&&(jr(async()=>{const{setupCSPReporting:e,applyCSPMetaTag:t}=await import("./csp-CBU0zWI4.js");return{setupCSPReporting:e,applyCSPMetaTag:t}},[]).then(({setupCSPReporting:e,applyCSPMetaTag:t})=>{e(),void 0!==import.meta&&t()}),jr(async()=>{const{setupCSRFForForms:e,setupDoubleSubmitCookie:t}=await import("./csrf-protection-Cy0XUYjU.js");return{setupCSRFForForms:e,setupDoubleSubmitCookie:t}},__vite__mapDeps([70,1,0,2])).then(({setupCSRFForForms:e,setupDoubleSubmitCookie:t})=>{e(),t()}),jr(async()=>{const{initializeRateLimiter:e}=await import("./rate-limiting-kZmhB5dy.js");return{initializeRateLimiter:e}},[]).then(({initializeRateLimiter:e})=>{e()})),"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(e=>{for(const t of e)t.active?.scriptURL.includes("sw.js")||t.unregister()}),window.addEventListener("error",e=>{console.error("Global error:",e.error)}),window.addEventListener("unhandledrejection",e=>{console.error("Unhandled promise rejection:",e.reason)}),document.documentElement.classList.remove("dark");try{const e=document.getElementById("root");e?(console.log("Starting React app..."),Sr.createRoot(e).render(pt.jsx(gt.StrictMode,{children:pt.jsx(Or,{children:pt.jsx(kr,{publishableKey:"pk_test_bWF0dXJlLXJhdHRsZXNuYWtlLTc1LmNsZXJrLmFjY291bnRzLmRldiQ",afterSignOutUrl:"/",appearance:{variables:{colorPrimary:"#3b82f6"}},allowedRedirectOrigins:[window.location.origin],children:pt.jsx(Ir,{store:Us,children:pt.jsx(mt,{})})})})})),console.log("React app rendered")):console.error("Root element not found!")}catch(Du){console.error("Error rendering app:",Du)}!function(e){if("serviceWorker"in navigator){let t="/";try{void 0!==import.meta&&Rl&&(t="/")}catch{}if(new URL(t,window.location.href).origin!==window.location.origin)return;window.addEventListener("load",()=>{const a=`${t}sw.js`;Fl?(function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then(a=>{const n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):ye(e,t)}).catch(()=>{})}(a,e),navigator.serviceWorker.ready.then(()=>{})):ye(a,e)}),e?.onOffline&&window.addEventListener("offline",e.onOffline),e?.onOnline&&window.addEventListener("online",e.onOnline)}}({onSuccess:async e=>{window.swRegistration=e;try{await Cu.initialize(),console.log("Push notifications initialized")}catch(Du){console.error("Failed to initialize push notifications:",Du)}},onUpdate:e=>{window.swRegistration=e,window.dispatchEvent(new CustomEvent("sw-update-available",{detail:{registration:e}}))},onOffline:()=>{window.dispatchEvent(new Event("app-offline"))},onOnline:()=>{window.dispatchEvent(new Event("app-online"))}});export{to as $,oc as A,Js as B,Wo as C,no as D,ao as E,go as F,uo as G,qs as H,Do as I,ot as J,st as K,mo as L,Se as M,lo as N,zs as O,ri as P,$s as Q,Eo as R,Zo as S,Xs as T,Qo as U,fs as V,Pi as W,ro as X,We as Y,Hi as Z,Wi as _,E as a,Oo as a$,ko as a0,Qs as a1,po as a2,Yi as a3,Fe as a4,ac as a5,ic as a6,cc as a7,Xi as a8,ed as a9,xo as aA,So as aB,yo as aC,fo as aD,ji as aE,Yo as aF,Si as aG,Go as aH,Ld as aI,ui as aJ,q as aK,Je as aL,ci as aM,Ro as aN,Ws as aO,Uo as aP,$o as aQ,xi as aR,ii as aS,oi as aT,ai as aU,To as aV,Xo as aW,zo as aX,Lo as aY,qe as aZ,Ti as a_,vo as aa,Mi as ab,Po as ac,at as ad,Li as ae,He as af,Ao as ag,Ks as ah,o as ai,ho as aj,Co as ak,Ni as al,Di as am,Mo as an,Zi as ao,Qi as ap,li as aq,di as ar,T as as,nt as at,qo as au,k as av,Ii as aw,Bi as ax,_o as ay,bo as az,O as b,co as b0,Al as b1,Bo as b2,lt as b3,ti as b4,Jo as b5,Vo as b6,Nu as b7,sc as b8,rc as b9,fi as bA,gi as bB,yi as bC,pi as bD,wi as bE,Ji as bF,hi as bG,Cl as bH,rd as bI,Le as bJ,Ko as bK,ki as bL,Tl as bM,Ai as bN,_i as bO,Vi as bP,Md as bQ,ec as ba,dc as bb,lc as bc,nc as bd,oe as be,ie as bf,tc as bg,uc as bh,Ci as bi,ei as bj,wo as bk,Ki as bl,Ho as bm,Re as bn,Ue as bo,si as bp,Oi as bq,bi as br,Ge as bs,Ri as bt,oo as bu,bd as bv,Gi as bw,zr as bx,e as by,mi as bz,rt as c,ke as d,Ie as e,vi as f,Be as g,Oe as h,Io as i,Me as j,Fo as k,Pe as l,Ys as m,jo as n,Vs as o,eo as p,Zs as q,Hs as r,Fr as s,S as t,d as u,io as v,ee as w,so as x,m as y,je as z};
