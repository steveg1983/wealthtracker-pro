function e({selectedTags:e,onTagsChange:t,placeholder:s="Add tags...",allowNewTags:o=!0,className:c=""}){const{tags:i,addTag:l,getTagUsageCount:g}=n(),[m,x]=a.useState(""),[u,p]=a.useState(!1),[h,y]=a.useState(-1),b=a.useRef(null),f=a.useRef(null),j=i.filter(t=>t.name.toLowerCase().includes(m.toLowerCase())&&!e.includes(t.name)),k=i.find(e=>e.name.toLowerCase()===m.toLowerCase());a.useEffect(()=>{const e=e=>{f.current&&!f.current.contains(e.target)&&(p(!1),y(-1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const N=a=>{e.includes(a)||t([...e,a]),x(""),p(!1),y(-1)},v=e=>{l({name:e,color:"#6B7280",description:"Created during transaction entry"}),N(e)},w=e=>{const t=i.find(t=>t.name===e);return t?.color||"#6B7280"};return r.jsxs("div",{className:`relative ${c}`,ref:f,children:[e.length>0&&r.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:e.map(a=>r.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-white rounded-full text-sm font-medium",style:{backgroundColor:w(a)},children:[a,r.jsx("button",{type:"button",onClick:()=>{return r=a,void t(e.filter(e=>e!==r));var r},className:"text-white/80 hover:text-white",children:r.jsx(I,{size:14})})]},a))}),r.jsxs("div",{className:"relative",children:[r.jsx("input",{ref:b,type:"text",value:m,onChange:e=>{const t=e.target.value;x(t),p(t.length>0),y(-1)},onFocus:()=>{m.length>0&&p(!0)},onKeyDown:e=>{if(!u)return;const t=j.length+(o&&m.trim()&&!k?1:0);switch(e.key){case"ArrowDown":e.preventDefault(),y(e=>(e+1)%t);break;case"ArrowUp":e.preventDefault(),y(e=>e<=0?t-1:e-1);break;case"Enter":e.preventDefault(),h>=0&&h<j.length?N(j[h].name):h===j.length&&o&&m.trim()&&!k?v(m.trim()):m.trim()&&(k?N(k.name):o&&v(m.trim()));break;case"Escape":p(!1),y(-1)}},placeholder:s,className:"w-full px-3 py-2 h-[42px] bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-300/50 dark:border-gray-600/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white"}),u&&(j.length>0||o&&m.trim()&&!k)&&r.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-60 overflow-y-auto z-50",children:[j.map((e,t)=>{const a=g(e.name);return r.jsxs("div",{className:"px-3 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 "+(h===t?"bg-gray-100 dark:bg-gray-600":""),onClick:()=>N(e.name),children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),r.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),r.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",a," uses)"]})]}),e.description&&r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 ml-5",children:e.description})]},e.id)}),o&&m.trim()&&!k&&r.jsxs("div",{className:"px-3 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 border-t border-gray-200 dark:border-gray-600 "+(h===j.length?"bg-gray-100 dark:bg-gray-600":""),onClick:()=>v(m.trim()),children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(d,{size:14,className:"text-green-600 dark:text-green-400"}),r.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:['Create "',m.trim(),'"']})]}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 ml-5",children:"Create new tag and add to transaction"})]})]})]}),0===e.length&&r.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 flex items-center gap-1",children:[r.jsx(z,{size:12}),"Type to search existing tags or create new ones"]})]})}function t({isOpen:t,onClose:c,transaction:d}){const{accounts:I,categories:z,updateTransaction:W,deleteTransaction:F,getSubCategories:L,getDetailCategories:A}=n(),{addTransaction:E}=function(){const{addTransaction:e,transactions:t}=n(),{checkLargeTransaction:r,checkEnhancedTransactionAlerts:s}=o();return{addTransaction:a.useCallback(a=>{const n={...a,id:`transaction-${Date.now()}`};e(a),s(n,t),"expense"===a.type&&r(a.amount,a.description)},[e,r,s,t])}}(),[O,M]=a.useState(!1),[$,q]=a.useState(!1),[H,R]=a.useState({}),[B,P]=a.useState(""),U=a.useRef(null),G=d?{date:d.date instanceof Date?d.date.toISOString().split("T")[0]:new Date(d.date).toISOString().split("T")[0],description:d.description,amount:"transfer"===d.type?d.amount.toString():Math.abs(d.amount).toString(),type:d.type,category:"",subCategory:"",accountId:d.accountId,tags:d.tags||[],notes:d.notes||"",cleared:d.cleared||!1,reconciledWith:d.reconciledWith||""}:{date:(new Date).toISOString().split("T")[0],description:"",amount:"",type:"expense",category:"",subCategory:"",accountId:I.length>0?I[0].id:"",tags:[],notes:"",cleared:!1,reconciledWith:""},{formData:K,updateField:X,handleSubmit:Y,setFormData:J}=i(G,{onSubmit:e=>{try{R({});const t=T.validateTransaction({id:d?.id,description:e.description,amount:e.amount,type:"transfer"===e.type?"expense":e.type,category:e.category,accountId:e.accountId,date:e.date,tags:e.tags.length>0?e.tags:void 0,notes:e.notes.trim()||void 0}),a={date:new Date(t.date),description:t.description,amount:parseFloat(t.amount),type:e.type,category:t.category,accountId:t.accountId,tags:t.tags,notes:t.notes,cleared:e.cleared,reconciledWith:e.reconciledWith.trim()||void 0};d?W(d.id,a):E(a),c()}catch(t){t instanceof s?R(T.formatErrors(t)):(console.error("Failed to update transaction:",t),R({general:"Failed to update transaction. Please try again."}))}},onClose:()=>{R({}),c()}}),Q=L(`type-${K.type}`),V=e=>{const t="string"==typeof e?parseFloat(e):e;if(isNaN(t))return"";const a=t<0,r=new Intl.NumberFormat("en-GB",{minimumFractionDigits:2,maximumFractionDigits:2}).format(Math.abs(t));return a?`-${r}`:r};return a.useEffect(()=>{if(d){const e=z.find(e=>e.id===d.category),t=e?.parentId||"",a=e?.parentId?d.category:"",r="transfer"===d.type?d.amount.toString():Math.abs(d.amount).toString();J({date:d.date instanceof Date?d.date.toISOString().split("T")[0]:new Date(d.date).toISOString().split("T")[0],description:d.description,amount:r,type:d.type,category:a,subCategory:t,accountId:d.accountId,tags:d.tags||[],notes:d.notes||"",cleared:d.cleared||!1,reconciledWith:d.reconciledWith||""}),P(V(r))}else{const e=(new Date).toISOString().split("T")[0];J({date:e,description:"",amount:"",type:"expense",subCategory:"",category:"",accountId:I.length>0?I[0].id:"",tags:[],notes:"",cleared:!1,reconciledWith:""}),P("")}M(!1)},[d,I,z,J]),r.jsxs(r.Fragment,{children:[r.jsx(l,{isOpen:t,onClose:c,title:d?"Edit Transaction":"New Transaction",size:"xl",children:r.jsxs("form",{onSubmit:Y,children:[r.jsx(g,{children:r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4",children:[r.jsxs("div",{className:"md:col-span-5",children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r.jsx(m,{size:16}),"Date"]}),r.jsx("input",{type:"date",value:K.date,onChange:e=>X("date",e.target.value),className:"w-full px-3 py-3 sm:py-2 h-12 sm:h-[42px] text-base sm:text-sm bg-white dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-blue-400 focus:border-transparent dark:text-white",required:!0})]}),r.jsxs("div",{className:"md:col-span-7",children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r.jsx(x,{size:16}),"Account"]}),r.jsxs("select",{value:K.accountId,onChange:e=>X("accountId",e.target.value),className:"w-full px-3 py-3 sm:py-2 h-12 sm:h-[42px] text-base sm:text-sm bg-white dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-blue-400 focus:border-transparent dark:text-white",required:!0,children:[r.jsx("option",{value:"",children:"Select account"}),I.map(e=>r.jsxs("option",{value:e.id,children:[e.name," (",e.type,")"]},e.id))]})]}),r.jsxs("div",{className:"md:col-span-12",children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r.jsx(u,{size:16}),"Description"]}),r.jsx("input",{type:"text",value:K.description,onChange:e=>X("description",e.target.value),className:"w-full px-3 py-3 sm:py-2 h-12 sm:h-[42px] text-base sm:text-sm bg-white dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-blue-400 focus:border-transparent dark:text-white",required:!0})]}),r.jsxs("div",{className:"md:col-span-12",children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r.jsx(p,{size:16}),"Type"]}),r.jsxs("div",{className:"flex gap-4 items-center h-[42px]",children:[r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"radio",value:"income",checked:"income"===K.type,onChange:e=>X("type",e.target.value),className:"mr-2"}),r.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Income"})]}),r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"radio",value:"expense",checked:"expense"===K.type,onChange:e=>X("type",e.target.value),className:"mr-2"}),r.jsx("span",{className:"text-red-600 dark:text-red-400",children:"Expense"})]}),r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"radio",value:"transfer",checked:"transfer"===K.type,onChange:e=>X("type",e.target.value),className:"mr-2"}),r.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Transfer"})]})]})]}),r.jsxs("div",{className:"md:col-span-5",children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r.jsx(h,{size:16}),"Amount ",K.accountId&&(()=>{const e=I.find(e=>e.id===K.accountId);return e?`(${y(e.currency)})`:""})()]}),r.jsx("input",{ref:U,type:"text",value:B,onChange:e=>{const t=e.target.value;if(""===t||"-"===t||/^-?[0-9,]*\.?[0-9]{0,2}$/.test(t)){P(t);const e=(e=>e.replace(/,/g,""))(t);""!==e&&"-"!==e&&isNaN(parseFloat(e))||X("amount",e)}},onBlur:()=>{K.amount&&""!==K.amount&&P(V(K.amount))},onFocus:()=>{U.current&&U.current.select()},placeholder:"0.00",className:"w-full px-3 py-2 h-[42px] text-right bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-300/50 dark:border-gray-600/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent "+(K.amount&&parseFloat(K.amount)<0?"text-red-600 dark:text-red-400":K.amount&&parseFloat(K.amount)>0?"text-green-600 dark:text-green-400":"text-gray-900 dark:text-white"),required:!0})]}),r.jsxs("div",{className:"md:col-span-12 space-y-3",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex justify-between items-center mb-1",children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:[r.jsx(b,{size:16}),"Category"]}),r.jsxs("button",{type:"button",onClick:()=>q(!0),className:"text-sm text-primary hover:text-secondary flex items-center gap-1",children:[r.jsx(f,{size:14}),"Create new category"]})]}),r.jsxs("select",{value:K.subCategory,onChange:e=>{X("subCategory",e.target.value),X("category","")},className:"w-full px-3 py-3 sm:py-2 h-12 sm:h-[42px] text-base sm:text-sm bg-white dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-blue-400 focus:border-transparent dark:text-white",required:!0,children:[r.jsx("option",{value:"",children:"Select category"}),Q.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]})]}),K.subCategory&&r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r.jsx("div",{className:"w-4 h-4"}),"Sub-category"]}),r.jsxs("select",{value:K.category,onChange:e=>X("category",e.target.value),className:"w-full px-3 py-3 sm:py-2 h-12 sm:h-[42px] text-base sm:text-sm bg-white dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-blue-400 focus:border-transparent dark:text-white",required:!0,children:[r.jsx("option",{value:"",children:"Select sub-category"}),A(K.subCategory).map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]})]})]}),r.jsxs("div",{className:"md:col-span-12",children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r.jsx(j,{size:16}),"Tags"]}),r.jsx(e,{selectedTags:K.tags,onTagsChange:e=>X("tags",e),placeholder:"Search or create tags...",allowNewTags:!0})]}),r.jsxs("div",{className:"md:col-span-12",children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r.jsx(u,{size:16}),"Notes"]}),r.jsx(k,{value:K.notes,onChange:e=>X("notes",e),placeholder:"Add notes... You can use **bold**, *italic*, [links](url), `code`, lists, etc.",maxHeight:"200px",className:"w-full"})]}),d&&r.jsxs("div",{className:"md:col-span-12",children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r.jsx(N,{size:16}),"Attachments"]}),r.jsx("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:r.jsx(D,{transactionId:d.id,compact:!0})})]}),r.jsxs("div",{className:"md:col-span-12 space-y-3",children:[r.jsxs("label",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",checked:K.cleared,onChange:e=>X("cleared",e.target.checked),className:"rounded border-gray-300 dark:border-gray-600"}),r.jsx(v,{size:16,className:"text-green-600 dark:text-green-400"}),r.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Reconciled"})]}),r.jsxs("label",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",checked:!!K.reconciledWith&&"manual"!==K.reconciledWith,disabled:!0,className:"rounded border-gray-300 dark:border-gray-600 disabled:opacity-50 disabled:cursor-not-allowed"}),r.jsx(w,{size:16,className:"text-blue-600 dark:text-blue-400"}),r.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Linked to bank statement"})]}),d?.reconciledWith&&"manual"!==d.reconciledWith&&r.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600 dark:text-blue-400",children:[r.jsx(w,{size:16}),r.jsxs("span",{children:["Reconciled with transaction ID: ",d.reconciledWith]})]})]})]})}),r.jsx(C,{children:r.jsxs("div",{className:"flex justify-between gap-3 w-full",children:[d&&r.jsx("button",{type:"button",onClick:()=>M(!0),className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600",children:"Delete"}),r.jsxs("div",{className:"flex gap-3 ml-auto",children:[r.jsx("button",{type:"button",onClick:c,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"}),r.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-secondary",children:d?"Save Changes":"Add Transaction"})]})]})})]})}),O&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-4 sm:p-6 w-full max-w-md mx-4 shadow-xl",children:[r.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Delete Transaction?"}),r.jsx("p",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-400 mb-4",children:"Are you sure you want to delete this transaction? This action cannot be undone."}),r.jsxs("div",{className:"flex gap-3 justify-end",children:[r.jsx("button",{onClick:()=>M(!1),className:"px-3 sm:px-4 py-2 text-sm sm:text-base border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"}),r.jsx("button",{onClick:()=>{d&&(F(d.id),c())},className:"px-3 sm:px-4 py-2 text-sm sm:text-base bg-red-500 text-white rounded-lg hover:bg-red-600",children:"Delete"})]})]})}),r.jsx(S,{isOpen:$,onClose:()=>q(!1),initialType:"transfer"===K.type?"expense":K.type,onCategoryCreated:e=>{const t=z.find(t=>t.id===e);t&&("detail"===t.level?(X("subCategory",t.parentId||""),X("category",e)):(X("subCategory",e),X("category",""))),q(!1)}})]})}import{r as a,H as r,cd as s}from"./chunk-DowOIOga.js";import{a as n,as as o,b1 as c,a9 as d,l as i,M as l,d as g,C as m,m as x,aH as u,bk as p,i as h,h as y,k as b,$ as f,aP as j,bs as k,bt as N,bu as v,a$ as w,e as C,j as S,bv as T}from"./index-qHm2isZb.js";import{X as I}from"./chunk-DBtIkPjn.js";import{D}from"./chunk-D0OZ1rzO.js";import"./chunk-ddLY9KjI.js";import"./chunk-B5pcS96K.js";import"./chunk-DUFDJ-wW.js";const z=e=>r.jsxs(c,{...e,children:[r.jsx("path",{d:"M4 9H20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),r.jsx("path",{d:"M4 15H20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),r.jsx("path",{d:"M10 3L8 21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),r.jsx("path",{d:"M16 3L14 21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]});export{t as default};
