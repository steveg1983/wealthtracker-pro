function e({isOpen:e,onClose:o,accountId:m}){const{transactions:x,accounts:g,updateTransaction:u}=a(),{formatCurrency:h}=c(),[b,p]=i.useState(m||""),[j,y]=i.useState({start:new Date((new Date).setMonth((new Date).getMonth()-1)),end:new Date}),[f,N]=i.useState(""),[v,k]=i.useState(!1),[w,S]=i.useState(null),[D,C]=i.useState(new Map),[M,R]=i.useState(!0),T=i.useMemo(()=>b?x.filter(e=>{const a=e.date instanceof Date?e.date:new Date(e.date);return e.accountId===b&&a>=j.start&&a<=j.end}):[],[x,b,j]);i.useMemo(()=>T.reduce((e,a)=>{const t="number"==typeof a.amount?a.amount:a.amount.toNumber();return e+("income"===a.type?t:-t)},0),[T]);const z=i.useMemo(()=>T.filter(e=>!e.cleared),[T]),E=i.useMemo(()=>T.filter(e=>e.cleared),[T]),F=i.useMemo(()=>E.reduce((e,a)=>{const t="number"==typeof a.amount?a.amount:a.amount.toNumber();return e+("income"===a.type?t:-t)},0),[E]),I=e=>{const a=[],t=e.date instanceof Date?e.date:new Date(e.date),s="number"==typeof e.amount?e.amount:e.amount.toNumber();return x.filter(a=>{const t=a.date instanceof Date?a.date:new Date(a.date);return a.accountId===b&&a.cleared&&t<j.start&&a.id!==e.id}).forEach(r=>{const n=r.date instanceof Date?r.date:new Date(r.date),d="number"==typeof r.amount?r.amount:r.amount.toNumber();let l=0;const i=[];Math.abs(d-s)<.01?(l+=40,i.push("Exact amount match")):Math.abs(d-s)/s<.1&&(l+=20,i.push("Similar amount (within 10%)"));const c=O(e.description.toLowerCase(),r.description.toLowerCase());c>.8?(l+=30,i.push("Very similar description")):c>.6&&(l+=20,i.push("Similar description")),e.category===r.category&&(l+=20,i.push("Same category")),t.getDate()===n.getDate()&&(l+=10,i.push("Same day of month (recurring?)")),l>=50&&a.push({transaction:r,score:l,reasons:i})}),a.sort((e,a)=>a.score-e.score).slice(0,3)},O=(e,a)=>{const t=e.split(/\s+/),s=a.split(/\s+/);return t.filter(e=>s.includes(e)).length/Math.max(t.length,s.length)};g.find(e=>e.id===b);const A=f?parseFloat(f)-F:0;return t.jsxs(s,{isOpen:e,onClose:o,title:"Transaction Reconciliation",size:"xl",children:[t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-6 mb-6",children:[t.jsx("h3",{className:"text-lg font-medium mb-4",children:"Reconciliation Setup"}),t.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Account"}),t.jsxs("select",{value:b,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg\n                         bg-white dark:bg-gray-700",children:[t.jsx("option",{value:"",children:"Select an account..."}),g.map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",h(e.balance),")"]},e.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Statement Balance"}),t.jsx("input",{type:"number",step:"0.01",value:f,onChange:e=>N(e.target.value),placeholder:"Enter statement ending balance",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg\n                         bg-white dark:bg-gray-700"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-6 mt-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Start Date"}),t.jsx("input",{type:"date",value:j.start.toISOString().split("T")[0],onChange:e=>y({...j,start:new Date(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg\n                         bg-white dark:bg-gray-700"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"End Date"}),t.jsx("input",{type:"date",value:j.end.toISOString().split("T")[0],onChange:e=>y({...j,end:new Date(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg\n                         bg-white dark:bg-gray-700"})]})]})]}),b&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Cleared Balance"}),t.jsx("div",{className:"text-xl font-semibold mt-1",children:h(F)})]}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Statement Balance"}),t.jsx("div",{className:"text-xl font-semibold mt-1",children:f?h(parseFloat(f)):"-"})]}),t.jsxs("div",{className:"rounded-lg p-4 border "+(Math.abs(A)<.01?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800"),children:[t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Difference"}),t.jsx("div",{className:"text-xl font-semibold mt-1 "+(Math.abs(A)<.01?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:h(A)})]}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Uncleared"}),t.jsx("div",{className:"text-xl font-semibold mt-1",children:z.length})]})]}),t.jsx("div",{className:"flex justify-center mb-6",children:t.jsx("button",{onClick:async()=>{k(!0);try{let e=0,a=0,t=0;for(const s of z){const r=I(s);r.length>0&&r[0].score>=80?(await u(s.id,{cleared:!0}),e++):r.length>0?t++:a++}S({matched:e,unmatched:a,suggestions:t})}catch(e){console.error("Error during reconciliation:",e)}finally{k(!1)}},disabled:v||!b,className:"flex items-center gap-2 px-6 py-3 bg-primary text-white rounded-lg\n                         hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed",children:v?t.jsxs(t.Fragment,{children:[t.jsx(r,{size:20,className:"animate-spin"}),"Reconciling..."]}):t.jsxs(t.Fragment,{children:[t.jsx(n,{size:20}),"Auto-Reconcile Transactions"]})})}),w&&t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mb-6",children:[t.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-300 mb-2",children:"Reconciliation Results"}),t.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-blue-700 dark:text-blue-400",children:"Matched:"}),t.jsx("span",{className:"ml-2 font-medium",children:w.matched})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-blue-700 dark:text-blue-400",children:"Suggestions:"}),t.jsx("span",{className:"ml-2 font-medium",children:w.suggestions})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-blue-700 dark:text-blue-400",children:"Unmatched:"}),t.jsx("span",{className:"ml-2 font-medium",children:w.unmatched})]})]})]}),z.length>0&&t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-medium",children:"Uncleared Transactions"}),t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:M,onChange:e=>R(e.target.checked),className:"rounded"}),t.jsx("span",{className:"text-sm",children:"Show suggestions"})]})]}),t.jsx("div",{className:"space-y-4",children:z.map(e=>{const a=e.date instanceof Date?e.date:new Date(e.date),s=M?I(e):[];return t.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:e.description}),t.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400 mt-1",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(d,{size:14}),a.toLocaleDateString()]}),t.jsx("span",{children:e.category})]})]}),t.jsxs("div",{className:"font-medium "+("income"===e.type?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:["income"===e.type?"+":"-",h(e.amount)]})]}),s.length>0&&t.jsxs("div",{className:"mt-3 bg-gray-50 dark:bg-gray-800 rounded p-3",children:[t.jsx("div",{className:"text-sm font-medium mb-2",children:"Possible matches:"}),t.jsx("div",{className:"space-y-2",children:s.map((a,s)=>t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:a.transaction.description}),t.jsxs("span",{className:"text-gray-500 ml-2",children:["(",a.reasons.join(", "),")"]})]}),t.jsx("button",{onClick:()=>(async(e,a)=>{const t=new Map(D);t.set(e,a),C(t),await u(e,{cleared:!0})})(e.id,a.transaction.id),className:"text-primary hover:underline",children:"Use this"})]},s))})]})]}),t.jsx("button",{onClick:()=>(async e=>{for(const a of e)await u(a,{cleared:!0})})([e.id]),className:"ml-4 px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700",children:"Clear"})]})},e.id)})})]}),0===z.length&&Math.abs(A)<.01&&t.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-8 text-center",children:[t.jsx(l,{className:"mx-auto text-green-600 dark:text-green-400 mb-3",size:48}),t.jsx("h4",{className:"text-lg font-medium text-green-900 dark:text-green-300",children:"Account Reconciled!"}),t.jsx("p",{className:"text-sm text-green-800 dark:text-green-200 mt-1",children:"All transactions are cleared and your balance matches the statement."})]})]})]}),t.jsx("div",{className:"flex justify-end px-6 py-4 border-t border-gray-200 dark:border-gray-700",children:t.jsx("button",{onClick:o,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 \n                   dark:hover:bg-gray-700 rounded-lg",children:"Close"})})]})}import{g as a,j as t,M as s,at as r,br as n,r as d,O as l}from"./index-Pkjq0qn3.js";import{a as i}from"./chunk-BWx9oMeS.js";import{u as c}from"./chunk-BYFRQ0Wn.js";import"./chunk-BN8kgYrt.js";import"./chunk-Drd-K-oK.js";export{e as default};
