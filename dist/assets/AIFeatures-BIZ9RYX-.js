function e(){const{transactions:e,categories:t}=d(),s=a(),[r,o]=n.useState([]),[f,v]=n.useState(!0),[j,N]=n.useState(D.getConfig()),[w,k]=n.useState(!1),[S,A]=n.useState(null);n.useEffect(()=>{M()},[e,t]);const M=async()=>{v(!0);try{const s=await D.detectAnomalies(e,t);o(s),D.saveAnomalies(s)}finally{v(!1)}},$=e=>{D.dismissAnomaly(e),o(r.filter(t=>t.id!==e))},C=e=>{switch(e){case"unusual_amount":return i.jsx(b,{size:16});case"frequency_spike":return i.jsx(y,{size:16});case"new_merchant":return i.jsx(p,{size:16});case"category_overspend":default:return i.jsx(h,{size:16});case"time_pattern":return i.jsx(x,{size:16});case"duplicate_charge":return i.jsx(u,{size:16})}},E=e=>{switch(e){case"low":return"text-yellow-600 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/20";case"medium":return"text-orange-600 dark:text-orange-400 bg-orange-50 dark:bg-orange-900/20";case"high":return"text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20"}},_=D.getAnomalyStats(r);return f?i.jsx("div",{className:"flex items-center justify-center h-64",children:i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"bg-gradient-to-r from-red-500 to-orange-500 rounded-2xl p-6 text-white",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Anomaly Detection"}),i.jsx("p",{className:"text-red-100",children:"AI-powered detection of unusual financial patterns and potential issues"})]}),i.jsx("button",{onClick:()=>k(!w),className:"p-2 bg-white/20 rounded-lg hover:bg-white/30 transition-colors",children:i.jsx(c,{size:20})})]}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[i.jsxs("div",{className:"bg-white/20 rounded-lg p-3",children:[i.jsx("p",{className:"text-3xl font-bold",children:_.total}),i.jsx("p",{className:"text-sm text-red-100",children:"Total Anomalies"})]}),i.jsxs("div",{className:"bg-white/20 rounded-lg p-3",children:[i.jsx("p",{className:"text-3xl font-bold",children:_.bySeverity.high||0}),i.jsx("p",{className:"text-sm text-red-100",children:"High Severity"})]}),i.jsxs("div",{className:"bg-white/20 rounded-lg p-3",children:[i.jsx("p",{className:"text-3xl font-bold",children:_.bySeverity.medium||0}),i.jsx("p",{className:"text-sm text-red-100",children:"Medium Severity"})]}),i.jsxs("div",{className:"bg-white/20 rounded-lg p-3",children:[i.jsxs("p",{className:"text-3xl font-bold",children:["$",_.totalAmount.toFixed(0)]}),i.jsx("p",{className:"text-sm text-red-100",children:"Total Amount"})]})]})]}),w&&i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6",children:[i.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Detection Settings"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sensitivity Level"}),i.jsx("div",{className:"flex gap-2",children:["low","medium","high"].map(e=>i.jsx("button",{onClick:()=>(e=>{const t={...j,sensitivityLevel:e};N(t),D.saveConfig(t)})(e),className:"px-4 py-2 rounded-lg capitalize "+(j.sensitivityLevel===e?"bg-indigo-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:e},e))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Detection Types"}),i.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:[{type:"unusual_amount",label:"Unusual Amounts"},{type:"frequency_spike",label:"Frequency Spikes"},{type:"new_merchant",label:"New Merchants"},{type:"category_overspend",label:"Category Overspending"},{type:"time_pattern",label:"Time Patterns"},{type:"duplicate_charge",label:"Duplicate Charges"}].map(({type:e,label:t})=>i.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[i.jsx("input",{type:"checkbox",checked:j.enabledTypes.has(e),onChange:()=>(e=>{const t=new Set(j.enabledTypes);t.has(e)?t.delete(e):t.add(e);const s={...j,enabledTypes:t};N(s),D.saveConfig(s)})(e),className:"rounded text-indigo-600"}),i.jsx("span",{className:"text-sm",children:t})]},e))})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Lookback Period"}),i.jsxs("select",{value:j.lookbackMonths,onChange:e=>{const t={...j,lookbackMonths:Number(e.target.value)};N(t),D.saveConfig(t)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[i.jsx("option",{value:1,children:"1 month"}),i.jsx("option",{value:3,children:"3 months"}),i.jsx("option",{value:6,children:"6 months"}),i.jsx("option",{value:12,children:"12 months"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Auto Alert"}),i.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[i.jsx("input",{type:"checkbox",checked:j.autoAlert,onChange:e=>{const t={...j,autoAlert:e.target.checked};N(t),D.saveConfig(t)},className:"rounded text-indigo-600"}),i.jsx("span",{className:"text-sm",children:"Send notifications for new anomalies"})]})]})]}),i.jsx("button",{onClick:M,className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:"Re-run Detection"})]})]}),0===r.length?i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-8 text-center",children:[i.jsx(l,{className:"mx-auto text-green-500 mb-3",size:48}),i.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Anomalies Detected"}),i.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Your financial activity looks normal. We'll keep monitoring for any unusual patterns."})]}):i.jsx("div",{className:"space-y-3",children:r.map(e=>i.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-4 hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>A(e),children:i.jsxs("div",{className:"flex items-start gap-4",children:[i.jsx("div",{className:`p-2 rounded-lg ${E(e.severity)}`,children:C(e.type)}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:e.title}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.description}),e.suggestedAction&&i.jsxs("p",{className:"text-sm text-indigo-600 dark:text-indigo-400 mt-2",children:[i.jsx(g,{size:14,className:"inline mr-1"}),e.suggestedAction]})]}),i.jsx("button",{onClick:t=>{t.stopPropagation(),$(e.id)},className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",title:"Dismiss",children:i.jsx(m,{size:16})})]}),i.jsxs("div",{className:"flex items-center gap-4 mt-3 text-xs text-gray-500 dark:text-gray-400",children:[i.jsx("span",{className:`px-2 py-1 rounded-full ${E(e.severity)}`,children:e.severity}),e.amount&&i.jsxs("span",{children:["$",e.amount.toFixed(2)]}),e.merchant&&i.jsx("span",{children:e.merchant}),e.category&&i.jsx("span",{children:t.find(t=>t.id===e.category)?.name||e.category}),i.jsx("span",{children:T(e.detectedAt,"MMM d, h:mm a")})]})]})]})},e.id))}),S&&i.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-lg w-full p-6",children:[i.jsxs("div",{className:"flex items-start justify-between mb-4",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:`p-2 rounded-lg ${E(S.severity)}`,children:C(S.type)}),i.jsx("h3",{className:"text-lg font-semibold",children:S.title})]}),i.jsx("button",{onClick:()=>A(null),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:i.jsx(m,{size:20})})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:S.description}),S.suggestedAction&&i.jsxs("div",{className:"bg-indigo-50 dark:bg-indigo-900/20 p-3 rounded-lg",children:[i.jsx("p",{className:"text-sm font-medium text-indigo-900 dark:text-indigo-200 mb-1",children:"Suggested Action"}),i.jsx("p",{className:"text-sm text-indigo-700 dark:text-indigo-300",children:S.suggestedAction})]}),i.jsxs("div",{className:"flex gap-3",children:[S.transactionId&&i.jsx("button",{onClick:()=>{var e;(e=S.transactionId)&&s(`/transactions?highlight=${e}`),A(null)},className:"flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:"View Transaction"}),S.transactions&&S.transactions.length>0&&i.jsxs("button",{onClick:()=>{s(`/transactions?ids=${S.transactions?.join(",")}`),A(null)},className:"flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:["View ",S.transactions.length," Transactions"]}),i.jsx("button",{onClick:()=>{$(S.id),A(null)},className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600",children:"Dismiss"})]})]})]})})]})}function t(){const{transactions:e,categories:t,budgets:s,updateBudget:a,addBudget:r}=d(),{formatCurrency:o}=E(),[m,u]=n.useState(null),[x,p]=n.useState(!0),[b,w]=n.useState(!1),[k,S]=n.useState(new Set),[A,M]=n.useState(_.getConfig());n.useEffect(()=>{$()},[e,t,s]);const $=()=>{p(!0);try{const a=_.analyzeBudgets(e,t,s);u(a)}finally{p(!1)}},C=(e,t)=>{const s={...A,[e]:t};M(s),_.saveConfig(s),setTimeout($,100)};return x?i.jsx("div",{className:"flex items-center justify-center h-64",children:i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):m?i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-500 rounded-2xl p-6 text-white",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Budget Recommendations"}),i.jsx("p",{className:"text-indigo-100",children:"AI-powered budget optimization based on your spending patterns"})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:()=>w(!b),className:"p-2 bg-white/20 rounded-lg hover:bg-white/30 transition-colors",title:"Settings",children:i.jsx(c,{size:20})}),i.jsx("button",{onClick:()=>{if(!m)return;const e=_.exportRecommendations(m),t=new Blob([e],{type:"text/plain"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`budget-recommendations-${(new Date).toISOString().split("T")[0]}.txt`,a.click(),URL.revokeObjectURL(s)},className:"p-2 bg-white/20 rounded-lg hover:bg-white/30 transition-colors",title:"Export Report",children:i.jsx(f,{size:20})})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[i.jsxs("div",{className:"bg-white/20 rounded-lg p-4",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("span",{className:"text-sm text-indigo-100",children:"Budget Health"}),i.jsx("span",{className:"text-2xl",children:(T=m.score,T>=80?"\ud83c\udfaf":T>=60?"\ud83d\udcca":"\u26a0\ufe0f")})]}),i.jsxs("p",{className:`text-3xl font-bold ${(e=>e>=80?"text-green-600 dark:text-green-400":e>=60?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400")(m.score)}`,children:[m.score,"/100"]})]}),i.jsxs("div",{className:"bg-white/20 rounded-lg p-4",children:[i.jsx("p",{className:"text-sm text-indigo-100 mb-2",children:"Current Budget"}),i.jsx("p",{className:"text-2xl font-bold",children:o(m.totalCurrentBudget)})]}),i.jsxs("div",{className:"bg-white/20 rounded-lg p-4",children:[i.jsx("p",{className:"text-sm text-indigo-100 mb-2",children:"Recommended"}),i.jsx("p",{className:"text-2xl font-bold",children:o(m.totalRecommendedBudget)})]}),i.jsxs("div",{className:"bg-white/20 rounded-lg p-4",children:[i.jsx("p",{className:"text-sm text-indigo-100 mb-2",children:"Potential Savings"}),i.jsx("p",{className:"text-2xl font-bold text-green-300",children:o(m.totalPotentialSavings)})]})]})]}),b&&i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6",children:[i.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Recommendation Settings"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Analysis Period"}),i.jsxs("select",{value:A.lookbackMonths,onChange:e=>C("lookbackMonths",Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[i.jsx("option",{value:3,children:"Last 3 months"}),i.jsx("option",{value:6,children:"Last 6 months"}),i.jsx("option",{value:12,children:"Last 12 months"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Recommendation Style"}),i.jsxs("select",{value:A.aggressiveness,onChange:e=>C("aggressiveness",e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[i.jsx("option",{value:"conservative",children:"Conservative (75th percentile)"}),i.jsx("option",{value:"moderate",children:"Moderate (65th percentile)"}),i.jsx("option",{value:"aggressive",children:"Aggressive (50th percentile)"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Minimum Confidence"}),i.jsxs("select",{value:A.minConfidence,onChange:e=>C("minConfidence",Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[i.jsx("option",{value:.6,children:"60%"}),i.jsx("option",{value:.7,children:"70%"}),i.jsx("option",{value:.8,children:"80%"}),i.jsx("option",{value:.9,children:"90%"})]})]}),i.jsx("div",{className:"flex items-center gap-4",children:i.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[i.jsx("input",{type:"checkbox",checked:A.includeSeasonality,onChange:e=>C("includeSeasonality",e.target.checked),className:"rounded text-indigo-600"}),i.jsx("span",{className:"text-sm",children:"Include seasonal adjustments"})]})})]})]}),m.insights.length>0&&i.jsxs("div",{className:"space-y-3",children:[i.jsx("h3",{className:"text-lg font-semibold",children:"Insights"}),m.insights.map((e,t)=>i.jsx("div",{className:"p-4 rounded-lg border "+("positive"===e.impact?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"negative"===e.impact?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800"),children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("div",{className:"mt-0.5",children:"achievement"===e.type?i.jsx(l,{size:20,className:"text-green-600 dark:text-green-400"}):"opportunity"===e.type?i.jsx(v,{size:20,className:"text-blue-600 dark:text-blue-400"}):i.jsx(h,{size:20,className:"text-yellow-600 dark:text-yellow-400"})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:e.title}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.description})]})]})},t))]}),m.recommendations.length>0&&i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("h3",{className:"text-lg font-semibold",children:"Recommendations"}),k.size>0&&i.jsxs("button",{onClick:()=>{const e=m?.recommendations.filter(e=>k.has(e.categoryId))||[];_.applyRecommendations(e).forEach(({categoryId:e,amount:n})=>{const i=s.find(t=>t.category===e),o=t.find(t=>t.id===e);i?a(i.id,{amount:n}):o&&r({name:`${o.name} Budget`,category:e,amount:n,period:"monthly",rollover:!1,notifications:!0})}),S(new Set),setTimeout($,100)},className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:["Apply ",k.size," Selected"]})]}),m.recommendations.map(e=>i.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-4",children:i.jsxs("div",{className:"flex items-start gap-4",children:[i.jsx("input",{type:"checkbox",checked:k.has(e.categoryId),onChange:t=>{const s=new Set(k);t.target.checked?s.add(e.categoryId):s.delete(e.categoryId),S(s)},className:"mt-1 rounded text-indigo-600"}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:e.categoryName}),i.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-gray-500",children:"Current:"}),i.jsx("span",{className:"font-medium",children:e.currentBudget?o(e.currentBudget):"No budget"})]}),i.jsx(j,{size:16,className:"text-gray-400"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-gray-500",children:"Recommended:"}),i.jsx("span",{className:"font-medium text-indigo-600 dark:text-indigo-400",children:o(e.recommendedBudget)})]})]})]}),i.jsx("button",{onClick:()=>(e=>{const t=s.find(t=>t.category===e.categoryId);t?a(t.id,{amount:e.recommendedBudget}):r({name:`${e.categoryName} Budget`,category:e.categoryId,amount:e.recommendedBudget,period:"monthly",rollover:!1,notifications:!0}),setTimeout($,100)})(e),className:"px-3 py-1 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded-lg hover:bg-indigo-200 dark:hover:bg-indigo-900/50 transition-colors",children:"Apply"})]}),i.jsxs("div",{className:"mt-3 space-y-2",children:[i.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("span",{children:"Avg spending:"}),i.jsx("span",{className:"font-medium",children:o(e.averageSpending)})]}),i.jsxs("div",{className:"flex items-center gap-1",children:["increasing"===e.spendingTrend?i.jsx(y,{size:14,className:"text-red-500"}):"decreasing"===e.spendingTrend?i.jsx(N,{size:14,className:"text-green-500"}):null,i.jsxs("span",{children:[e.spendingTrend," ",e.trendPercentage,"%"]})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("span",{children:"Confidence:"}),i.jsxs("span",{className:"font-medium",children:[Math.round(100*e.confidence),"%"]})]})]}),i.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[i.jsx(g,{size:14,className:"inline mr-1"}),e.reasoning]}),e.potentialSavings&&i.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400 font-medium",children:[i.jsx(v,{size:14,className:"inline mr-1"}),"Potential savings: ",o(e.potentialSavings),"/month"]})]})]})]})},e.categoryId))]}),0===m.recommendations.length&&i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-8 text-center",children:[i.jsx(l,{className:"mx-auto text-green-500 mb-3",size:48}),i.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Recommendations Available"}),i.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Your budgets are well-aligned with your spending patterns!"})]})]}):i.jsx("div",{className:"text-center py-8",children:i.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No budget analysis available"})});var T}function s(){const[s,a]=n.useState("categorization");return i.jsx(r,{title:"AI-Powered Features",rightContent:i.jsx("div",{className:"cursor-pointer",title:"AI-Powered Features",children:i.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",className:"transition-all duration-200 hover:scale-110 drop-shadow-lg hover:drop-shadow-xl",style:{filter:"drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1))"},children:[i.jsx("defs",{children:i.jsxs("linearGradient",{id:"ai-gradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[i.jsx("stop",{offset:"0%",stopColor:"#A78BFA"}),i.jsx("stop",{offset:"100%",stopColor:"#7C3AED"})]})}),i.jsx("circle",{cx:"24",cy:"24",r:"24",fill:"url(#ai-gradient)"}),i.jsx("g",{transform:"translate(12, 12)",children:i.jsx(S,{size:24,className:"text-white"})})]})}),children:i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-1 flex",children:[i.jsxs("button",{onClick:()=>a("categorization"),className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg transition-colors "+("categorization"===s?"bg-indigo-600 text-white":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[i.jsx(w,{size:20}),i.jsx("span",{className:"font-medium",children:"Smart Categorization"})]}),i.jsxs("button",{onClick:()=>a("anomalies"),className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg transition-colors "+("anomalies"===s?"bg-red-600 text-white":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[i.jsx(h,{size:20}),i.jsx("span",{className:"font-medium",children:"Anomaly Detection"})]}),i.jsxs("button",{onClick:()=>a("budgets"),className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg transition-colors "+("budgets"===s?"bg-purple-600 text-white":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[i.jsx(k,{size:20}),i.jsx("span",{className:"font-medium",children:"Budget Recommendations"})]})]}),i.jsxs("div",{children:["categorization"===s&&i.jsx(o,{}),"anomalies"===s&&i.jsx(e,{}),"budgets"===s&&i.jsx(t,{})]})]})})}import{bY as a,r as n,H as i}from"./chunk-DowOIOga.js";import{P as r}from"./chunk-r7IQz9KP.js";import o from"./SmartCategorizationSettings-Bq6fJsU1.js";import{a as d,r as c,x as l,a0 as g,X as m,aB as h,ap as u,aF as x,S as p,T as y,ak as b,ay as f,n as v,aj as j,p as N,ax as w,au as k,aE as S}from"./index-qHm2isZb.js";import{s as A,d as M,h as $,e as C,f as T}from"./chunk-B5pcS96K.js";import{u as E}from"./chunk-CSFgP5a1.js";import"./chunk-ddLY9KjI.js";import"./chunk-CkYa08k9.js";const D=new class{STORAGE_KEY="money_management_anomaly_config";ANOMALIES_KEY="money_management_detected_anomalies";THRESHOLDS={low:{amountDeviation:3,frequencyIncrease:2,categoryOverspend:1.5},medium:{amountDeviation:2.5,frequencyIncrease:1.5,categoryOverspend:1.3},high:{amountDeviation:2,frequencyIncrease:1.3,categoryOverspend:1.2}};getConfig(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(e){const t=JSON.parse(e);return t.enabledTypes=new Set(t.enabledTypes),t}}catch(e){console.error("Failed to load anomaly detection config:",e)}return{enabledTypes:new Set(["unusual_amount","frequency_spike","new_merchant","category_overspend"]),sensitivityLevel:"medium",lookbackMonths:3,minTransactionHistory:30,autoAlert:!0}}saveConfig(e){const t=this.getConfig(),s={...t,...e,enabledTypes:e.enabledTypes?Array.from(e.enabledTypes):Array.from(t.enabledTypes)};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(s))}async detectAnomalies(e,t){const s=this.getConfig(),a=[],n=A(new Date,s.lookbackMonths),i=e.filter(e=>new Date(e.date)>=n);if(i.length<s.minTransactionHistory)return[];const r=[...i].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime());s.enabledTypes.has("unusual_amount")&&a.push(...this.detectUnusualAmounts(r,s)),s.enabledTypes.has("frequency_spike")&&a.push(...this.detectFrequencySpikes(r,s)),s.enabledTypes.has("new_merchant")&&a.push(...this.detectNewMerchants(r,e)),s.enabledTypes.has("category_overspend")&&a.push(...this.detectCategoryOverspend(r,t,s)),s.enabledTypes.has("time_pattern")&&a.push(...this.detectTimePatternAnomalies(r)),s.enabledTypes.has("duplicate_charge")&&a.push(...this.detectDuplicateCharges(r));const o=this.getSavedAnomalies(),d=new Set(o.filter(e=>e.dismissed).map(e=>e.id));return a.filter(e=>!d.has(e.id))}detectUnusualAmounts(e,t){const s=[],a=this.THRESHOLDS[t.sensitivityLevel].amountDeviation,n=new Map;return e.forEach(e=>{if("expense"===e.type){const t=n.get(e.category)||[];t.push(e),n.set(e.category,t)}}),n.forEach((e,t)=>{if(e.length<5)return;const n=e.map(e=>Math.abs(e.amount)),i=n.reduce((e,t)=>e+t,0)/n.length,r=n.reduce((e,t)=>e+Math.pow(t-i,2),0)/n.length,o=Math.sqrt(r);e.forEach(e=>{const n=Math.abs(e.amount),r=Math.abs((n-i)/o);if(r>a){const a=r>4?"high":r>3?"medium":"low";s.push({id:`unusual-amount-${e.id}`,type:"unusual_amount",severity:a,transactionId:e.id,title:"Unusual Transaction Amount",description:`${e.description} - $${n.toFixed(2)} is ${r.toFixed(1)} standard deviations from your typical ${t} spending`,detectedAt:new Date,amount:n,category:t,merchant:this.extractMerchant(e.description),suggestedAction:"Review this transaction to ensure it's correct"})}})}),s}detectFrequencySpikes(e,t){const s=[],a=this.THRESHOLDS[t.sensitivityLevel].frequencyIncrease,n=new Map;return e.forEach(e=>{if("expense"===e.type){const t=this.extractMerchant(e.description),s=n.get(t)||[];s.push(e),n.set(t,s)}}),n.forEach((e,t)=>{if(e.length<3)return;const n=[...e].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()),i=[];for(let s=1;s<n.length-1;s++){const e=M(new Date(n[s].date),new Date(n[s-1].date));i.push(e)}const r=i.reduce((e,t)=>e+t,0)/i.length,o=M(new Date(n[n.length-1].date),new Date(n[n.length-2].date));if(o<r/a){const e=n.slice(-3);s.push({id:`frequency-spike-${t}-${Date.now()}`,type:"frequency_spike",severity:o<r/(1.5*a)?"high":"medium",transactions:e.map(e=>e.id),title:"Unusual Frequency Increase",description:`You've made ${e.length} purchases at ${t} in ${o} days, much more frequent than your usual ${r.toFixed(0)} day interval`,detectedAt:new Date,merchant:t,suggestedAction:"Check for duplicate charges or subscription changes"})}}),s}detectNewMerchants(e,t){const s=[],a=new Set,n=A(new Date,6);t.filter(e=>new Date(e.date)<n).forEach(e=>{a.add(this.extractMerchant(e.description))});const i=new Map;return e.filter(e=>"expense"===e.type).forEach(e=>{const t=this.extractMerchant(e.description);if(!a.has(t)){const s=i.get(t)||{amount:0,count:0,transactions:[]};s.amount+=Math.abs(e.amount),s.count++,s.transactions.push(e.id),i.set(t,s)}}),i.forEach((e,t)=>{(e.amount>100||e.count>2)&&s.push({id:`new-merchant-${t.replace(/\s+/g,"-")}`,type:"new_merchant",severity:e.amount>500?"high":e.amount>200?"medium":"low",transactions:e.transactions,title:"New Merchant Detected",description:`First time purchasing from ${t} - ${e.count} transaction(s) totaling $${e.amount.toFixed(2)}`,detectedAt:new Date,amount:e.amount,merchant:t,suggestedAction:"Verify this is a legitimate merchant and these charges are authorized"})}),s}detectCategoryOverspend(e,t,s){const a=[],n=this.THRESHOLDS[s.sensitivityLevel].categoryOverspend,i=new Date,r=$(i),o=C(i),d=new Map,c=new Map;e.filter(e=>{const t=new Date(e.date);return"expense"===e.type&&t>=r&&t<=o}).forEach(e=>{const t=d.get(e.category)||0;d.set(e.category,t+Math.abs(e.amount))});const l=new Map;for(let g=1;g<=3;g++){const t=$(A(i,g)),s=C(A(i,g)),a=new Map;e.filter(e=>{const a=new Date(e.date);return"expense"===e.type&&a>=t&&a<=s}).forEach(e=>{const t=a.get(e.category)||0;a.set(e.category,t+Math.abs(e.amount))}),a.forEach((e,t)=>{const s=l.get(t)||[];s.push(e),l.set(t,s)})}return l.forEach((e,t)=>{const s=e.reduce((e,t)=>e+t,0)/e.length;c.set(t,s)}),d.forEach((e,s)=>{const r=c.get(s)||0;if(r>0&&e>r*n){const n=t.find(e=>e.id===s),o=(e-r)/r*100;a.push({id:`overspend-${s}-${T(i,"yyyy-MM")}`,type:"category_overspend",severity:o>100?"high":o>50?"medium":"low",title:"Category Overspending",description:`${n?.name||s} spending is ${o.toFixed(0)}% higher than your 3-month average`,detectedAt:new Date,amount:e,category:s,suggestedAction:`Review ${n?.name||s} expenses and consider adjusting your budget`})}}),a}detectTimePatternAnomalies(e){const t=[],s=[];return e.filter(e=>"expense"===e.type).forEach(e=>{const t=new Date(e.date),a=t.getHours();t.getDay(),a>=0&&a<5&&s.push(e)}),s.length>0&&t.push({id:`time-pattern-${Date.now()}`,type:"time_pattern",severity:s.length>3?"high":"medium",transactions:s.map(e=>e.id),title:"Unusual Transaction Times",description:`${s.length} transaction(s) occurred during unusual hours (midnight-5AM)`,detectedAt:new Date,suggestedAction:"Verify these late-night transactions are legitimate"}),t}detectDuplicateCharges(e){const t=[],s=new Map;return e.filter(e=>"expense"===e.type).forEach(e=>{const t=`${this.extractMerchant(e.description)}-${Math.abs(e.amount).toFixed(2)}`,a=s.get(t)||[];a.push(e),s.set(t,a)}),s.forEach((e,s)=>{if(!(e.length<2))for(let a=0;a<e.length-1;a++)for(let s=a+1;s<e.length;s++){const n=Math.abs(M(new Date(e[a].date),new Date(e[s].date)));n<=3&&t.push({id:`duplicate-${e[a].id}-${e[s].id}`,type:"duplicate_charge",severity:"high",transactions:[e[a].id,e[s].id],title:"Possible Duplicate Charge",description:`Two identical charges of $${Math.abs(e[a].amount).toFixed(2)} at ${this.extractMerchant(e[a].description)} within ${n} days`,detectedAt:new Date,amount:Math.abs(e[a].amount),merchant:this.extractMerchant(e[a].description),suggestedAction:"Check if one of these is a duplicate charge and contact the merchant if needed"})}}),t}extractMerchant(e){return e.replace(/[#*]/g,"").replace(/\d{4,}/g,"").replace(/\s+/g," ").trim().split(" ").slice(0,3).join(" ")}saveAnomalies(e){localStorage.setItem(this.ANOMALIES_KEY,JSON.stringify(e))}getSavedAnomalies(){try{const e=localStorage.getItem(this.ANOMALIES_KEY);return e?JSON.parse(e):[]}catch{return[]}}dismissAnomaly(e){const t=this.getSavedAnomalies(),s=t.find(t=>t.id===e);s&&(s.dismissed=!0,this.saveAnomalies(t))}getAnomalyStats(e){const t={total:e.length,byType:{},bySeverity:{},totalAmount:0};return e.forEach(e=>{t.byType[e.type]=(t.byType[e.type]||0)+1,t.bySeverity[e.severity]=(t.bySeverity[e.severity]||0)+1,e.amount&&(t.totalAmount+=e.amount)}),t}},_=new class{STORAGE_KEY="budget_recommendation_config";PERCENTILES={conservative:.75,moderate:.65,aggressive:.5};SEASONAL_FACTORS={Gifts:{11:2.5,0:2},Travel:{5:1.3,6:1.5,7:1.5},Utilities:{0:1.3,1:1.3,6:1.2,7:1.2},Entertainment:{11:1.2}};getConfig(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(e)return JSON.parse(e)}catch(e){console.error("Failed to load recommendation config:",e)}return{lookbackMonths:6,includeSeasonality:!0,aggressiveness:"moderate",minConfidence:.7,considerGoals:!0}}saveConfig(e){const t={...this.getConfig(),...e};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}analyzeBudgets(e,t,s){const a=this.getConfig(),n=[],i=[],r=this.analyzeCategorySpending(e,a.lookbackMonths);t.forEach(e=>{const t=r.get(e.id);if(!t||t.months.length<3)return;const i=s.find(t=>t.category===e.id),o=this.generateRecommendation(e,t,i,a);o.confidence>=a.minConfidence&&n.push(o)}),n.sort((e,t)=>{const s={high:3,medium:2,low:1},a=s[t.priority]-s[e.priority];return 0!==a?a:(t.potentialSavings||0)-(e.potentialSavings||0)}),i.push(...this.generateInsights(e,t,s,n));const o=s.reduce((e,t)=>e+t.amount,0),d=n.reduce((e,t)=>e+t.recommendedBudget,0),c=n.reduce((e,t)=>e+(t.potentialSavings||0),0),l=this.calculateBudgetHealthScore(s,e,n);return{totalCurrentBudget:o,totalRecommendedBudget:d,totalPotentialSavings:c,recommendations:n,insights:i,score:l}}analyzeCategorySpending(e,t){const s=new Map,a=new Date;for(let n=0;n<t;n++){const t=$(A(a,n)),i=C(A(a,n)),r=e.filter(e=>{const s=new Date(e.date);return"expense"===e.type&&s>=t&&s<=i}),o=new Map;r.forEach(e=>{const t=o.get(e.category)||0;o.set(e.category,t+Math.abs(e.amount))}),o.forEach((e,a)=>{const n=s.get(a)||{months:[],amounts:[],total:0};n.months.push(t),n.amounts.push(e),n.total+=e,s.set(a,n)})}return s}generateRecommendation(e,t,s,a){const n=[...t.amounts].sort((e,t)=>e-t),i=t.total/t.amounts.length,r=this.PERCENTILES[a.aggressiveness];let o=n[Math.floor(n.length*r)]||i;a.includeSeasonality&&(o=this.applySeasonalAdjustment(e.name,o,new Date));const d=this.calculateTrend(t.amounts);"increasing"===d.direction&&d.percentage>10&&(o*=1+d.percentage/200),o=5*Math.ceil(o/5);const c=this.calculateStdDev(n)/i,l=Math.max(.5,Math.min(1,1-c));let g="medium";const m=s?.amount||0,h=Math.abs(o-m),u=m>0?h/m*100:100;u>30||0===m&&i>100?g="high":u<10&&(g="low");const x=m>o?m-o:0,p=this.generateReasoning(e.name,m,o,i,d,a);return{categoryId:e.id,categoryName:e.name,currentBudget:m||void 0,recommendedBudget:o,averageSpending:i,spendingTrend:d.direction,trendPercentage:d.percentage,confidence:l,reasoning:p,priority:g,potentialSavings:x>0?x:void 0}}calculateTrend(e){if(e.length<2)return{direction:"stable",percentage:0};const t=e.length,s=e.map((e,t)=>t),a=s.reduce((e,t)=>e+t,0),n=e.reduce((e,t)=>e+t,0),i=(t*s.reduce((t,s,a)=>t+s*e[a],0)-a*n)/(t*s.reduce((e,t)=>e+t*t,0)-a*a),r=n/t,o=Math.abs(i/r*100*t);let d;return d=i>.05*r?"increasing":i<.05*-r?"decreasing":"stable",{direction:d,percentage:Math.round(o)}}calculateStdDev(e){const t=e.reduce((e,t)=>e+t,0)/e.length,s=e.reduce((e,s)=>e+Math.pow(s-t,2),0)/e.length;return Math.sqrt(s)}applySeasonalAdjustment(e,t,s){const a=s.getMonth(),n=this.SEASONAL_FACTORS[e];return n&&n[a]?t*n[a]:t}generateReasoning(e,t,s,a,n,i){const r=[];return 0===t?r.push(`Based on your average spending of $${a.toFixed(0)} in ${e}`):s>t?r.push("Your current budget may be too restrictive"):s<t&&r.push("You have an opportunity to reduce this budget"),"increasing"===n.direction&&n.percentage>15?r.push(`spending has been increasing by ${n.percentage}%`):"decreasing"===n.direction&&n.percentage>15&&r.push(`spending has been decreasing by ${n.percentage}%`),r.push(`using ${i.aggressiveness} analysis of ${i.lookbackMonths} months`),r.join(", ")+"."}generateInsights(e,t,s,a){const n=[],i=new Date,r=$(i);a.forEach(e=>{!e.currentBudget&&e.averageSpending>100&&n.push({type:"unbudgeted",title:`Unbudgeted Spending in ${e.categoryName}`,description:`You're spending an average of $${e.averageSpending.toFixed(0)} per month in ${e.categoryName} without a budget.`,impact:"negative",actionable:!0,categoryId:e.categoryId,amount:e.averageSpending})}),s.forEach(s=>{const a=t.find(e=>e.id===s.category);if(!a)return;const o=e.filter(e=>e.category===s.category&&"expense"===e.type&&new Date(e.date)>=r).reduce((e,t)=>e+Math.abs(t.amount),0),d=o/s.amount*100,c=new Date(i.getFullYear(),i.getMonth()+1,0).getDate(),l=i.getDate();d>l/c*100+20&&n.push({type:"overspend",title:`Overspending Alert: ${a.name}`,description:`You've spent ${d.toFixed(0)}% of your budget with ${c-l} days left in the month.`,impact:"negative",actionable:!0,categoryId:a.id,amount:o})});const o=a.filter(e=>e.potentialSavings).reduce((e,t)=>e+(t.potentialSavings||0),0);o>100&&n.push({type:"opportunity",title:"Budget Optimization Available",description:`You could potentially save $${o.toFixed(0)} per month by adjusting your budgets to match your actual spending patterns.`,impact:"positive",actionable:!0,amount:o});const d=s.filter(e=>{const t=a.find(t=>t.categoryId===e.category);return t&&Math.abs(t.recommendedBudget-e.amount)/e.amount<.1});return d.length>=.7*s.length&&n.push({type:"achievement",title:"Excellent Budget Management",description:`${Math.round(d.length/s.length*100)}% of your budgets are well-aligned with your spending patterns!`,impact:"positive",actionable:!1}),n}calculateBudgetHealthScore(e,t,s){let a=100;const n=$(new Date),i=5*s.filter(e=>!e.currentBudget&&e.averageSpending>50).length;a-=Math.min(25,i),e.forEach(e=>{const t=s.find(t=>t.categoryId===e.category);if(t){const s=Math.abs(t.recommendedBudget-e.amount)/e.amount;s>.3?a-=5:s>.2&&(a-=3)}}),e.forEach(e=>{const s=t.filter(t=>t.category===e.category&&"expense"===t.type&&new Date(t.date)>=n).reduce((e,t)=>e+Math.abs(t.amount),0);if(s>e.amount){const t=(s-e.amount)/e.amount*100;a-=Math.min(10,Math.floor(t/10))}});const r=s.filter(e=>e.confidence>.8).length;return a+=Math.min(10,2*r),Math.max(0,Math.min(100,a))}applyRecommendations(e,t){return(t?e.filter(e=>t.includes(e.categoryId)):e).map(e=>({categoryId:e.categoryId,amount:e.recommendedBudget}))}exportRecommendations(e){const t=["Budget Recommendations Report",`Generated: ${T(new Date,"MMMM d, yyyy")}`,`Budget Health Score: ${e.score}/100`,"",`Total Current Budget: $${e.totalCurrentBudget.toFixed(2)}`,`Total Recommended Budget: $${e.totalRecommendedBudget.toFixed(2)}`,`Potential Savings: $${e.totalPotentialSavings.toFixed(2)}`,"","Recommendations:",""];return e.recommendations.forEach(e=>{t.push(`${e.categoryName}:`),t.push(`  Current Budget: $${e.currentBudget?.toFixed(2)||"0.00"}`),t.push(`  Recommended: $${e.recommendedBudget.toFixed(2)}`),t.push(`  Average Spending: $${e.averageSpending.toFixed(2)}`),t.push(`  Trend: ${e.spendingTrend} (${e.trendPercentage}%)`),t.push(`  Confidence: ${(100*e.confidence).toFixed(0)}%`),t.push(`  ${e.reasoning}`),t.push("")}),t.push("Insights:"),t.push(""),e.insights.forEach(e=>{t.push(`\u2022 ${e.title}`),t.push(`  ${e.description}`),t.push("")}),t.join("\n")}};export{s as default};
