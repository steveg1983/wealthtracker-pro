function e({isOpen:e,onClose:h,newTransactions:u,onConfirm:p}){const{transactions:j}=t(),{formatCurrency:f}=g(),[b,y]=x.useState([]),[N,k]=x.useState(new Set),[v,w]=x.useState(!1),[S,C]=x.useState(0),[D,M]=x.useState(3),[z,F]=x.useState(.01),[T,A]=x.useState(80),[I,$]=x.useState(!0),E=(e,t)=>{const a=e.date instanceof Date?e.date:new Date(e.date),s=t.date instanceof Date?t.date:new Date(t.date),n=Math.abs((a.getTime()-s.getTime())/864e5),r=n<=D?100-n/D*50:0,i=m(e.amount).toNumber(),d=m(t.amount).toNumber(),l=Math.abs(i-d),o=l<=z?100:Math.max(0,100-l/Math.max(i,d)*100),c=((e,t)=>{const a=e.toLowerCase().trim(),s=t.toLowerCase().trim();if(a===s)return 100;const n=[],r=a.length,i=s.length;for(let o=0;o<=i;o++)n[o]=[o];for(let o=0;o<=r;o++)n[0][o]=o;for(let o=1;o<=i;o++)for(let e=1;e<=r;e++)s.charAt(o-1)===a.charAt(e-1)?n[o][e]=n[o-1][e-1]:n[o][e]=Math.min(n[o-1][e-1]+1,n[o][e-1]+1,n[o-1][e]+1);const d=n[i][r],l=Math.max(r,i);return Math.round(100*(1-d/l))})(e.description,t.description);return{dateScore:r,amountScore:o,descriptionScore:c,totalScore:.3*r+.4*o+.3*c}},L=x.useMemo(()=>{const e=[],t=new Set;for(let a=0;a<j.length;a++){if(t.has(j[a].id))continue;const s=[];for(let e=a+1;e<j.length;e++)t.has(j[e].id)||E(j[a],j[e]).totalScore>=T&&(s.push(j[e]),t.add(j[e].id));s.length>0&&(t.add(j[a].id),e.push({original:j[a],potential:s,confidence:Math.max(...s.map(e=>E(j[a],e).totalScore))}))}return e},[j,T,D,z]);x.useEffect(()=>{e&&(u?(()=>{if(!u||0===u.length)return;w(!0),C(0);const e=[],t=new Set;u.forEach((a,s)=>{C((s+1)/u.length*100);const n=[];if(j.forEach(e=>{if(!a.date||!a.description||void 0===a.amount)return;const t={date:a.date,description:a.description,amount:a.amount};E(t,e).totalScore>=T&&n.push(e)}),n.length>0){const r=Math.max(...n.map(e=>E({date:a.date,description:a.description,amount:a.amount},e).totalScore));e.push({original:{...a,id:`new-${s}`,date:a.date,description:a.description,amount:a.amount,type:a.type||"expense",accountId:a.accountId||"",category:a.category||"",cleared:a.cleared||!1},potential:n,confidence:r}),I&&r>=90&&t.add(`new-${s}`)}}),y(e),k(t),w(!1)})():y(L))},[e,u]);const R=e=>{const t=new Set(N);t.has(e)?t.delete(e):t.add(e),k(t)},V=e=>e>=90?"Very likely duplicate":e>=75?"Likely duplicate":"Possible duplicate";return a.jsx(s,{isOpen:e,onClose:h,title:u?"Import Duplicate Check":"Find Duplicate Transactions",size:"xl",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 mb-6",children:[a.jsxs("h3",{className:"font-medium mb-3 flex items-center gap-2",children:[a.jsx(n,{size:18}),"Detection Settings"]}),a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Date Threshold (days)"}),a.jsx("input",{type:"number",value:D,onChange:e=>M(parseInt(e.target.value)||0),min:"0",max:"30",className:"w-full px-3 py-1 border border-gray-300 dark:border-gray-600 rounded\n                         bg-white dark:bg-gray-700"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Amount Threshold (\xa3)"}),a.jsx("input",{type:"number",value:z,onChange:e=>F(parseFloat(e.target.value)||0),min:"0",step:"0.01",className:"w-full px-3 py-1 border border-gray-300 dark:border-gray-600 rounded\n                         bg-white dark:bg-gray-700"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Similarity Threshold (%)"}),a.jsx("input",{type:"range",value:T,onChange:e=>A(parseInt(e.target.value)),min:"50",max:"100",className:"w-full"}),a.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[T,"%"]})]})]}),u&&a.jsxs("label",{className:"flex items-center gap-2 mt-3",children:[a.jsx("input",{type:"checkbox",checked:I,onChange:e=>$(e.target.checked),className:"rounded"}),a.jsx("span",{className:"text-sm",children:"Auto-select very likely duplicates (90%+)"})]})]}),v&&a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("span",{className:"text-sm font-medium",children:"Scanning for duplicates..."}),a.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[Math.round(S),"%"]})]}),a.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:a.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${S}%`}})})]}),!v&&b.length>0&&a.jsx("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4 mb-6",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(r,{className:"text-orange-600 dark:text-orange-400 mt-0.5",size:20}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-medium text-orange-900 dark:text-orange-300",children:u?`Found ${b.length} potential duplicates in import`:`Found ${b.length} duplicate groups`}),a.jsx("p",{className:"text-sm text-orange-800 dark:text-orange-200 mt-1",children:u?"Review and deselect any transactions you want to import anyway.":"Review and select which duplicates to remove."})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>{const e=new Set;b.forEach(t=>{u?e.add(t.original.id):t.potential.forEach(t=>e.add(t.id))}),k(e)},className:"px-3 py-1 text-sm bg-orange-600 text-white rounded hover:bg-orange-700",children:"Select All"}),a.jsx("button",{onClick:()=>{k(new Set)},className:"px-3 py-1 text-sm border border-orange-600 text-orange-600 \n                           dark:text-orange-400 dark:border-orange-400 rounded hover:bg-orange-50\n                           dark:hover:bg-orange-900/20",children:"Deselect All"})]})]})}),!v&&0===b.length&&a.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-8 text-center",children:[a.jsx(i,{className:"mx-auto text-green-600 dark:text-green-400 mb-3",size:48}),a.jsx("h4",{className:"font-medium text-green-900 dark:text-green-300",children:"No duplicates found!"}),a.jsx("p",{className:"text-sm text-green-800 dark:text-green-200 mt-1",children:u?"All transactions in the import appear to be unique.":"Your transaction history doesn't contain any duplicates."})]}),!v&&b.length>0&&a.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:b.map((e,t)=>{return a.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-start justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[u&&a.jsx("input",{type:"checkbox",checked:N.has(e.original.id),onChange:()=>R(e.original.id),className:"mt-1"}),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium",children:e.original.description}),a.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400 mt-1",children:[a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(d,{size:14}),(e.original.date instanceof Date?e.original.date:new Date(e.original.date)).toLocaleDateString()]}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(l,{size:14}),f(e.original.amount)]}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(o,{size:14}),e.original.category]})]})]})]}),a.jsxs("div",{className:"text-sm font-medium "+(s=e.confidence,s>=90?"text-red-600 dark:text-red-400":s>=75?"text-orange-600 dark:text-orange-400":"text-yellow-600 dark:text-yellow-400"),children:[Math.round(e.confidence),"% match"]})]}),a.jsxs("div",{className:"ml-7 space-y-2",children:[a.jsxs("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:[V(e.confidence)," with:"]}),e.potential.map(t=>a.jsxs("div",{className:"flex items-center justify-between bg-gray-50 \n                                                       dark:bg-gray-800 rounded p-2",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[!u&&a.jsx("input",{type:"checkbox",checked:N.has(t.id),onChange:()=>R(t.id)}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium",children:t.description}),a.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-600 dark:text-gray-400",children:[a.jsx("span",{children:(t.date instanceof Date?t.date:new Date(t.date)).toLocaleDateString()}),a.jsx("span",{children:f(t.amount)}),a.jsx("span",{children:t.category})]})]})]}),a.jsxs("div",{className:"text-xs text-gray-500",children:[E(e.original,t).totalScore.toFixed(0),"% similar"]})]},t.id))]})]},t);var s})}),a.jsxs("div",{className:"flex justify-between mt-6",children:[a.jsx("button",{onClick:h,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 \n                     dark:hover:bg-gray-700 rounded-lg",children:"Cancel"}),b.length>0&&a.jsx("button",{onClick:()=>{if(u){const e=u.filter((e,t)=>!N.has(`new-${t}`));p?.(e)}h()},disabled:u&&N.size===u.length,className:"flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg\n                       hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed",children:u?a.jsxs(a.Fragment,{children:[a.jsx(i,{size:20}),"Import ",u.length-N.size," Unique Transactions"]}):a.jsxs(a.Fragment,{children:[a.jsx(c,{size:20}),"Remove ",N.size," Duplicates"]})})]})]})})}import{g as t,j as a,M as s,aa as n,aV as r,_ as i,r as d,aB as l,b2 as o,aF as c,F as m}from"./index-Pkjq0qn3.js";import{a as x}from"./chunk-BWx9oMeS.js";import{u as g}from"./chunk-BYFRQ0Wn.js";import"./chunk-BN8kgYrt.js";import"./chunk-Drd-K-oK.js";export{e as default};
