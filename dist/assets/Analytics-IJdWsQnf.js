const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DashboardBuilder-B2nLCEba.js","assets/index-Pkjq0qn3.js","assets/chunk-BWx9oMeS.js","assets/chunk-BN8kgYrt.js","assets/chunk-Drd-K-oK.js","assets/index-Bkln43Xj.css","assets/chunk-Dfgb0jMK.js","assets/DashboardBuilder-C9-ySRfk.css","assets/QueryBuilder-BRbOva8B.js","assets/ChartWizard-B18YUYOZ.js","assets/index-D59Gcdkn.js"])))=>i.map(i=>d[i]);
function e(e){if(0===e.length)return 0;var t,r=e[0],a=0;if("number"!=typeof r)return Number.NaN;for(var s=1;s<e.length;s++){if("number"!=typeof e[s])return Number.NaN;t=r+e[s],Math.abs(r)>=Math.abs(e[s])?a+=r-t+e[s]:a+=e[s]-t+r,r=t}return r+a}function t(t){if(0===t.length)throw new Error("mean requires at least one data point");return e(t)/t.length}function r(e,r){var a,s,n=t(e),i=0;for(s=0;s<e.length;s++)i+=(a=e[s]-n)*a;return i}function a(e){if(1===e.length)return 0;var t=function(e){if(0===e.length)throw new Error("variance requires at least one data point");return r(e)/e.length}(e);return Math.sqrt(t)}function s(e,t){var r=e.length*t;if(0===e.length)throw new Error("quantile requires at least one data point.");if(t<0||t>1)throw new Error("quantiles must be between 0 and 1");return 1===t?e[e.length-1]:0===t?e[0]:r%1!=0?e[Math.ceil(r)-1]:e.length%2==0?(e[r-1]+e[r])/2:e[r]}function n(e,t,r,a){for(r=r||0,a=a||e.length-1;a>r;){if(a-r>600){var s=a-r+1,o=t-r+1,l=Math.log(s),c=.5*Math.exp(2*l/3),d=.5*Math.sqrt(l*c*(s-c)/s);o-s/2<0&&(d*=-1),n(e,t,Math.max(r,Math.floor(t-o*c/s+d)),Math.min(a,Math.floor(t+(s-o)*c/s+d)))}var u=e[t],h=r,g=a;for(i(e,r,t),e[a]>u&&i(e,r,a);h<g;){for(i(e,h,g),h++,g--;e[h]<u;)h++;for(;e[g]>u;)g--}e[r]===u?i(e,r,g):i(e,++g,a),g<=t&&(r=g+1),t<=g&&(a=g-1)}}function i(e,t,r){var a=e[t];e[t]=e[r],e[r]=a}function o(e,t,r,a){t%1==0?n(e,t,r,a):(n(e,t=Math.floor(t),r,a),n(e,t+1,t+1,a))}function l(e,t){return e-t}function c(e,t){var r=e*t;return 1===t?e-1:0===t?0:r%1!=0?Math.ceil(r)-1:e%2==0?r-.5:r}function d(e){var t=function(e){if(e.length<2)throw new Error("sampleVariance requires at least two data points");return r(e)/(e.length-1)}(e);return Math.sqrt(t)}function u(e,r){var a=function(e,r){if(e.length!==r.length)throw new Error("sampleCovariance requires samples with equal lengths");if(e.length<2)throw new Error("sampleCovariance requires at least two data points in each sample");for(var a=t(e),s=t(r),n=0,i=0;i<e.length;i++)n+=(e[i]-a)*(r[i]-s);return n/(e.length-1)}(e,r);return a/d(e)/d(r)}function h(){return P||(P=1,function(e){function t(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function r(e,t){var r=[],a=[];e.forEach(function(e,s){null!==e[1]&&(a.push(e),r.push(t[s]))});var s=a.reduce(function(e,t){return e+t[1]},0)/a.length,n=a.reduce(function(e,t){var r=t[1]-s;return e+r*r},0);return 1-a.reduce(function(e,t,a){var s=r[a],n=t[1]-s[1];return e+n*n},0)/n}function a(e,t){var r=Math.pow(10,t);return Math.round(e*r)/r}var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},n={order:2,precision:2,period:null},i={linear:function(e,t){for(var s=[0,0,0,0,0],n=0,i=0;i<e.length;i++)null!==e[i][1]&&(n++,s[0]+=e[i][0],s[1]+=e[i][1],s[2]+=e[i][0]*e[i][0],s[3]+=e[i][0]*e[i][1],s[4]+=e[i][1]*e[i][1]);var o=n*s[2]-s[0]*s[0],l=n*s[3]-s[0]*s[1],c=0===o?0:a(l/o,t.precision),d=a(s[1]/n-c*s[0]/n,t.precision),u=function(e){return[a(e,t.precision),a(c*e+d,t.precision)]},h=e.map(function(e){return u(e[0])});return{points:h,predict:u,equation:[c,d],r2:a(r(e,h),t.precision),string:0===d?"y = "+c+"x":"y = "+c+"x + "+d}},exponential:function(e,t){for(var s=[0,0,0,0,0,0],n=0;n<e.length;n++)null!==e[n][1]&&(s[0]+=e[n][0],s[1]+=e[n][1],s[2]+=e[n][0]*e[n][0]*e[n][1],s[3]+=e[n][1]*Math.log(e[n][1]),s[4]+=e[n][0]*e[n][1]*Math.log(e[n][1]),s[5]+=e[n][0]*e[n][1]);var i=s[1]*s[2]-s[5]*s[5],o=Math.exp((s[2]*s[3]-s[5]*s[4])/i),l=(s[1]*s[4]-s[5]*s[3])/i,c=a(o,t.precision),d=a(l,t.precision),u=function(e){return[a(e,t.precision),a(c*Math.exp(d*e),t.precision)]},h=e.map(function(e){return u(e[0])});return{points:h,predict:u,equation:[c,d],string:"y = "+c+"e^("+d+"x)",r2:a(r(e,h),t.precision)}},logarithmic:function(e,t){for(var s=[0,0,0,0],n=e.length,i=0;i<n;i++)null!==e[i][1]&&(s[0]+=Math.log(e[i][0]),s[1]+=e[i][1]*Math.log(e[i][0]),s[2]+=e[i][1],s[3]+=Math.pow(Math.log(e[i][0]),2));var o=a((n*s[1]-s[2]*s[0])/(n*s[3]-s[0]*s[0]),t.precision),l=a((s[2]-o*s[0])/n,t.precision),c=function(e){return[a(e,t.precision),a(a(l+o*Math.log(e),t.precision),t.precision)]},d=e.map(function(e){return c(e[0])});return{points:d,predict:c,equation:[l,o],string:"y = "+l+" + "+o+" ln(x)",r2:a(r(e,d),t.precision)}},power:function(e,t){for(var s=[0,0,0,0,0],n=e.length,i=0;i<n;i++)null!==e[i][1]&&(s[0]+=Math.log(e[i][0]),s[1]+=Math.log(e[i][1])*Math.log(e[i][0]),s[2]+=Math.log(e[i][1]),s[3]+=Math.pow(Math.log(e[i][0]),2));var o=(n*s[1]-s[0]*s[2])/(n*s[3]-Math.pow(s[0],2)),l=(s[2]-o*s[0])/n,c=a(Math.exp(l),t.precision),d=a(o,t.precision),u=function(e){return[a(e,t.precision),a(a(c*Math.pow(e,d),t.precision),t.precision)]},h=e.map(function(e){return u(e[0])});return{points:h,predict:u,equation:[c,d],string:"y = "+c+"x^"+d,r2:a(r(e,h),t.precision)}},polynomial:function(e,s){for(var n=[],i=[],o=0,l=0,c=e.length,d=s.order+1,u=0;u<d;u++){for(var h=0;h<c;h++)null!==e[h][1]&&(o+=Math.pow(e[h][0],u)*e[h][1]);n.push(o),o=0;for(var g=[],m=0;m<d;m++){for(var p=0;p<c;p++)null!==e[p][1]&&(l+=Math.pow(e[p][0],u+m));g.push(l),l=0}i.push(g)}i.push(n);for(var x=function(e,t){for(var r=e,a=e.length-1,s=[t],n=0;n<a;n++){for(var i=n,o=n+1;o<a;o++)Math.abs(r[n][o])>Math.abs(r[n][i])&&(i=o);for(var l=n;l<a+1;l++){var c=r[l][n];r[l][n]=r[l][i],r[l][i]=c}for(var d=n+1;d<a;d++)for(var u=a;u>=n;u--)r[u][d]-=r[u][n]*r[n][d]/r[n][n]}for(var h=a-1;h>=0;h--){for(var g=0,m=h+1;m<a;m++)g+=r[m][h]*s[m];s[h]=(r[a][h]-g)/r[h][h]}return s}(i,d).map(function(e){return a(e,s.precision)}),f=function(e){return[a(e,s.precision),a(x.reduce(function(t,r,a){return t+r*Math.pow(e,a)},0),s.precision)]},y=e.map(function(e){return f(e[0])}),b="y = ",v=x.length-1;v>=0;v--)b+=v>1?x[v]+"x^"+v+" + ":1===v?x[v]+"x + ":x[v];return{string:b,points:y,predict:f,equation:[].concat(t(x)).reverse(),r2:a(r(e,y),s.precision)}}};e.exports=Object.keys(i).reduce(function(e,t){return s({_round:a},e,(l=function(e,r){return i[t](e,s({},n,r))},(o=t)in(r={})?Object.defineProperty(r,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[o]=l,r));var r,o,l},{})}(T)),T.exports}function g(){const{transactions:e,accounts:t,budgets:r,goals:a,investments:s}=y(),{formatCurrency:n}=B(),[i,o]=z.useState("dashboards"),[l,c]=z.useState([]),[d,u]=z.useState(null),[h,g]=z.useState([]),[m,p]=z.useState(!1),[x,f]=z.useState(!1),[E,R]=z.useState(!1),[A,_]=z.useState(null),[D,P]=z.useState([]);z.useEffect(()=>{const e=localStorage.getItem("analytics_dashboards");e&&c(JSON.parse(e));const t=localStorage.getItem("analytics_queries");t&&g(JSON.parse(t)),T()},[]);const T=async()=>{const t=[],r=I.detectSeasonalPatterns(e,"expenses");"stable"!==r.direction&&t.push({type:"trend",title:`Spending is ${r.direction}`,description:`Your spending has ${"increasing"===r.direction?"increased":"decreased"} by ${Math.abs(100*r.changeRate).toFixed(1)}% over the last 30 days`,severity:"increasing"===r.direction?"warning":"success"});const a=I.performCohortAnalysis(e,"category","amount"),s=Object.entries(a.segments).sort((e,t)=>t[1].total-e[1].total)[0];s&&t.push({type:"category",title:`Highest spending category: ${s[0]}`,description:`You've spent ${n(s[1].total)} in ${s[0]} this month`,severity:"info"}),P(t)},O=n=>{let i=[];switch(n.dataSource){case"transactions":i=[...e];break;case"accounts":i=[...t];break;case"budgets":i=[...r];break;case"goals":i=[...a];break;case"investments":i=[...s]}return n.conditions.forEach(e=>{i=i.filter(t=>{const r=t[e.field];switch(e.operator){case"equals":return r===e.value;case"contains":return r?.toString().includes(e.value);case"greater":return parseFloat(r)>parseFloat(e.value);case"less":return parseFloat(r)<parseFloat(e.value);case"between":return parseFloat(r)>=parseFloat(e.value)&&parseFloat(r)<=parseFloat(e.value2);default:return!0}})}),n.sortBy.forEach(e=>{i.sort((t,r)=>{const a=t[e.field],s=r[e.field],n=a>s?1:a<s?-1:0;return"asc"===e.direction?n:-n})}),n.limit&&(i=i.slice(0,n.limit)),i},U=e=>{const t=[...l,e];c(t),localStorage.setItem("analytics_dashboards",JSON.stringify(t)),R(!1),u(e)},G=z.useMemo(()=>{const t=e.filter(e=>"income"===e.type).reduce((e,t)=>e+parseFloat(t.amount),0),r=e.filter(e=>"expense"===e.type).reduce((e,t)=>e+parseFloat(t.amount),0);return{totalIncome:t,totalExpenses:r,savingsRate:t>0?(t-r)/t*100:0,transactionCount:e.length}},[e]);return b.jsx(F,{title:"Analytics",children:b.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[b.jsx("div",{className:"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700",children:b.jsxs("div",{className:"px-6 py-4",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{children:[b.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Analytics"}),b.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Professional-grade financial analytics and insights"})]}),b.jsxs("div",{className:"flex gap-2",children:[b.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600",children:[b.jsx(v,{size:16}),"New Query"]}),b.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600",children:[b.jsx(j,{size:16}),"New Chart"]}),b.jsxs("button",{onClick:()=>R(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90",children:[b.jsx(w,{size:16}),"New Dashboard"]})]})]}),b.jsx("div",{className:"flex gap-6 mt-6",children:[{id:"dashboards",label:"Dashboards",icon:v},{id:"explorer",label:"Data Explorer",icon:v},{id:"insights",label:"AI Insights",icon:N},{id:"reports",label:"Reports",icon:k}].map(e=>b.jsxs("button",{onClick:()=>o(e.id),className:"flex items-center gap-2 px-4 py-2 border-b-2 transition-colors "+(i===e.id?"border-primary text-primary":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:[b.jsx(e.icon,{size:18}),e.label]},e.id))})]})}),b.jsx("div",{className:"px-6 py-4",children:b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[b.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4",children:b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{children:[b.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Income"}),b.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:n(G.totalIncome)})]}),b.jsx(M,{className:"text-green-500",size:24})]})}),b.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4",children:b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{children:[b.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Expenses"}),b.jsx("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:n(G.totalExpenses)})]}),b.jsx(S,{className:"text-red-500",size:24})]})}),b.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4",children:b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{children:[b.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Savings Rate"}),b.jsxs("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[G.savingsRate.toFixed(1),"%"]})]}),b.jsx(q,{className:"text-blue-500",size:24})]})}),b.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4",children:b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{children:[b.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Transactions"}),b.jsx("p",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:G.transactionCount})]}),b.jsx(j,{className:"text-purple-500",size:24})]})})]})}),b.jsxs("div",{className:"p-6",children:["dashboards"===i&&b.jsx("div",{children:d?b.jsxs("div",{children:[b.jsxs("div",{className:"flex items-center justify-between mb-4",children:[b.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:d.name}),b.jsx("button",{onClick:()=>u(null),className:"text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Back to Dashboards"})]}),b.jsx(z.Suspense,{fallback:b.jsx("div",{className:"flex items-center justify-center h-64",children:"Loading dashboard..."}),children:b.jsx(L,{dashboard:d,onSave:U,onClose:()=>u(null)})})]}):b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[l.map(e=>b.jsxs("div",{onClick:()=>u(e),className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 hover:shadow-md cursor-pointer transition-shadow",children:[b.jsxs("div",{className:"flex items-start justify-between mb-2",children:[b.jsx(v,{size:24,className:"text-primary"}),b.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(e.updatedAt).toLocaleDateString()})]}),b.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-1",children:e.name}),b.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.description}),b.jsxs("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400",children:[e.widgets.length," widgets"]})]},e.id)),0===l.length&&b.jsxs("div",{className:"col-span-full text-center py-12",children:[b.jsx(v,{size:48,className:"mx-auto text-gray-400 dark:text-gray-600 mb-4"}),b.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No dashboards yet"}),b.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Create your first dashboard to visualize your financial data"}),b.jsxs("button",{onClick:()=>R(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90",children:[b.jsx(w,{size:16}),"Create Dashboard"]})]})]})}),"explorer"===i&&b.jsx("div",{children:b.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[b.jsxs("div",{className:"flex items-center justify-between mb-4",children:[b.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Saved Queries"}),b.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-2 px-3 py-1.5 bg-primary text-white rounded-lg hover:bg-primary/90 text-sm",children:[b.jsx(w,{size:14}),"New Query"]})]}),h.length>0?b.jsx("div",{className:"space-y-3",children:h.map(e=>b.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[b.jsxs("div",{children:[b.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),b.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.dataSource," \u2022 ",e.conditions.length," filters \u2022 Last run: ",e.lastRun?new Date(e.lastRun).toLocaleString():"Never"]})]}),b.jsxs("button",{onClick:()=>{const t=O(e);_(t)},className:"flex items-center gap-2 px-3 py-1.5 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 text-sm",children:[b.jsx(C,{size:14}),"Run"]})]},e.id))}):b.jsxs("div",{className:"text-center py-8",children:[b.jsx(v,{size:32,className:"mx-auto text-gray-400 dark:text-gray-600 mb-3"}),b.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No saved queries yet. Create your first query to explore your data."})]}),A&&A.length>0&&b.jsxs("div",{className:"mt-6",children:[b.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:["Query Results (",A.length," rows)"]}),b.jsx("div",{className:"ag-theme-alpine-dark",style:{height:400},children:b.jsx(z.Suspense,{fallback:b.jsx("div",{className:"flex items-center justify-center h-full",children:"Loading grid..."}),children:b.jsx($,{rowData:A,columnDefs:Object.keys(A[0]||{}).map(e=>({field:e,sortable:!0,filter:!0,resizable:!0})),defaultColDef:{flex:1,minWidth:100}})})})]})]})}),"insights"===i&&b.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[D.map((e,t)=>b.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border-l-4 p-6 "+("warning"===e.severity?"border-l-amber-500":"success"===e.severity?"border-l-green-500":"border-l-blue-500"),children:b.jsxs("div",{className:"flex items-start gap-3",children:[b.jsx(N,{size:20,className:"warning"===e.severity?"text-amber-500":"success"===e.severity?"text-green-500":"text-blue-500"}),b.jsxs("div",{className:"flex-1",children:[b.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-1",children:e.title}),b.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.description})]})]})},t)),0===D.length&&b.jsxs("div",{className:"col-span-full text-center py-12",children:[b.jsx(N,{size:48,className:"mx-auto text-gray-400 dark:text-gray-600 mb-4"}),b.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Generating insights from your financial data..."})]})]}),"reports"===i&&b.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-8",children:b.jsxs("div",{className:"text-center",children:[b.jsx(k,{size:48,className:"mx-auto text-gray-400 dark:text-gray-600 mb-4"}),b.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Report Generation Coming Soon"}),b.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Generate professional PDF reports with your custom dashboards and insights"})]})})]}),m&&b.jsx(z.Suspense,{fallback:b.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:"Loading..."}),children:b.jsx(Q,{onSave:e=>{const t=O(e),r={...e,lastRun:new Date,results:t},a=[...h,r];g(a),localStorage.setItem("analytics_queries",JSON.stringify(a)),p(!1),_(t)},onCancel:()=>p(!1)})}),x&&A&&b.jsx(z.Suspense,{fallback:b.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:"Loading..."}),children:b.jsx(V,{data:A,onSave:e=>{f(!1)},onCancel:()=>f(!1)})}),E&&b.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:b.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:b.jsx(z.Suspense,{fallback:b.jsx("div",{className:"flex items-center justify-center h-full p-8",children:"Loading..."}),children:b.jsx(L,{onSave:U,onClose:()=>R(!1)})})})})]})})}import{_ as m}from"./chunk-Drd-K-oK.js";import{aO as p,ab as x,aP as f,g as y,j as b,aQ as v,B as j,ag as w,aR as N,aS as k,aT as M,aU as S,T as q,aC as C}from"./index-Pkjq0qn3.js";import{g as E,a as z}from"./chunk-BWx9oMeS.js";import{s as R,a as A}from"./chunk-DyhMGJi1.js";import{p as _}from"./chunk-B_sbv61Y.js";import{i as D}from"./chunk-DLIzqRsk.js";import{u as B}from"./chunk-BYFRQ0Wn.js";import{P as F}from"./chunk-BnYLBI7x.js";import"./chunk-BN8kgYrt.js";var P,T={exports:{}};const O=E(h()),I=new class{calculatePeriodComparison(e,t,r,a="net",s="both"){const n=this.filterByTimeRange(e,t),i=this.filterByTimeRange(e,r),o=this.calculateMetric(n,a),l=this.calculateMetric(i,a),c=o-l;return{value:o,change:"percentage"!==s?c:void 0,changePercent:"absolute"!==s?0!==l?c/l*100:0:void 0,trend:c>0?"up":c<0?"down":"stable"}}calculateRollingWindow(e,t,r,a="net",s=new Date){const n=[];for(let i=0;i<12;i++){const o="months"===r?R(s,i):new Date(s.getTime()-i*t*24*60*60*1e3),l="months"===r?R(o,t):new Date(o.getTime()-24*t*60*60*1e3),c=this.filterByTimeRange(e,{start:l,end:o}),d=this.calculateMetric(c,a)/t;n.unshift({x:x(o,"MMM yyyy"),y:d,metadata:{periodStart:l,periodEnd:o,transactionCount:c.length}})}return n}performCohortAnalysis(e,t,r,a){const s=new Map;e.forEach(e=>{let t;switch(r){case"account":t=e.accountId;break;case"category":t=e.category||"Uncategorized";break;case"month":t=x(_(e.date),"yyyy-MM")}s.has(t)||s.set(t,[]),s.get(t).push(e)});const n=[];return s.forEach((e,t)=>{const r=[],s=new Date(Math.min(...e.map(e=>new Date(e.date).getTime())));for(let n=0;n<12;n++){const t=A(s,n),i=f(t),o=e.filter(e=>{const r=_(e.date);return D(r,{start:t,end:i})});let l=0;switch(a){case"retention":l=o.length>0?1:0;break;case"value":l=this.calculateMetric(o,"net");break;case"frequency":l=o.length}r.push({period:n,value:l})}n.push({cohort:t,periods:r})}),n}detectSeasonalPatterns(e,t="expenses"){const r=this.aggregateByPeriod(e,"month",t);if(r.length<12)return{direction:"stable",slope:0,rSquared:0,changeRate:0,seasonality:{detected:!1}};const a=r.map(e=>e.y),s=a.map((e,t)=>[t,e]),n=O.linear(s),i=a.map((e,t)=>e-n.predict(t)[1]),o=this.calculateAutocorrelation(i,12);return{direction:n.equation[0]>.01?"increasing":n.equation[0]<-.01?"decreasing":"stable",slope:n.equation[0],rSquared:n.r2,changeRate:n.equation[0]/(a[0]||1)*100,seasonality:{detected:Math.abs(o)>.3,pattern:Math.abs(o)>.3?"monthly":void 0,strength:Math.abs(o)}}}async generateForecast(r,s,n=3,i="auto"){const o=this.aggregateByPeriod(r,"month",s);if(o.length<3)throw new Error("Insufficient data for forecasting");const l=o.map((e,t)=>[t,e.y]);let c=i,d={equation:[0,0],r2:0,predict:e=>[0,0]};if("auto"===i){const e={linear:O.linear(l),exponential:O.exponential(l),polynomial:O.polynomial(l,{order:2})};let t=0;Object.entries(e).forEach(([e,r])=>{r.r2>t&&(t=r.r2,c=e,d=r)})}else switch(i){case"linear":d=O.linear(l);break;case"exponential":d=O.exponential(l);break;case"polynomial":d=O.polynomial(l,{order:2})}const u=[],h=l.length-1,g=_(o[o.length-1].x),m=a(l.map(([e,t])=>t-d.predict(e)[1]));for(let a=1;a<=n;a++){const r=h+a,s=d.predict(r)[1],n=1.96*m*Math.sqrt(1+1/l.length+Math.pow(r-t(l.map(e=>e[0])),2)/e(l.map(e=>Math.pow(e[0]-t(l.map(e=>e[0])),2))));u.push({date:A(g,a),value:Math.max(0,s),lower:Math.max(0,s-n),upper:s+n})}return{predictions:u,accuracy:d.r2,model:c,parameters:{equation:d.equation,dataPoints:l.length}}}calculateCorrelations(e,t){const r=[],a=new Map;this.getUniqueMonths(e).forEach(r=>{const s=e.filter(e=>x(_(e.date),"yyyy-MM")===r),n=new Map;if(t.includes("income")&&n.set("income",this.calculateMetric(s,"income")),t.includes("expenses")&&n.set("expenses",this.calculateMetric(s,"expenses")),t.includes("savings")){const e=this.calculateMetric(s,"income"),t=this.calculateMetric(s,"expenses");n.set("savings",e-t)}a.set(r,n)});const s=Array.from(new Set(Array.from(a.values()).flatMap(e=>Array.from(e.keys()))));for(let n=0;n<s.length;n++)for(let e=n+1;e<s.length;e++){const t=s[n],i=s[e],o=[],l=[];if(a.forEach(e=>{const r=e.get(t),a=e.get(i);void 0!==r&&void 0!==a&&(o.push(r),l.push(a))}),o.length>=3){const e=u(o,l),a=Math.abs(e);r.push({variable1:t,variable2:i,correlation:e,pValue:this.calculatePValue(e,o.length),strength:a>.7?"strong":a>.4?"moderate":a>.2?"weak":"none",direction:e>0?"positive":e<0?"negative":"none"})}}return r}executeQuery(e,t){let r=[...e];t.filters&&(r=this.applyFilters(r,t.filters)),t.timeRange&&(r=this.filterByTimeRange(r,t.timeRange));const a=t.groupBy?this.groupBy(r,t.groupBy):new Map([["all",r]]),s=[];return a.forEach((e,r)=>{const a={};t.groupBy&&(a[t.groupBy]=r),t.metrics.forEach(r=>{a[r]=this.calculateCustomMetric(e,r,t.aggregation)}),s.push(a)}),t.orderBy&&s.sort((e,r)=>{const a=e[t.orderBy.field]-r[t.orderBy.field];return"asc"===t.orderBy.direction?a:-a}),t.limit?s.slice(0,t.limit):s}filterByTimeRange(e,t){return e.filter(e=>{const r=_(e.date);return D(r,{start:t.start,end:t.end})})}calculateMetric(e,t){switch(t){case"income":return e.filter(e=>"income"===e.type).reduce((e,t)=>e+t.amount,0);case"expenses":return e.filter(e=>"expense"===e.type).reduce((e,t)=>e+t.amount,0);case"net":return this.calculateMetric(e,"income")-this.calculateMetric(e,"expenses");case"count":return e.length}}aggregateByPeriod(e,t,r){const a=new Map;e.forEach(e=>{const r=_(e.date);let s;switch(t){case"day":s=x(r,"yyyy-MM-dd");break;case"week":s=x(r,"yyyy-ww");break;case"month":s=x(r,"yyyy-MM");break;case"quarter":s=`${function(e){return p(e,undefined).getFullYear()}(r)}-Q${function(e){const t=p(e,undefined);return Math.trunc(t.getMonth()/3)+1}(r)}`;break;case"year":s=x(r,"yyyy")}a.has(s)||a.set(s,[]),a.get(s).push(e)});const s=[];return Array.from(a.entries()).sort((e,t)=>e[0].localeCompare(t[0])).forEach(([e,t])=>{s.push({x:e,y:this.calculateMetric(t,r)})}),s}calculateAutocorrelation(r,a){if(r.length<=a)return 0;const s=t(r),n=e(r.map(e=>Math.pow(e-s,2)))/r.length;let i=0;for(let e=0;e<r.length-a;e++)i+=(r[e]-s)*(r[e+a]-s);return i/(r.length-a)/n}calculatePValue(e,t){const r=.5*Math.log((1+e)/(1-e))/(1/Math.sqrt(t-3));return 2*(1-this.normalCDF(Math.abs(r)))}normalCDF(e){const t=e<0?-1:1,r=1/(1+.3275911*(e=Math.abs(e)/Math.sqrt(2))),a=r*r,s=a*r,n=s*r;return.5*(1+t*(1-(n*r*1.061405429+-1.453152027*n+1.421413741*s+-.284496736*a+.254829592*r)*Math.exp(-e*e)))}getUniqueMonths(e){const t=new Set;return e.forEach(e=>{t.add(x(_(e.date),"yyyy-MM"))}),Array.from(t).sort()}applyFilters(e,t){return e.filter(e=>t.every(t=>{if(t.customFunction)return t.customFunction(e);const r="custom"===t.field?null:e[t.field];switch(t.operator){case"equals":return r===t.value;case"contains":return String(r).toLowerCase().includes(String(t.value).toLowerCase());case"greater":return Number(r)>Number(t.value);case"less":return Number(r)<Number(t.value);case"between":return Number(r)>=t.value[0]&&Number(r)<=t.value[1];case"in":return Array.isArray(t.value)&&t.value.includes(r);default:return!0}}))}groupBy(e,t){const r=new Map;return e.forEach(e=>{const a=String(e[t]||"Unknown");r.has(a)||r.set(a,[]),r.get(a).push(e)}),r}calculateCustomMetric(r,n,i="sum"){if(["income","expenses","net","count"].includes(n))return this.calculateMetric(r,n);const d=r.map(e=>Number(e[n])||0);switch(i){case"sum":return e(d);case"average":return d.length>0?t(d):0;case"median":return d.length>0?+function(e,t){var r=e.slice();if(Array.isArray(t)){!function(e,t){for(var r=[0],a=0;a<t.length;a++)r.push(c(e.length,t[a]));r.push(e.length-1),r.sort(l);for(var s=[0,r.length-1];s.length;){var n=Math.ceil(s.pop()),i=Math.floor(s.pop());if(!(n-i<=1)){var d=Math.floor((i+n)/2);o(e,r[d],Math.floor(r[i]),Math.ceil(r[n])),s.push(i,d,d,n)}}}(r,t);for(var a=[],n=0;n<t.length;n++)a[n]=s(r,t[n]);return a}return o(r,c(r.length,t),0,r.length-1),s(r,t)}(d,.5):0;case"min":return d.length>0?function(e){if(0===e.length)throw new Error("min requires at least one data point");for(var t=e[0],r=1;r<e.length;r++)e[r]<t&&(t=e[r]);return t}(d):0;case"max":return d.length>0?function(e){if(0===e.length)throw new Error("max requires at least one data point");for(var t=e[0],r=1;r<e.length;r++)e[r]>t&&(t=e[r]);return t}(d):0;case"count":return d.length;case"stddev":return d.length>1?a(d):0;default:return 0}}},L=z.lazy(()=>m(()=>import("./DashboardBuilder-B2nLCEba.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),Q=z.lazy(()=>m(()=>import("./QueryBuilder-BRbOva8B.js"),__vite__mapDeps([8,1,2,3,4,5])).then(e=>({default:e.default,Query:e.Query}))),V=z.lazy(()=>m(()=>import("./ChartWizard-B18YUYOZ.js"),__vite__mapDeps([9,4,1,2,3,5]))),$=z.lazy(()=>m(()=>import("./index-D59Gcdkn.js"),__vite__mapDeps([10,2])).then(e=>({default:e.AgGridReact})));export{g as default};
