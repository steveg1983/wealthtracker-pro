function e({isOpen:e,onClose:u}){const{accounts:p,transactions:g,categories:h,addTransaction:y}=s(),[b,j]=t.useState(null),[f,k]=t.useState(!1),[N,v]=t.useState(null),[w,F]=t.useState(null),[I,C]=t.useState(""),[S,Q]=t.useState(!0),q=t.useCallback(e=>{const t=e.target.files?.[0];t&&(t.name.toLowerCase().endsWith(".qif")?(j(t),v(null),F(null),T(t)):alert("Please select a QIF file"))},[]),z=t.useCallback(e=>{e.preventDefault();const t=e.dataTransfer.files[0];t&&t.name.toLowerCase().endsWith(".qif")&&(j(t),v(null),F(null),T(t))},[]),T=async e=>{k(!0);try{const t=await e.text(),a=m.parseQIF(t);v({transactions:a.transactions,accountType:a.accountType}),1===p.length&&C(p[0].id)}catch(t){console.error("Error parsing QIF file:",t),alert("Error parsing QIF file. Please check the file format.")}finally{k(!1)}},D=()=>{j(null),v(null),F(null),C("")};return a.jsx(r,{isOpen:e,onClose:u,title:"Import QIF File",size:"lg",children:a.jsxs("div",{className:"p-6",children:[!N&&!w&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-primary transition-colors cursor-pointer",onDrop:z,onDragOver:e=>e.preventDefault(),children:[a.jsx(n,{size:48,className:"mx-auto text-gray-400 mb-4"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Upload QIF File"}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Drag and drop your .qif file here, or click to browse"}),a.jsx("input",{type:"file",accept:".qif",onChange:q,className:"hidden",id:"qif-upload"}),a.jsxs("label",{htmlFor:"qif-upload",className:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-secondary cursor-pointer",children:[a.jsx(l,{size:20}),"Select QIF File"]})]}),a.jsx("div",{className:"mt-6 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(i,{className:"text-blue-600 dark:text-blue-400 mt-0.5",size:20}),a.jsxs("div",{className:"text-sm",children:[a.jsx("h4",{className:"font-semibold text-blue-900 dark:text-blue-300 mb-1",children:"About QIF Files"}),a.jsx("p",{className:"text-blue-800 dark:text-blue-200 mb-2",children:"QIF (Quicken Interchange Format) is a simple text format for financial data."}),a.jsxs("ul",{className:"text-blue-700 dark:text-blue-300 space-y-1",children:[a.jsx("li",{children:"\u2022 Widely supported by UK banks and financial software"}),a.jsx("li",{children:"\u2022 Simple format but no unique transaction IDs"}),a.jsx("li",{children:"\u2022 Requires manual account selection"}),a.jsx("li",{children:"\u2022 Best for one-time imports or initial setup"})]})]})]})})]}),N&&!w&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center gap-3 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[a.jsx(l,{className:"text-gray-600 dark:text-gray-400",size:24}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:b?.name}),a.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[N.transactions.length," transactions found",N.accountType&&` (Type: ${N.accountType})`]})]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Import to Account ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("select",{value:I,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white",required:!0,children:[a.jsx("option",{value:"",children:"Select an account..."}),p.map(e=>a.jsxs("option",{value:e.id,children:[e.name," (",e.type,")"]},e.id))]}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"QIF files don't contain account information, so you need to select the destination account"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",checked:S,onChange:e=>Q(e.target.checked),className:"rounded border-gray-300 text-primary focus:ring-primary"}),a.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Skip potential duplicates"})]}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 ml-6 mt-1",children:"Checks for transactions with the same date, amount, and payee"})]}),a.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[a.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Preview (First 5 transactions)"}),a.jsxs("div",{className:"space-y-2 text-sm",children:[N.transactions.slice(0,5).map((e,t)=>a.jsxs("div",{className:"flex justify-between text-gray-600 dark:text-gray-400",children:[a.jsxs("span",{children:[e.date," - ",e.payee||e.memo||"No description"]}),a.jsxs("span",{className:e.amount<0?"text-red-600":"text-green-600",children:["\xa3",Math.abs(e.amount).toFixed(2)]})]},t)),N.transactions.length>5&&a.jsxs("p",{className:"text-gray-500 dark:text-gray-400 text-xs mt-2",children:["...and ",N.transactions.length-5," more transactions"]})]})]}),a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsx("button",{onClick:D,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"Cancel"}),a.jsxs(c,{isLoading:f,onClick:async()=>{if(N&&b&&I){k(!0);try{const e=await b.text(),t=await m.importTransactions(e,I,S?g:[],{categories:h,autoCategorize:!0});for(const a of t.transactions)y(a);F({success:!0,imported:t.newTransactions,duplicates:t.duplicates,account:p.find(e=>e.id===I)})}catch(e){console.error("Import error:",e),F({success:!1,error:e instanceof Error?e.message:"Import failed"})}finally{k(!1)}}},disabled:!I,className:"flex items-center gap-2 px-6 py-2 bg-primary text-white rounded-lg hover:bg-secondary disabled:opacity-50",children:[a.jsx(n,{size:20}),"Import Transactions"]})]})]}),w&&a.jsxs("div",{className:"text-center",children:[w.success?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full mb-4",children:a.jsx(d,{size:32,className:"text-green-600 dark:text-green-400"})}),a.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Import Successful!"}),a.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:["Imported ",w.imported," transactions to ",w.account?.name]}),(w.duplicates??0)>0&&a.jsxs("p",{className:"text-sm text-yellow-600 dark:text-yellow-400 mb-6",children:["Skipped ",w.duplicates," potential duplicate transactions"]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full mb-4",children:a.jsx(o,{size:32,className:"text-red-600 dark:text-red-400"})}),a.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Import Failed"}),a.jsx("p",{className:"text-red-600 dark:text-red-400 mb-6",children:w.error})]}),a.jsxs("div",{className:"flex justify-center gap-3",children:[a.jsxs("button",{onClick:D,className:"flex items-center gap-2 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600",children:[a.jsx(x,{size:20}),"Import Another File"]}),a.jsx("button",{onClick:u,className:"px-6 py-2 bg-primary text-white rounded-lg hover:bg-secondary",children:"Done"})]})]})]})})}import{r as t,L as a}from"./chunk-Bcp2Zi4E.js";import{a as s,M as r,aY as n,aH as l,a0 as i,af as c,x as d,aa as o,ac as x}from"./index-LbveD3Go.js";import{q as m}from"./chunk-tZvAe11p.js";import"./chunk-oUGr0aFc.js";import"./chunk-a7oqB5tI.js";import"./chunk-B5pcS96K.js";import"./chunk-CkYa08k9.js";export{e as default};
