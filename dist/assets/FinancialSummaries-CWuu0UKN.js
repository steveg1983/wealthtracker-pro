function e(e,t){const a=i(),s=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??a.weekStartsOn??a.locale?.options?.weekStartsOn??0,n=r(e,t?.in),o=n.getDay(),l=6+(o<s?-7:0)-(o-s);return n.setDate(n.getDate()+l),n.setHours(23,59,59,999),n}function t(e,t,a){return function(e,t,a){return function(e,t,a){const s=r(e,a?.in);return isNaN(t)?n(e,NaN):(s.setDate(s.getDate()+t),s)}(e,7*t,a)}(e,-1,a)}function a({period:e}){const{transactions:t,accounts:a,budgets:s,goals:r}=m(),{formatCurrency:n,getCurrencySymbol:i,displayCurrency:o}=w(),[l,d]=k.useState(null),[b,f]=k.useState(!1);if(k.useEffect(()=>{const n="weekly"===e?v.generateWeeklySummary(t,a,s,r):v.generateMonthlySummary(t,a,s,r);d(n)},[t,a,s,r,e]),!l)return null;const j=e=>e>=0,N=e=>`${e>=0?"+":""}${e.toFixed(1)}%`;return x.jsxs("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-6",children:[x.jsxs("div",{className:"flex items-center justify-between mb-6",children:[x.jsxs("div",{children:[x.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:["weekly"===e?"Weekly":"Monthly"," Summary"]}),x.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1 mt-1",children:[x.jsx(g,{size:14}),c(l.startDate,"MMM d")," - ",c(l.endDate,"MMM d, yyyy")]})]}),x.jsxs("button",{onClick:()=>f(!b),className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300",children:[b?"Hide":"Show"," Details"]})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[x.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-xl p-4",children:[x.jsxs("div",{className:"flex items-center justify-between mb-2",children:[x.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Income"}),0!==l.comparison.incomeChange&&x.jsxs("span",{className:"text-xs flex items-center gap-1 "+(j(l.comparison.incomeChange)?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[j(l.comparison.incomeChange)?x.jsx(h,{size:12}):x.jsx(u,{size:12}),N(l.comparison.incomeChange)]})]}),x.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:n(l.totalIncome)})]}),x.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-xl p-4",children:[x.jsxs("div",{className:"flex items-center justify-between mb-2",children:[x.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Expenses"}),0!==l.comparison.expenseChange&&x.jsxs("span",{className:"text-xs flex items-center gap-1 "+(j(l.comparison.expenseChange)?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400"),children:[j(l.comparison.expenseChange)?x.jsx(h,{size:12}):x.jsx(u,{size:12}),N(l.comparison.expenseChange)]})]}),x.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:n(l.totalExpenses)})]}),x.jsxs("div",{className:"rounded-xl p-4 "+(l.netIncome.greaterThanOrEqualTo(0)?"bg-blue-50 dark:bg-blue-900/20":"bg-orange-50 dark:bg-orange-900/20"),children:[x.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Net Income"}),x.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:n(l.netIncome)}),x.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[l.savingsRate.toFixed(1),"% savings rate"]})]})]}),b&&x.jsxs("div",{className:"space-y-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[l.topCategories.length>0&&x.jsxs("div",{children:[x.jsxs("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:[x.jsx(y,{size:16}),"Top Spending Categories"]}),x.jsx("div",{className:"space-y-2",children:l.topCategories.map((e,t)=>x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[x.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.category}),x.jsx("div",{className:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:x.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${e.percentage}%`}})})]}),x.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white ml-3",children:n(e.amount)})]},t))})]}),l.budgetPerformance.filter(e=>e.percentage>80).length>0&&x.jsxs("div",{children:[x.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:"Budget Status"}),x.jsx("div",{className:"space-y-2",children:l.budgetPerformance.filter(e=>e.percentage>80).map((e,t)=>x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.budgetName}),x.jsxs("span",{className:"text-sm font-medium "+(e.percentage>100?"text-red-600 dark:text-red-400":e.percentage>90?"text-yellow-600 dark:text-yellow-400":"text-gray-900 dark:text-white"),children:[n(e.spent)," / ",n(e.limit),x.jsxs("span",{className:"text-xs ml-1",children:["(",e.percentage.toFixed(0),"%)"]})]})]},t))})]}),l.goalProgress.filter(e=>e.amountAdded.greaterThan(0)).length>0&&x.jsxs("div",{children:[x.jsxs("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:[x.jsx(p,{size:16}),"Goal Progress"]}),x.jsx("div",{className:"space-y-2",children:l.goalProgress.filter(e=>e.amountAdded.greaterThan(0)).map((e,t)=>x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.goalName}),x.jsxs("span",{className:"text-sm font-medium text-green-600 dark:text-green-400",children:["+",n(e.amountAdded)]})]},t))})]}),l.unusualTransactions.length>0&&x.jsxs("div",{children:[x.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:"Notable Transactions"}),x.jsx("div",{className:"space-y-2",children:l.unusualTransactions.map((e,t)=>x.jsxs("div",{className:"flex items-center justify-between text-sm",children:[x.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:e.description}),x.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:n(e.amount)})]},t))})]})]}),x.jsxs("div",{className:"flex gap-3 mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[x.jsx("button",{onClick:()=>{const e=v.formatSummaryText(l,i(o));navigator.clipboard.writeText(e)},className:"flex-1 px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors text-sm",children:"Copy Summary"}),x.jsx("button",{onClick:()=>{v.saveSummary(l)},className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"Save to History"})]})]})}function s(){const{transactions:e,accounts:t,budgets:s,goals:r}=m(),{formatCurrency:n}=w(),[i,o]=k.useState("weekly"),[l,d]=k.useState(!1);k.useEffect(()=>{if(v.shouldGenerateSummary("weekly")){const a=v.generateWeeklySummary(e,t,s,r);v.saveSummary(a)}if(v.shouldGenerateSummary("monthly")){const a=v.generateMonthlySummary(e,t,s,r);v.saveSummary(a)}},[e,t,s,r]);const u=v.getSummaryHistory().filter(e=>e.period===i).sort((e,t)=>new Date(t.startDate).getTime()-new Date(e.startDate).getTime());return x.jsx(N,{title:"Financial Summaries",rightContent:x.jsx("div",{className:"flex items-center gap-2",children:x.jsxs("button",{onClick:()=>d(!l),className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors flex items-center gap-2",children:[x.jsx(b,{size:20}),l?"Hide":"Show"," History"]})}),children:x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"flex gap-2 bg-gray-100 dark:bg-gray-800 p-1 rounded-lg",children:[x.jsxs("button",{onClick:()=>o("weekly"),className:"flex-1 px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2 "+("weekly"===i?"bg-white dark:bg-gray-700 text-primary shadow":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:[x.jsx(g,{size:16}),"Weekly"]}),x.jsxs("button",{onClick:()=>o("monthly"),className:"flex-1 px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2 "+("monthly"===i?"bg-white dark:bg-gray-700 text-primary shadow":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:[x.jsx(g,{size:16}),"Monthly"]})]}),x.jsxs("div",{children:[x.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["Current ","weekly"===i?"Week":"Month"]}),x.jsx(a,{period:i})]}),l&&u.length>0&&x.jsxs("div",{children:[x.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Previous Summaries"}),x.jsx("div",{className:"space-y-4",children:u.map((e,t)=>x.jsxs("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-6",children:[x.jsxs("div",{className:"flex items-center justify-between mb-4",children:[x.jsxs("div",{children:[x.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white",children:[c(new Date(e.startDate),"MMM d")," - ",c(new Date(e.endDate),"MMM d, yyyy")]}),x.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["weekly"===e.period?"Weekly":"Monthly"," Summary"]})]}),x.jsxs("div",{className:"text-right",children:[x.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Net Income"}),x.jsx("p",{className:"text-lg font-bold "+(e.netIncome.greaterThanOrEqualTo(0)?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:n(e.netIncome)})]})]}),x.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[x.jsxs("div",{children:[x.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Income"}),x.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:n(e.totalIncome)})]}),x.jsxs("div",{children:[x.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Expenses"}),x.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:n(e.totalExpenses)})]}),x.jsxs("div",{children:[x.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Savings Rate"}),x.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[e.savingsRate.toFixed(1),"%"]})]})]})]},t))})]}),l&&0===u.length&&x.jsx("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-12",children:x.jsxs("div",{className:"text-center",children:[x.jsx(h,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),x.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Historical Summaries"}),x.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"weekly"===i?"Weekly summaries will appear here as they are generated each Monday.":"Monthly summaries will appear here as they are generated on the 1st of each month."})]})})]})})}import{aO as r,b5 as n,bN as i,bO as o,aP as l,F as d,ab as c,g as m,j as x,r as g,T as h,J as u,L as y,aL as p,B as b}from"./index-Pkjq0qn3.js";import{a as k}from"./chunk-BWx9oMeS.js";import{s as f}from"./chunk-CGkNpBL1.js";import{s as j}from"./chunk-DyhMGJi1.js";import{P as N}from"./chunk-BnYLBI7x.js";import{u as w}from"./chunk-BYFRQ0Wn.js";import"./chunk-BN8kgYrt.js";import"./chunk-Drd-K-oK.js";const v=new class{STORAGE_KEY="financialSummaries";LAST_SUMMARY_KEY="lastSummaryGenerated";generateWeeklySummary(a,s,r,n,i=new Date){const l=o(i,{weekStartsOn:1}),d=e(i,{weekStartsOn:1}),c=o(t(i),{weekStartsOn:1}),m=e(t(i),{weekStartsOn:1});return this.generateSummary("weekly",l,d,c,m,a,s,r,n)}generateMonthlySummary(e,t,a,s,r=new Date){const n=f(r),i=l(r),o=f(j(r,1)),d=l(j(r,1));return this.generateSummary("monthly",n,i,o,d,e,t,a,s)}generateSummary(e,t,a,s,r,n,i,o,l){const m=n.filter(e=>{const s=new Date(e.date);return s>=t&&s<=a}),x=n.filter(e=>{const t=new Date(e.date);return t>=s&&t<=r}),g=m.filter(e=>"income"===e.type).reduce((e,t)=>e.plus(d(t.amount)),d(0)),h=m.filter(e=>"expense"===e.type).reduce((e,t)=>e.plus(d(t.amount)),d(0)),u=g.minus(h),y=x.filter(e=>"income"===e.type).reduce((e,t)=>e.plus(d(t.amount)),d(0)),p=x.filter(e=>"expense"===e.type).reduce((e,t)=>e.plus(d(t.amount)),d(0)),b=new Map;m.filter(e=>"expense"===e.type&&e.category).forEach(e=>{const t=b.get(e.category)||d(0);b.set(e.category,t.plus(d(e.amount)))});const k=Array.from(b.entries()).sort((e,t)=>t[1].minus(e[1]).toNumber()).slice(0,5).map(([e,t])=>({category:e,amount:t,percentage:h.greaterThan(0)?t.dividedBy(h).times(100).toNumber():0})),f=g.greaterThan(0)?u.dividedBy(g).times(100).toNumber():0,j=i.map(e=>{const t=m.filter(t=>t.accountId===e.id),a=t.filter(e=>"income"===e.type).reduce((e,t)=>e.plus(d(t.amount)),d(0)),s=t.filter(e=>"expense"===e.type).reduce((e,t)=>e.plus(d(t.amount)),d(0));return{accountName:e.name,balance:d(e.balance),change:a.minus(s)}}),N=o.map(e=>{const t=m.filter(t=>"expense"===t.type&&t.category===e.category).reduce((e,t)=>e.plus(d(t.amount)),d(0)),a=d(e.limit);return{budgetName:e.name,spent:t,limit:a,percentage:a.greaterThan(0)?t.dividedBy(a).times(100).toNumber():0}}),w=l.filter(e=>e.isActive).map(e=>{let t=d(0);e.linkedAccountIds&&e.linkedAccountIds.length>0&&e.linkedAccountIds.forEach(e=>{const a=j.find(t=>{const a=i.find(t=>t.id===e);return a&&t.accountName===a.name});a&&a.change.greaterThan(0)&&(t=t.plus(a.change))});const a=e.targetAmount>0?e.currentAmount/e.targetAmount*100:0;return{goalName:e.name,progress:a,amountAdded:t}}),v=h.dividedBy(Math.max(m.filter(e=>"expense"===e.type).length,1)).times(2),S=m.filter(e=>d(e.amount).greaterThan(v)||e.tags?.includes("unusual")).map(e=>({description:e.description,amount:d(e.amount),date:c(new Date(e.date),"dd MMM"),isHighAmount:d(e.amount).greaterThan(v)})).slice(0,5),M={incomeChange:y.greaterThan(0)?g.minus(y).dividedBy(y).times(100).toNumber():0,expenseChange:p.greaterThan(0)?h.minus(p).dividedBy(p).times(100).toNumber():0,savingsChange:y.greaterThan(0)?u.minus(y.minus(p)).dividedBy(y.minus(p).abs()).times(100).toNumber():0};return{period:e,startDate:t,endDate:a,totalIncome:g,totalExpenses:h,netIncome:u,topCategories:k,savingsRate:f,accountBalances:j,budgetPerformance:N,goalProgress:w,unusualTransactions:S,comparison:M}}saveSummary(e){try{const t=this.getSummaryHistory();t.push(e);const a="weekly"===e.period?52:12;t.length>a&&t.splice(0,t.length-a),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t)),localStorage.setItem(this.LAST_SUMMARY_KEY,(new Date).toISOString())}catch(t){console.error("Failed to save summary:",t)}}getSummaryHistory(){try{const e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):[]}catch{return[]}}shouldGenerateSummary(e){try{const t=localStorage.getItem(this.LAST_SUMMARY_KEY);if(!t)return!0;const a=new Date(t),s=new Date;return"weekly"===e?1===s.getDay()&&s.getDate()!==a.getDate():1===s.getDate()&&s.getMonth()!==a.getMonth()}catch{return!0}}formatSummaryText(e,t="\xa3"){const a="weekly"===e.period?"This Week":"This Month",s=`${c(e.startDate,"MMM d")} - ${c(e.endDate,"MMM d")}`;let r=`## ${a}'s Financial Summary\n`;r+=`### ${s}\n\n`,r+=`**Income:** ${t}${e.totalIncome.toFixed(2)}\n`,r+=`**Expenses:** ${t}${e.totalExpenses.toFixed(2)}\n`,r+=`**Net:** ${t}${e.netIncome.toFixed(2)}\n`,r+=`**Savings Rate:** ${e.savingsRate.toFixed(1)}%\n\n`,0===e.comparison.incomeChange&&0===e.comparison.expenseChange||(r+=`### Compared to Last ${"weekly"===e.period?"Week":"Month"}\n`,r+=`- Income: ${e.comparison.incomeChange>=0?"+":""}${e.comparison.incomeChange.toFixed(1)}%\n`,r+=`- Expenses: ${e.comparison.expenseChange>=0?"+":""}${e.comparison.expenseChange.toFixed(1)}%\n\n`),e.topCategories.length>0&&(r+="### Top Spending Categories\n",e.topCategories.forEach(e=>{r+=`- ${e.category}: ${t}${e.amount.toFixed(2)} (${e.percentage.toFixed(1)}%)\n`}),r+="\n");const n=e.budgetPerformance.filter(e=>e.percentage>100);n.length>0&&(r+="### \u26a0\ufe0f Over Budget\n",n.forEach(e=>{r+=`- ${e.budgetName}: ${t}${e.spent.toFixed(2)} / ${t}${e.limit.toFixed(2)} (${e.percentage.toFixed(0)}%)\n`}),r+="\n");const i=e.goalProgress.filter(e=>e.amountAdded.greaterThan(0));return i.length>0&&(r+="### Goal Progress\n",i.forEach(a=>{r+=`- ${a.goalName}: ${a.progress.toFixed(1)}% (+${t}${a.amountAdded.toFixed(2)} this ${"weekly"===e.period?"week":"month"})\n`})),r}};export{s as default};
