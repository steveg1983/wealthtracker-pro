function e(e,t,a){let s="";for(let r=0;r<a&&t+r<e.length;r++){const a=e[t+r];if(0===a)break;a>=32&&a<=126&&(s+=String.fromCharCode(a))}return s.trim()}function t(e,t,a){let s="";for(let r=0;r<a&&t+2*r+1<e.length;r++){const a=e[t+2*r]|e[t+2*r+1]<<8;if(0===a)break;a>=32&&a<65536&&(s+=String.fromCharCode(a))}return s.trim()}function a(e){let t=null;const a=e.split("/");if(3===a.length){const e=parseInt(a[0]),s=parseInt(a[1]);let r=parseInt(a[2]);r<100&&(r=r<50?2e3+r:1900+r),t=new Date(r,e-1,s)}if(!t||isNaN(t.getTime())){const a=e.split("-");if(3===a.length){const e=parseInt(a[0]),s=parseInt(a[1]);let r=parseInt(a[2]);r<100&&(r=r<50?2e3+r:1900+r),t=new Date(r,e-1,s)}}if(!t||isNaN(t.getTime())){const a=e.split("/");if(3===a.length){const e=parseInt(a[0]),s=parseInt(a[1]),r=parseInt(a[2]);e<=31&&s<=12&&(t=new Date(r,s-1,e))}}if(!t||isNaN(t.getTime())){const a=e.split("-");if(3===a.length&&4===a[0].length){const e=parseInt(a[0]),s=parseInt(a[1]),r=parseInt(a[2]);t=new Date(e,s-1,r)}}return t||new Date}function s({isOpen:e,onClose:t,rawData:a,onMappingComplete:s}){const[r,c]=o.useState({}),[i,l]=o.useState([]),[d,g]=o.useState("");o.useEffect(()=>{a&&a.length>0&&l(a.slice(0,10))},[a]);const h=e=>{if(null==e)return"";if(e instanceof Date)return e.toLocaleDateString();if("number"==typeof e){if(e>3e4&&e<6e4){const t=new Date(86400*(e-25569)*1e3);if(!isNaN(t.getTime()))return`${e} (${t.toLocaleDateString()})`}return e.toFixed(2)}const t=String(e);return t.length>50?t.substring(0,50)+"...":t};if(!e)return null;const m=i.length>0?Object.keys(i[0]):[];return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-7xl max-h-[90vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"flex justify-between items-center mb-4",children:[n.jsx("h2",{className:"text-xl font-semibold dark:text-white",children:"Map Your Data Fields"}),n.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:n.jsx(u,{size:24})})]}),n.jsx("div",{className:"mb-4",children:n.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx(b,{className:"text-blue-600 dark:text-blue-400 mt-0.5",size:20}),n.jsxs("div",{className:"text-sm text-blue-800 dark:text-blue-200",children:[n.jsx("p",{className:"font-semibold mb-1",children:"Help us understand your data"}),n.jsx("p",{children:"We've extracted data from your Money file. Please tell us what each column represents by selecting from the dropdown menus."}),n.jsxs("p",{className:"mt-2",children:["Required fields: ",n.jsx("span",{className:"font-semibold",children:"Date, Amount, and Description"})]})]})]})})}),n.jsx("div",{className:"flex-1 overflow-auto mb-4",children:n.jsxs("table",{className:"w-full border-collapse",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{className:"border border-gray-300 dark:border-gray-600 p-2 bg-gray-100 dark:bg-gray-700",children:n.jsxs("div",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:["Column ",m.map((e,t)=>t+1).join(", ")]})}),m.map((e,t)=>n.jsx("th",{className:"border border-gray-300 dark:border-gray-600 p-2 bg-gray-100 dark:bg-gray-700",children:n.jsx("select",{className:"w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:r[t]||"ignore",onChange:e=>{return a=t,s=e.target.value,c(e=>({...e,[a]:s})),void g("");var a,s},children:f.map(e=>n.jsx("option",{value:e.value,children:e.label},e.value))})},t))]})}),n.jsx("tbody",{children:i.map((e,t)=>n.jsxs("tr",{className:t%2==0?"bg-gray-50 dark:bg-gray-800/50":"",children:[n.jsxs("td",{className:"border border-gray-300 dark:border-gray-600 p-2 text-sm font-semibold text-gray-600 dark:text-gray-400",children:["Row ",t+1]}),m.map((t,a)=>n.jsx("td",{className:"border border-gray-300 dark:border-gray-600 p-2 text-sm text-gray-900 dark:text-white",children:h(e[t])},a))]},t))})]})}),n.jsx("div",{className:"mb-4",children:n.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing first 10 records of ",a.length," total records"]})}),d&&n.jsxs("div",{className:"mb-4 p-3 rounded-lg flex items-center gap-2 bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300",children:[n.jsx(b,{size:20}),n.jsx("span",{children:d})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:t,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"}),n.jsxs("button",{onClick:()=>{const e=(()=>{const e={};let t=!1,a=!1,s=!1;return Object.entries(r).forEach(([r,n])=>{const o=parseInt(r);switch(n){case"date":e.date=o,t=!0;break;case"amount":e.amount=o,a=!0;break;case"description":e.description=o,s=!0;break;case"payee":e.payee=o;break;case"category":e.category=o;break;case"accountName":e.accountName=o;break;case"type":e.type=o}}),t&&a&&s?e:(g("Please map at least Date, Amount, and Description fields"),null)})();e&&s(e,a)},className:"flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-secondary flex items-center justify-center gap-2",children:[n.jsx(y,{size:20}),"Continue with Import"]})]})]})})}function r({isOpen:r,onClose:c}){const{addAccount:u,addTransaction:f,accounts:k,hasTestData:j,clearAllData:N}=i(),[w,v]=o.useState(null),[M,C]=o.useState(!1),[D,S]=o.useState(!1),[I,L]=o.useState("idle"),[A,T]=o.useState(""),[F,W]=o.useState(null),[$,E]=o.useState(!1),[O,_]=o.useState([]),[P,R]=o.useState(!1),z=async()=>{if(F){C(!0);try{console.log("Starting import of",F.accounts.length,"accounts and",F.transactions.length,"transactions");const e=new Map;for(const a of F.accounts){const t=k.find(e=>e.name.toLowerCase()===a.name.toLowerCase());if(t){console.log("Account already exists:",a.name),e.set(a.name,t.id);continue}const s={name:a.name,type:"checking"===a.type?"current":a.type,balance:a.balance,currency:"GBP",institution:"Imported",lastUpdated:new Date};console.log("Adding account:",s),u(s),e.set(a.name,`imported-${Date.now()}`)}const t=k[0]?.id||"default";console.log("Importing",F.transactions.length,"transactions");for(const a of F.transactions)f({...a,accountId:t});L("success"),T(`Successfully imported ${F.accounts.length} accounts and ${F.transactions.length} transactions`),setTimeout(()=>{c(),v(null),W(null),L("idle"),T("")},2e3)}catch(e){console.error("Import error:",e),L("error"),T("Failed to import data")}finally{C(!1)}}};return n.jsxs(n.Fragment,{children:[n.jsxs(l,{isOpen:r,onClose:()=>{c(),R(!1)},title:"Import Financial Data",size:"xl",children:[n.jsxs(d,{children:[n.jsxs("div",{className:"mb-6",children:[n.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Import your financial data from Microsoft Money or other financial software. Supported formats:"}),n.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-600 dark:text-gray-400 mb-4",children:[n.jsxs("li",{children:[n.jsx("strong",{children:"QIF"})," - Quicken Interchange Format (recommended for Money users)"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"OFX"})," - Open Financial Exchange"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"MNY"})," - Microsoft Money database files (with manual mapping)"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"MBF"})," - Microsoft Money backup files (with manual mapping)"]})]}),n.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4",children:n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx(g,{className:"text-blue-600 dark:text-blue-400 mt-0.5",size:20}),n.jsxs("div",{className:"text-sm text-blue-800 dark:text-blue-200",children:[n.jsx("p",{className:"font-semibold mb-1",children:"Money File Import:"}),n.jsx("p",{children:"For Money .mny or .mbf files, we'll show you the data and let you tell us what each column represents."})]})]})}),n.jsx("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center",children:D?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),n.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Parsing file..."})]}):n.jsxs(n.Fragment,{children:[n.jsx(x,{className:"mx-auto text-gray-400 mb-4",size:48}),n.jsxs("label",{className:"cursor-pointer",children:[n.jsx("span",{className:"bg-primary text-white px-4 py-2 rounded-lg hover:bg-secondary transition-colors inline-block",children:"Choose File"}),n.jsx("input",{type:"file",accept:".mny,.mbf,.qif,.ofx,.csv",onChange:async s=>{const r=s.target.files?.[0];if(!r)return;v(r),L("idle"),T(""),S(!0);const n=r.name.toLowerCase();try{let s=null;if(n.endsWith(".mny")){console.log("Detected MNY file"),T("Parsing Money database file... This may take a moment...");const a=await r.arrayBuffer();if(s=await async function(a){const s=new Uint8Array(a),r=new DataView(a),n=[];for(let o=0;o<a.byteLength-256&&n.length<1e4;o+=256){const c={};for(let n=0;n<Math.min(10,32);n++){const i=o+8*n;if(i+8<=a.byteLength){const e=r.getFloat64(i,!0);e>3e4&&e<6e4?c[`field_${n}_date`]=e:Math.abs(e)>.01&&Math.abs(e)<1e6&&(c[`field_${n}_amount`]=e);const t=r.getInt32(i,!0);t>0&&t<1e6&&(c[`field_${n}_int`]=t)}const l=e(s,o+20*n,50);l&&l.length>2&&(c[`field_${n}_text`]=l);const d=t(s,o+20*n,25);d&&d.length>2&&d!==l&&(c[`field_${n}_text_utf16`]=d)}Object.keys(c).length>=3&&n.push(c),o%1048576==0&&o>0&&(console.log(`Scanned ${(o/1048576).toFixed(1)}MB...`),await new Promise(e=>setTimeout(e,0)))}return n.length>10?{accounts:[],transactions:[],rawData:n,needsMapping:!0,warning:"We found structured data in your Money file. Please help us understand what each field represents."}:{accounts:[{name:"Money Import",type:"checking",balance:0}],transactions:[],warning:"Unable to automatically parse this Money file. Please export from Money as QIF format instead."}}(a),s.needsMapping&&s.rawData)return _(s.rawData),E(!0),void S(!1)}else if(n.endsWith(".mbf")){console.log("Detected MBF backup file"),T("Parsing Money backup file... This may take a moment...");const a=await r.arrayBuffer();if(s=await async function(a){const s=new Uint8Array(a),r=new DataView(a);Array.from(s.slice(0,64)).map(e=>e.toString(16).padStart(2,"0")).join(" ");let n=0;for(let e=0;e<Math.min(1e4,a.byteLength);e++){const t=s[e];t>=32&&t<=126&&n++}const o=n/Math.min(1e4,a.byteLength)*100;console.log(`Readable text percentage in first 10KB: ${o.toFixed(1)}%`);const c=[],i=[128,256,512,1024];for(const l of i){const n=[];for(let o=0;o<Math.min(5e4,a.byteLength)&&n.length<100;o+=l){const c={};let i=!1;for(let n=0;n<Math.min(20,l/8);n++){const l=o+8*n;if(l+8<=a.byteLength){const e=r.getFloat64(l,!0);if(e>3e4&&e<6e4?(c[`field_${n}_date`]=e,i=!0):Math.abs(e)>.01&&Math.abs(e)<1e6&&(c[`field_${n}_amount`]=e,i=!0),l+4<=a.byteLength){const e=r.getInt32(l,!0),t=r.getFloat32(l,!0);e>0&&e<1e6&&(c[`field_${n}_int32`]=e),Math.abs(t)>.01&&Math.abs(t)<1e4&&(c[`field_${n}_float32`]=t)}}const d=o+16*n;if(d<a.byteLength-50){const a=e(s,d,50),r=t(s,d,25);a&&a.length>2&&a.length<50&&(c[`field_${n}_text`]=a,i=!0),r&&r.length>2&&r.length<50&&r!==a&&(c[`field_${n}_text_utf16`]=r,i=!0)}}i&&Object.keys(c).length>=2&&n.push(c)}if(n.length>10){c.push(...n);break}}if(c.length<10)for(let l=0;l<Math.min(a.byteLength-100,1e5);l++){const n={};let o=!1,i=!1;if(l+4<=a.byteLength){const e=r.getInt32(l,!0);if(e>25e3&&e<5e4){const t=new Date(1900,0,1);t.setDate(t.getDate()+e),t.getFullYear()>=1990&&t.getFullYear()<=2030&&(n.date_value=e,n.date_formatted=t.toLocaleDateString(),o=!0)}}if(o)for(let e=4;e<50&&!(l+e+8>a.byteLength);e+=4){const t=r.getFloat64(l+e,!0),a=r.getFloat32(l+e,!0),s=r.getInt32(l+e,!0);if(Math.abs(t)>.01&&Math.abs(t)<1e5){n.amount=t,i=!0;break}if(Math.abs(a)>.01&&Math.abs(a)<1e5){n.amount=a,i=!0;break}if(Math.abs(s/100)>.01&&Math.abs(s/100)<1e5){n.amount=s/100,i=!0;break}}if(o&&i){for(let a=0;a<200;a+=10){const r=e(s,l+a,100)||t(s,l+a,50);if(r&&r.length>2&&r.length<100){n.description=r;break}}Object.keys(n).length>=3&&(c.push(n),l+=50)}}return c.length>10?{accounts:[],transactions:[],rawData:c,needsMapping:!0,warning:"Found data in your Money backup file. Please help us map the fields correctly."}:{accounts:[{name:"Money Backup File",type:"checking",balance:0}],transactions:[],warning:"Unable to extract data from this Money backup file. The file may be encrypted or in a format we don't support. Please try exporting as QIF from Microsoft Money instead."}}(a),s.needsMapping&&s.rawData)return _(s.rawData),E(!0),void S(!1)}else if(n.endsWith(".qif")){console.log("Detected QIF file"),T("Parsing QIF file...");const e=await r.text();console.log("QIF file content length:",e.length),console.log("First 200 chars:",e.substring(0,200)),s=function(e){const t=e.split(/\r?\n/),s=[],r=new Map;let n={},o="",c="checking",i=0;for(;i<t.length;){const e=t[i].trim();if("!Account"===e){let e="",a="checking",s=0;for(i++;i<t.length&&!t[i].startsWith("!");){const r=t[i].trim();if(r.startsWith("N"))e=r.substring(1).trim();else if(r.startsWith("T")){const e=r.substring(1).toLowerCase();e.includes("credit")||"ccard"===e?a="credit":e.includes("savings")||e.includes("oth a")?a="savings":e.includes("invest")?a="investment":(e.includes("loan")||e.includes("mort"))&&(a="loan")}else if(r.startsWith("B")){const e=r.substring(1).replace(/[,\xa3$]/g,"");s=parseFloat(e)||0}else if(r.startsWith("^"))break;i++}e&&r.set(e,{name:e,type:a,balance:s})}else if(e.startsWith("!Type:")){o=o||"Default Account";const t=e.substring(6).toLowerCase();t.includes("bank")||t.includes("cash")?c="checking":t.includes("ccard")||t.includes("credit")?c="credit":t.includes("invst")?c="investment":t.includes("oth l")?c="loan":t.includes("oth a")&&(c="savings")}i++}i=0;const l=new Map;for(;i<t.length;){const e=t[i].trim();if(e.startsWith("^")){if(n.date&&void 0!==n.amount){let e=o||"General Account";if(n.category){const t=n.category.match(/\[([^\]]+)\]/);t&&(e=t[1],n.category=n.category.replace(/\[([^\]]+)\]/,"").trim());const a=n.category.match(/^([^:]+):/);a&&a[1].length<50&&(e=a[1],n.category=n.category.substring(a[0].length).trim())}if(n.payee){const e=n.payee.match(/Transfer (?:from|to) (.+)/i);if(e){const t=e[1];r.has(t)||r.set(t,{name:t,type:"checking",balance:0})}}r.has(e)||r.set(e,{name:e,type:c,balance:0}),l.has(e)||l.set(e,{income:0,expenses:0});const t=l.get(e);n.amount>0?t.income+=Math.abs(n.amount):t.expenses+=Math.abs(n.amount);const a={date:n.date,amount:Math.abs(n.amount),description:n.payee||n.memo||"No description",type:n.amount<0?"expense":"income",category:n.category||"Uncategorized",payee:n.payee,accountName:e};s.push(a)}n={}}else if(e.startsWith("D")){const t=e.substring(1).trim();n.date=a(t)}else if(e.startsWith("T")){const t=e.substring(1).replace(/[,\xa3$]/g,"").trim();n.amount=Math.round(100*parseFloat(t))/100}else e.startsWith("P")?n.payee=e.substring(1).trim():e.startsWith("M")?n.memo=e.substring(1).trim():e.startsWith("L")?n.category=e.substring(1).trim():e.startsWith("N")&&!e.startsWith("N0")&&e.length>2&&(n.checkNum=e.substring(1).trim());i++}return l.forEach((e,t)=>{const a=r.get(t);a&&(a.balance=e.income-e.expenses)}),r.size<=1&&s.length>10&&s.forEach(e=>{if(e.payee&&e.payee.match(/VISA|MASTERCARD|AMEX|DISCOVER/i)){const t=e.payee.match(/(VISA|MASTERCARD|AMEX|DISCOVER).*?(\d{4})/i);if(t){const e=`${t[1]} ...${t[2]}`;r.has(e)||r.set(e,{name:e,type:"credit",balance:0})}}if(e.payee&&e.payee.match(/HSBC|BARCLAYS|LLOYDS|NATWEST|SANTANDER/i)){const t=e.payee.match(/(HSBC|BARCLAYS|LLOYDS|NATWEST|SANTANDER).*?(\d{4})/i);if(t){const e=`${t[1]} ...${t[2]}`;r.has(e)||r.set(e,{name:e,type:"checking",balance:0})}}}),0===r.size&&r.set("Imported Account",{name:"Imported Account",type:"checking",balance:0}),{accounts:Array.from(r.values()),transactions:s}}(e)}else{if(!n.endsWith(".ofx"))throw new Error("Unsupported file format. Please use .mny, .mbf, .qif, or .ofx files.");console.log("Detected OFX file"),T("Parsing OFX file..."),s=(e=>{const t=[],a=new Map,s=e.match(/<ACCTID>([^<]+)/),r=e.match(/<ACCTTYPE>([^<]+)/),n=e.match(/<BALAMT>([^<]+)/),o=s?`Account ${s[1]}`:"Imported Account",c=r?.[1]?.toLowerCase()||"checking",i=n?parseFloat(n[1]):0;a.set(o,{name:o,type:c.includes("credit")?"credit":c.includes("saving")?"savings":"checking",balance:i});const l=e.match(/<STMTTRN>[\s\S]*?<\/STMTTRN>/g)||[];for(const d of l){const e=d.match(/<TRNTYPE>([^<]+)/),a=d.match(/<DTPOSTED>([^<]+)/),s=d.match(/<TRNAMT>([^<]+)/),r=d.match(/<NAME>([^<]+)/),n=d.match(/<MEMO>([^<]+)/);if(a&&s){const o=a[1],c=parseInt(o.substring(0,4)),i=parseInt(o.substring(4,6)),l=parseInt(o.substring(6,8)),d=parseFloat(s[1]),g=r?.[1]||n?.[1]||"Imported transaction",h=d<0?"expense":"income";t.push({date:new Date(c,i-1,l),amount:Math.abs(d),description:g,type:h,category:e?.[1]||"Other"})}}return{accounts:Array.from(a.values()),transactions:t}})(await r.text())}s&&(console.log("Parse complete:",s.accounts.length,"accounts,",s.transactions.length,"transactions"),W(s),s.warning?(T(s.warning),L("error")):(T(`Found ${s.accounts.length} accounts and ${s.transactions.length} transactions`),L("idle")))}catch(o){console.error("Parse error:",o),L("error"),T(o instanceof Error?o.message:"Failed to parse file"),W(null)}finally{S(!1)}},className:"hidden",disabled:D})]}),n.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:w?w.name:"No file selected"})]})})]}),F&&F.warning&&n.jsxs("div",{className:"mb-4 p-3 rounded-lg flex items-start gap-2 bg-orange-100 dark:bg-orange-900/20 text-orange-700 dark:text-orange-300",children:[n.jsx(m,{size:20,className:"mt-0.5 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold mb-1",children:"Import Notice"}),n.jsx("p",{className:"text-sm",children:F.warning})]})]}),F&&(F.accounts.length>0||F.transactions.length>0)&&n.jsxs("div",{className:"mb-6 bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[n.jsx("h3",{className:"font-semibold mb-2 dark:text-white",children:"Preview"}),n.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Accounts found:"}),n.jsx("p",{className:"font-semibold dark:text-white",children:F.accounts.length}),F.accounts.slice(0,5).map((e,t)=>n.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["\u2022 ",e.name," (",e.type,")"]},t)),F.accounts.length>5&&n.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["\u2022 ... and ",F.accounts.length-5," more"]})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Transactions found:"}),n.jsx("p",{className:"font-semibold dark:text-white",children:F.transactions.length}),F.transactions.length>0&&n.jsxs(n.Fragment,{children:[n.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Date range: ",F.transactions[0].date.toLocaleDateString()," - ",F.transactions[F.transactions.length-1].date.toLocaleDateString()]}),n.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["First: ",F.transactions[0].description.substring(0,30),"..."]})]})]})]})]}),A&&!F?.warning&&n.jsxs("div",{className:"mb-4 p-3 rounded-lg flex items-center gap-2 "+("success"===I?"bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-300":"error"===I?"bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300":"bg-blue-100 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300"),children:["success"===I?n.jsx(y,{size:20}):"error"===I?n.jsx(b,{size:20}):n.jsx(p,{size:20}),n.jsx("span",{children:A})]})]}),n.jsx(h,{children:n.jsxs("div",{className:"flex gap-3 w-full",children:[n.jsx("button",{onClick:()=>{c(),R(!1)},disabled:D||M,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50",children:"Cancel"}),n.jsx("button",{onClick:async()=>{F&&(!j||P?z():R(!0))},disabled:!F||M||D||0===F.accounts.length,className:"flex-1 px-4 py-2 rounded-lg "+(F&&!M&&!D&&F.accounts.length>0?"bg-primary text-white hover:bg-secondary":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"),children:M?"Importing...":"Import Data"})]})})]}),n.jsx(s,{isOpen:$,onClose:()=>E(!1),rawData:O,onMappingComplete:(e,t)=>{const a=function(e,t){const a=new Map,s=[];return e.forEach(e=>{try{const r=e[Object.keys(e)[t.date]],n=e[Object.keys(e)[t.amount]],o=e[Object.keys(e)[t.description]];let c;if(c="number"==typeof r&&r>3e4&&r<6e4?new Date(86400*(r-25569)*1e3):r instanceof Date?r:new Date(String(r)),isNaN(c.getTime()))return;const i=parseFloat(String(n));if(isNaN(i))return;const l=Math.round(100*i)/100,d=void 0!==t.payee?String(e[Object.keys(e)[t.payee]]||""):void 0,g=void 0!==t.category?String(e[Object.keys(e)[t.category]]||"Imported"):"Imported",h=void 0!==t.accountName?String(e[Object.keys(e)[t.accountName]]||"Primary Account"):"Primary Account";h&&!a.has(h)&&a.set(h,{name:h,type:"checking",balance:0}),s.push({date:c,amount:Math.abs(l),description:String(o),type:l<0?"expense":"income",category:String(g),payee:d?String(d):void 0,accountName:h})}catch(r){console.error("Error processing record:",r)}}),a.forEach(e=>{const t=s.filter(t=>t.accountName===e.name),a=t.filter(e=>"income"===e.type).reduce((e,t)=>e+t.amount,0),r=t.filter(e=>"expense"===e.type).reduce((e,t)=>e+t.amount,0);e.balance=a-r}),{accounts:Array.from(a.values()),transactions:s}}(t,e);W({accounts:a.accounts,transactions:a.transactions}),T(`Mapped ${a.accounts.length} accounts and ${a.transactions.length} transactions`),E(!1)}}),P&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx(m,{className:"text-orange-500",size:24}),n.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Test Data Detected"})]}),n.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"You currently have test data loaded in your application. You're about to import real bank data."}),n.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Would you like to:"}),n.jsxs("div",{className:"space-y-3 mb-6",children:[n.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[n.jsx("p",{className:"font-medium text-blue-800 dark:text-blue-200",children:"Clear test data first (Recommended)"}),n.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-300 mt-1",children:"Remove all test data and start fresh with your real bank data"})]}),n.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[n.jsx("p",{className:"font-medium text-gray-800 dark:text-gray-200",children:"Continue with test data"}),n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Mix your real bank data with the existing test data"})]})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>R(!1),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"}),n.jsx("button",{onClick:()=>{R(!1),z()},className:"flex-1 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Continue"}),n.jsx("button",{onClick:async()=>{N(),R(!1),setTimeout(()=>{F&&(C(!0),z())},100)},className:"flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-secondary",children:"Clear & Import"})]})]})})]})}import{H as n,r as o}from"./chunk-DowOIOga.js";import{b1 as c,a as i,M as l,d,bM as g,e as h}from"./index-qHm2isZb.js";import{A as m}from"./chunk-BC9R0o2T.js";import{X as u}from"./chunk-DBtIkPjn.js";import"./chunk-ddLY9KjI.js";import"./chunk-B5pcS96K.js";const x=e=>n.jsxs(c,{...e,children:[n.jsx("path",{d:"M21 15V19C21 20.1 20.1 21 19 21H5C3.9 21 3 20.1 3 19V15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),n.jsx("path",{d:"M17 8L12 3L7 8",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),n.jsx("path",{d:"M12 3V15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),p=e=>n.jsxs(c,{...e,children:[n.jsx("path",{d:"M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),n.jsx("path",{d:"M14 2V8H20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),n.jsx("path",{d:"M16 13H8",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),n.jsx("path",{d:"M16 17H8",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),n.jsx("path",{d:"M10 9H8",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),b=e=>n.jsxs(c,{...e,children:[n.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",fill:"none"}),n.jsx("path",{d:"M12 8V12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),n.jsx("path",{d:"M12 16H12.01",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),y=e=>n.jsxs(c,{...e,children:[n.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",fill:"none"}),n.jsx("path",{d:"M9 12L11 14L15 10",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),f=[{value:"ignore",label:"Ignore this column"},{value:"date",label:"Date"},{value:"amount",label:"Amount"},{value:"description",label:"Description"},{value:"payee",label:"Payee"},{value:"category",label:"Category"},{value:"accountName",label:"Account Name"},{value:"type",label:"Transaction Type (Income/Expense)"},{value:"balance",label:"Balance"},{value:"checkNumber",label:"Check Number"}];export{r as default};
