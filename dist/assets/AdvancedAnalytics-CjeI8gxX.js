function e(){const{transactions:e,accounts:t,budgets:s,categories:n}=l(),{formatCurrency:y}=S(),[b,v]=a.useState("insights"),[j,f]=a.useState([]),[N,w]=a.useState([]),[I,M]=a.useState([]),[z,$]=a.useState([]),[C,B]=a.useState(!1),D=a.useCallback(async()=>{B(!0);try{const[a,r,i,l]=await Promise.all([Promise.resolve(A.detectSpendingAnomalies(e)),Promise.resolve(A.predictFutureSpending(e,n)),Promise.resolve(A.identifySavingsOpportunities(e,t)),Promise.resolve(A.generateInsights(e,t,s))]);f(a),w(r),M(i),$(l)}finally{B(!1)}},[e,t,s,n]);a.useEffect(()=>{D()},[D]);const P=e=>{switch(e){case"high":return"text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20";case"medium":return"text-yellow-600 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/20";case"low":return"text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20"}},T=e=>{switch(e){case"easy":return"text-green-600 dark:text-green-400";case"medium":return"text-yellow-600 dark:text-yellow-400";case"hard":return"text-red-600 dark:text-red-400"}},R=e=>{switch(e){case"positive":return r.jsx(p,{size:20,className:"text-green-600 dark:text-green-400"});case"negative":return r.jsx(h,{size:20,className:"text-red-600 dark:text-red-400"});case"neutral":return r.jsx(u,{size:20,className:"text-blue-600 dark:text-blue-400"})}},E=[{id:"insights",label:"Insights",icon:c,count:z.length},{id:"anomalies",label:"Anomalies",icon:d,count:j.length},{id:"predictions",label:"Predictions",icon:o,count:N.length},{id:"opportunities",label:"Opportunities",icon:g,count:I.length}];return r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-blue-600 rounded-2xl p-6 text-white",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold mb-2",children:"AI-Powered Analytics"}),r.jsx("p",{className:"text-purple-100",children:"Advanced insights powered by machine learning algorithms"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-3 h-3 rounded-full "+(C?"bg-yellow-400 animate-pulse":"bg-green-400")}),r.jsx("span",{className:"text-sm",children:C?"Analyzing...":"Up to date"})]})]})}),r.jsx("div",{className:"flex gap-2 bg-gray-100 dark:bg-gray-800 p-1 rounded-lg overflow-x-auto",children:E.map(e=>{const t=e.icon;return r.jsxs("button",{onClick:()=>v(e.id),className:"flex-1 min-w-[120px] px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2 "+(b===e.id?"bg-white dark:bg-gray-700 text-primary shadow":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:[r.jsx(t,{size:16}),r.jsx("span",{children:e.label}),e.count>0&&r.jsx("span",{className:"ml-1 px-2 py-0.5 text-xs bg-primary/10 text-primary rounded-full",children:e.count})]},e.id)})}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow p-6",children:["insights"===b&&r.jsx("div",{className:"space-y-4",children:z.length>0?z.map(e=>r.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl p-4",children:r.jsxs("div",{className:"flex items-start gap-4",children:[R(e.impact),r.jsxs("div",{className:"flex-1",children:[r.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-1",children:e.title}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:e.description}),e.actionable&&r.jsx("button",{className:"mt-2 text-sm text-blue-600 dark:text-blue-400 hover:underline",children:"Take action \u2192"})]}),r.jsxs("span",{className:"text-xs px-2 py-1 rounded-full "+("high"===e.priority?"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300":"medium"===e.priority?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:[e.priority," priority"]})]})},e.id)):r.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[r.jsx(c,{size:48,className:"mx-auto mb-3 opacity-50"}),r.jsx("p",{children:"No insights available yet. Add more transactions to get started."})]})}),"anomalies"===b&&r.jsx("div",{className:"space-y-4",children:j.length>0?j.map(e=>r.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl p-4",children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsxs("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${P(e.severity)}`,children:[e.severity," severity"]}),r.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:k(e.date,"MMM d, yyyy")})]}),r.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-1",children:e.description}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.reason}),r.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[r.jsxs("span",{className:"text-gray-700 dark:text-gray-300",children:["Category: ",e.category]}),r.jsxs("span",{className:"text-red-600 dark:text-red-400",children:[e.percentageAboveNormal,"% above normal"]})]})]}),r.jsx("div",{className:"text-right",children:r.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:y(e.amount)})})]})},e.id)):r.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[r.jsx(d,{size:48,className:"mx-auto mb-3 opacity-50"}),r.jsx("p",{children:"No spending anomalies detected. Your spending patterns look normal!"})]})}),"predictions"===b&&r.jsx("div",{className:"space-y-4",children:N.length>0?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mb-4",children:r.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[r.jsx("strong",{children:"Next Month Forecast:"})," Based on your spending patterns, we predict your expenses for each category next month."]})}),N.map(e=>r.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:e.category}),r.jsxs("div",{className:"flex items-center gap-2",children:["increasing"===e.trend?r.jsx(m,{size:16,className:"text-red-600 dark:text-red-400"}):"decreasing"===e.trend?r.jsx(x,{size:16,className:"text-green-600 dark:text-green-400"}):r.jsx("span",{className:"w-4 h-0.5 bg-gray-400"}),r.jsx("span",{className:"text-sm "+("increasing"===e.trend?"text-red-600 dark:text-red-400":"decreasing"===e.trend?"text-green-600 dark:text-green-400":"text-gray-600 dark:text-gray-400"),children:e.trend})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Predicted"}),r.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:y(e.predictedAmount)})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Monthly Avg"}),r.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:y(e.monthlyAverage)})]})]}),r.jsx("div",{className:"mt-3 flex items-center justify-between",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-24 bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:r.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:100*e.confidence+"%"}})}),r.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[Math.round(100*e.confidence),"% confidence"]})]})}),e.recommendation&&r.jsxs("p",{className:"mt-3 text-sm text-blue-600 dark:text-blue-400",children:["\ud83d\udca1 ",e.recommendation]})]},e.category))]}):r.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[r.jsx(o,{size:48,className:"mx-auto mb-3 opacity-50"}),r.jsx("p",{children:"Not enough data to make predictions yet. Keep tracking your expenses!"})]})}),"opportunities"===b&&r.jsx("div",{className:"space-y-4",children:I.length>0?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 mb-4",children:r.jsxs("p",{className:"text-sm text-green-800 dark:text-green-200",children:[r.jsx("strong",{children:"Total Potential Savings:"})," ",y(I.reduce((e,t)=>e.plus(t.potentialSavings),i(0)))," per year"]})}),I.map(e=>r.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl p-4",children:[r.jsxs("div",{className:"flex items-start justify-between mb-3",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-1",children:e.title}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.description})]}),r.jsx("span",{className:`text-sm font-medium ${T(e.difficulty)}`,children:e.difficulty})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Potential savings"}),r.jsxs("p",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:[y(e.potentialSavings),"/year"]})]}),r.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm",children:e.actionRequired})]})]},e.id))]}):r.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[r.jsx(g,{size:48,className:"mx-auto mb-3 opacity-50"}),r.jsx("p",{children:"No savings opportunities identified yet. We'll keep analyzing your spending!"})]})})]})]})}function t(){const{transactions:e}=l(),{formatCurrency:t}=S(),[s,n]=a.useState([]),[c,d]=a.useState(null),[o,g]=a.useState(!1),[m,x]=a.useState(new Set);a.useEffect(()=>{h(),p()},[e]);const h=()=>{const t=A.suggestBillNegotiations(e);n(t)},p=()=>{const e=localStorage.getItem("completedNegotiations");e&&x(new Set(JSON.parse(e)))},f=s.reduce((e,t)=>e.plus(t.potentialSavings),i(0)),N=e=>e>=70?"text-green-600 dark:text-green-400":e>=50?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400";return r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl p-6 text-white",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-xl font-bold mb-2",children:"Bill Negotiation Assistant"}),r.jsx("p",{className:"text-green-100",children:"AI-powered suggestions to reduce your recurring bills"})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("p",{className:"text-sm text-green-100",children:"Potential Annual Savings"}),r.jsx("p",{className:"text-3xl font-bold",children:t(f.times(12))})]})]})}),s.length>0?r.jsx("div",{className:"space-y-4",children:s.map(e=>{const s=m.has(e.merchant);return r.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border "+(s?"border-green-200 dark:border-green-800 opacity-75":"border-gray-200 dark:border-gray-700"),children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx("h4",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e.merchant}),s&&r.jsxs("span",{className:"flex items-center gap-1 text-green-600 dark:text-green-400 text-sm",children:[r.jsx(y,{size:16}),"Negotiated"]})]}),r.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Current Bill"}),r.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[t(e.currentAmount),"/month"]})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Potential Savings"}),r.jsxs("p",{className:"font-medium text-green-600 dark:text-green-400",children:[t(e.potentialSavings),"/month"]})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Success Rate"}),r.jsxs("p",{className:`font-medium ${N(e.successRate)}`,children:[e.successRate,"%"]})]})]}),r.jsxs("div",{className:"flex items-center gap-4 mt-3 text-sm text-gray-600 dark:text-gray-400",children:[r.jsxs("span",{children:["Category: ",e.category]}),r.jsxs("span",{children:["Last bill: ",k(e.lastTransactionDate,"MMM d, yyyy")]})]})]}),r.jsx("div",{className:"ml-6",children:s?r.jsx("button",{onClick:()=>{const t=new Set(m);t.delete(e.merchant),x(t),localStorage.setItem("completedNegotiations",JSON.stringify(Array.from(t)))},className:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Undo"}):r.jsxs("button",{onClick:()=>(d(e),void g(!0)),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[r.jsx(b,{size:16}),"Negotiate"]})})]})},e.merchant)})}):r.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-xl p-8 text-center",children:[r.jsx(v,{size:48,className:"text-gray-300 dark:text-gray-600 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Negotiable Bills Found"}),r.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"We'll analyze your recurring bills and suggest ones that could be negotiated for better rates."})]}),c&&r.jsx(j,{isOpen:o,onClose:()=>{g(!1),d(null)},title:`Negotiate ${c.merchant}`,size:"md",children:r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-sm text-blue-800 dark:text-blue-200",children:"Potential Monthly Savings"}),r.jsx("span",{className:"text-lg font-bold text-blue-900 dark:text-blue-100",children:t(c.potentialSavings)})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-sm text-blue-800 dark:text-blue-200",children:"Success Rate"}),r.jsxs("span",{className:`font-medium ${N(c.successRate)}`,children:[c.successRate,"%"]})]})]}),r.jsxs("div",{children:[r.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:[r.jsx(u,{size:20}),"Negotiation Tips"]}),r.jsx("ul",{className:"space-y-2",children:c.negotiationTips.map((e,t)=>r.jsxs("li",{className:"flex items-start gap-2",children:[r.jsx(y,{size:16,className:"text-green-600 dark:text-green-400 mt-0.5 flex-shrink-0"}),r.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:e})]},t))})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Sample Script"}),r.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 text-sm text-gray-700 dark:text-gray-300",children:[r.jsx("p",{className:"mb-2",children:"\"Hi, I've been a loyal customer for [time period] and I'm reviewing my monthly expenses. I've noticed that competitors are offering similar services for less.\""}),r.jsxs("p",{className:"mb-2",children:["\"I'd like to stay with ",c.merchant,', but I need to reduce my monthly costs. What options do you have available for loyal customers?"']}),r.jsx("p",{children:"\"If we can't find a solution, I'll need to consider switching to [competitor].\""})]})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:()=>{(e=>{const t=new Set(m).add(e);x(t),localStorage.setItem("completedNegotiations",JSON.stringify(Array.from(t)))})(c.merchant),g(!1),d(null)},className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Mark as Negotiated"}),r.jsx("button",{onClick:()=>{g(!1),d(null)},className:"flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Close"})]})]})})]})}function s(){return r.jsx(n,{title:"AI Analytics",rightContent:r.jsx("div",{className:"cursor-pointer",title:"AI-Powered Analytics",children:r.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",className:"transition-all duration-200 hover:scale-110 drop-shadow-lg hover:drop-shadow-xl",style:{filter:"drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1))"},children:[r.jsx("circle",{cx:"24",cy:"24",r:"24",fill:"#E9D5FF",className:"transition-all duration-200",onMouseEnter:e=>e.currentTarget.setAttribute("fill","#DDD6FE"),onMouseLeave:e=>e.currentTarget.setAttribute("fill","#E9D5FF")}),r.jsx("g",{transform:"translate(12, 12)",children:r.jsx(f,{size:24,className:"text-purple-600"})})]})}),children:r.jsxs("div",{className:"space-y-8",children:[r.jsx(e,{}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow p-6",children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6",children:"Bill Negotiation Assistant"}),r.jsx(t,{})]})]})})}import{r as a,L as r}from"./chunk-Bcp2Zi4E.js";import{P as n}from"./chunk-zHRn0GaW.js";import{t as i,a as l,ax as c,aB as d,T as o,n as g,aC as m,aD as x,a0 as u,aa as h,v as p,x as y,P as b,ak as v,M as j,aE as f}from"./index-LbveD3Go.js";import{s as N,f as k,d as w}from"./chunk-B5pcS96K.js";import{u as S}from"./chunk-BlSolNAr.js";import"./chunk-oUGr0aFc.js";import"./chunk-a7oqB5tI.js";const A=new class{detectSpendingAnomalies(e,t=6){const s=[],a=new Date,r=N(a,t),n=e.filter(e=>"expense"===e.type&&new Date(e.date)>=r),l=this.calculateCategoryStatistics(n),c=N(a,1);return n.filter(e=>new Date(e.date)>=c).forEach(e=>{const t=l.get(e.category||"Uncategorized");if(!t)return;const a=i(e.amount),r=t.stdDev.greaterThan(0)?a.minus(t.mean).dividedBy(t.stdDev).toNumber():0;if(r>2){const n=a.minus(t.mean).dividedBy(t.mean).times(100).toNumber();s.push({id:`anomaly-${e.id}`,date:new Date(e.date),description:e.description,amount:a,category:e.category||"Uncategorized",severity:r>3?"high":r>2.5?"medium":"low",reason:this.getAnomalyReason(e,t,r),percentageAboveNormal:Math.round(n)})}}),s.sort((e,t)=>t.severity.localeCompare(e.severity))}predictFutureSpending(e,t,s=1){const a=[],r=new Date,n=N(r,6),i=e.filter(e=>"expense"===e.type&&new Date(e.date)>=n&&new Date(e.date)<r),l=new Map;return i.forEach(e=>{const t=e.category||"Uncategorized";l.has(t)||l.set(t,[]),l.get(t).push(e)}),l.forEach((e,t)=>{const r=this.calculateMonthlyTotals(e),n=this.detectTrend(r),i=this.calculateAverage(r),l=this.makePrediction(r,n,s);a.push({category:t,predictedAmount:l.amount,confidence:l.confidence,trend:n,monthlyAverage:i,recommendation:this.getSpendingRecommendation(t,n,l.amount,i)})}),a.sort((e,t)=>t.predictedAmount.minus(e.predictedAmount).toNumber())}identifySavingsOpportunities(e,t){const s=[];return this.detectSubscriptions(e).forEach(e=>{e.unusedMonths>2&&s.push({id:`opp-sub-${e.merchant}`,type:"subscription",title:`Unused Subscription: ${e.merchant}`,description:`You haven't used ${e.merchant} in ${e.unusedMonths} months`,potentialSavings:e.monthlyAmount.times(12),difficulty:"easy",actionRequired:"Cancel subscription",relatedTransactions:e.transactionIds})}),this.analyzeCategorySpending(e).forEach((e,t)=>{"increasing"===e.trend&&e.percentageOfIncome>15&&s.push({id:`opp-cat-${t}`,type:"category",title:`Reduce ${t} Spending`,description:`Your ${t} spending is ${e.percentageIncrease}% higher than 3 months ago`,potentialSavings:e.monthlyAverage.times(.2),difficulty:"medium",actionRequired:`Review and reduce ${t} expenses`})}),this.findDuplicateServices(e).forEach(e=>{s.push({id:`opp-dup-${e.category}`,type:"recurring",title:`Duplicate ${e.category} Services`,description:`You're paying for multiple ${e.category} services`,potentialSavings:e.potentialSavings,difficulty:"easy",actionRequired:"Consolidate or cancel duplicate services",relatedTransactions:e.transactionIds})}),this.analyzeMerchantSpending(e).forEach((e,t)=>{e.averageTransaction.greaterThan(50)&&e.frequency>4&&s.push({id:`opp-merchant-${t}`,type:"merchant",title:`Optimize ${t} Spending`,description:"Consider bulk purchases or membership discounts",potentialSavings:e.monthlyTotal.times(.1),difficulty:"medium",actionRequired:"Look for discounts or alternative options"})}),s.sort((e,t)=>t.potentialSavings.minus(e.potentialSavings).toNumber())}generateInsights(e,t,s){const a=[],r=this.calculateSpendingVelocity(e);r.isAccelerating&&a.push({id:"insight-velocity",type:"spending",title:"Spending Acceleration Detected",description:`Your spending has increased ${r.percentageIncrease}% this month`,impact:"negative",priority:"high",actionable:!0,relatedData:{velocity:r}});const n=this.analyzeSavingsBehavior(e,t);n.consistentSaving&&a.push({id:"insight-savings",type:"saving",title:"Great Saving Habits!",description:`You've consistently saved ${n.averagePercentage}% of your income`,impact:"positive",priority:"medium",actionable:!1}),s.forEach(t=>{const s=this.analyzeBudgetPerformance(t,e);s.consistentlyUnder&&s.averageUsage<80&&a.push({id:`insight-budget-${t.id}`,type:"budget",title:`${t.name} Budget Opportunity`,description:`You consistently use only ${s.averageUsage}% of this budget. Consider reducing it.`,impact:"neutral",priority:"low",actionable:!0,relatedData:{budgetId:t.id,performance:s}})});const i=this.analyzeIncomeStability(e);return i.isIrregular&&a.push({id:"insight-income",type:"income",title:"Irregular Income Pattern",description:"Your income varies significantly. Consider building a larger emergency fund.",impact:"neutral",priority:"high",actionable:!0,relatedData:{incomeAnalysis:i}}),this.detectSeasonalPatterns(e).forEach(e=>{a.push({id:`insight-seasonal-${e.category}`,type:"spending",title:`${e.category} Seasonal Pattern`,description:e.description,impact:"neutral",priority:"low",actionable:!0,relatedData:{pattern:e}})}),a.sort((e,t)=>{const s={high:0,medium:1,low:2};return s[e.priority]-s[t.priority]})}suggestBillNegotiations(e){const t=[],s=["Internet","Mobile Phone","Insurance","Utilities","Cable/Streaming","Gym","Subscriptions"];return this.findRecurringBills(e).forEach(e=>{if(s.includes(e.category)){const s={merchant:e.merchant,currentAmount:e.amount,potentialSavings:e.amount.times(.2),category:e.category,negotiationTips:this.getNegotiationTips(e.category),successRate:this.getSuccessRate(e.category),lastTransactionDate:e.lastDate};t.push(s)}}),t.sort((e,t)=>t.potentialSavings.minus(e.potentialSavings).toNumber())}calculateCategoryStatistics(e){const t=new Map;e.forEach(e=>{const s=e.category||"Uncategorized";t.has(s)||t.set(s,[]),t.get(s).push(i(e.amount))});const s=new Map;return t.forEach((e,t)=>{const a=e.reduce((e,t)=>e.plus(t),i(0)).dividedBy(e.length),r=e.map(e=>e.minus(a).pow(2)).reduce((e,t)=>e.plus(t),i(0)).dividedBy(e.length).sqrt();s.set(t,{mean:a,stdDev:r})}),s}getAnomalyReason(e,t,s){const a=i(e.amount).minus(t.mean).dividedBy(t.mean).times(100).toNumber();return s>3?`This transaction is ${Math.round(a)}% above your typical ${e.category} spending`:e.description.toLowerCase().includes("annual")||e.description.toLowerCase().includes("yearly")?"Annual payment detected - higher than usual but expected":`Unusually high amount for ${e.category}`}calculateMonthlyTotals(e){const t=new Map;return e.forEach(e=>{const s=k(new Date(e.date),"yyyy-MM"),a=t.get(s)||i(0);t.set(s,a.plus(i(e.amount)))}),t}detectTrend(e){const t=Array.from(e.values());if(t.length<3)return"stable";const s=t.slice(-3).reduce((e,t)=>e.plus(t),i(0)).dividedBy(3),a=t.slice(0,3).reduce((e,t)=>e.plus(t),i(0)).dividedBy(3),r=s.minus(a).dividedBy(a).toNumber();return r>.1?"increasing":r<-.1?"decreasing":"stable"}calculateAverage(e){const t=Array.from(e.values());return t.reduce((e,t)=>e.plus(t),i(0)).dividedBy(t.length)}makePrediction(e,t,s){const a=Array.from(e.values()).slice(-3).reduce((e,t)=>e.plus(t),i(0)).dividedBy(3);let r=a,n=.8;return"increasing"===t?(r=a.times(1.05),n=.7):"decreasing"===t&&(r=a.times(.95),n=.7),{amount:r,confidence:n}}getSpendingRecommendation(e,t,s,a){return"increasing"===t&&s.greaterThan(a.times(1.2))?`Consider setting a budget limit for ${e} to control spending growth`:"decreasing"===t?`Great job reducing ${e} spending! Keep it up!`:void 0}detectSubscriptions(e){const t=new Map;e.forEach(e=>{if("expense"===e.type){const s=`${e.description}-${e.amount}`;t.has(s)||t.set(s,[]),t.get(s).push(e)}});const s=[];return t.forEach((e,t)=>{if(e.length>=3){const t=e.map(e=>new Date(e.date)).sort((e,t)=>e.getTime()-t.getTime()),a=w(t[t.length-1],t[0])/(t.length-1);a>=25&&a<=35&&s.push({merchant:e[0].description,monthlyAmount:i(e[0].amount),unusedMonths:0,transactionIds:e.map(e=>e.id)})}}),s}analyzeCategorySpending(e){return new Map}findDuplicateServices(e){return[]}analyzeMerchantSpending(e){return new Map}calculateSpendingVelocity(e){return{isAccelerating:!1,percentageIncrease:0}}analyzeSavingsBehavior(e,t){return{consistentSaving:!1,averagePercentage:0}}analyzeBudgetPerformance(e,t){return{consistentlyUnder:!1,averageUsage:0}}analyzeIncomeStability(e){return{isIrregular:!1}}detectSeasonalPatterns(e){return[]}findRecurringBills(e){return[]}getNegotiationTips(e){return{Internet:["Research competitor prices in your area","Mention you're considering switching providers","Ask about promotional rates for existing customers","Bundle services for additional discounts"],"Mobile Phone":["Review your data usage - you might need less","Ask about loyalty discounts","Consider switching to a prepaid plan","Negotiate for free add-ons instead of price reduction"],Insurance:["Get quotes from multiple providers","Increase deductibles to lower premiums","Bundle multiple policies","Ask about discounts (safe driver, home security, etc.)"]}[e]||["Call and ask for retention department","Be prepared to switch providers"]}getSuccessRate(e){return{Internet:75,"Mobile Phone":80,Insurance:65,"Cable/Streaming":70,Gym:60}[e]||50}};export{s as default};
