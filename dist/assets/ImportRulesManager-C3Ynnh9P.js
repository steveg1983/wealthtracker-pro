function e(){const{categories:e,accounts:m,transactions:h}=s(),[y,b]=a.useState([]),[v,j]=a.useState(null),[k,f]=a.useState(!1);a.useState(!1);const[N,w]=a.useState(new Map),[C,R]=a.useState(!1),[S,A]=a.useState([]);a.useEffect(()=>{z()},[]);const z=()=>{b(p.getRules())},I=(e,r)=>{const a=y.findIndex(r=>r.id===e);if(-1===a)return;const t="up"===r?Math.max(1,y[a].priority-1):y[a].priority+1,s=y.findIndex(e=>e.priority===t);-1!==s&&p.updateRule(y[s].id,{priority:y[a].priority}),p.updateRule(e,{priority:t}),z()};return t.jsxs("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h2",{className:"text-xl font-semibold text-theme-heading dark:text-white",children:"Import Rules"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:()=>{const e=p.suggestRules(h);A(e),R(!0)},className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[t.jsx(i,{size:16}),"Suggest Rules"]}),t.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-secondary transition-colors",children:[t.jsx(n,{size:16}),"Add Rule"]})]})]}),t.jsx("div",{className:"mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:t.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:"Import rules automatically transform transactions during import. Rules are applied in priority order (lower numbers first)."})}),0===y.length?t.jsxs("div",{className:"text-center py-8",children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"No import rules configured"}),t.jsx("button",{onClick:()=>f(!0),className:"text-primary hover:underline",children:"Create your first rule"})]}):t.jsx("div",{className:"space-y-3",children:y.map(e=>t.jsx("div",{className:"p-4 rounded-lg border "+(e.enabled?"bg-white dark:bg-gray-700 border-gray-200 dark:border-gray-600":"bg-gray-50 dark:bg-gray-800 border-gray-300 dark:border-gray-700 opacity-60"),children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),t.jsxs("span",{className:"text-xs px-2 py-1 bg-gray-200 dark:bg-gray-600 rounded",children:["Priority: ",e.priority]}),void 0!==N.get(e.id)&&t.jsx("span",{className:"text-xs px-2 py-1 rounded "+(N.get(e.id)?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"),children:N.get(e.id)?"Matches found":"No matches"})]}),e.description&&t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:e.description}),t.jsxs("div",{className:"text-sm",children:[t.jsxs("div",{className:"mb-1",children:[t.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Conditions:"}),t.jsx("ul",{className:"ml-4 mt-1",children:e.conditions.map((e,r)=>t.jsxs("li",{className:"text-gray-600 dark:text-gray-400",children:["\u2022 ",e.field," ",e.operator,' "',e.value,'"',e.value2&&` and "${e.value2}"`]},r))})]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Actions:"}),t.jsx("ul",{className:"ml-4 mt-1",children:e.actions.map((e,r)=>t.jsxs("li",{className:"text-gray-600 dark:text-gray-400",children:["\u2022 ",e.type,e.value&&`: "${e.value}"`]},r))})]})]})]}),t.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[t.jsx("button",{onClick:()=>I(e.id,"up"),className:"p-1 text-gray-600 dark:text-gray-400 hover:text-primary",disabled:1===e.priority,children:t.jsx(d,{size:16})}),t.jsx("button",{onClick:()=>I(e.id,"down"),className:"p-1 text-gray-600 dark:text-gray-400 hover:text-primary",disabled:e.priority===y.length,children:t.jsx(l,{size:16})}),t.jsx("button",{onClick:()=>(e=>{const r=h.slice(0,50);let a=0;r.forEach(r=>{p.testRule(e,{description:r.description,amount:r.amount,accountId:r.accountId,date:r.date})&&a++}),w(r=>new Map(r).set(e.id,a>0))})(e),className:"p-2 text-gray-600 dark:text-gray-400 hover:text-primary",title:"Test rule",children:t.jsx(o,{size:16})}),t.jsx("button",{onClick:()=>j(e),className:"p-2 text-gray-600 dark:text-gray-400 hover:text-primary",children:t.jsx(c,{size:16})}),t.jsx("button",{onClick:()=>{return r=e.id,a=!e.enabled,p.updateRule(r,{enabled:a}),void z();var r,a},className:"p-2 text-gray-600 dark:text-gray-400 hover:text-primary",children:e.enabled?t.jsx(x,{size:16}):t.jsx(g,{size:16})}),t.jsx("button",{onClick:()=>{return r=e.id,void(confirm("Are you sure you want to delete this rule?")&&(p.deleteRule(r),z()));var r},className:"p-2 text-gray-600 dark:text-gray-400 hover:text-red-600",children:t.jsx(u,{size:16})})]})]})},e.id))}),(k||v)&&t.jsx(r,{rule:v,categories:e,accounts:m,onSave:e=>{v?p.updateRule(v.id,e):p.addRule(e),z(),j(null),f(!1)},onClose:()=>{f(!1),j(null)}}),C&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl w-full max-w-2xl max-h-[80vh] overflow-hidden",children:[t.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Suggested Rules"}),t.jsx("button",{onClick:()=>R(!1),className:"text-gray-400 hover:text-gray-600",children:t.jsx(g,{size:20})})]})}),t.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:0===S.length?t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-center",children:"No suggestions available. Import more transactions to generate suggestions."}):t.jsx("div",{className:"space-y-3",children:S.map((e,r)=>t.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.description})]}),t.jsx("button",{onClick:()=>(e=>{p.addRule(e),z(),R(!1)})(e),className:"px-3 py-1 bg-primary text-white rounded hover:bg-secondary text-sm",children:"Apply"})]})},r))})})]})})]})}function r({rule:e,categories:r,accounts:s,onSave:i,onClose:n}){const[d,l]=a.useState({name:e?.name||"",description:e?.description||"",enabled:e?.enabled??!0,priority:e?.priority||1,conditions:e?.conditions||[{field:"description",operator:"contains",value:"",caseSensitive:!1}],actions:e?.actions||[{type:"setCategory",value:""}]}),o=(e,r)=>{const a=[...d.conditions||[]];a[e]={...a[e],...r},l({...d,conditions:a})},c=(e,r)=>{const a=[...d.actions||[]];a[e]={...a[e],...r},l({...d,actions:a})};return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:t.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden",children:t.jsxs("form",{onSubmit:e=>{e.preventDefault(),i(d)},children:[t.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e?"Edit Rule":"New Import Rule"})}),t.jsxs("div",{className:"p-6 overflow-y-auto max-h-[70vh]",children:[t.jsxs("div",{className:"space-y-4 mb-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Rule Name"}),t.jsx("input",{type:"text",value:d.name,onChange:e=>l({...d,name:e.target.value}),className:"w-full px-3 py-2 bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-300/50 dark:border-gray-600/50 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description (optional)"}),t.jsx("input",{type:"text",value:d.description,onChange:e=>l({...d,description:e.target.value}),className:"w-full px-3 py-2 bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-300/50 dark:border-gray-600/50 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Priority"}),t.jsx("input",{type:"number",min:"1",value:d.priority,onChange:e=>l({...d,priority:parseInt(e.target.value)}),className:"w-full px-3 py-2 bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-300/50 dark:border-gray-600/50 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"})]}),t.jsx("div",{className:"flex items-end",children:t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:d.enabled,onChange:e=>l({...d,enabled:e.target.checked}),className:"rounded border-gray-300 dark:border-gray-600"}),t.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Enabled"})]})})]})]}),t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-3",children:[t.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Conditions (all must match)"}),t.jsx("button",{type:"button",onClick:()=>{l({...d,conditions:[...d.conditions||[],{field:"description",operator:"contains",value:"",caseSensitive:!1}]})},className:"text-sm text-primary hover:underline",children:"Add Condition"})]}),t.jsx("div",{className:"space-y-3",children:d.conditions?.map((e,r)=>t.jsxs("div",{className:"flex gap-2 items-start bg-gray-50 dark:bg-gray-700/50 p-3 rounded-lg",children:[t.jsxs("select",{value:e.field,onChange:e=>o(r,{field:e.target.value}),className:"px-2 py-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-sm",children:[t.jsx("option",{value:"description",children:"Description"}),t.jsx("option",{value:"amount",children:"Amount"}),t.jsx("option",{value:"accountId",children:"Account"})]}),t.jsx("select",{value:e.operator,onChange:e=>o(r,{operator:e.target.value}),className:"px-2 py-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-sm",children:"amount"===e.field?t.jsxs(t.Fragment,{children:[t.jsx("option",{value:"equals",children:"Equals"}),t.jsx("option",{value:"greaterThan",children:"Greater than"}),t.jsx("option",{value:"lessThan",children:"Less than"}),t.jsx("option",{value:"between",children:"Between"})]}):t.jsxs(t.Fragment,{children:[t.jsx("option",{value:"contains",children:"Contains"}),t.jsx("option",{value:"equals",children:"Equals"}),t.jsx("option",{value:"startsWith",children:"Starts with"}),t.jsx("option",{value:"endsWith",children:"Ends with"}),t.jsx("option",{value:"regex",children:"Regex"})]})}),t.jsx("input",{type:"amount"===e.field?"number":"text",value:e.value,onChange:a=>o(r,{value:"amount"===e.field?parseFloat(a.target.value):a.target.value}),placeholder:"Value",className:"flex-1 px-2 py-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-sm"}),"between"===e.operator&&t.jsx("input",{type:"number",value:e.value2,onChange:e=>o(r,{value2:parseFloat(e.target.value)}),placeholder:"Max value",className:"px-2 py-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-sm w-24"}),"amount"!==e.field&&t.jsxs("label",{className:"flex items-center gap-1 text-sm",children:[t.jsx("input",{type:"checkbox",checked:e.caseSensitive,onChange:e=>o(r,{caseSensitive:e.target.checked})}),"Case"]}),t.jsx("button",{type:"button",onClick:()=>(e=>{l({...d,conditions:d.conditions?.filter((r,a)=>a!==e)||[]})})(r),className:"text-red-600 hover:text-red-700",children:t.jsx(g,{size:16})})]},r))})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-3",children:[t.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Actions"}),t.jsx("button",{type:"button",onClick:()=>{l({...d,actions:[...d.actions||[],{type:"setCategory",value:""}]})},className:"text-sm text-primary hover:underline",children:"Add Action"})]}),t.jsx("div",{className:"space-y-3",children:d.actions?.map((e,a)=>t.jsxs("div",{className:"flex gap-2 items-start bg-gray-50 dark:bg-gray-700/50 p-3 rounded-lg",children:[t.jsxs("select",{value:e.type,onChange:e=>c(a,{type:e.target.value}),className:"px-2 py-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-sm",children:[t.jsx("option",{value:"setCategory",children:"Set Category"}),t.jsx("option",{value:"addTag",children:"Add Tag"}),t.jsx("option",{value:"modifyDescription",children:"Modify Description"}),t.jsx("option",{value:"setAccount",children:"Set Account"}),t.jsx("option",{value:"skip",children:"Skip Transaction"})]}),"setCategory"===e.type&&t.jsxs("select",{value:e.value,onChange:e=>c(a,{value:e.target.value}),className:"flex-1 px-2 py-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-sm",children:[t.jsx("option",{value:"",children:"Select category"}),r.filter(e=>"expense"===e.type||"both"===e.type).map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),"addTag"===e.type&&t.jsx("input",{type:"text",value:e.value,onChange:e=>c(a,{value:e.target.value}),placeholder:"Tag name",className:"flex-1 px-2 py-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-sm"}),"modifyDescription"===e.type&&t.jsxs(t.Fragment,{children:[t.jsxs("select",{value:e.modification,onChange:e=>c(a,{modification:e.target.value}),className:"px-2 py-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-sm",children:[t.jsx("option",{value:"replace",children:"Replace"}),t.jsx("option",{value:"prepend",children:"Prepend"}),t.jsx("option",{value:"append",children:"Append"}),t.jsx("option",{value:"regex",children:"Regex Replace"})]}),"regex"===e.modification?t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"text",value:e.pattern,onChange:e=>c(a,{pattern:e.target.value}),placeholder:"Pattern",className:"flex-1 px-2 py-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-sm"}),t.jsx("input",{type:"text",value:e.replacement,onChange:e=>c(a,{replacement:e.target.value}),placeholder:"Replacement",className:"flex-1 px-2 py-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-sm"})]}):t.jsx("input",{type:"text",value:e.value,onChange:e=>c(a,{value:e.target.value}),placeholder:"Text",className:"flex-1 px-2 py-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-sm"})]}),"setAccount"===e.type&&t.jsxs("select",{value:e.value,onChange:e=>c(a,{value:e.target.value}),className:"flex-1 px-2 py-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-sm",children:[t.jsx("option",{value:"",children:"Select account"}),s.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),t.jsx("button",{type:"button",onClick:()=>(e=>{l({...d,actions:d.actions?.filter((r,a)=>a!==e)||[]})})(a),className:"text-red-600 hover:text-red-700",children:t.jsx(g,{size:16})})]},a))})]})]}),t.jsxs("div",{className:"p-6 border-t border-gray-200 dark:border-gray-700 flex gap-3 justify-end",children:[t.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:"Cancel"}),t.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-secondary",children:e?"Save Changes":"Create Rule"})]})]})})})}import{r as a,H as t}from"./chunk-DowOIOga.js";import{a as s,aE as i,$ as n,aC as d,aD as l,al as o,E as c,x,X as g,D as u}from"./index-qHm2isZb.js";import{i as p}from"./chunk-BUNwFMNM.js";import"./chunk-ddLY9KjI.js";import"./chunk-B5pcS96K.js";export{e as default};
