const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pdfExport-CTDNmc67.js","assets/chunk-C1eKK5Oc.js"])))=>i.map(i=>d[i]);
function e(e,t){const a=d(e,t?.in),r=a.getMonth(),s=r-r%3;return a.setMonth(s,1),a.setHours(0,0,0,0),a}function t(e,t){const a=d(e,t?.in),r=a.getMonth(),s=r-r%3+3;return a.setMonth(s,0),a.setHours(23,59,59,999),a}function a({report:e,onSave:t,onCancel:a}){g();const{addNotification:s}=u(),[n,o]=_.useState(e?.name||""),[d,i]=_.useState(e?.description||""),[l,c]=_.useState(e?.components||[]),[m,h]=_.useState(e?.filters||{dateRange:"month"}),[x,b]=_.useState(null),[f,v]=_.useState(!1),j=(e,t)=>{const a="up"===t?e-1:e+1;if(a<0||a>=l.length)return;const r=Array.from(l),[s]=r.splice(e,1);r.splice(a,0,s),c(r)};return y.jsxs("div",{className:"flex flex-col h-full",children:[y.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[y.jsxs("div",{className:"flex items-center justify-between mb-4",children:[y.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:e?"Edit Report":"Create Custom Report"}),y.jsxs("div",{className:"flex gap-2",children:[y.jsx("button",{onClick:a,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:"Cancel"}),y.jsxs("button",{onClick:()=>{if(!n.trim())return void s({type:"error",title:"Report name required",message:"Please enter a name for your report"});const a={id:e?.id||`report-${Date.now()}`,name:n,description:d,components:l,filters:m,createdAt:e?.createdAt||new Date,updatedAt:new Date};t(a)},className:"flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90",children:[y.jsx(p,{size:16}),"Save Report"]})]})]}),y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[y.jsxs("div",{children:[y.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Report Name"}),y.jsx("input",{type:"text",value:n,onChange:e=>o(e.target.value),className:"w-full px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Monthly Financial Summary"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),y.jsx("input",{type:"text",value:d,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Overview of monthly income, expenses, and savings"})]})]})]}),y.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800/50 border-b border-gray-200 dark:border-gray-700",children:[y.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Report Filters"}),y.jsxs("div",{className:"flex flex-wrap gap-3",children:[y.jsxs("select",{value:m.dateRange,onChange:e=>h({...m,dateRange:e.target.value}),className:"px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-sm",children:[y.jsx("option",{value:"month",children:"This Month"}),y.jsx("option",{value:"quarter",children:"This Quarter"}),y.jsx("option",{value:"year",children:"This Year"}),y.jsx("option",{value:"custom",children:"Custom Range"})]}),"custom"===m.dateRange&&y.jsxs(y.Fragment,{children:[y.jsx("input",{type:"date",value:m.customStartDate||"",onChange:e=>h({...m,customStartDate:e.target.value}),className:"px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-sm"}),y.jsx("input",{type:"date",value:m.customEndDate||"",onChange:e=>h({...m,customEndDate:e.target.value}),className:"px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-sm"})]})]})]}),y.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[y.jsx("div",{className:"space-y-4 min-h-[200px]",children:l.map((e,t)=>y.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[y.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[y.jsxs("div",{className:"flex items-center gap-3",children:[y.jsxs("div",{className:"flex flex-col gap-1",children:[y.jsx("button",{onClick:()=>j(t,"up"),disabled:0===t,className:"p-1 text-gray-400 hover:text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",title:"Move up",children:"\u25b2"}),y.jsx("button",{onClick:()=>j(t,"down"),disabled:t===l.length-1,className:"p-1 text-gray-400 hover:text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",title:"Move down",children:"\u25bc"})]}),y.jsxs("div",{children:[y.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:e.title}),y.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:B.find(t=>t.type===e.type)?.description})]})]}),y.jsxs("div",{className:"flex items-center gap-2",children:[y.jsxs("select",{value:e.width,onChange:t=>{return a=e.id,r={width:t.target.value},void c(l.map(e=>e.id===a?{...e,...r}:e));var a,r},className:"px-2 py-1 text-sm bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded",children:[y.jsx("option",{value:"full",children:"Full Width"}),y.jsx("option",{value:"half",children:"Half Width"}),y.jsx("option",{value:"third",children:"Third Width"})]}),y.jsx("button",{onClick:()=>b(e.id),className:"p-1.5 text-gray-600 dark:text-gray-400 hover:text-primary",title:"Configure",children:y.jsx(w,{size:16})}),y.jsx("button",{onClick:()=>{return t=e.id,void c(l.filter(e=>e.id!==t));var t},className:"p-1.5 text-gray-600 dark:text-gray-400 hover:text-red-600",title:"Remove",children:y.jsx(R,{size:16})})]})]}),y.jsx("div",{className:"p-4",children:y.jsx(r,{component:e})})]},e.id))}),0===l.length&&y.jsx("div",{className:"text-center py-12",children:y.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Start building your report by adding components"})}),y.jsxs("button",{onClick:()=>v(!0),className:"mt-4 w-full py-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg hover:border-primary hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[y.jsx(D,{size:24,className:"mx-auto text-gray-400 dark:text-gray-600"}),y.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Add Component"})]})]}),f&&y.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:y.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl max-w-3xl w-full max-h-[80vh] overflow-hidden",children:[y.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Add Report Component"}),y.jsx("button",{onClick:()=>v(!1),className:"text-gray-400 hover:text-gray-600",children:y.jsx(R,{size:20})})]})}),y.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:y.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:B.map(e=>y.jsxs("button",{onClick:()=>(e=>{const t=B.find(t=>t.type===e);if(!t)return;const a={id:`component-${Date.now()}`,type:e,title:t.name,config:{...t.defaultConfig},width:"full"};c([...l,a]),v(!1)})(e.type),className:"flex items-start gap-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-left",children:[y.jsx("div",{className:"p-2 bg-white dark:bg-gray-800 rounded-lg",children:y.jsx(e.icon,{size:24,className:"text-primary"})}),y.jsxs("div",{children:[y.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),y.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.description})]})]},e.type))})})]})})]})}function r({component:e}){const t=B.find(t=>t.type===e.type)?.icon||j;return y.jsxs("div",{className:"flex items-center justify-center py-8 text-gray-400 dark:text-gray-600",children:[y.jsx(t,{size:48}),y.jsx("p",{className:"ml-4 text-sm",children:"Preview will be shown when report is generated"})]})}function s(){const{transactions:e,accounts:t,budgets:a,categories:r}=g(),{addNotification:s}=u(),[o,d]=_.useState([]),[i,l]=_.useState([]),[c,p]=_.useState(!1),[h,x]=_.useState(null),[b,f]=_.useState(null);_.useEffect(()=>(v(),J.initialize(),()=>{J.destroy()}),[]);const v=()=>{d(J.getScheduledReports()),l(W.getCustomReports())};return y.jsxs("div",{className:"space-y-6",children:[y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsxs("div",{children:[y.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Scheduled Reports"}),y.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Automate report generation and delivery"})]}),y.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90",children:[y.jsx(D,{size:16}),"Schedule Report"]})]}),0===o.length?y.jsxs("div",{className:"text-center py-12 bg-gray-50 dark:bg-gray-800/50 rounded-lg",children:[y.jsx(N,{size:48,className:"mx-auto text-gray-400 mb-4"}),y.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No scheduled reports yet"}),y.jsx("button",{onClick:()=>p(!0),className:"mt-4 text-primary hover:underline",children:"Create your first scheduled report"})]}):y.jsx("div",{className:"space-y-4",children:o.map(n=>{const o=i.find(e=>e.id===n.customReportId);return y.jsx("div",{className:"p-4 rounded-lg border "+(n.enabled?"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700":"bg-gray-50 dark:bg-gray-900 border-gray-300 dark:border-gray-800 opacity-60"),children:y.jsxs("div",{className:"flex items-start justify-between",children:[y.jsxs("div",{className:"flex-1",children:[y.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[y.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:n.reportName}),!n.enabled&&y.jsx("span",{className:"text-xs px-2 py-1 bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded",children:"Disabled"})]}),y.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-600 dark:text-gray-400",children:[y.jsxs("div",{className:"flex items-center gap-1",children:[y.jsx(S,{size:16}),y.jsxs("span",{children:["daily"===n.frequency&&"Daily","weekly"===n.frequency&&`Weekly on ${["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][n.dayOfWeek||1]}`,"monthly"===n.frequency&&`Monthly on day ${n.dayOfMonth||1}`,"quarterly"===n.frequency&&"Quarterly","yearly"===n.frequency&&"Yearly"," at ",n.time]})]}),y.jsxs("div",{className:"flex items-center gap-1",children:[y.jsx("span",{className:"font-medium",children:"Format:"}),y.jsx("span",{children:n.deliveryFormat.toUpperCase()})]}),n.emailRecipients&&n.emailRecipients.length>0&&y.jsxs("div",{className:"flex items-center gap-1",children:[y.jsx(M,{size:16}),y.jsx("span",{children:n.emailRecipients.join(", ")})]})]}),y.jsxs("div",{className:"flex gap-4 mt-2 text-xs text-gray-500 dark:text-gray-500",children:[y.jsxs("span",{children:["Next run: ",m(new Date(n.nextRun),"MMM d, yyyy HH:mm")]}),n.lastRun&&y.jsxs("span",{children:["Last run: ",m(new Date(n.lastRun),"MMM d, yyyy HH:mm")]})]}),!o&&y.jsx("div",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:"\u26a0\ufe0f Custom report not found"})]}),y.jsxs("div",{className:"flex items-center gap-2",children:[y.jsx("button",{onClick:()=>(async n=>{f(n.id);try{await J.runScheduledReport(n,{transactions:e,accounts:t,budgets:a,categories:r}),s({type:"success",title:"Report Generated",message:`${n.reportName} has been generated successfully`}),v()}catch(o){s({type:"error",title:"Report Failed",message:`Failed to generate ${n.reportName}`})}finally{f(null)}})(n),disabled:b===n.id||!o,className:"p-2 text-gray-600 dark:text-gray-400 hover:text-primary disabled:opacity-50",title:"Run now",children:b===n.id?y.jsx("div",{className:"animate-spin",children:"\u23f3"}):y.jsx(T,{size:16})}),y.jsx("button",{onClick:()=>x(n),className:"p-2 text-gray-600 dark:text-gray-400 hover:text-primary",title:"Edit",children:y.jsx(I,{size:16})}),y.jsx("button",{onClick:()=>(e=>{const t={...e,enabled:!e.enabled};J.saveScheduledReport(t),v()})(n),className:"p-2 text-gray-600 dark:text-gray-400 hover:text-primary",title:n.enabled?"Disable":"Enable",children:n.enabled?y.jsx(E,{size:20,className:"text-green-600"}):y.jsx(O,{size:20})}),y.jsx("button",{onClick:()=>{return e=n.id,void(confirm("Are you sure you want to delete this scheduled report?")&&(J.deleteScheduledReport(e),v(),s({type:"success",title:"Schedule Deleted",message:"The scheduled report has been deleted"})));var e},className:"p-2 text-gray-600 dark:text-gray-400 hover:text-red-600",title:"Delete",children:y.jsx(A,{size:16})})]})]})},n.id)})}),(c||h)&&y.jsx(n,{scheduledReport:h,customReports:i,onSave:e=>{J.saveScheduledReport(e),v(),p(!1),x(null),s({type:"success",title:"Schedule Saved",message:`${e.reportName} has been scheduled successfully`})},onClose:()=>{p(!1),x(null)}})]})}function n({scheduledReport:e,customReports:t,onSave:a,onClose:r}){const[s,n]=_.useState({customReportId:e?.customReportId||"",reportName:e?.reportName||"",frequency:e?.frequency||"monthly",dayOfWeek:e?.dayOfWeek||1,dayOfMonth:e?.dayOfMonth||1,time:e?.time||"09:00",deliveryFormat:e?.deliveryFormat||"pdf",emailRecipients:e?.emailRecipients||[],enabled:e?.enabled??!0}),[o,d]=_.useState("");_.useEffect(()=>{if(s.customReportId&&!e){const e=t.find(e=>e.id===s.customReportId);e&&n(t=>({...t,reportName:e.name}))}},[s.customReportId,t,e]);const i=()=>{o&&o.includes("@")&&(n(e=>({...e,emailRecipients:[...e.emailRecipients||[],o]})),d(""))};return y.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:y.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl max-w-lg w-full max-h-[90vh] overflow-hidden",children:y.jsxs("form",{onSubmit:t=>{t.preventDefault();const r={id:e?.id||`scheduled-${Date.now()}`,customReportId:s.customReportId,reportName:s.reportName,frequency:s.frequency,dayOfWeek:s.dayOfWeek,dayOfMonth:s.dayOfMonth,time:s.time,deliveryFormat:s.deliveryFormat,emailRecipients:s.emailRecipients,enabled:s.enabled,nextRun:J.calculateNextRun({frequency:s.frequency,dayOfWeek:s.dayOfWeek,dayOfMonth:s.dayOfMonth,time:s.time}),createdAt:e?.createdAt||new Date,updatedAt:new Date};a(r)},children:[y.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:y.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e?"Edit Scheduled Report":"Schedule New Report"})}),y.jsxs("div",{className:"p-6 space-y-4 overflow-y-auto max-h-[60vh]",children:[y.jsxs("div",{children:[y.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Report Template"}),y.jsxs("select",{value:s.customReportId,onChange:e=>n({...s,customReportId:e.target.value}),className:"w-full px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg",required:!0,children:[y.jsx("option",{value:"",children:"Select a report..."}),t.map(e=>y.jsx("option",{value:e.id,children:e.name},e.id))]})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Schedule Name"}),y.jsx("input",{type:"text",value:s.reportName,onChange:e=>n({...s,reportName:e.target.value}),className:"w-full px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg",required:!0})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Frequency"}),y.jsxs("select",{value:s.frequency,onChange:e=>n({...s,frequency:e.target.value}),className:"w-full px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg",children:[y.jsx("option",{value:"daily",children:"Daily"}),y.jsx("option",{value:"weekly",children:"Weekly"}),y.jsx("option",{value:"monthly",children:"Monthly"}),y.jsx("option",{value:"quarterly",children:"Quarterly"}),y.jsx("option",{value:"yearly",children:"Yearly"})]})]}),"weekly"===s.frequency&&y.jsxs("div",{children:[y.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Day of Week"}),y.jsxs("select",{value:s.dayOfWeek,onChange:e=>n({...s,dayOfWeek:parseInt(e.target.value)}),className:"w-full px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg",children:[y.jsx("option",{value:"0",children:"Sunday"}),y.jsx("option",{value:"1",children:"Monday"}),y.jsx("option",{value:"2",children:"Tuesday"}),y.jsx("option",{value:"3",children:"Wednesday"}),y.jsx("option",{value:"4",children:"Thursday"}),y.jsx("option",{value:"5",children:"Friday"}),y.jsx("option",{value:"6",children:"Saturday"})]})]}),"monthly"===s.frequency&&y.jsxs("div",{children:[y.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Day of Month"}),y.jsx("input",{type:"number",min:"1",max:"31",value:s.dayOfMonth,onChange:e=>n({...s,dayOfMonth:parseInt(e.target.value)}),className:"w-full px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Time"}),y.jsx("input",{type:"time",value:s.time,onChange:e=>n({...s,time:e.target.value}),className:"w-full px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Delivery Format"}),y.jsxs("select",{value:s.deliveryFormat,onChange:e=>n({...s,deliveryFormat:e.target.value}),className:"w-full px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg",children:[y.jsx("option",{value:"pdf",children:"PDF"}),y.jsx("option",{value:"csv",children:"CSV"}),y.jsx("option",{value:"excel",children:"Excel"}),y.jsx("option",{value:"email",children:"Email (with PDF attachment)"})]})]}),"email"===s.deliveryFormat&&y.jsxs("div",{children:[y.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email Recipients"}),y.jsxs("div",{className:"flex gap-2 mb-2",children:[y.jsx("input",{type:"email",value:o,onChange:e=>d(e.target.value),onKeyPress:e=>"Enter"===e.key&&(e.preventDefault(),i()),className:"flex-1 px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg",placeholder:"email@example.com"}),y.jsx("button",{type:"button",onClick:i,className:"px-3 py-2 bg-primary text-white rounded-lg hover:bg-primary/90",children:"Add"})]}),s.emailRecipients&&s.emailRecipients.length>0&&y.jsx("div",{className:"space-y-1",children:s.emailRecipients.map(e=>y.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-100 dark:bg-gray-700 rounded",children:[y.jsx("span",{className:"text-sm",children:e}),y.jsx("button",{type:"button",onClick:()=>(e=>{n(t=>({...t,emailRecipients:t.emailRecipients?.filter(t=>t!==e)||[]}))})(e),className:"text-red-600 hover:text-red-700",children:y.jsx(R,{size:16})})]},e))})]})]}),y.jsxs("div",{className:"p-6 border-t border-gray-200 dark:border-gray-700 flex gap-3 justify-end",children:[y.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:"Cancel"}),y.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90",children:e?"Save Changes":"Create Schedule"})]})]})})})}function o(){const{transactions:e,accounts:t,budgets:r,categories:n}=g(),{addNotification:o}=u(),[d,i]=_.useState([]),[l,c]=_.useState(!1),[p,h]=_.useState(),[x,b]=_.useState(null),[f,v]=_.useState(null);_.useEffect(()=>{k()},[]);const k=()=>{const e=W.getCustomReports();i(e)};return l||p?y.jsx(a,{report:p,onSave:e=>{W.saveCustomReport(e),k(),c(!1),h(void 0),o({type:"success",title:"Report Saved",message:`${e.name} has been saved successfully`})},onCancel:()=>{c(!1),h(void 0)}}):y.jsxs("div",{className:"space-y-6",children:[y.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6",children:y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsxs("div",{children:[y.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Custom Reports"}),y.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Create and manage your personalized financial reports"})]}),y.jsxs("button",{onClick:()=>c(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90",children:[y.jsx(D,{size:20}),"Create Report"]})]})}),y.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6",children:[y.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Quick Start Templates"}),y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[y.jsxs("button",{onClick:()=>{h({id:"",name:"Monthly Summary",description:"Overview of income, expenses, and savings",components:[{id:"stats",type:"summary-stats",title:"Key Metrics",config:{metrics:["income","expenses","netIncome","savingsRate"]},width:"full"},{id:"trend",type:"line-chart",title:"Income vs Expenses Trend",config:{dataType:"income-vs-expenses"},width:"full"},{id:"categories",type:"pie-chart",title:"Spending by Category",config:{dataType:"expenses-by-category"},width:"half"}],filters:{dateRange:"month"},createdAt:new Date,updatedAt:new Date})},className:"p-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg hover:border-primary hover:bg-gray-50 dark:hover:bg-gray-700 text-left",children:[y.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Monthly Summary"}),y.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Income, expenses, and category breakdown"})]}),y.jsxs("button",{onClick:()=>{h({id:"",name:"Budget vs Actual",description:"Compare budgeted amounts with actual spending",components:[{id:"budget",type:"category-breakdown",title:"Budget Performance",config:{showSubcategories:!0,comparisonType:"budget"},width:"full"}],filters:{dateRange:"month"},createdAt:new Date,updatedAt:new Date})},className:"p-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg hover:border-primary hover:bg-gray-50 dark:hover:bg-gray-700 text-left",children:[y.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Budget vs Actual"}),y.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Track budget performance by category"})]}),y.jsxs("button",{onClick:()=>{h({id:"",name:"Year-over-Year",description:"Compare current year with previous year",components:[{id:"comparison",type:"date-comparison",title:"Year Comparison",config:{periods:["current","previous"],metric:"all"},width:"full"}],filters:{dateRange:"year"},createdAt:new Date,updatedAt:new Date})},className:"p-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg hover:border-primary hover:bg-gray-50 dark:hover:bg-gray-700 text-left",children:[y.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Year-over-Year"}),y.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Annual comparison and trends"})]})]})]}),y.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6",children:[y.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Your Reports"}),0===d.length?y.jsxs("div",{className:"text-center py-12",children:[y.jsx(j,{size:48,className:"mx-auto text-gray-400 mb-4"}),y.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No custom reports yet. Create your first report to get started."})]}):y.jsx("div",{className:"space-y-4",children:d.map(a=>y.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[y.jsxs("div",{children:[y.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:a.name}),y.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:a.description}),y.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-gray-500 dark:text-gray-500",children:[y.jsxs("span",{className:"flex items-center gap-1",children:[y.jsx(N,{size:14}),"Created ",m(new Date(a.createdAt),"MMM d, yyyy")]}),y.jsxs("span",{children:[a.components.length," component",1!==a.components.length?"s":""]})]})]}),y.jsxs("div",{className:"flex items-center gap-2",children:[y.jsx("button",{onClick:()=>(async a=>{b(a.id);try{const s=await W.generateReportData(a,{transactions:e,accounts:t,budgets:r,categories:n});v(s),o({type:"success",title:"Report Generated",message:"Your report has been generated successfully"})}catch(s){o({type:"error",title:"Generation Failed",message:"Failed to generate the report"})}finally{b(null)}})(a),disabled:x===a.id,className:"p-2 text-primary hover:bg-gray-100 dark:hover:bg-gray-600 rounded-lg disabled:opacity-50",title:"Generate Report",children:x===a.id?y.jsx("div",{className:"animate-spin",children:"\u23f3"}):y.jsx(T,{size:18})}),y.jsx("button",{onClick:()=>h(a),className:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-lg",title:"Edit",children:y.jsx(I,{size:18})}),y.jsx("button",{onClick:()=>(e=>{const t={...e,id:`report-${Date.now()}`,name:`${e.name} (Copy)`,createdAt:new Date,updatedAt:new Date};W.saveCustomReport(t),k(),o({type:"success",title:"Report Duplicated",message:"The report has been duplicated"})})(a),className:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-lg",title:"Duplicate",children:y.jsx(F,{size:18})}),y.jsx("button",{onClick:()=>{return e=a.id,void(confirm("Are you sure you want to delete this report?")&&(W.deleteCustomReport(e),k(),o({type:"success",title:"Report Deleted",message:"The report has been deleted"})));var e},className:"p-2 text-gray-600 dark:text-gray-400 hover:text-red-600 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-lg",title:"Delete",children:y.jsx(A,{size:18})})]})]},a.id))})]}),y.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6",children:y.jsx(s,{})})]})}import{aO as d,b0 as i,aP as l,aN as c,ab as m,g,aJ as u,j as y,b1 as p,T as h,ay as x,L as b,B as f,aQ as v,b2 as j,aB as k,r as N,N as w,X as R,ag as D,b3 as C,aZ as S,b4 as M,aC as T,Q as I,af as E,ae as O,V as A,aE as F}from"./index-CgJz7Gw0.js";import{a as _}from"./chunk-BWx9oMeS.js";import{e as z}from"./chunk-RPC-O8j3.js";import{p as q}from"./chunk-DDgtQIuA.js";import{s as $}from"./chunk-Bz0sHhCn.js";import{s as Y}from"./chunk-BcvNNmv9.js";import{_ as P}from"./chunk-C1eKK5Oc.js";import"./chunk-BN8kgYrt.js";const W=new class{STORAGE_KEY="money_management_custom_reports";getCustomReports(){try{const e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load custom reports:",e),[]}}saveCustomReport(e){const t=this.getCustomReports(),a=t.findIndex(t=>t.id===e.id);a>=0?t[a]=e:t.push(e),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}deleteCustomReport(e){const t=this.getCustomReports().filter(t=>t.id!==e);localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}async generateReportData(e,t){const{startDate:a,endDate:r}=this.getDateRange(e.filters.dateRange,{start:e.filters.customStartDate,end:e.filters.customEndDate});let s=t.transactions.filter(e=>{const t=new Date(e.date);return t>=a&&t<=r});e.filters.accounts&&e.filters.accounts.length>0&&(s=s.filter(t=>e.filters.accounts.includes(t.accountId))),e.filters.categories&&e.filters.categories.length>0&&(s=s.filter(t=>e.filters.categories.includes(t.category))),e.filters.tags&&e.filters.tags.length>0&&(s=s.filter(t=>t.tags&&t.tags.some(t=>e.filters.tags.includes(t))));const n={};for(const o of e.components)n[o.id]=await this.generateComponentData(o,{transactions:s,accounts:t.accounts,budgets:t.budgets,categories:t.categories,dateRange:{startDate:a,endDate:r}});return{report:e,dateRange:{startDate:a,endDate:r},data:n}}getDateRange(a,r){const s=new Date;switch(a){case"month":return{startDate:Y(s),endDate:l(s)};case"quarter":return{startDate:e(s),endDate:t(s)};case"year":return{startDate:i(s),endDate:z(s)};case"custom":return{startDate:r?.start?q(r.start):$(s,1),endDate:r?.end?q(r.end):s}}}async generateComponentData(e,t){const{transactions:a,accounts:r,budgets:s,categories:n,dateRange:o}=t;switch(e.type){case"summary-stats":return this.generateSummaryStats(a,e.config);case"line-chart":return this.generateLineChartData(a,o,e.config);case"pie-chart":return this.generatePieChartData(a,n,e.config);case"bar-chart":return this.generateBarChartData(a,o,e.config);case"table":return this.generateTableData(a,r,e.config);case"text-block":return{content:e.config.content||""};case"category-breakdown":return this.generateCategoryBreakdown(a,n,s,e.config);case"date-comparison":return this.generateDateComparison(a,o,e.config);default:return null}}generateSummaryStats(e,t){const a=e.filter(e=>"income"===e.type).reduce((e,t)=>e.plus(t.amount),new c(0)),r=e.filter(e=>"expense"===e.type).reduce((e,t)=>e.plus(Math.abs(t.amount)),new c(0)),s=a.minus(r),n=a.gt(0)?s.div(a).mul(100):new c(0),o={income:a.toNumber(),expenses:r.toNumber(),netIncome:s.toNumber(),savingsRate:n.toNumber(),transactionCount:e.length,avgTransaction:e.length>0?r.div(e.filter(e=>"expense"===e.type).length).toNumber():0};return t.metrics&&Array.isArray(t.metrics)?Object.keys(o).filter(e=>t.metrics.includes(e)).reduce((e,t)=>({...e,[t]:o[t]}),{}):o}generateLineChartData(e,t,a){const r=new Map;e.forEach(e=>{const t=m(new Date(e.date),"yyyy-MM");r.has(t)||r.set(t,{income:new c(0),expenses:new c(0)});const a=r.get(t);"income"===e.type?a.income=a.income.plus(e.amount):"expense"===e.type&&(a.expenses=a.expenses.plus(Math.abs(e.amount)))});const s=Array.from(r.keys()).sort(),n=[];return"income-vs-expenses"!==a.dataType&&"both"!==a.dataType||(n.push({label:"Income",data:s.map(e=>r.get(e).income.toNumber()),borderColor:"rgb(34, 197, 94)",backgroundColor:"rgba(34, 197, 94, 0.1)"}),n.push({label:"Expenses",data:s.map(e=>r.get(e).expenses.toNumber()),borderColor:"rgb(239, 68, 68)",backgroundColor:"rgba(239, 68, 68, 0.1)"})),{labels:s,datasets:n}}generatePieChartData(e,t,a){const r=new Map;e.filter(e=>"expense"===e.type).forEach(e=>{const t=r.get(e.category)||new c(0);r.set(e.category,t.plus(Math.abs(e.amount)))});const s=Array.from(r.entries()).sort((e,t)=>t[1].toNumber()-e[1].toNumber()).slice(0,a.limit||10);if(r.size>s.length){const e=Array.from(r.entries()).slice(s.length).reduce((e,[t,a])=>e.plus(a),new c(0));e.gt(0)&&s.push(["Other",e])}return{labels:s.map(([e])=>t.find(t=>t.id===e)?.name||e),data:s.map(([e,t])=>t.toNumber())}}generateBarChartData(e,t,a){const r=new Map;e.filter(e=>"expense"===e.type).forEach(e=>{const t=m(new Date(e.date),"MMM yyyy"),a=r.get(t)||new c(0);r.set(t,a.plus(Math.abs(e.amount)))});const s=Array.from(r.keys()).sort((e,t)=>new Date(e).getTime()-new Date(t).getTime());return{labels:s,datasets:[{label:"Monthly Expenses",data:s.map(e=>r.get(e).toNumber()),backgroundColor:"rgba(99, 102, 241, 0.5)",borderColor:"rgb(99, 102, 241)",borderWidth:1}]}}generateTableData(e,t,a){let r=[...e];return a.sortBy&&r.sort((e,t)=>{const r=e[a.sortBy],s=t[a.sortBy];return"desc"===a.sortOrder?r>s?-1:1:r>s?1:-1}),a.limit&&(r=r.slice(0,a.limit)),r.map(e=>({date:m(new Date(e.date),"MMM d, yyyy"),description:e.description,category:e.category,account:t.find(t=>t.id===e.accountId)?.name||"Unknown",amount:e.amount,type:e.type}))}generateCategoryBreakdown(e,t,a,r){const s=new Map;return e.filter(e=>"expense"===e.type).forEach(e=>{const t=s.get(e.category)||{actual:new c(0),budget:new c(0),count:0};t.actual=t.actual.plus(Math.abs(e.amount)),t.count++,s.set(e.category,t)}),a.forEach(e=>{const t=s.get(e.category)||{actual:new c(0),budget:new c(0),count:0};t.budget=new c(e.amount),s.set(e.category,t)}),Array.from(s.entries()).map(([e,a])=>{const r=t.find(t=>t.id===e),s=a.budget.gt(0)?a.actual.minus(a.budget).div(a.budget).mul(100):new c(0);return{category:r?.name||e,actual:a.actual.toNumber(),budget:a.budget.toNumber(),variance:s.toNumber(),count:a.count,status:a.actual.lte(a.budget)?"under":"over"}})}generateDateComparison(e,t,a){const r=Math.round((t.endDate.getTime()-t.startDate.getTime())/864e5),s=new Date(t.startDate);s.setDate(s.getDate()-r);const n=new Date(t.startDate);n.setDate(n.getDate()-1);const o=e.filter(e=>{const a=new Date(e.date);return a>=t.startDate&&a<=t.endDate}),d=e.filter(e=>{const t=new Date(e.date);return t>=s&&t<=n}),i=e=>{const t=e.filter(e=>"income"===e.type).reduce((e,t)=>e.plus(t.amount),new c(0)),a=e.filter(e=>"expense"===e.type).reduce((e,t)=>e.plus(Math.abs(t.amount)),new c(0));return{income:t.toNumber(),expenses:a.toNumber(),netIncome:t.minus(a).toNumber(),transactionCount:e.length}},l=i(o),g=i(d);return{current:l,previous:g,changes:{income:g.income>0?(l.income-g.income)/g.income*100:0,expenses:g.expenses>0?(l.expenses-g.expenses)/g.expenses*100:0,netIncome:0!==g.netIncome?(l.netIncome-g.netIncome)/Math.abs(g.netIncome)*100:0},periodLabel:{current:`${m(t.startDate,"MMM d")} - ${m(t.endDate,"MMM d, yyyy")}`,previous:`${m(s,"MMM d")} - ${m(n,"MMM d, yyyy")}`}}}},B=[{type:"summary-stats",name:"Summary Statistics",description:"Key financial metrics overview",icon:h,defaultConfig:{metrics:["income","expenses","netIncome","savingsRate"]}},{type:"line-chart",name:"Line Chart",description:"Trends over time",icon:x,defaultConfig:{dataType:"income-vs-expenses",showLegend:!0,showDataLabels:!1}},{type:"pie-chart",name:"Pie Chart",description:"Category breakdown",icon:b,defaultConfig:{dataType:"expenses-by-category",showPercentages:!0,limit:10}},{type:"bar-chart",name:"Bar Chart",description:"Comparisons",icon:f,defaultConfig:{dataType:"monthly-expenses",orientation:"vertical"}},{type:"table",name:"Data Table",description:"Detailed tabular data",icon:v,defaultConfig:{dataType:"top-transactions",limit:20,sortBy:"amount",sortOrder:"desc"}},{type:"text-block",name:"Text Block",description:"Custom text or notes",icon:j,defaultConfig:{content:"",fontSize:"medium"}},{type:"category-breakdown",name:"Category Analysis",description:"Detailed category breakdown",icon:k,defaultConfig:{showSubcategories:!0,comparisonType:"budget"}},{type:"date-comparison",name:"Period Comparison",description:"Compare different time periods",icon:N,defaultConfig:{periods:["current","previous"],metric:"netIncome"}}],J=new class{STORAGE_KEY="money_management_scheduled_custom_reports";checkInterval=null;initialize(){this.checkInterval=setInterval(()=>{this.checkAndRunDueReports()},6e4),this.checkAndRunDueReports()}destroy(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)}getScheduledReports(){try{const e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load scheduled reports:",e),[]}}saveScheduledReport(e){const t=this.getScheduledReports(),a=t.findIndex(t=>t.id===e.id);a>=0?t[a]=e:t.push(e),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}deleteScheduledReport(e){const t=this.getScheduledReports().filter(t=>t.id!==e);localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}calculateNextRun(e,t=new Date){const[a,r]=e.time.split(":").map(Number),s=new Date(t);switch(s.setHours(a,r,0,0),s<=t&&s.setDate(s.getDate()+1),e.frequency){case"daily":break;case"weekly":{const t=e.dayOfWeek||1;for(;s.getDay()!==t;)s.setDate(s.getDate()+1);break}case"monthly":{const a=e.dayOfMonth||1;s.setDate(a),s<=t&&s.setMonth(s.getMonth()+1);break}case"quarterly":{const e=Math.floor(s.getMonth()/3)+1;s.setMonth(3*e,1);break}case"yearly":s.setMonth(0,1),s<=t&&s.setFullYear(s.getFullYear()+1)}return s}async checkAndRunDueReports(){const e=this.getScheduledReports(),t=new Date;for(const a of e)a.enabled&&new Date(a.nextRun)<=t&&await this.runScheduledReport(a)}async runScheduledReport(e,t){try{console.log(`[ScheduledReports] Running report: ${e.reportName}`);const a=W.getCustomReports().find(t=>t.id===e.customReportId);if(!a)throw new Error("Custom report not found");t||(t=this.getDataFromStorage());const r=await W.generateReportData(a,t);let s;switch(e.deliveryFormat){case"pdf":s=await this.exportToPDF(r,a);break;case"csv":s=await this.exportToCSV(r,t);break;case"excel":s=await this.exportToExcel(r,t);break;case"email":s=await this.exportToPDF(r,a),this.notifyEmailReady(e,s)}e.lastRun=new Date,e.nextRun=this.calculateNextRun(e),this.saveScheduledReport(e),this.addToHistory({reportId:e.id,reportName:e.reportName,runTime:new Date,success:!0,format:e.deliveryFormat}),console.log(`[ScheduledReports] Report completed: ${e.reportName}`)}catch(a){console.error(`[ScheduledReports] Report failed: ${e.reportName}`,a),this.addToHistory({reportId:e.id,reportName:e.reportName,runTime:new Date,success:!1,error:a instanceof Error?a.message:"Unknown error"})}}getDataFromStorage(){return{transactions:JSON.parse(localStorage.getItem("money_management_transactions")||"[]"),accounts:JSON.parse(localStorage.getItem("money_management_accounts")||"[]"),budgets:JSON.parse(localStorage.getItem("money_management_budgets")||"[]"),categories:JSON.parse(localStorage.getItem("money_management_categories")||"[]")}}async exportToPDF(e,t){const{generatePDFReport:a}=await P(async()=>{const{generatePDFReport:e}=await import("./pdfExport-CTDNmc67.js");return{generatePDFReport:e}},__vite__mapDeps([0,1])),r={title:t.name,dateRange:`${m(e.dateRange.startDate,"MMM d, yyyy")} - ${m(e.dateRange.endDate,"MMM d, yyyy")}`,components:e.data,customReport:t};return await a(r,[])}async exportToCSV(e,t){return await C.exportData({transactions:t.transactions,accounts:t.accounts,investments:[],budgets:t.budgets},{startDate:e.dateRange.startDate,endDate:e.dateRange.endDate,format:"csv",includeTransactions:!0,includeAccounts:!0,includeBudgets:!0})}async exportToExcel(e,t){return await C.exportData({transactions:t.transactions,accounts:t.accounts,investments:[],budgets:t.budgets},{startDate:e.dateRange.startDate,endDate:e.dateRange.endDate,format:"xlsx",includeTransactions:!0,includeAccounts:!0,includeBudgets:!0})}notifyEmailReady(e,t){new Notification("Report Ready for Email",{body:`${e.reportName} has been generated and is ready to email to ${e.emailRecipients?.join(", ")}`,icon:"/icon-192.png",tag:"scheduled-report-email"})}addToHistory(e){const t="money_management_report_history",a=JSON.parse(localStorage.getItem(t)||"[]");a.unshift(e),a.length>100&&a.splice(100),localStorage.setItem(t,JSON.stringify(a))}getReportHistory(){return JSON.parse(localStorage.getItem("money_management_report_history")||"[]")}};export{o as default};
