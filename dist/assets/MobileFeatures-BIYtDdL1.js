function e({isOpen:e,onClose:t,onExpenseCreated:a}){const{accounts:h,categories:u,addTransaction:b}=s(),{formatCurrency:f}=k(),[y,p]=j.useState("camera"),[N,v]=j.useState(null),[w,S]=j.useState([]),[C,O]=j.useState(!1),[E,z]=j.useState(null),[A,D]=j.useState(0),[P,L]=j.useState(""),[R,M]=j.useState(""),[q,F]=j.useState(""),[H,W]=j.useState(null);j.useEffect(()=>{e&&(p("camera"),v(null),S([]),z(null),D(0),L(""),M(""),F(h[0]?.id||""),W(null))},[e,h]);const $=e=>{W(e),e&&(L(e.name),M(e.category)),p("review")};return e?i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:i.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-6",children:[i.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Quick Expense"}),i.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:i.jsx(r,{size:20})})]}),"camera"===y&&i.jsxs("div",{className:"text-center space-y-6",children:[i.jsx("div",{className:"mx-auto w-32 h-32 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center",children:i.jsx(n,{size:48,className:"text-gray-400"})}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Capture Receipt"}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:"Take a photo of your receipt to automatically extract expense details"})]}),E&&i.jsxs("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-red-700 dark:text-red-300 text-sm",children:[i.jsx(l,{size:16,className:"inline mr-2"}),E]}),i.jsxs("div",{className:"space-y-3",children:[i.jsx("button",{onClick:async()=>{O(!0),z(null);try{const e=await T.captureExpense();if(e)if(v(e),D(e.suggestedAmount||0),L(e.suggestedMerchant||""),M(e.suggestedCategory||""),e.location){const t=await T.findNearbyMerchants(e.location);S(t),p("location")}else p("review")}catch(e){z(e instanceof Error?e.message:"Failed to capture expense")}finally{O(!1)}},disabled:C,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-[var(--color-primary)] text-white rounded-lg hover:bg-[var(--color-primary)]/90 disabled:opacity-50",children:C?i.jsxs(i.Fragment,{children:[i.jsx(o,{size:20,className:"animate-spin"}),"Processing..."]}):i.jsxs(i.Fragment,{children:[i.jsx(n,{size:20}),"Take Photo"]})}),i.jsx("button",{onClick:()=>p("review"),className:"w-full px-6 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:"Enter Manually"})]})]}),"location"===y&&i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"text-center",children:[i.jsx(d,{size:32,className:"mx-auto mb-4 text-blue-600 dark:text-blue-400"}),i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Select Merchant"}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"We found these nearby merchants. Select one or continue without location."})]}),i.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:w.map((e,t)=>i.jsx("button",{onClick:()=>$(e),className:"w-full p-3 text-left border border-gray-200 dark:border-gray-700 rounded-lg hover:border-[var(--color-primary)] hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.address})]}),i.jsx("div",{className:"text-right",children:i.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[e.distance?.toFixed(1)," mi"]})})]})},t))}),i.jsx("div",{className:"flex gap-3",children:i.jsx("button",{onClick:()=>$(null),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:"Skip Location"})})]}),"review"===y&&i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"text-center",children:[i.jsx(c,{size:32,className:"mx-auto mb-4 text-green-600 dark:text-green-400"}),i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Review Expense"}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Verify the details and save your expense"})]}),N&&i.jsx("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("img",{src:N.imageData,alt:"Receipt",className:"w-16 h-16 object-cover rounded-lg"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Receipt captured"}),i.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:N.timestamp.toLocaleString()})]})]})}),H&&i.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(d,{size:20,className:"text-blue-600 dark:text-blue-400"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:H.name}),i.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:H.address})]})]})}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Amount *"}),i.jsx("input",{type:"number",step:"0.01",value:A,onChange:e=>D(Number(e.target.value)),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"0.00"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description *"}),i.jsx("input",{type:"text",value:P,onChange:e=>L(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"Coffee, lunch, etc."})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Category"}),i.jsxs("select",{value:R,onChange:e=>M(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[i.jsx("option",{value:"",children:"Select category"}),u.map(e=>i.jsx("option",{value:e.id,children:e.name},e.id))]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Account *"}),i.jsx("select",{value:q,onChange:e=>F(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:h.map(e=>i.jsx("option",{value:e.id,children:e.name},e.id))})]})]}),E&&i.jsxs("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-red-700 dark:text-red-300 text-sm",children:[i.jsx(l,{size:16,className:"inline mr-2"}),E]}),T.isOffline()&&i.jsxs("div",{className:"p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg text-yellow-700 dark:text-yellow-300 text-sm",children:[i.jsx(l,{size:16,className:"inline mr-2"}),"You're offline. Expense will be saved and synced when connection is restored."]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>p("camera"),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:"Back"}),i.jsx("button",{onClick:async()=>{if(A&&P&&q){O(!0);try{const e={id:Date.now().toString(),date:new Date,amount:-Math.abs(A),description:P,category:R||"other",accountId:q,type:"expense",notes:H?`Location: ${H.address}`:void 0,tags:H?["mobile-capture","location-tagged"]:["mobile-capture"]};T.isOffline()?(T.addOfflineTransaction(e,"create"),p("complete")):(await b(e),p("complete")),a?.(e),setTimeout(()=>{t()},2e3)}catch(e){z(e instanceof Error?e.message:"Failed to save expense")}finally{O(!1)}}else z("Please fill in all required fields")},disabled:C||!A||!P||!q,className:"flex-1 px-4 py-2 bg-[var(--color-primary)] text-white rounded-lg hover:bg-[var(--color-primary)]/90 disabled:opacity-50",children:C?i.jsxs(i.Fragment,{children:[i.jsx(o,{size:16,className:"animate-spin inline mr-2"}),"Saving..."]}):"Save Expense"})]})]}),"complete"===y&&i.jsxs("div",{className:"text-center space-y-6",children:[i.jsx("div",{className:"mx-auto w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center",children:i.jsx(x,{size:32,className:"text-green-600 dark:text-green-400"})}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Expense Saved!"}),i.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[f(g(A))," expense has been ",T.isOffline()?"queued for sync":"saved"]})]}),T.isOffline()&&i.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-blue-700 dark:text-blue-300 text-sm",children:[i.jsx(m,{size:16,className:"inline mr-2"}),"Will sync automatically when you're back online"]})]})]})})}):null}function t({isOpen:e,onClose:t}){const[a,s]=j.useState(T.getNotificationSettings()),[n,o]=j.useState(!1),[d,x]=j.useState(!1);j.useEffect(()=>{e&&(s(T.getNotificationSettings()),x("granted"===Notification.permission))},[e]);const g=(e,t)=>{const i={...a,[e]:t};s(i),T.updateNotificationSettings(i)},b=(e,t)=>{const i={...a,quietHours:{...a.quietHours,[e]:t}};s(i),T.updateNotificationSettings(i)};return e?i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:i.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-6",children:[i.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[i.jsx(h,{size:20,className:"text-blue-600 dark:text-blue-400"}),"Notification Settings"]}),i.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:i.jsx(r,{size:20})})]}),i.jsxs("div",{className:"space-y-6",children:[!d&&i.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(l,{size:20,className:"text-blue-600 dark:text-blue-400 mt-0.5"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-medium text-blue-900 dark:text-blue-100 mb-1",children:"Enable Notifications"}),i.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mb-3",children:"Allow notifications to receive budget alerts and bill reminders"}),i.jsx("button",{onClick:async()=>{o(!0);try{const e=await T.requestNotificationPermission();x(e),e&&s(e=>({...e,enabled:!0}))}catch(e){console.error("Failed to request notification permission:",e)}finally{o(!1)}},disabled:n,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 text-sm",children:n?"Requesting...":"Allow Notifications"})]})]})}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Enable Notifications"}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Receive all types of notifications"})]}),i.jsx("button",{onClick:()=>g("enabled",!a.enabled),disabled:!d,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${a.enabled&&d?"bg-[var(--color-primary)]":"bg-gray-200 dark:bg-gray-700"} ${d?"":"opacity-50 cursor-not-allowed"}`,children:i.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(a.enabled&&d?"translate-x-6":"translate-x-1")})})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(c,{size:20,className:"text-yellow-600 dark:text-yellow-400"}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Budget Alerts"}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"When you exceed 90% of a budget"})]})]}),i.jsx("button",{onClick:()=>g("budgetAlerts",!a.budgetAlerts),disabled:!a.enabled,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${a.budgetAlerts&&a.enabled?"bg-[var(--color-primary)]":"bg-gray-200 dark:bg-gray-700"} ${a.enabled?"":"opacity-50 cursor-not-allowed"}`,children:i.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(a.budgetAlerts&&a.enabled?"translate-x-6":"translate-x-1")})})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(u,{size:20,className:"text-green-600 dark:text-green-400"}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Bill Reminders"}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Recurring bill payment reminders"})]})]}),i.jsx("button",{onClick:()=>g("billReminders",!a.billReminders),disabled:!a.enabled,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${a.billReminders&&a.enabled?"bg-[var(--color-primary)]":"bg-gray-200 dark:bg-gray-700"} ${a.enabled?"":"opacity-50 cursor-not-allowed"}`,children:i.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(a.billReminders&&a.enabled?"translate-x-6":"translate-x-1")})})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Large Expense Alert Threshold"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"$"}),i.jsx("input",{type:"number",value:a.expenseThreshold,onChange:e=>g("expenseThreshold",Number(e.target.value)),disabled:!a.enabled,className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white disabled:opacity-50",min:"0",step:"10"})]}),i.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Get notified for expenses above this amount"})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(m,{size:20,className:"text-purple-600 dark:text-purple-400"}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Quiet Hours"}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Disable notifications during these hours"})]})]}),i.jsx("button",{onClick:()=>b("enabled",!a.quietHours.enabled),disabled:!a.enabled,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${a.quietHours.enabled&&a.enabled?"bg-[var(--color-primary)]":"bg-gray-200 dark:bg-gray-700"} ${a.enabled?"":"opacity-50 cursor-not-allowed"}`,children:i.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(a.quietHours.enabled&&a.enabled?"translate-x-6":"translate-x-1")})})]}),a.quietHours.enabled&&a.enabled&&i.jsxs("div",{className:"pl-8 space-y-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("label",{className:"text-sm text-gray-600 dark:text-gray-400 w-12",children:"From:"}),i.jsx("input",{type:"time",value:a.quietHours.start,onChange:e=>b("start",e.target.value),className:"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("label",{className:"text-sm text-gray-600 dark:text-gray-400 w-12",children:"To:"}),i.jsx("input",{type:"time",value:a.quietHours.end,onChange:e=>b("end",e.target.value),className:"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm"})]})]})]}),a.enabled&&d&&i.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:i.jsx("button",{onClick:async()=>{await T.sendNotification("Test Notification","This is a test notification from Wealth Tracker",{type:"test"})},className:"w-full px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 text-sm",children:"Send Test Notification"})})]}),i.jsx("div",{className:"flex justify-end mt-6",children:i.jsx("button",{onClick:t,className:"px-4 py-2 bg-[var(--color-primary)] text-white rounded-lg hover:bg-[var(--color-primary)]/90",children:"Done"})})]})})}):null}function a(){const[a,s]=j.useState(T.isOffline()),[r,o]=j.useState([]),[c,x]=j.useState([]),[g,u]=j.useState(T.getNotificationSettings()),[k,w]=j.useState(!1),[S,C]=j.useState(!1),[O,E]=j.useState(!1),[z,A]=j.useState(!1);j.useEffect(()=>{D();const e=()=>D(),t=()=>D();return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[]);const D=()=>{s(T.isOffline()),o(T.getOfflineTransactions()),x(T.getNotifications()),u(T.getNotificationSettings()),w(T.isPWAInstalled())},P=async()=>{await T.requestNotificationPermission()&&u(T.getNotificationSettings())},L=T.getConnectionStatus();return i.jsxs(v,{children:[i.jsxs("div",{className:"max-w-4xl mx-auto",children:[i.jsx("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 dark:from-indigo-800 dark:to-purple-800 rounded-2xl p-6 mb-6 text-white shadow-lg",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Mobile Features"}),i.jsx("p",{className:"text-indigo-100",children:"Enhanced mobile experience with offline support"})]}),i.jsx(b,{size:48,className:"text-white/80"})]})}),i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 mb-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Connection Status"}),i.jsxs("div",{className:"flex items-center gap-2",children:[a?i.jsx(f,{size:20,className:"text-red-500"}):i.jsx(y,{size:20,className:"text-green-500"}),i.jsx("span",{className:"font-medium "+(a?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400"),children:a?"Offline":L})]})]}),a&&i.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 mb-4",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx(l,{size:20,className:"text-red-600 dark:text-red-400"}),i.jsx("p",{className:"font-medium text-red-800 dark:text-red-200",children:"You're currently offline"})]}),i.jsx("p",{className:"text-sm text-red-700 dark:text-red-300",children:"Your transactions will be saved locally and synced when you're back online."})]}),r.length>0&&i.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(m,{size:20,className:"text-yellow-600 dark:text-yellow-400"}),i.jsx("p",{className:"font-medium text-yellow-800 dark:text-yellow-200",children:"Pending Sync"})]}),i.jsxs("button",{onClick:async()=>{if(!a){A(!0);try{await T.syncOfflineTransactions(),D()}catch(e){console.error("Sync failed:",e)}finally{A(!1)}}},disabled:a||z,className:"flex items-center gap-1 px-3 py-1 bg-yellow-600 text-white rounded text-sm hover:bg-yellow-700 disabled:opacity-50",children:[i.jsx(p,{size:14,className:z?"animate-spin":""}),z?"Syncing...":"Sync Now"]})]}),i.jsxs("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:[r.length," transaction",1!==r.length?"s":""," waiting to sync"]})]})]}),i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 mb-6",children:[i.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Quick Actions"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("button",{onClick:()=>C(!0),className:"flex items-center gap-4 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg hover:bg-green-100 dark:hover:bg-green-900/30 transition-colors text-left",children:[i.jsx(n,{size:24,className:"text-green-600 dark:text-green-400"}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-medium text-green-800 dark:text-green-200",children:"Quick Expense Capture"}),i.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"Snap a photo of your receipt"})]})]}),i.jsxs("button",{onClick:()=>E(!0),className:"flex items-center gap-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors text-left",children:[i.jsx(h,{size:24,className:"text-blue-600 dark:text-blue-400"}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-medium text-blue-800 dark:text-blue-200",children:"Notification Settings"}),i.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:"Configure alerts and reminders"})]})]})]})]}),!k&&i.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 mb-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Install Mobile App"}),i.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Add Wealth Tracker to your home screen for faster access and offline support"})]}),i.jsx("button",{onClick:async()=>{try{await T.installPWA()?alert("PWA installation available! Look for the install button in your browser."):alert("PWA installation not available on this device.")}catch(e){console.error("PWA installation failed:",e)}},className:"px-4 py-2 bg-[var(--color-primary)] text-white rounded-lg hover:bg-[var(--color-primary)]/90",children:"Install App"})]})}),i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 mb-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Notifications"}),i.jsxs("div",{className:"flex items-center gap-2",children:[!g.enabled&&i.jsx("button",{onClick:P,className:"px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700",children:"Enable"}),i.jsx("button",{onClick:()=>E(!0),className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:i.jsx(N,{size:16})})]})]}),g.enabled?0===c.length?i.jsxs("div",{className:"text-center py-8",children:[i.jsx(y,{size:48,className:"mx-auto mb-4 text-gray-400"}),i.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No notifications yet"})]}):i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[c.length," notification",1!==c.length?"s":""]}),i.jsx("button",{onClick:()=>{T.clearNotifications(),x([])},className:"text-sm text-red-600 dark:text-red-400 hover:underline",children:"Clear All"})]}),c.slice(0,5).map(e=>i.jsx("div",{className:"p-3 rounded-lg border cursor-pointer transition-colors "+(e.read?"bg-gray-50 dark:bg-gray-700/50 border-gray-200 dark:border-gray-700":"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-700"),onClick:()=>{return t=e.id,T.markNotificationAsRead(t),void x(T.getNotifications());var t},children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:e.title}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.body})]}),i.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.timestamp.toLocaleTimeString()})]})},e.id))]}):i.jsxs("div",{className:"text-center py-8",children:[i.jsx(h,{size:48,className:"mx-auto mb-4 text-gray-400"}),i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Notifications Disabled"}),i.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Enable notifications to receive budget alerts and bill reminders"}),i.jsx("button",{onClick:P,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Enable Notifications"})]})]}),i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:[i.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Mobile Features"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{children:[i.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[i.jsx(f,{size:20,className:"text-orange-600 dark:text-orange-400"}),"Offline Support"]}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Continue using the app without internet. All transactions are saved locally and synced when you're back online."})]}),i.jsxs("div",{children:[i.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[i.jsx(n,{size:20,className:"text-green-600 dark:text-green-400"}),"Receipt Capture"]}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Take photos of receipts to automatically extract expense details using OCR technology."})]}),i.jsxs("div",{children:[i.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[i.jsx(d,{size:20,className:"text-blue-600 dark:text-blue-400"}),"Location Services"]}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Automatically detect nearby merchants and categorize expenses based on your location."})]}),i.jsxs("div",{children:[i.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[i.jsx(h,{size:20,className:"text-purple-600 dark:text-purple-400"}),"Smart Notifications"]}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Get timely alerts for budget limits, bill reminders, and unusual spending patterns."})]})]})]})]}),i.jsx(e,{isOpen:S,onClose:()=>C(!1),onExpenseCreated:e=>{D()}}),i.jsx(t,{isOpen:O,onClose:()=>{E(!1),u(T.getNotificationSettings())}})]})}import{g as s,j as i,X as r,bT as n,ar as l,bU as o,bV as d,aB as c,_ as x,F as g,aZ as m,aH as h,r as u,P as b,as as f,O as y,at as p,N}from"./index-CgJz7Gw0.js";import{a as j}from"./chunk-BWx9oMeS.js";import{P as v}from"./chunk-DLeAFLQD.js";import{u as k}from"./chunk-tt7ooTmr.js";import"./chunk-BN8kgYrt.js";import"./chunk-C1eKK5Oc.js";const w="offline_transactions",S="notification_settings",C="push_notifications",T=new class{offlineTransactions=[];notificationSettings;pushNotifications=[];isOnline=navigator.onLine;constructor(){this.loadOfflineData(),this.notificationSettings=this.loadNotificationSettings(),this.pushNotifications=this.loadPushNotifications(),this.setupNetworkListeners(),this.setupNotificationPermissions()}loadOfflineData(){const e=localStorage.getItem(w);e&&(this.offlineTransactions=JSON.parse(e).map(e=>({...e,timestamp:new Date(e.timestamp)})))}saveOfflineData(){localStorage.setItem(w,JSON.stringify(this.offlineTransactions))}loadNotificationSettings(){const e=localStorage.getItem(S);return e?JSON.parse(e):{enabled:!1,budgetAlerts:!0,billReminders:!0,expenseThreshold:100,quietHours:{enabled:!0,start:"22:00",end:"08:00"}}}saveNotificationSettings(){localStorage.setItem(S,JSON.stringify(this.notificationSettings))}loadPushNotifications(){const e=localStorage.getItem(C);return e?JSON.parse(e).map(e=>({...e,timestamp:new Date(e.timestamp)})):[]}savePushNotifications(){localStorage.setItem(C,JSON.stringify(this.pushNotifications))}setupNetworkListeners(){window.addEventListener("online",()=>{this.isOnline=!0,this.syncOfflineTransactions()}),window.addEventListener("offline",()=>{this.isOnline=!1})}async setupNotificationPermissions(){if("Notification"in window&&"serviceWorker"in navigator)try{await navigator.serviceWorker.ready,"granted"===Notification.permission&&(this.notificationSettings.enabled=!0,this.saveNotificationSettings())}catch(e){console.error("Error setting up notifications:",e)}}isOffline(){return!this.isOnline}addOfflineTransaction(e,t){const a={id:Date.now().toString(),data:e,action:t,timestamp:new Date,synced:!1,retry_count:0};return this.offlineTransactions.push(a),this.saveOfflineData(),a.id}getOfflineTransactions(){return[...this.offlineTransactions]}async syncOfflineTransactions(){if(!this.isOnline||0===this.offlineTransactions.length)return;const e=this.offlineTransactions.filter(e=>!e.synced);for(const a of e)try{await this.simulateSync(a),a.synced=!0,a.retry_count=0}catch(t){a.retry_count++,console.error("Failed to sync transaction:",t),a.retry_count>=5&&(this.offlineTransactions=this.offlineTransactions.filter(e=>e.id!==a.id))}this.offlineTransactions=this.offlineTransactions.filter(e=>!e.synced),this.saveOfflineData()}async simulateSync(e){if(await new Promise(e=>setTimeout(e,500)),Math.random()<.1)throw new Error("Sync failed")}async captureExpense(){if(!("mediaDevices"in navigator)||!("getUserMedia"in navigator.mediaDevices))throw new Error("Camera not supported");try{const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1}),t=document.createElement("video");return t.srcObject=e,t.play(),new Promise((a,s)=>{t.onloadedmetadata=()=>{const i=document.createElement("canvas");i.width=t.videoWidth,i.height=t.videoHeight;const r=i.getContext("2d");if(!r)return void s(new Error("Canvas context not available"));r.drawImage(t,0,0);const n=i.toDataURL("image/jpeg",.8);e.getTracks().forEach(e=>e.stop()),this.getCurrentLocation().then(e=>{const t={imageData:n,timestamp:new Date,location:e||void 0};this.processImage(t).then(e=>{a(e)})})}})}catch(e){throw console.error("Camera capture failed:",e),e}}async processImage(e){const t="COFFEE SHOP\nTOTAL: $4.50\nDATE: "+(new Date).toLocaleDateString(),a=t.match(/\$?(\d+\.?\d*)/),s=a?parseFloat(a[1]):void 0,i=t.match(/([A-Z\s]+)(?=\n)/),r=i?i[1].trim():void 0;let n="other";return t.toLowerCase().includes("coffee")?n="dining":t.toLowerCase().includes("gas")&&(n="transportation"),{...e,extractedText:t,suggestedAmount:s,suggestedMerchant:r,suggestedCategory:n}}async getCurrentLocation(){return"geolocation"in navigator?new Promise(e=>{navigator.geolocation.getCurrentPosition(t=>e(t.coords),()=>e(null),{timeout:1e4,enableHighAccuracy:!0})}):null}async findNearbyMerchants(e){return[{name:"Starbucks",category:"dining",coordinates:{latitude:e.latitude+.001,longitude:e.longitude+.001},address:"123 Main St",distance:.1},{name:"Shell Gas Station",category:"transportation",coordinates:{latitude:e.latitude-.002,longitude:e.longitude+.002},address:"456 Oak Ave",distance:.2},{name:"Walmart",category:"shopping",coordinates:{latitude:e.latitude+.003,longitude:e.longitude-.001},address:"789 Pine Rd",distance:.3}]}async requestNotificationPermission(){if(!("Notification"in window))return!1;let e=Notification.permission;"default"===e&&(e=await Notification.requestPermission());const t="granted"===e;return this.notificationSettings.enabled=t,this.saveNotificationSettings(),t}getNotificationSettings(){return{...this.notificationSettings}}updateNotificationSettings(e){this.notificationSettings={...this.notificationSettings,...e},this.saveNotificationSettings()}async sendNotification(e,t,a){if(!this.notificationSettings.enabled||!this.canSendNotification())return;const s={id:Date.now().toString(),title:e,body:t,data:a,timestamp:new Date,read:!1};this.pushNotifications.unshift(s),this.savePushNotifications(),"granted"===Notification.permission&&new Notification(e,{body:t,icon:"/icon-192x192.png",badge:"/icon-192x192.png",data:a})}canSendNotification(){if(!this.notificationSettings.quietHours.enabled)return!0;const e=new Date,t=e.getHours().toString().padStart(2,"0")+":"+e.getMinutes().toString().padStart(2,"0"),a=this.notificationSettings.quietHours.start,s=this.notificationSettings.quietHours.end;return a>s?t<a&&t>s:t<a||t>s}getNotifications(){return[...this.pushNotifications]}markNotificationAsRead(e){const t=this.pushNotifications.find(t=>t.id===e);t&&(t.read=!0,this.savePushNotifications())}clearNotifications(){this.pushNotifications=[],this.savePushNotifications()}checkBudgetAlerts(e,t){if(!this.notificationSettings.budgetAlerts)return;const a=(new Date).getMonth(),s=(new Date).getFullYear();e.forEach(e=>{const i=t.filter(t=>{const i=new Date(t.date);return i.getMonth()===a&&i.getFullYear()===s&&t.category===e.category&&"expense"===t.type}).reduce((e,t)=>e+Math.abs(t.amount),0)/e.amount*100;i>=90&&this.sendNotification("Budget Alert",`You've spent ${i.toFixed(0)}% of your ${e.category} budget`,{type:"budget_alert",category:e.category})})}checkBillReminders(e){if(!this.notificationSettings.billReminders)return;const t=e.filter(e=>e.isRecurring),a=new Date;t.forEach(e=>{const t=new Date(e.date),s=Math.floor((a.getTime()-t.getTime())/864e5);s>=25&&s<=35&&this.sendNotification("Bill Reminder",`${e.description} payment may be due soon`,{type:"bill_reminder",transaction_id:e.id})})}async installPWA(){return"serviceWorker"in navigator&&"PushManager"in window}isPWAInstalled(){return window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone}getConnectionStatus(){if(!this.isOnline)return"offline";const e=navigator.connection;return!e||"slow-2g"!==e.effectiveType&&"2g"!==e.effectiveType?"online":"slow"}getStorageUsage(){return"storage"in navigator&&"estimate"in navigator.storage&&navigator.storage.estimate().then(e=>({used:e.usage||0,available:e.quota||0})),{used:0,available:0}}};export{a as default};
