function e({period:e}){const{transactions:t,accounts:r,budgets:m,goals:x}=n(),{formatCurrency:g,getCurrencySymbol:h,displayCurrency:u}=j(),[y,p]=a.useState(null),[k,N]=a.useState(!1);if(a.useEffect(()=>{const a="weekly"===e?f.generateWeeklySummary(t,r,m,x):f.generateMonthlySummary(t,r,m,x);p(a)},[t,r,m,x,e]),!y)return null;const w=e=>e>=0,v=e=>`${e>=0?"+":""}${e.toFixed(1)}%`;return s.jsxs("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:["weekly"===e?"Weekly":"Monthly"," Summary"]}),s.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1 mt-1",children:[s.jsx(i,{size:14}),b(y.startDate,"MMM d")," - ",b(y.endDate,"MMM d, yyyy")]})]}),s.jsxs("button",{onClick:()=>N(!k),className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300",children:[k?"Hide":"Show"," Details"]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[s.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-xl p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Income"}),0!==y.comparison.incomeChange&&s.jsxs("span",{className:"text-xs flex items-center gap-1 "+(w(y.comparison.incomeChange)?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[w(y.comparison.incomeChange)?s.jsx(d,{size:12}):s.jsx(o,{size:12}),v(y.comparison.incomeChange)]})]}),s.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:g(y.totalIncome)})]}),s.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-xl p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Expenses"}),0!==y.comparison.expenseChange&&s.jsxs("span",{className:"text-xs flex items-center gap-1 "+(w(y.comparison.expenseChange)?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400"),children:[w(y.comparison.expenseChange)?s.jsx(d,{size:12}):s.jsx(o,{size:12}),v(y.comparison.expenseChange)]})]}),s.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:g(y.totalExpenses)})]}),s.jsxs("div",{className:"rounded-xl p-4 "+(y.netIncome.greaterThanOrEqualTo(0)?"bg-blue-50 dark:bg-blue-900/20":"bg-orange-50 dark:bg-orange-900/20"),children:[s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Net Income"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:g(y.netIncome)}),s.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[y.savingsRate.toFixed(1),"% savings rate"]})]})]}),k&&s.jsxs("div",{className:"space-y-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[y.topCategories.length>0&&s.jsxs("div",{children:[s.jsxs("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:[s.jsx(l,{size:16}),"Top Spending Categories"]}),s.jsx("div",{className:"space-y-2",children:y.topCategories.map((e,t)=>s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[s.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.category}),s.jsx("div",{className:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:s.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${e.percentage}%`}})})]}),s.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white ml-3",children:g(e.amount)})]},t))})]}),y.budgetPerformance.filter(e=>e.percentage>80).length>0&&s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:"Budget Status"}),s.jsx("div",{className:"space-y-2",children:y.budgetPerformance.filter(e=>e.percentage>80).map((e,t)=>s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.budgetName}),s.jsxs("span",{className:"text-sm font-medium "+(e.percentage>100?"text-red-600 dark:text-red-400":e.percentage>90?"text-yellow-600 dark:text-yellow-400":"text-gray-900 dark:text-white"),children:[g(e.spent)," / ",g(e.limit),s.jsxs("span",{className:"text-xs ml-1",children:["(",e.percentage.toFixed(0),"%)"]})]})]},t))})]}),y.goalProgress.filter(e=>e.amountAdded.greaterThan(0)).length>0&&s.jsxs("div",{children:[s.jsxs("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:[s.jsx(c,{size:16}),"Goal Progress"]}),s.jsx("div",{className:"space-y-2",children:y.goalProgress.filter(e=>e.amountAdded.greaterThan(0)).map((e,t)=>s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.goalName}),s.jsxs("span",{className:"text-sm font-medium text-green-600 dark:text-green-400",children:["+",g(e.amountAdded)]})]},t))})]}),y.unusualTransactions.length>0&&s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:"Notable Transactions"}),s.jsx("div",{className:"space-y-2",children:y.unusualTransactions.map((e,t)=>s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:e.description}),s.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:g(e.amount)})]},t))})]})]}),s.jsxs("div",{className:"flex gap-3 mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[s.jsx("button",{onClick:()=>{const e=f.formatSummaryText(y,h(u));navigator.clipboard.writeText(e)},className:"flex-1 px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors text-sm",children:"Copy Summary"}),s.jsx("button",{onClick:()=>{f.saveSummary(y)},className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"Save to History"})]})]})}function t(){const{transactions:t,accounts:r,budgets:o,goals:l}=n(),{formatCurrency:c}=j(),[x,g]=a.useState("weekly"),[h,u]=a.useState(!1);a.useEffect(()=>{if(f.shouldGenerateSummary("weekly")){const e=f.generateWeeklySummary(t,r,o,l);f.saveSummary(e)}if(f.shouldGenerateSummary("monthly")){const e=f.generateMonthlySummary(t,r,o,l);f.saveSummary(e)}},[t,r,o,l]);const y=f.getSummaryHistory().filter(e=>e.period===x).sort((e,t)=>new Date(t.startDate).getTime()-new Date(e.startDate).getTime());return s.jsx(k,{title:"Financial Summaries",rightContent:s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("button",{onClick:()=>u(!h),className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors flex items-center gap-2",children:[s.jsx(m,{size:20}),h?"Hide":"Show"," History"]})}),children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex gap-2 bg-gray-100 dark:bg-gray-800 p-1 rounded-lg",children:[s.jsxs("button",{onClick:()=>g("weekly"),className:"flex-1 px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2 "+("weekly"===x?"bg-white dark:bg-gray-700 text-primary shadow":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:[s.jsx(i,{size:16}),"Weekly"]}),s.jsxs("button",{onClick:()=>g("monthly"),className:"flex-1 px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2 "+("monthly"===x?"bg-white dark:bg-gray-700 text-primary shadow":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:[s.jsx(i,{size:16}),"Monthly"]})]}),s.jsxs("div",{children:[s.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["Current ","weekly"===x?"Week":"Month"]}),s.jsx(e,{period:x})]}),h&&y.length>0&&s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Previous Summaries"}),s.jsx("div",{className:"space-y-4",children:y.map((e,t)=>s.jsxs("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white",children:[b(new Date(e.startDate),"MMM d")," - ",b(new Date(e.endDate),"MMM d, yyyy")]}),s.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["weekly"===e.period?"Weekly":"Monthly"," Summary"]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Net Income"}),s.jsx("p",{className:"text-lg font-bold "+(e.netIncome.greaterThanOrEqualTo(0)?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:c(e.netIncome)})]})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Income"}),s.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:c(e.totalIncome)})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Expenses"}),s.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:c(e.totalExpenses)})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Savings Rate"}),s.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[e.savingsRate.toFixed(1),"%"]})]})]})]},t))})]}),h&&0===y.length&&s.jsx("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-lg border border-white/20 dark:border-gray-700/50 p-12",children:s.jsxs("div",{className:"text-center",children:[s.jsx(d,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Historical Summaries"}),s.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"weekly"===x?"Weekly summaries will appear here as they are generated each Monday.":"Monthly summaries will appear here as they are generated on the 1st of each month."})]})})]})})}import{r as a,L as s}from"./chunk-Bcp2Zi4E.js";import{t as r,a as n,C as i,T as d,p as o,q as l,au as c,B as m}from"./index-LbveD3Go.js";import{n as x,o as g,q as h,h as u,e as y,s as p,f as b}from"./chunk-B5pcS96K.js";import{P as k}from"./chunk-zHRn0GaW.js";import{u as j}from"./chunk-BlSolNAr.js";import"./chunk-oUGr0aFc.js";import"./chunk-a7oqB5tI.js";const f=new class{STORAGE_KEY="financialSummaries";LAST_SUMMARY_KEY="lastSummaryGenerated";generateWeeklySummary(e,t,a,s,r=new Date){const n=x(r,{weekStartsOn:1}),i=g(r,{weekStartsOn:1}),d=x(h(r),{weekStartsOn:1}),o=g(h(r),{weekStartsOn:1});return this.generateSummary("weekly",n,i,d,o,e,t,a,s)}generateMonthlySummary(e,t,a,s,r=new Date){const n=u(r),i=y(r),d=u(p(r,1)),o=y(p(r,1));return this.generateSummary("monthly",n,i,d,o,e,t,a,s)}generateSummary(e,t,a,s,n,i,d,o,l){const c=i.filter(e=>{const s=new Date(e.date);return s>=t&&s<=a}),m=i.filter(e=>{const t=new Date(e.date);return t>=s&&t<=n}),x=c.filter(e=>"income"===e.type).reduce((e,t)=>e.plus(r(t.amount)),r(0)),g=c.filter(e=>"expense"===e.type).reduce((e,t)=>e.plus(r(t.amount)),r(0)),h=x.minus(g),u=m.filter(e=>"income"===e.type).reduce((e,t)=>e.plus(r(t.amount)),r(0)),y=m.filter(e=>"expense"===e.type).reduce((e,t)=>e.plus(r(t.amount)),r(0)),p=new Map;c.filter(e=>"expense"===e.type&&e.category).forEach(e=>{const t=p.get(e.category)||r(0);p.set(e.category,t.plus(r(e.amount)))});const k=Array.from(p.entries()).sort((e,t)=>t[1].minus(e[1]).toNumber()).slice(0,5).map(([e,t])=>({category:e,amount:t,percentage:g.greaterThan(0)?t.dividedBy(g).times(100).toNumber():0})),j=x.greaterThan(0)?h.dividedBy(x).times(100).toNumber():0,f=d.map(e=>{const t=c.filter(t=>t.accountId===e.id),a=t.filter(e=>"income"===e.type).reduce((e,t)=>e.plus(r(t.amount)),r(0)),s=t.filter(e=>"expense"===e.type).reduce((e,t)=>e.plus(r(t.amount)),r(0));return{accountName:e.name,balance:r(e.balance),change:a.minus(s)}}),N=o.map(e=>{const t=c.filter(t=>"expense"===t.type&&t.category===e.category).reduce((e,t)=>e.plus(r(t.amount)),r(0)),a=r(e.limit);return{budgetName:e.name,spent:t,limit:a,percentage:a.greaterThan(0)?t.dividedBy(a).times(100).toNumber():0}}),w=l.filter(e=>e.isActive).map(e=>{let t=r(0);e.linkedAccountIds&&e.linkedAccountIds.length>0&&e.linkedAccountIds.forEach(e=>{const a=f.find(t=>{const a=d.find(t=>t.id===e);return a&&t.accountName===a.name});a&&a.change.greaterThan(0)&&(t=t.plus(a.change))});const a=e.targetAmount>0?e.currentAmount/e.targetAmount*100:0;return{goalName:e.name,progress:a,amountAdded:t}}),v=g.dividedBy(Math.max(c.filter(e=>"expense"===e.type).length,1)).times(2),S=c.filter(e=>r(e.amount).greaterThan(v)||e.tags?.includes("unusual")).map(e=>({description:e.description,amount:r(e.amount),date:b(new Date(e.date),"dd MMM"),isHighAmount:r(e.amount).greaterThan(v)})).slice(0,5),M={incomeChange:u.greaterThan(0)?x.minus(u).dividedBy(u).times(100).toNumber():0,expenseChange:y.greaterThan(0)?g.minus(y).dividedBy(y).times(100).toNumber():0,savingsChange:u.greaterThan(0)?h.minus(u.minus(y)).dividedBy(u.minus(y).abs()).times(100).toNumber():0};return{period:e,startDate:t,endDate:a,totalIncome:x,totalExpenses:g,netIncome:h,topCategories:k,savingsRate:j,accountBalances:f,budgetPerformance:N,goalProgress:w,unusualTransactions:S,comparison:M}}saveSummary(e){try{const t=this.getSummaryHistory();t.push(e);const a="weekly"===e.period?52:12;t.length>a&&t.splice(0,t.length-a),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t)),localStorage.setItem(this.LAST_SUMMARY_KEY,(new Date).toISOString())}catch(t){console.error("Failed to save summary:",t)}}getSummaryHistory(){try{const e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):[]}catch{return[]}}shouldGenerateSummary(e){try{const t=localStorage.getItem(this.LAST_SUMMARY_KEY);if(!t)return!0;const a=new Date(t),s=new Date;return"weekly"===e?1===s.getDay()&&s.getDate()!==a.getDate():1===s.getDate()&&s.getMonth()!==a.getMonth()}catch{return!0}}formatSummaryText(e,t="\xa3"){const a="weekly"===e.period?"This Week":"This Month",s=`${b(e.startDate,"MMM d")} - ${b(e.endDate,"MMM d")}`;let r=`## ${a}'s Financial Summary\n`;r+=`### ${s}\n\n`,r+=`**Income:** ${t}${e.totalIncome.toFixed(2)}\n`,r+=`**Expenses:** ${t}${e.totalExpenses.toFixed(2)}\n`,r+=`**Net:** ${t}${e.netIncome.toFixed(2)}\n`,r+=`**Savings Rate:** ${e.savingsRate.toFixed(1)}%\n\n`,0===e.comparison.incomeChange&&0===e.comparison.expenseChange||(r+=`### Compared to Last ${"weekly"===e.period?"Week":"Month"}\n`,r+=`- Income: ${e.comparison.incomeChange>=0?"+":""}${e.comparison.incomeChange.toFixed(1)}%\n`,r+=`- Expenses: ${e.comparison.expenseChange>=0?"+":""}${e.comparison.expenseChange.toFixed(1)}%\n\n`),e.topCategories.length>0&&(r+="### Top Spending Categories\n",e.topCategories.forEach(e=>{r+=`- ${e.category}: ${t}${e.amount.toFixed(2)} (${e.percentage.toFixed(1)}%)\n`}),r+="\n");const n=e.budgetPerformance.filter(e=>e.percentage>100);n.length>0&&(r+="### \u26a0\ufe0f Over Budget\n",n.forEach(e=>{r+=`- ${e.budgetName}: ${t}${e.spent.toFixed(2)} / ${t}${e.limit.toFixed(2)} (${e.percentage.toFixed(0)}%)\n`}),r+="\n");const i=e.goalProgress.filter(e=>e.amountAdded.greaterThan(0));return i.length>0&&(r+="### Goal Progress\n",i.forEach(a=>{r+=`- ${a.goalName}: ${a.progress.toFixed(1)}% (+${t}${a.amountAdded.toFixed(2)} this ${"weekly"===e.period?"week":"month"})\n`})),r}};export{t as default};
