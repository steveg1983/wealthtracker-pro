function e({onSuccess:e,onError:n}){const[s,u]=t.useState(!1),[m,x]=t.useState(h.getConnections()),[y,g]=t.useState(new Set),{addAccount:p,addTransaction:b}=i(),j=t.useCallback(async()=>{u(!0);try{const n={public_token:`public-sandbox-${Date.now()}`,institution_id:"ins_1",institution_name:"Chase Bank",accounts:[{account_id:`acc-${Date.now()}-1`,balances:{available:2500,current:2600,iso_currency_code:"USD",limit:null,unofficial_currency_code:null},mask:"1234",name:"Checking",official_name:"Chase Total Checking",type:"depository",subtype:"checking"},{account_id:`acc-${Date.now()}-2`,balances:{available:15e3,current:15e3,iso_currency_code:"USD",limit:null,unofficial_currency_code:null},mask:"5678",name:"Savings",official_name:"Chase Savings",type:"depository",subtype:"savings"}]},t=await h.addConnection(n);(await h.syncAccounts(t.id)).forEach(e=>{p(e)}),x(h.getConnections()),e&&e()}catch(t){console.error("Failed to connect bank:",t),n&&n(t)}finally{u(!1)}},[p,e,n]),v=t.useCallback(async e=>{g(n=>new Set(n).add(e));try{(await h.syncAccounts(e)).forEach(e=>{p(e)});const n=new Date;n.setDate(n.getDate()-30),(await h.syncTransactions(e,n)).forEach(e=>{b(e)}),x(h.getConnections())}catch(n){console.error("Sync failed:",n),h.updateConnectionStatus(e,"error",n.message),x(h.getConnections())}finally{g(n=>{const t=new Set(n);return t.delete(e),t})}},[p,b]),k=t.useCallback(e=>{confirm("Are you sure you want to remove this bank connection? This will not delete the imported accounts or transactions.")&&(h.removeConnection(e),x(h.getConnections()))},[]);return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Connect Your Bank"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Securely connect your bank accounts to automatically import transactions and keep your balances up to date."}),a.jsxs("button",{onClick:j,disabled:s,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:[a.jsx(c,{size:20}),s?"Connecting...":"Connect Bank Account"]}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"Bank connections are secured with 256-bit encryption"})]}),m.length>0&&a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Connected Banks"}),a.jsx("div",{className:"space-y-4",children:m.map(e=>a.jsxs("div",{className:"flex items-center justify-between p-4 border dark:border-gray-700 rounded-lg",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h4",{className:"font-medium",children:e.institutionName}),"active"===e.status&&a.jsx(r,{size:16,className:"text-green-600"}),"error"===e.status&&a.jsx(o,{size:16,className:"text-red-600"})]}),a.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.accounts.length," accounts connected"]}),a.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500",children:["Last synced: ",e.lastSync.toLocaleString()]}),e.error&&a.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:["Error: ",e.error]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>v(e.id),disabled:y.has(e.id),className:"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-gray-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",title:"Sync accounts and transactions",children:a.jsx(l,{size:20,className:y.has(e.id)?"animate-spin":""})}),a.jsx("button",{onClick:()=>k(e.id),className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-gray-700 rounded-lg",title:"Remove connection",children:a.jsx(d,{size:20})})]})]},e.id))})]}),a.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-6",children:[a.jsx("h4",{className:"font-semibold text-blue-900 dark:text-blue-300 mb-2",children:"How It Works"}),a.jsxs("ul",{className:"space-y-2 text-sm text-blue-800 dark:text-blue-400",children:[a.jsx("li",{children:"\u2022 Your bank credentials are never stored in the app"}),a.jsx("li",{children:"\u2022 Connections are secured using bank-level encryption"}),a.jsx("li",{children:"\u2022 Transactions sync automatically every 24 hours"}),a.jsx("li",{children:"\u2022 You can manually sync anytime by clicking the refresh button"}),a.jsx("li",{children:"\u2022 Remove connections anytime without losing imported data"})]})]})]})}function n(){const[n,c]=t.useState(!0),[o,l]=t.useState("24"),{accounts:d}=i(),x=d.filter(e=>e.plaidConnectionId).length,y=h.getConnections().length;return a.jsxs(s,{title:"Open Banking",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[a.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Connected Banks"}),a.jsx("p",{className:"text-2xl font-bold",children:y})]}),a.jsx(u,{size:32,className:"text-blue-600"})]})}),a.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Synced Accounts"}),a.jsx("p",{className:"text-2xl font-bold",children:x})]}),a.jsx(r,{size:32,className:"text-green-600"})]})}),a.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Security Status"}),a.jsx("p",{className:"text-lg font-semibold text-green-600",children:"Secured"})]}),a.jsx(m,{size:32,className:"text-green-600"})]})})]}),a.jsx(e,{}),a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mt-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sync Settings"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("label",{className:"font-medium",children:"Automatic Sync"}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Automatically sync transactions from connected banks"})]}),a.jsx("button",{onClick:()=>{c(!n)},className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(n?"bg-blue-600":"bg-gray-300 dark:bg-gray-600"),children:a.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(n?"translate-x-6":"translate-x-1")})})]}),n&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Sync Frequency"}),a.jsxs("select",{value:o,onChange:e=>{l(e.target.value)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700",children:[a.jsx("option",{value:"6",children:"Every 6 hours"}),a.jsx("option",{value:"12",children:"Every 12 hours"}),a.jsx("option",{value:"24",children:"Daily"}),a.jsx("option",{value:"168",children:"Weekly"})]})]})]})]}),a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mt-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx(m,{size:24,className:"text-green-600"}),a.jsx("h3",{className:"text-lg font-semibold",children:"Bank-Level Security"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium mb-2",children:"Data Protection"}),a.jsxs("ul",{className:"space-y-1 text-sm text-gray-600 dark:text-gray-400",children:[a.jsx("li",{children:"\u2022 256-bit encryption for all data"}),a.jsx("li",{children:"\u2022 Read-only access to your accounts"}),a.jsx("li",{children:"\u2022 No access to move money"}),a.jsx("li",{children:"\u2022 Credentials never stored locally"})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium mb-2",children:"Privacy First"}),a.jsxs("ul",{className:"space-y-1 text-sm text-gray-600 dark:text-gray-400",children:[a.jsx("li",{children:"\u2022 Your data stays on your device"}),a.jsx("li",{children:"\u2022 No third-party data sharing"}),a.jsx("li",{children:"\u2022 Delete connections anytime"}),a.jsx("li",{children:"\u2022 Full control over your information"})]})]})]})]}),a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mt-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Supported Banks"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Connect to over 12,000 financial institutions across the US, Canada, and Europe."}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[a.jsx("div",{className:"font-medium",children:"Major Banks"}),a.jsx("div",{className:"font-medium",children:"Credit Unions"}),a.jsx("div",{className:"font-medium",children:"Investment Firms"}),a.jsx("div",{className:"font-medium",children:"Credit Cards"}),a.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Chase"}),a.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Navy Federal"}),a.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Vanguard"}),a.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"American Express"}),a.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Bank of America"}),a.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Alliant"}),a.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Fidelity"}),a.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Capital One"}),a.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Wells Fargo"}),a.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"PenFed"}),a.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Charles Schwab"}),a.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Discover"}),a.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Citi"}),a.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"BECU"}),a.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"E*TRADE"}),a.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"And 12,000+ more..."})]})]})]})}import{r as t,H as a}from"./chunk-DowOIOga.js";import{P as s}from"./chunk-r7IQz9KP.js";import{a as i,a$ as c,v as r,aa as o,ac as l,ao as d,bG as u,S as m}from"./index-qHm2isZb.js";import"./chunk-ddLY9KjI.js";import"./chunk-B5pcS96K.js";const h=new class{connections=[];storageKey="wealthtracker_plaid_connections";plaidEnv="sandbox";constructor(){this.loadConnections()}loadConnections(){try{const e=localStorage.getItem(this.storageKey);if(e){const n=JSON.parse(e);this.connections=n.map(e=>{const{accessToken:n,...t}=e;return{...t,lastSync:new Date(e.lastSync)}})}}catch(e){console.error("Failed to load Plaid connections:",e),this.connections=[]}}saveConnections(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.connections))}catch(e){console.error("Failed to save Plaid connections:",e)}}async createLinkToken(e){return{link_token:`link-${this.plaidEnv}-${Date.now()}`,expiration:new Date(Date.now()+18e5).toISOString()}}async exchangePublicToken(e){return{access_token:`access-${this.plaidEnv}-${Date.now()}`,item_id:`item-${Date.now()}`}}async addConnection(e){const{access_token:n,item_id:t}=await this.exchangePublicToken(e.public_token),a={id:`conn-${Date.now()}`,institutionId:e.institution_id,institutionName:e.institution_name,itemId:t,lastSync:new Date,accounts:e.accounts.map(e=>e.account_id),status:"active",isDevelopment:"production"!==this.plaidEnv};return this.connections.push(a),this.saveConnections(),"production"===this.plaidEnv&&await this.sendTokenToBackend(n,t),a}getConnections(){return[...this.connections]}removeConnection(e){const n=this.connections.findIndex(n=>n.id===e);return-1!==n&&(this.connections.splice(n,1),this.saveConnections(),!0)}async syncAccounts(e){const n=this.connections.find(n=>n.id===e);if(!n)throw new Error("Connection not found");const t=[{account_id:`${n.institutionId}-checking-${Date.now()}`,balances:{available:2500,current:2600,iso_currency_code:"USD",limit:null,unofficial_currency_code:null},mask:"1234",name:"Checking Account",official_name:"Personal Checking",type:"depository",subtype:"checking"},{account_id:`${n.institutionId}-savings-${Date.now()}`,balances:{available:1e4,current:1e4,iso_currency_code:"USD",limit:null,unofficial_currency_code:null},mask:"5678",name:"Savings Account",official_name:"High Yield Savings",type:"depository",subtype:"savings"}].map(n=>({id:n.account_id,name:n.official_name||n.name,type:this.mapPlaidAccountType(n.type,n.subtype),balance:n.balances.current||0,currency:n.balances.iso_currency_code||"USD",isActive:!0,lastUpdated:new Date,plaidConnectionId:e,plaidAccountId:n.account_id,mask:n.mask}));return n.lastSync=new Date,n.status="active",this.saveConnections(),t}mapPlaidAccountType(e,n){return"depository"===e?"checking"===n?"checking":"savings":"credit"===e?"credit":"loan"===e?"loan":"investment"===e?"investment":"other"}async syncTransactions(e,n,t=new Date){const a=this.connections.find(n=>n.id===e);if(!a)throw new Error("Connection not found");return[{account_id:a.accounts[0],amount:42.5,iso_currency_code:"USD",unofficial_currency_code:null,category:["Food and Drink","Restaurants"],category_id:"13005000",date:new Date(Date.now()-1728e5).toISOString().split("T")[0],datetime:null,authorized_date:null,authorized_datetime:null,location:{address:"123 Main St",city:"New York",region:"NY",postal_code:"10001",country:"US",lat:40.7128,lon:-74.006,store_number:null},name:"STARBUCKS",merchant_name:"Starbucks",payment_meta:{by_order_of:null,payee:null,payer:null,payment_method:null,payment_processor:null,ppd_id:null,reason:null,reference_number:null},payment_channel:"in store",pending:!1,pending_transaction_id:null,account_owner:null,transaction_id:`txn-${Date.now()}-1`,transaction_code:null,transaction_type:"place"},{account_id:a.accounts[0],amount:1200,iso_currency_code:"USD",unofficial_currency_code:null,category:["Transfer","Deposit"],category_id:"21007000",date:new Date(Date.now()-432e6).toISOString().split("T")[0],datetime:null,authorized_date:null,authorized_datetime:null,location:{address:null,city:null,region:null,postal_code:null,country:null,lat:null,lon:null,store_number:null},name:"EMPLOYER DIRECT DEPOSIT",merchant_name:null,payment_meta:{by_order_of:null,payee:null,payer:"EMPLOYER INC",payment_method:"ACH",payment_processor:null,ppd_id:null,reason:"PAYROLL",reference_number:null},payment_channel:"online",pending:!1,pending_transaction_id:null,account_owner:null,transaction_id:`txn-${Date.now()}-2`,transaction_code:null,transaction_type:"digital"}].map(e=>({id:e.transaction_id,accountId:e.account_id,date:new Date(e.date),description:e.merchant_name||e.name,amount:-e.amount,category:this.mapPlaidCategory(e.category),pending:e.pending,plaidTransactionId:e.transaction_id,merchant:e.merchant_name||void 0,paymentChannel:e.payment_channel,location:e.location.city?{city:e.location.city,region:e.location.region,country:e.location.country}:void 0}))}mapPlaidCategory(e){const n={"Food and Drink":"Dining",Restaurants:"Dining",Groceries:"Groceries",Transportation:"Transportation",Travel:"Travel",Shopping:"Shopping","Bills & Utilities":"Utilities",Healthcare:"Healthcare",Entertainment:"Entertainment",Transfer:"Transfer",Deposit:"Income",Withdrawal:"Other"};for(const t of e)if(n[t])return n[t];return"Other"}async getInstitution(e){return{institution_id:e,name:"Example Bank",products:["accounts","transactions","identity","investments"],country_codes:["US"],url:"https://example-bank.com",primary_color:"#0066CC",logo:null}}updateConnectionStatus(e,n,t){const a=this.connections.find(n=>n.id===e);a&&(a.status=n,a.error=t,this.saveConnections())}hasActiveConnections(){return this.connections.some(e=>"active"===e.status)}getConnectionAccounts(e){const n=this.connections.find(n=>n.id===e);return n?n.accounts:[]}async sendTokenToBackend(e,n){}async makeAuthenticatedCall(e,n){if("production"===this.plaidEnv)throw new Error("Production API calls must go through backend");return{}}};export{n as default};
