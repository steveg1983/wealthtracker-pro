const n=new class{connections=[];plaidConfig={};trueLayerConfig={};constructor(){this.loadConnections(),this.loadConfig()}initialize(n){n.plaid&&(this.plaidConfig=n.plaid),n.trueLayer&&(this.trueLayerConfig=n.trueLayer),this.saveConfig()}async getInstitutions(n="GB"){return[{id:"barclays",name:"Barclays",country:"GB",provider:"truelayer",supportsAccountDetails:!0,supportsTransactions:!0,supportsBalance:!0},{id:"hsbc",name:"HSBC",country:"GB",provider:"truelayer",supportsAccountDetails:!0,supportsTransactions:!0,supportsBalance:!0},{id:"lloyds",name:"Lloyds Bank",country:"GB",provider:"truelayer",supportsAccountDetails:!0,supportsTransactions:!0,supportsBalance:!0},{id:"natwest",name:"NatWest",country:"GB",provider:"truelayer",supportsAccountDetails:!0,supportsTransactions:!0,supportsBalance:!0},{id:"revolut",name:"Revolut",country:"GB",provider:"truelayer",supportsAccountDetails:!0,supportsTransactions:!0,supportsBalance:!0},{id:"monzo",name:"Monzo",country:"GB",provider:"truelayer",supportsAccountDetails:!0,supportsTransactions:!0,supportsBalance:!0}]}async connectBank(n,t){return"truelayer"===t?{url:`https://auth.truelayer.com/?response_type=code&client_id=${this.trueLayerConfig.clientId||"demo"}&scope=info%20accounts%20balance%20transactions&redirect_uri=${encodeURIComponent(this.trueLayerConfig.redirectUri||window.location.origin+"/auth/callback")}&providers=${n}`}:{linkToken:"link-sandbox-demo-token"}}async handleOAuthCallback(n,t){const e={id:`conn_${Date.now()}`,provider:"truelayer",institutionId:"demo-bank",institutionName:"Demo Bank",status:"connected",lastSync:new Date,accounts:[],createdAt:new Date,expiresAt:new Date(Date.now()+7776e6)};return this.connections.push(e),this.saveConnections(),e}async syncConnection(n){const t=this.connections.find(t=>t.id===n);if(!t)return{success:!1,accountsUpdated:0,transactionsImported:0,errors:["Connection not found"]};try{return t.lastSync=new Date,t.status="connected",this.saveConnections(),{success:!0,accountsUpdated:t.accounts.length,transactionsImported:0,errors:[]}}catch(e){return t.status="error",t.error=e instanceof Error?e.message:"Unknown error",this.saveConnections(),{success:!1,accountsUpdated:0,transactionsImported:0,errors:[t.error]}}}async syncAll(){const n=new Map;for(const t of this.connections)if("connected"===t.status){const e=await this.syncConnection(t.id);n.set(t.id,e)}return n}async disconnect(n){const t=this.connections.findIndex(t=>t.id===n);return-1!==t&&(this.connections.splice(t,1),this.saveConnections(),!0)}getConnections(){return this.connections}getConnection(n){return this.connections.find(t=>t.id===n)}needsReauth(){return this.connections.filter(n=>"reauth_required"===n.status||n.expiresAt&&new Date(n.expiresAt)<new Date)}linkAccount(n,t,e){const o=this.connections.find(t=>t.id===n);o&&!o.accounts.includes(e)&&(o.accounts.push(e),this.saveConnections())}isConfigured(){return!!(this.plaidConfig.clientId&&this.plaidConfig.secret||this.trueLayerConfig.clientId&&this.trueLayerConfig.clientSecret)}getConfigStatus(){return{plaid:!(!this.plaidConfig.clientId||!this.plaidConfig.secret),trueLayer:!(!this.trueLayerConfig.clientId||!this.trueLayerConfig.clientSecret)}}loadConnections(){try{const n=localStorage.getItem("bankConnections");n&&(this.connections=JSON.parse(n))}catch(n){console.error("Failed to load bank connections:",n),this.connections=[]}}saveConnections(){try{localStorage.setItem("bankConnections",JSON.stringify(this.connections))}catch(n){console.error("Failed to save bank connections:",n)}}loadConfig(){try{const n=localStorage.getItem("bankAPIConfig");if(n){const t=JSON.parse(n);this.plaidConfig=t.plaid||{},this.trueLayerConfig=t.trueLayer||{}}}catch(n){console.error("Failed to load bank API config:",n)}}saveConfig(){try{const n={plaid:this.plaidConfig,trueLayer:this.trueLayerConfig};localStorage.setItem("bankAPIConfig",JSON.stringify(n))}catch(n){console.error("Failed to save bank API config:",n)}}};export{n as b};
