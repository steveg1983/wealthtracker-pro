function e({isOpen:e,onClose:b}){const{transactions:f,accounts:N,budgets:w,categories:j}=o(),{getCurrencySymbol:k,displayCurrency:D}=y(),C=k(D),[v,A]=a.useState(!1),[T,_]=a.useState({transactions:!0,accounts:!0,budgets:!0,categories:!0,summary:!0,dateRange:{start:new Date((new Date).getFullYear(),(new Date).getMonth(),1),end:new Date},groupBy:"none",includeCharts:!1,formatting:{currencyFormat:`${C}#,##0.00`,dateFormat:"dd/mm/yyyy",highlightNegative:!0,zebra:!0,autoFilter:!0}}),S=e=>T.dateRange.start&&T.dateRange.end?e.filter(e=>{const t=e.date instanceof Date?e.date:new Date(e.date);return t>=T.dateRange.start&&t<=T.dateRange.end}):e;return n.jsx(r,{isOpen:e,onClose:b,title:"Export to Excel",size:"lg",children:n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsxs("h3",{className:"text-lg font-medium mb-3 flex items-center gap-2",children:[n.jsx(s,{size:20}),"Select Data to Export"]}),n.jsx("div",{className:"space-y-2",children:[{key:"transactions",label:"Transactions",icon:n.jsx(c,{})},{key:"accounts",label:"Accounts",icon:n.jsx(i,{})},{key:"budgets",label:"Budgets",icon:n.jsx(l,{})},{key:"categories",label:"Categories",icon:n.jsx(u,{})},{key:"summary",label:"Summary Report",icon:n.jsx(d,{})}].map(({key:e,label:t,icon:a})=>n.jsxs("label",{className:"flex items-center gap-3 p-2 rounded hover:bg-gray-50 \n                                          dark:hover:bg-gray-800 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:T[e],onChange:t=>_({...T,[e]:t.target.checked}),className:"rounded"}),n.jsxs("span",{className:"flex items-center gap-2",children:[a,t]})]},e))})]}),n.jsxs("div",{children:[n.jsxs("h3",{className:"text-lg font-medium mb-3 flex items-center gap-2",children:[n.jsx(g,{size:20}),"Date Range (for transactions)"]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-1",children:"Start Date"}),n.jsx("input",{type:"date",value:T.dateRange.start?.toISOString().split("T")[0]||"",onChange:e=>_({...T,dateRange:{...T.dateRange,start:e.target.value?new Date(e.target.value):null}}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg\n                           bg-white dark:bg-gray-800"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-1",children:"End Date"}),n.jsx("input",{type:"date",value:T.dateRange.end?.toISOString().split("T")[0]||"",onChange:e=>_({...T,dateRange:{...T.dateRange,end:e.target.value?new Date(e.target.value):null}}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg\n                           bg-white dark:bg-gray-800"})]})]})]}),n.jsxs("div",{children:[n.jsxs("h3",{className:"text-lg font-medium mb-3 flex items-center gap-2",children:[n.jsx(m,{size:20}),"Transaction Grouping"]}),n.jsxs("select",{value:T.groupBy,onChange:e=>_({...T,groupBy:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg\n                       bg-white dark:bg-gray-800",children:[n.jsx("option",{value:"none",children:"No Grouping"}),n.jsx("option",{value:"month",children:"Group by Month"}),n.jsx("option",{value:"category",children:"Group by Category"}),n.jsx("option",{value:"account",children:"Group by Account"})]})]}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-medium mb-3",children:"Formatting Options"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("label",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",checked:T.formatting.highlightNegative,onChange:e=>_({...T,formatting:{...T.formatting,highlightNegative:e.target.checked}}),className:"rounded"}),n.jsx("span",{className:"text-sm",children:"Highlight negative values"})]}),n.jsxs("label",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",checked:T.formatting.zebra,onChange:e=>_({...T,formatting:{...T.formatting,zebra:e.target.checked}}),className:"rounded"}),n.jsx("span",{className:"text-sm",children:"Zebra striping"})]}),n.jsxs("label",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",checked:T.formatting.autoFilter,onChange:e=>_({...T,formatting:{...T.formatting,autoFilter:e.target.checked}}),className:"rounded"}),n.jsx("span",{className:"text-sm",children:"Enable auto-filters"})]})]})]})]}),n.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[n.jsx("button",{onClick:b,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 \n                     dark:hover:bg-gray-700 rounded-lg",children:"Cancel"}),n.jsxs("button",{onClick:async()=>{try{x||(A(!0),x=await t(()=>import("./xlsx-CngQiIXK.js"),[]));const e=(()=>{if(!x)throw new Error("XLSX not loaded");const e=x.utils.book_new();if(T.summary){const t=(()=>{const e=S(f),t=e.filter(e=>"income"===e.type).reduce((e,t)=>e+h(t.amount).toNumber(),0),a=e.filter(e=>"expense"===e.type).reduce((e,t)=>e+h(t.amount).toNumber(),0),n=j.map(t=>{const a=e.filter(e=>e.category===t.name),n=a.filter(e=>"income"===e.type).reduce((e,t)=>e+h(t.amount).toNumber(),0),o=a.filter(e=>"expense"===e.type).reduce((e,t)=>e+h(t.amount).toNumber(),0);return{Category:t.name,Income:n,Expenses:o,Net:n-o,"Transaction Count":a.length}}),o=N.map(e=>({"Account Name":e.name,Type:e.type,Balance:h(e.balance).toNumber(),Currency:e.currency,Institution:e.institution||""}));return{overview:[{Metric:"Total Income",Value:t},{Metric:"Total Expenses",Value:a},{Metric:"Net Income",Value:t-a},{Metric:"Transaction Count",Value:e.length},{Metric:"Date Range",Value:`${T.dateRange.start?.toLocaleDateString()} - ${T.dateRange.end?.toLocaleDateString()}`}],categoryBreakdown:n,accountSummary:o}})(),a=x.utils.json_to_sheet(t.overview);x.utils.sheet_add_json(a,t.categoryBreakdown,{origin:"A8"}),x.utils.sheet_add_json(a,t.accountSummary,{origin:"A"+(8+t.categoryBreakdown.length+2)}),T.formatting.autoFilter&&(a["!autofilter"]={ref:"A8:E"+(8+t.categoryBreakdown.length-1)}),x.utils.book_append_sheet(e,a,"Summary")}if(T.transactions){const t=S(f);let a=[];if("month"===T.groupBy){const e=t.reduce((e,t)=>{const a=t.date instanceof Date?t.date:new Date(t.date),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`;return e[n]||(e[n]=[]),e[n].push(t),e},{});Object.entries(e).sort().forEach(([e,t])=>{a.push({Date:e,Description:"MONTH TOTAL",Category:"",Type:"",Amount:"",Account:""}),t.forEach(e=>{const t=e.date instanceof Date?e.date:new Date(e.date);a.push({Date:t.toLocaleDateString(),Description:e.description,Category:e.category,Type:e.type,Amount:"expense"===e.type?-h(e.amount).toNumber():h(e.amount).toNumber(),Account:N.find(t=>t.id===e.accountId)?.name||"Unknown",Tags:e.tags?.join(", ")||"",Notes:e.notes||"",Cleared:e.cleared?"Yes":"No"})});const n=t.reduce((e,t)=>e+("expense"===t.type?-h(t.amount).toNumber():h(t.amount).toNumber()),0);a.push({Date:"",Description:"Subtotal",Category:"",Type:"",Amount:n,Account:""}),a.push({Date:"",Description:"",Category:"",Type:"",Amount:"",Account:""})})}else if("category"===T.groupBy){const e=t.reduce((e,t)=>(e[t.category]||(e[t.category]=[]),e[t.category].push(t),e),{});Object.entries(e).sort().forEach(([e,t])=>{a.push({Date:"",Description:`CATEGORY: ${e}`,Category:"",Type:"",Amount:"",Account:""}),t.forEach(e=>{const t=e.date instanceof Date?e.date:new Date(e.date);a.push({Date:t.toLocaleDateString(),Description:e.description,Category:e.category,Type:e.type,Amount:"expense"===e.type?-h(e.amount).toNumber():h(e.amount).toNumber(),Account:N.find(t=>t.id===e.accountId)?.name||"Unknown",Tags:e.tags?.join(", ")||"",Notes:e.notes||"",Cleared:e.cleared?"Yes":"No"})});const n=t.reduce((e,t)=>e+("expense"===t.type?-h(t.amount).toNumber():h(t.amount).toNumber()),0);a.push({Date:"",Description:"Subtotal",Category:"",Type:"",Amount:n,Account:""}),a.push({Date:"",Description:"",Category:"",Type:"",Amount:"",Account:""})})}else a=t.map(e=>({Date:(e.date instanceof Date?e.date:new Date(e.date)).toLocaleDateString(),Description:e.description,Category:e.category,Type:e.type,Amount:"expense"===e.type?-h(e.amount).toNumber():h(e.amount).toNumber(),Account:N.find(t=>t.id===e.accountId)?.name||"Unknown",Tags:e.tags?.join(", ")||"",Notes:e.notes||"",Cleared:e.cleared?"Yes":"No"}));const n=x.utils.json_to_sheet(a);n["!cols"]=[{wch:12},{wch:30},{wch:15},{wch:10},{wch:12},{wch:20},{wch:20},{wch:30},{wch:8}],T.formatting.autoFilter&&a.length>0&&(n["!autofilter"]={ref:`A1:I${a.length}`}),x.utils.book_append_sheet(e,n,"Transactions")}if(T.accounts){const t=N.map(e=>{const t=f.filter(t=>t.accountId===e.id),a=t.filter(e=>"income"===e.type).reduce((e,t)=>e+h(t.amount).toNumber(),0),n=t.filter(e=>"expense"===e.type).reduce((e,t)=>e+h(t.amount).toNumber(),0);return{Name:e.name,Type:e.type,Balance:h(e.balance).toNumber(),Currency:e.currency,Institution:e.institution||"","Total Income":a,"Total Expenses":n,"Net Change":a-n,"Transaction Count":t.length,"Last Updated":(e.lastUpdated instanceof Date?e.lastUpdated:new Date(e.lastUpdated)).toLocaleDateString()}}),a=x.utils.json_to_sheet(t);a["!cols"]=[{wch:20},{wch:12},{wch:15},{wch:10},{wch:20},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15}],T.formatting.autoFilter&&(a["!autofilter"]={ref:`A1:J${t.length}`}),x.utils.book_append_sheet(e,a,"Accounts")}if(T.budgets){const t=w.map(e=>{const t=f.filter(t=>{const a=t.date instanceof Date?t.date:new Date(t.date);return"expense"===t.type&&t.category===e.category&&a.getMonth()===(new Date).getMonth()&&a.getFullYear()===(new Date).getFullYear()}).reduce((e,t)=>e+h(t.amount).toNumber(),0),a=h(e.amount).toNumber()-t,n=h(e.amount).toNumber()>0?t/h(e.amount).toNumber()*100:0;return{Category:e.category,"Budget Amount":h(e.amount).toNumber(),Spent:t,Remaining:a,"% Used":n.toFixed(1)+"%",Status:a<0?"Over Budget":n>80?"Warning":"On Track"}}),a=x.utils.json_to_sheet(t);a["!cols"]=[{wch:20},{wch:15},{wch:15},{wch:15},{wch:10},{wch:12}],T.formatting.autoFilter&&(a["!autofilter"]={ref:`A1:F${t.length}`}),x.utils.book_append_sheet(e,a,"Budgets")}if(T.categories){const t=j.map(e=>{const t=f.filter(t=>t.category===e.name),a=t.filter(e=>"income"===e.type).reduce((e,t)=>e+h(t.amount).toNumber(),0),n=t.filter(e=>"expense"===e.type).reduce((e,t)=>e+h(t.amount).toNumber(),0),o=w.find(t=>t.category===e.name);return{Name:e.name,Icon:e.icon,Color:e.color,"Total Income":a,"Total Expenses":n,"Net Amount":a-n,"Transaction Count":t.length,"Budget Amount":o?h(o.amount).toNumber():0,"Budget vs Actual":o?n-h(o.amount).toNumber():0}}),a=x.utils.json_to_sheet(t);a["!cols"]=[{wch:20},{wch:10},{wch:10},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15}],T.formatting.autoFilter&&(a["!autofilter"]={ref:`A1:I${t.length}`}),x.utils.book_append_sheet(e,a,"Categories")}return e})(),a=`wealth-tracker-export-${(new Date).toISOString().split("T")[0]}.xlsx`;x.writeFile(e,a),b()}catch(e){console.error("Failed to export Excel file:",e),alert("Failed to export Excel file. Please try again.")}finally{A(!1)}},disabled:!Object.values(T).slice(0,5).some(e=>!0===e)||v,className:"flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg\n                     hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed",children:[n.jsx(p,{size:20}),v?"Loading...":"Export to Excel"]})]})]})})}import{_ as t}from"./chunk-ddLY9KjI.js";import{r as a,H as n}from"./chunk-DowOIOga.js";import{a as o,M as r,aH as s,bk as c,m as i,q as l,k as u,B as d,C as g,r as m,ay as p,t as h}from"./index-qHm2isZb.js";import{u as y}from"./chunk-ByFoKVyi.js";import"./chunk-B5pcS96K.js";let x=null;export{e as default};
