function e({currentTier:e="free",onSelectPlan:t,showFreePlan:r=!0,className:s=""}){n();const[a,i]=P.useState("month"),[g,u]=P.useState(null),h=l.getSubscriptionPlans(),b=r?h:h.filter(e=>"free"!==e.tier),p=t=>"free"===t.tier?"free"===e?"Current Plan":"Downgrade to Free":t.tier===e?"Current Plan":l.isUpgrade(e,t.tier)?"Upgrade":"Change Plan",y=t=>t.tier===e?"bg-gray-100 text-gray-500 cursor-not-allowed":t.isPopular?"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:from-blue-700 hover:to-purple-700":"bg-white text-gray-900 border border-gray-300 hover:bg-gray-50",j=e=>{const t=12*e*.8;return l.formatPrice(t)},N=e=>{const t=12*e-12*e*.8;return l.formatPrice(t)};return d.jsxs("div",{className:`max-w-7xl mx-auto ${s}`,children:[d.jsxs("div",{className:"text-center mb-12",children:[d.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:"Choose Your Plan"}),d.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400 mb-8",children:"Select the perfect plan for your financial management needs"}),d.jsxs("div",{className:"inline-flex items-center bg-gray-100 dark:bg-gray-800 rounded-lg p-1",children:[d.jsx("button",{onClick:()=>i("month"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors "+("month"===a?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:"Monthly"}),d.jsxs("button",{onClick:()=>i("year"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors "+("year"===a?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:[d.jsx("span",{children:"Yearly"}),d.jsx("span",{className:"ml-2 text-xs bg-green-100 text-green-800 px-2 py-0.5 rounded-full",children:"Save 20%"})]})]})]}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 lg:gap-12",children:b.map(r=>{return d.jsxs("div",{className:`relative rounded-2xl border-2 transition-all duration-200 ${r.isPopular?"border-blue-500 bg-blue-50 dark:bg-blue-900/10 scale-105":"border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"} ${r.tier===e?"ring-2 ring-green-500":""}`,children:[r.isPopular&&d.jsx("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2",children:d.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-medium flex items-center gap-1",children:[d.jsx(c,{size:14}),"Most Popular"]})}),r.tier===e&&d.jsx("div",{className:"absolute -top-4 right-4",children:d.jsxs("div",{className:"bg-green-500 text-white px-3 py-1 rounded-full text-sm font-medium flex items-center gap-1",children:[d.jsx(o,{size:14}),"Current"]})}),d.jsxs("div",{className:"p-8",children:[d.jsxs("div",{className:"text-center mb-8",children:[d.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:r.name}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:r.description}),d.jsx("div",{className:"mb-6",children:0===r.price?d.jsx("div",{className:"text-4xl font-bold text-gray-900 dark:text-white",children:"Free"}):d.jsxs("div",{children:[d.jsxs("div",{className:"text-4xl font-bold text-gray-900 dark:text-white",children:["month"===a?(s=r.price,0===s?"Free":l.formatPrice(s)):j(r.price),d.jsxs("span",{className:"text-lg font-normal text-gray-600 dark:text-gray-400",children:["/","month"===a?"month":"year"]})]}),"year"===a&&d.jsxs("div",{className:"text-sm text-green-600 dark:text-green-400 mt-1",children:["Save ",N(r.price)," per year"]})]})}),d.jsx("button",{onClick:()=>(async r=>{if(r.tier!==e&&"free"!==r.tier){u(r.id);try{await t(r)}catch(s){console.error("Error selecting plan:",s)}finally{u(null)}}})(r),disabled:r.tier===e||g===r.id,className:`w-full py-3 px-6 rounded-lg font-medium transition-all duration-200 flex items-center justify-center gap-2 ${y(r)}`,children:g===r.id?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Processing..."]}):d.jsxs(d.Fragment,{children:["free"===r.tier&&d.jsx(c,{size:16}),"free"!==r.tier&&r.tier!==e&&d.jsx(x,{size:16}),p(r),r.tier!==e&&d.jsx(m,{size:16})]})})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white text-center",children:"What's included:"}),d.jsx("ul",{className:"space-y-3",children:r.features.map((e,t)=>d.jsxs("li",{className:"flex items-start gap-3",children:[d.jsx(o,{size:16,className:"text-green-500 mt-0.5 flex-shrink-0"}),d.jsx("span",{className:"text-gray-700 dark:text-gray-300 text-sm",children:e})]},t))}),"free"===r.tier&&d.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[d.jsx("h5",{className:"font-medium text-gray-900 dark:text-white mb-3 text-sm",children:"Usage Limits:"}),d.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:r.maxAccounts}),d.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Accounts"})]}),d.jsxs("div",{className:"text-center",children:[d.jsxs("div",{className:"font-semibold text-gray-900 dark:text-white",children:[r.maxTransactions,"/mo"]}),d.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Transactions"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:r.maxBudgets}),d.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Budgets"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:r.maxGoals}),d.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Goals"})]})]})]})]})]})]},r.id);var s})}),d.jsx("div",{className:"mt-16 text-center",children:d.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-8",children:[d.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Need help choosing?"}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6 max-w-2xl mx-auto",children:"Start with our free plan and upgrade anytime as your needs grow. All paid plans include a 14-day free trial with full access to premium features."}),d.jsxs("div",{className:"flex flex-wrap justify-center gap-6 text-sm text-gray-600 dark:text-gray-400",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(o,{size:16,className:"text-green-500"}),"Cancel anytime"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(o,{size:16,className:"text-green-500"}),"14-day free trial"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(o,{size:16,className:"text-green-500"}),"Secure payments"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(o,{size:16,className:"text-green-500"}),"Data export anytime"]})]})]})})]})}function t({className:e=""}){n();const[t,r]=P.useState(null),[s,a]=P.useState(null),[i,c]=P.useState(!0),[o,m]=P.useState(null),[N,f]=P.useState(!1),[k,v]=P.useState(!1),[w,S]=P.useState(!1);P.useEffect(()=>{C()},[]);const C=async()=>{c(!0),m(null);try{const[e,t]=await Promise.all([l.getCurrentSubscription(),l.getBillingHistory()]);r(e),a(t)}catch(e){console.error("Error loading billing data:",e),m("Failed to load billing information")}finally{c(!1)}},z=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return i?d.jsx("div",{className:`flex items-center justify-center py-12 ${e}`,children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-8 h-8 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading billing information..."})]})}):o?d.jsx("div",{className:`bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6 ${e}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(g,{size:20,className:"text-red-600 dark:text-red-400"}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-red-800 dark:text-red-200 font-medium",children:"Error Loading Billing Information"}),d.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm mt-1",children:o}),d.jsx("button",{onClick:C,className:"text-red-800 dark:text-red-200 underline text-sm mt-2 hover:no-underline",children:"Try again"})]})]})}):d.jsxs("div",{className:`space-y-8 ${e}`,children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Billing & Subscription"}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Manage your subscription and billing information"})]}),d.jsxs("button",{onClick:async()=>{try{const e=await l.createPortalSession();window.open(e,"_blank")}catch(e){console.error("Error creating portal session:",e),m("Failed to open billing portal")}},className:"flex items-center gap-2 px-4 py-2 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:[d.jsx(u,{size:16}),"Manage Billing",d.jsx(h,{size:14})]})]}),d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[d.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6 flex items-center gap-2",children:[d.jsx(x,{size:20}),"Current Subscription"]}),t?d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Plan"}),d.jsx("p",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:(e=>{const t=l.getPlanByTier(e);return t?.name||e})(t.tier)})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Status"}),d.jsx("div",{children:(e=>{const t={active:{color:"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200",icon:b},trialing:{color:"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-200",icon:b},past_due:{color:"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200",icon:g},cancelled:{color:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200",icon:g}},r=t[e]||t.cancelled,s=r.icon;return d.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${r.color}`,children:[d.jsx(s,{size:12}),e.replace("_"," ")]})})(t.status)})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"trialing"===t.status?"Trial ends":"Next billing"}),d.jsx("p",{className:"text-lg font-medium text-gray-900 dark:text-white",children:t.currentPeriodEnd?z(t.currentPeriodEnd):"N/A"})]})]}),"trialing"===t.status&&t.trialEnd&&d.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx(b,{size:20,className:"text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),d.jsxs("div",{children:[d.jsx("h4",{className:"text-blue-900 dark:text-blue-300 font-medium",children:"Free Trial Active"}),d.jsxs("p",{className:"text-blue-800 dark:text-blue-200 text-sm mt-1",children:["Your trial ends on ",z(t.trialEnd),". Your subscription will automatically continue unless you cancel."]})]})]})}),t.cancelAtPeriodEnd&&d.jsx("div",{className:"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx(g,{size:20,className:"text-orange-600 dark:text-orange-400 flex-shrink-0 mt-0.5"}),d.jsxs("div",{children:[d.jsx("h4",{className:"text-orange-900 dark:text-orange-300 font-medium",children:"Subscription Ending"}),d.jsxs("p",{className:"text-orange-800 dark:text-orange-200 text-sm mt-1",children:["Your subscription will end on ",t.currentPeriodEnd?z(t.currentPeriodEnd):"the next billing date",". You'll still have access until then."]})]})]})}),d.jsxs("div",{className:"flex flex-wrap gap-3",children:[d.jsx("button",{onClick:()=>v(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Change Plan"}),!t.cancelAtPeriodEnd&&d.jsx("button",{onClick:()=>f(!0),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Cancel Subscription"})]})]}):d.jsxs("div",{className:"text-center py-8",children:[d.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"You're currently on the free plan"}),d.jsx("button",{onClick:()=>v(!0),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Upgrade to Premium"})]})]}),s?.paymentMethods&&s.paymentMethods.length>0&&d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:"Payment Methods"}),d.jsx("div",{className:"space-y-3",children:s.paymentMethods.map(e=>d.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(x,{size:20,className:"text-gray-600 dark:text-gray-400"}),d.jsxs("div",{children:[d.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:["\u2022\u2022\u2022\u2022 \u2022\u2022\u2022\u2022 \u2022\u2022\u2022\u2022 ",e.last4]}),d.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.brand.toUpperCase()," \u2022 Expires ",e.expiryMonth,"/",e.expiryYear]})]}),e.isDefault&&d.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:"Default"})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("button",{className:"p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:d.jsx(p,{size:16})}),d.jsx("button",{className:"p-2 text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300",children:d.jsx(y,{size:16})})]})]},e.id))})]}),s?.invoices&&s.invoices.length>0&&d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:"Billing History"}),d.jsx("div",{className:"overflow-x-auto",children:d.jsxs("table",{className:"w-full",children:[d.jsx("thead",{className:"border-b border-gray-200 dark:border-gray-700",children:d.jsxs("tr",{children:[d.jsx("th",{className:"text-left py-3 text-sm font-medium text-gray-600 dark:text-gray-400",children:"Date"}),d.jsx("th",{className:"text-left py-3 text-sm font-medium text-gray-600 dark:text-gray-400",children:"Description"}),d.jsx("th",{className:"text-left py-3 text-sm font-medium text-gray-600 dark:text-gray-400",children:"Amount"}),d.jsx("th",{className:"text-left py-3 text-sm font-medium text-gray-600 dark:text-gray-400",children:"Status"}),d.jsx("th",{className:"text-right py-3 text-sm font-medium text-gray-600 dark:text-gray-400",children:"Download"})]})}),d.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:s.invoices.map(e=>{return d.jsxs("tr",{children:[d.jsx("td",{className:"py-4 text-sm text-gray-900 dark:text-white",children:z(e.createdAt)}),d.jsx("td",{className:"py-4 text-sm text-gray-900 dark:text-white",children:e.description||"Subscription payment"}),d.jsx("td",{className:"py-4 text-sm text-gray-900 dark:text-white",children:(t=e.amount,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t))}),d.jsx("td",{className:"py-4",children:d.jsx("span",{className:"text-xs px-2 py-1 rounded-full "+("paid"===e.status?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200"),children:e.status})}),d.jsx("td",{className:"py-4 text-right",children:e.invoicePdf&&d.jsx("a",{href:e.invoicePdf,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300",children:d.jsx(j,{size:16})})})]},e.id);var t})})]})})]}),N&&d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl w-full max-w-md p-6",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Cancel Subscription"}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Are you sure you want to cancel your subscription? You'll continue to have access until the end of your current billing period."}),d.jsxs("div",{className:"flex justify-end gap-3",children:[d.jsx("button",{onClick:()=>f(!1),disabled:w,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white disabled:opacity-50",children:"Keep Subscription"}),d.jsx("button",{onClick:async()=>{if(t){S(!0);try{await l.cancelSubscription(t.stripeSubscriptionId,!0),await C(),f(!1)}catch(e){console.error("Error canceling subscription:",e),m("Failed to cancel subscription")}finally{S(!1)}}},disabled:w,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 flex items-center gap-2",children:w?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Canceling..."]}):"Cancel Subscription"})]})]})})]})}function r({onSync:e}){const{getToken:t}=N(),[r,s]=P.useState(!1),[a,i]=P.useState("");return d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsxs("button",{onClick:async()=>{s(!0),i("");try{const r=await t();if(!r)return void i("Not authenticated");const s=await fetch("http://localhost:3000/api/subscriptions/sync",{headers:{Authorization:`Bearer ${r}`}}),a=await s.json();a.success?(a.subscription?i(`\u2713 Synced: ${a.subscription.planType} (${a.subscription.status})`):i("No active subscription found"),e&&setTimeout(e,500)):i(`Error: ${a.error||"Sync failed"}`)}catch(r){console.error("Sync error:",r),i("Failed to sync subscription")}finally{s(!1)}},disabled:r,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[d.jsx(f,{size:16,className:r?"animate-spin":""}),r?"Syncing...":"Sync Subscription"]}),a&&d.jsx("span",{className:"text-sm "+(a.includes("Error")?"text-red-600":"text-green-600"),children:a})]})}function s(){const{getToken:e}=N(),[t,r]=P.useState(!1),[s,a]=P.useState(null),[i,n]=P.useState("");return d.jsxs("div",{className:"p-4 bg-white dark:bg-gray-800 rounded-lg shadow",children:[d.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Stripe Subscription Status"}),d.jsx("button",{onClick:async()=>{r(!0),n(""),a(null);try{const t=await e();if(!t)return void n("Not authenticated");const r=await fetch("http://localhost:3000/api/subscriptions/stripe-status",{headers:{Authorization:`Bearer ${t}`}}),s=await r.json();s.success?a(s):n(s.error||"Failed to check status")}catch(t){console.error("Status check error:",t),n("Failed to check subscription status")}finally{r(!1)}},disabled:t,className:"mb-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:t?"Checking...":"Check Stripe Status"}),i&&d.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg mb-4",children:d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(k,{size:16,className:"text-red-600 dark:text-red-400"}),d.jsx("span",{className:"text-red-800 dark:text-red-200",children:i})]})}),s&&d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(b,{size:16,className:"text-green-600 dark:text-green-400"}),d.jsx("span",{className:"font-medium",children:"Status Retrieved Successfully"})]}),s.hasSubscription?d.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg space-y-2",children:[d.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Plan:"}),d.jsx("span",{className:"ml-2 font-medium text-gray-900 dark:text-white capitalize",children:s.tier})]}),d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Status:"}),d.jsx("span",{className:"ml-2 font-medium capitalize "+("trialing"===s.status?"text-blue-600":"active"===s.status?"text-green-600":"canceled"===s.status?"text-red-600":"text-gray-600"),children:s.status})]})]}),s.subscription&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"text-sm",children:[d.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Customer ID:"}),d.jsx("span",{className:"ml-2 font-mono text-xs",children:s.subscription.customerId})]}),s.subscription.trialEnd&&d.jsxs("div",{className:"text-sm",children:[d.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Trial Ends:"}),d.jsx("span",{className:"ml-2",children:new Date(s.subscription.trialEnd).toLocaleDateString()})]}),d.jsxs("div",{className:"text-sm",children:[d.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Current Period Ends:"}),d.jsx("span",{className:"ml-2",children:new Date(s.subscription.currentPeriodEnd).toLocaleDateString()})]}),d.jsxs("div",{className:"text-sm",children:[d.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Amount:"}),d.jsxs("span",{className:"ml-2",children:["\xa3",(s.subscription.priceAmount/100).toFixed(2),"/",s.subscription.currency.toUpperCase()]})]})]})]}):d.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[d.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No active subscription found"}),d.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-500 mt-1",children:s.message})]})]})]})}function a({defaultView:a="plans",className:i=""}){const{isSignedIn:c}=n(),{session:o}=v(),[x,m]=P.useState(a),[g,u]=P.useState(null),[h,p]=P.useState(null),[y,j]=P.useState(!0),[N,f]=P.useState(null);P.useState(l.getStripe()),P.useEffect(()=>{(async()=>{if(c&&o)try{const e=await o.getToken();e?k(e):j(!1)}catch(e){console.error("Error getting auth token:",e),j(!1)}else j(!1)})()},[c,o]);const k=async e=>{j(!0),f(null);try{if(!e)return console.warn("No auth token available"),void j(!1);const t=await l.getCurrentSubscription(e);p(t),t&&"plans"===a&&m("billing")}catch(t){console.error("Error loading subscription:",t),f("Failed to load subscription information")}finally{j(!1)}},S=async e=>{if(u(e),"free"!==e.tier)try{if(!o)return void f("Authentication required. Please sign in again.");j(!0);const t=await o.getToken();if(!t)return f("Failed to get authentication token"),void j(!1);const{url:r}=await l.createCheckoutSession(e.tier,t);r?window.location.href=r:f("Failed to create checkout session")}catch(t){console.error("Error creating checkout:",t),f("Failed to start checkout process")}finally{j(!1)}else if(h)try{f("Downgrade functionality coming soon")}catch(t){console.error("Error downgrading to free:",t),f("Failed to downgrade subscription")}},C=()=>{m("plans"),u(null),f(null)},z=()=>{m("billing"),u(null)},E=()=>h?h.tier:"free";return c?y?d.jsx("div",{className:`flex items-center justify-center py-12 ${i}`,children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-8 h-8 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading subscription information..."})]})}):d.jsx("div",{className:`min-h-screen bg-gray-50 dark:bg-gray-900 ${i}`,children:d.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(()=>{const e={plans:"Choose Your Plan",payment:`Upgrade to ${g?.name}`,billing:"Billing & Subscription",success:"Welcome to Premium!"};return d.jsxs("div",{className:"mb-8",children:[("payment"===x||"success"===x)&&d.jsxs("button",{onClick:C,className:"flex items-center gap-2 text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 mb-4",children:[d.jsx(w,{size:16}),"Back to Plans"]}),d.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:e[x]}),"billing"===x&&d.jsxs("div",{className:"flex items-center justify-between mt-4",children:[d.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["Current plan: ",d.jsx("span",{className:"font-medium",children:E()})]}),d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx(r,{onSync:()=>{o&&o.getToken().then(e=>{e&&k(e)})}}),d.jsx("button",{onClick:()=>m("plans"),className:"text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300",children:"Change Plan"})]})]})]})})(),N&&d.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-6",children:[d.jsx("p",{className:"text-red-800 dark:text-red-200",children:N}),d.jsx("button",{onClick:()=>f(null),className:"text-red-600 dark:text-red-400 underline text-sm mt-1 hover:no-underline",children:"Dismiss"})]}),(()=>{switch(x){case"plans":return d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"mb-6 flex justify-end",children:d.jsx(r,{onSync:()=>{o&&o.getToken().then(e=>{e&&k(e)})}})}),d.jsx(e,{currentTier:E(),onSelectPlan:S,showFreePlan:!0})]});case"payment":return m("plans"),null;case"billing":return d.jsxs("div",{className:"space-y-6",children:[d.jsx(s,{}),d.jsx(t,{})]});case"success":return d.jsxs("div",{className:"max-w-2xl mx-auto text-center py-12",children:[d.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx(b,{size:32,className:"text-green-600"})}),d.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Subscription Activated!"}),d.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:["Welcome to ",g?.name||"Premium","! Your subscription is now active and you have access to all premium features. You're currently in your 14-day free trial period."]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-8",children:[d.jsx("button",{onClick:()=>window.location.href="/dashboard",className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Go to Dashboard"}),d.jsx("button",{onClick:z,className:"px-6 py-3 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:"Manage Billing"})]}),d.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-xl p-6",children:[d.jsx("h3",{className:"text-lg font-semibold text-blue-900 dark:text-blue-300 mb-4",children:"What's Next?"}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[d.jsxs("div",{className:"flex items-center gap-2 text-blue-800 dark:text-blue-200",children:[d.jsx(b,{size:16}),d.jsx("span",{children:"Unlimited accounts & transactions"})]}),d.jsxs("div",{className:"flex items-center gap-2 text-blue-800 dark:text-blue-200",children:[d.jsx(b,{size:16}),d.jsx("span",{children:"Advanced analytics & reports"})]}),d.jsxs("div",{className:"flex items-center gap-2 text-blue-800 dark:text-blue-200",children:[d.jsx(b,{size:16}),d.jsx("span",{children:"CSV export functionality"})]}),d.jsxs("div",{className:"flex items-center gap-2 text-blue-800 dark:text-blue-200",children:[d.jsx(b,{size:16}),d.jsx("span",{children:"Investment portfolio tracking"})]})]})]})]});default:return d.jsx(e,{currentTier:E(),onSelectPlan:S})}})()]})}):d.jsx("div",{className:`text-center py-12 ${i}`,children:d.jsxs("div",{className:"max-w-md mx-auto",children:[d.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Sign In Required"}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Please sign in to manage your subscription and access premium features."}),d.jsx("button",{onClick:()=>window.location.href="/sign-in",className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Sign In"})]})})}function i(){return d.jsx(S,{title:"Subscription",description:"Manage your WealthTracker subscription",children:d.jsx(a,{})})}import{cb as n,cc as l,j as d,c7 as c,_ as o,I as x,aA as m,aV as g,N as u,br as h,O as b,Q as p,aF as y,aS as j,b as N,at as f,ar as k,cd as v,aj as w}from"./index-CgJz7Gw0.js";import{P as S}from"./chunk-DLeAFLQD.js";import{a as P}from"./chunk-BWx9oMeS.js";import"./chunk-BN8kgYrt.js";import"./chunk-C1eKK5Oc.js";export{i as default};
